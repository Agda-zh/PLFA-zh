<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="../assets/css/light.css" integrity="sha512-MkpYfmkWIfATGEd6NpDhZJQB2nIkJDL4/+fTWrR8KGUYK4WpHdNkNtsOewHrkVqI4K1SrtjK7aC/fwQljbifBA==" title="Light" id="stylesheet-light"><link rel="alternate stylesheet" href="../assets/css/dark.css" integrity="sha512-T2Tad3PSo5pIHyLVaV57XanuJRwSgTPT+WVb96FUf6y0ZJIXP4d/lNPJUqbUZ3j0Nq/gej2yteryEz/Hkr2Cdg==" title="Dark" id="stylesheet-dark" disabled><title>Programming Language Foundations in Agda – Bisimulation</title><script src="../assets/js/anchor.js" integrity="sha512-Y5IMGqYQp36NYYdEL6gXISLsHNpx0LxW0NS0twvYBvXI8GH5PZa1g5gm1B5lxg6tlFyUAiOOfgKL/NIn0dtY4w==" id="script-anchor"></script><script src="../assets/js/darkmode.js" integrity="sha512-iUX9HnSphH4WbMv88MYJEFtLfkCtTHrvWyFwjigSm5GkwHv1L31GP5grIGDo7kI2jftuYVvt4xu4qeCn2fKbww==" id="script-darkmode"></script><script src="../assets/js/main.js" integrity="sha512-X7aZg6IUKq1TvTVjSureaMGKZ/ylbAD7kxiU2w42IUgh4lUTWoOsoIWzNvrqkwBJdQ1y2GsS67gtsv39Uuq6ew==" id="script-main"></script></head><body><header class="site-header"><div class="wrapper"><a class="site-title" href="../">Programming Language Foundations in Agda</a><nav class="site-nav"><input type="checkbox" id="nav-trigger" class="nav-trigger"><label for="nav-trigger"><span class="menu-icon"><svg class="svg-icon grey" viewBox="0 0 18 15" width="18px" height="15px"><path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"></path><path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"></path><path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"></path></svg></span></label><div class="trigger"><a class="page-link" href="../">The Book</a> <a class="page-link" href="../Announcements/">Announcements</a> <a class="page-link" href="../GettingStarted/">Getting Started</a> <a class="page-link" href="../Citing/">Citing</a> <a class="page-link" href="https://agda-zh.github.io/PLFA-zh/">中文</a> <a class="page-link" onclick="window.darkmode.toggle()"><i id="darkmode-trigger" class="fas fa-moon"></i></a></div></nav></div></header><main class="page-content" aria-label="Content"><div class="wrapper"><article class="post"><nav class="pager"><ul class="pagination"><li><a class="pagelink" href="../More/">Prev</a></li><li class="separator">•</li><li><a class="pagelink" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/part2/Bisimulation.lagda.md">Source</a></li><li class="separator">•</li><li><a class="pagelink" href="../Inference/">Next</a></li><li class="separator">•</li></ul></nav><header class="post-header"><h1 class="post-title">Bisimulation: Relating reduction systems</h1></header><div class="post-content"><pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-100" class="Keyword">module</a> <a id="plfa_plfa-part2-Bisimulation-107" href="../Bisimulation/#" class="Module">plfa.part2.Bisimulation</a> <a id="plfa_plfa-part2-Bisimulation-131" class="Keyword">where</a>
</pre><p>Some constructs can be defined in terms of other constructs. In the previous chapter, we saw how <em>let</em> terms can be rewritten as an application of an abstraction, and how two alternative formulations of products — one with projections and one with case — can be formulated in terms of each other. In this chapter, we look at how to formalise such claims.</p><p>Given two different systems, with different terms and reduction rules, we define what it means to claim that one <em>simulates</em> the other. Let’s call our two systems <em>source</em> and <em>target</em>. Let <code>M</code>, <code>N</code> range over terms of the source, and <code>M†</code>, <code>N†</code> range over terms of the target. We define a relation</p><pre><code>M ~ M†</code></pre><p>between corresponding terms of the two systems. We have a <em>simulation</em> of the source by the target if every reduction in the source has a corresponding reduction sequence in the target:</p><p><em>Simulation</em>: For every <code>M</code>, <code>M†</code>, and <code>N</code>: If <code>M ~ M†</code> and <code>M —→ N</code> then <code>M† —↠ N†</code> and <code>N ~ N†</code> for some <code>N†</code>.</p><p>Or, in a diagram:</p><pre><code>M  --- —→ --- N
|             |
|             |
~             ~
|             |
|             |
M† --- —↠ --- N†</code></pre><p>Sometimes we will have a stronger condition, where each reduction in the source corresponds to a reduction (rather than a reduction sequence) in the target:</p><pre><code>M  --- —→ --- N
|             |
|             |
~             ~
|             |
|             |
M† --- —→ --- N†</code></pre><p>This stronger condition is known as <em>lock-step</em> or <em>on the nose</em> simulation.</p><p>We are particularly interested in the situation where there is also a simulation from the target to the source: every reduction in the target has a corresponding reduction sequence in the source. This situation is called a <em>bisimulation</em>.</p><p>Simulation is established by case analysis over all possible reductions and all possible terms to which they are related. For each reduction step in the source we must show a corresponding reduction sequence in the target.</p><p>For instance, the source might be lambda calculus with <em>let</em> added, and the target the same system with <code>let</code> translated out. The key rule defining our relation will be:</p><pre><code>M ~ M†
N ~ N†
--------------------------------
let x = M in N ~ (ƛ x ⇒ N†) · M†</code></pre><p>All the other rules are congruences: variables relate to themselves, and abstractions and applications relate if their components relate:</p><pre><code>-----
x ~ x

N ~ N†
------------------
ƛ x ⇒ N ~ ƛ x ⇒ N†

L ~ L†
M ~ M†
---------------
L · M ~ L† · M†</code></pre><p>Covering the other constructs of our language — naturals, fixpoints, products, and so on — would add little save length.</p><p>In this case, our relation can be specified by a function from source to target:</p><pre><code>(x) †               =  x
(ƛ x ⇒ N) †         =  ƛ x ⇒ (N †)
(L · M) †           =  (L †) · (M †)
(let x = M in N) †  =  (ƛ x ⇒ (N †)) · (M †)</code></pre><p>And we have</p><pre><code>M † ≡ N
-------
M ~ N</code></pre><p>and conversely. But in general we may have a relation without any corresponding function.</p><p>This chapter formalises establishing that <code>~</code> as defined above is a simulation from source to target. We leave establishing it in the reverse direction as an exercise. Another exercise is to show the alternative formulations of products in Chapter <a href="../More/">More</a> are in bisimulation.</p><h2 id="imports">Imports</h2>We import our source language from Chapter <a href="../More/">More</a>:<pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-3537" class="Keyword">open</a> <a id="plfa_plfa-part2-Bisimulation-3542" class="Keyword">import</a> <a id="plfa_plfa-part2-Bisimulation-3549" href="../More/#" class="Module">plfa.part2.More</a>
</pre><h2 id="simulation">Simulation</h2>The simulation is a straightforward formalisation of the rules in the introduction:<pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-3678" class="Keyword">infix</a>  <a id="plfa_plfa-part2-Bisimulation-3685" class="Number">4</a> <a id="plfa_plfa-part2-Bisimulation-3687" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">_~_</a>
<a id="plfa_plfa-part2-Bisimulation-3691" class="Keyword">infix</a>  <a id="plfa_plfa-part2-Bisimulation-3698" class="Number">5</a> <a id="plfa_plfa-part2-Bisimulation-3700" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3831" class="InductiveConstructor Operator">~ƛ_</a>
<a id="plfa_plfa-part2-Bisimulation-3704" class="Keyword">infix</a>  <a id="plfa_plfa-part2-Bisimulation-3711" class="Number">7</a> <a id="plfa_plfa-part2-Bisimulation-3713" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3916" class="InductiveConstructor Operator">_~·_</a>

<a id="plfa_plfa-part2-Bisimulation-3719" class="Keyword">data</a> <a id="plfa_plfa-part2-Bisimulation-_~_"></a><a id="plfa_plfa-part2-Bisimulation-3724" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">_~_</a> <a id="plfa_plfa-part2-Bisimulation-3728" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-3730" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-3732" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-3733" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3733" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-3735" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3735" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-3736" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-3738" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-3740" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-3741" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3733" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-3743" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-3745" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3735" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-3746" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-3748" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-3750" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-3751" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3733" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-3753" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-3755" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3735" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-3756" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-3758" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-3760" href="https://agda.github.io/agda-stdlib/v1.7.1/Agda.Primitive.html#326" class="Primitive">Set</a> <a id="plfa_plfa-part2-Bisimulation-3764" class="Keyword">where</a>

  <a id="plfa_plfa-part2-Bisimulation-_~_.~`"></a><a id="plfa_plfa-part2-Bisimulation-3773" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3773" class="InductiveConstructor">~`</a> <a id="plfa_plfa-part2-Bisimulation-3776" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-3778" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-3780" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-3781" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3781" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-3783" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3783" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-3784" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-3786" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-3787" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3787" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-3789" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-3791" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3781" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-3793" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-3795" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3783" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-3796" class="Symbol">}</a>
     <a id="plfa_plfa-part2-Bisimulation-3803" class="Comment">---------</a>
   <a id="plfa_plfa-part2-Bisimulation-3816" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-3818" href="../More/#plfa_plfa-part2-More-15002" class="InductiveConstructor Operator">`</a> <a id="plfa_plfa-part2-Bisimulation-3820" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3787" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-3822" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-3824" href="../More/#plfa_plfa-part2-More-15002" class="InductiveConstructor Operator">`</a> <a id="plfa_plfa-part2-Bisimulation-3826" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3787" class="Bound">x</a>

  <a id="plfa_plfa-part2-Bisimulation-_~_.~ƛ_"></a><a id="plfa_plfa-part2-Bisimulation-3831" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3831" class="InductiveConstructor Operator">~ƛ_</a> <a id="plfa_plfa-part2-Bisimulation-3835" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-3837" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-3839" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-3840" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3840" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-3842" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3842" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-3844" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3844" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-3845" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-3847" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-3848" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3848" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-3850" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3850" class="Bound">N†</a> <a id="plfa_plfa-part2-Bisimulation-3853" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-3855" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3840" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-3857" href="../More/#plfa_plfa-part2-More-14667" class="InductiveConstructor Operator">,</a> <a id="plfa_plfa-part2-Bisimulation-3859" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3842" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-3861" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-3863" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3844" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-3864" class="Symbol">}</a>
    <a id="plfa_plfa-part2-Bisimulation-3870" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-3872" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3848" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-3874" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-3876" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3850" class="Bound">N†</a>
      <a id="plfa_plfa-part2-Bisimulation-3885" class="Comment">----------</a>
    <a id="plfa_plfa-part2-Bisimulation-3900" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-3902" href="../More/#plfa_plfa-part2-More-15070" class="InductiveConstructor Operator">ƛ</a> <a id="plfa_plfa-part2-Bisimulation-3904" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3848" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-3906" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-3908" href="../More/#plfa_plfa-part2-More-15070" class="InductiveConstructor Operator">ƛ</a> <a id="plfa_plfa-part2-Bisimulation-3910" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3850" class="Bound">N†</a>

  <a id="plfa_plfa-part2-Bisimulation-_~_._~·_"></a><a id="plfa_plfa-part2-Bisimulation-3916" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3916" class="InductiveConstructor Operator">_~·_</a> <a id="plfa_plfa-part2-Bisimulation-3921" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-3923" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-3925" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-3926" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3926" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-3928" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3928" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-3930" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3930" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-3931" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-3933" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-3934" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3934" class="Bound">L</a> <a id="plfa_plfa-part2-Bisimulation-3936" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3936" class="Bound">L†</a> <a id="plfa_plfa-part2-Bisimulation-3939" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-3941" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3926" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-3943" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-3945" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3928" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-3947" href="../More/#plfa_plfa-part2-More-14526" class="InductiveConstructor Operator">⇒</a> <a id="plfa_plfa-part2-Bisimulation-3949" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3930" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-3950" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-3952" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-3953" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3953" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-3955" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3955" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-3958" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-3960" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3926" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-3962" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-3964" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3928" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-3965" class="Symbol">}</a>
    <a id="plfa_plfa-part2-Bisimulation-3971" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-3973" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3934" class="Bound">L</a> <a id="plfa_plfa-part2-Bisimulation-3975" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-3977" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3936" class="Bound">L†</a>
    <a id="plfa_plfa-part2-Bisimulation-3984" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-3986" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3953" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-3988" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-3990" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3955" class="Bound">M†</a>
      <a id="plfa_plfa-part2-Bisimulation-3999" class="Comment">---------------</a>
    <a id="plfa_plfa-part2-Bisimulation-4019" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-4021" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3934" class="Bound">L</a> <a id="plfa_plfa-part2-Bisimulation-4023" href="../More/#plfa_plfa-part2-More-15138" class="InductiveConstructor Operator">·</a> <a id="plfa_plfa-part2-Bisimulation-4025" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3953" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-4027" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-4029" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3936" class="Bound">L†</a> <a id="plfa_plfa-part2-Bisimulation-4032" href="../More/#plfa_plfa-part2-More-15138" class="InductiveConstructor Operator">·</a> <a id="plfa_plfa-part2-Bisimulation-4034" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3955" class="Bound">M†</a>

  <a id="plfa_plfa-part2-Bisimulation-_~_.~let"></a><a id="plfa_plfa-part2-Bisimulation-4040" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4040" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-4045" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-4047" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-4049" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-4050" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4050" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-4052" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4052" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-4054" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4054" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-4055" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-4057" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-4058" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4058" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-4060" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4060" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-4063" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-4065" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4050" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-4067" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-4069" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4052" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-4070" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-4072" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-4073" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4073" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-4075" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4075" class="Bound">N†</a> <a id="plfa_plfa-part2-Bisimulation-4078" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-4080" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4050" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-4082" href="../More/#plfa_plfa-part2-More-14667" class="InductiveConstructor Operator">,</a> <a id="plfa_plfa-part2-Bisimulation-4084" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4052" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-4086" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-4088" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4054" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-4089" class="Symbol">}</a>
    <a id="plfa_plfa-part2-Bisimulation-4095" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-4097" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4058" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-4099" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-4101" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4060" class="Bound">M†</a>
    <a id="plfa_plfa-part2-Bisimulation-4108" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-4110" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4073" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-4112" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-4114" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4075" class="Bound">N†</a>
      <a id="plfa_plfa-part2-Bisimulation-4123" class="Comment">----------------------</a>
    <a id="plfa_plfa-part2-Bisimulation-4150" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-4152" href="../More/#plfa_plfa-part2-More-15644" class="InductiveConstructor">`let</a> <a id="plfa_plfa-part2-Bisimulation-4157" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4058" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-4159" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4073" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-4161" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-4163" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-4164" href="../More/#plfa_plfa-part2-More-15070" class="InductiveConstructor Operator">ƛ</a> <a id="plfa_plfa-part2-Bisimulation-4166" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4075" class="Bound">N†</a><a id="plfa_plfa-part2-Bisimulation-4168" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-4170" href="../More/#plfa_plfa-part2-More-15138" class="InductiveConstructor Operator">·</a> <a id="plfa_plfa-part2-Bisimulation-4172" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4060" class="Bound">M†</a>
</pre><p>The language in Chapter <a href="../More/">More</a> has more constructs, which we could easily add. However, leaving the simulation small lets us focus on the essence. It’s a handy technical trick that we can have a large source language, but only bother to include in the simulation the terms of interest.</p><h4 id="exercise-_-practice">Exercise <code>_†</code> (practice)</h4><p>Formalise the translation from source to target given in the introduction. Show that <code>M † ≡ N</code> implies <code>M ~ N</code>, and conversely.</p><p><strong>Hint:</strong> For simplicity, we focus on only a few constructs of the language, so <code>_†</code> should be defined only on relevant terms. One way to do this is to use a decidable predicate to pick out terms in the domain of <code>_†</code>, using <a href="../Decidable/#proof-by-reflection">proof by reflection</a>.</p><pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-4924" class="Comment">-- Your code goes here</a>
</pre><h2 id="simulation-commutes-with-values">Simulation commutes with values</h2>We need a number of technical results. The first is that simulation commutes with values. That is, if <code>M ~ M†</code> and <code>M</code> is a value then <code>M†</code> is also a value:<pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-~val"></a><a id="plfa_plfa-part2-Bisimulation-5155" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5155" class="Function">~val</a> <a id="plfa_plfa-part2-Bisimulation-5160" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-5162" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-5164" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-5165" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5165" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-5167" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5167" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-5168" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-5170" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-5171" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5171" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-5173" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5173" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-5176" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-5178" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5165" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-5180" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-5182" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5167" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-5183" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-5187" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-5189" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5171" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-5191" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-5193" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5173" class="Bound">M†</a>
  <a id="plfa_plfa-part2-Bisimulation-5198" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-5200" href="../More/#plfa_plfa-part2-More-19171" class="Datatype">Value</a> <a id="plfa_plfa-part2-Bisimulation-5206" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5171" class="Bound">M</a>
    <a id="plfa_plfa-part2-Bisimulation-5212" class="Comment">--------</a>
  <a id="plfa_plfa-part2-Bisimulation-5223" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-5225" href="../More/#plfa_plfa-part2-More-19171" class="Datatype">Value</a> <a id="plfa_plfa-part2-Bisimulation-5231" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5173" class="Bound">M†</a>
<a id="plfa_plfa-part2-Bisimulation-5234" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5155" class="Function">~val</a> <a id="plfa_plfa-part2-Bisimulation-5239" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3773" class="InductiveConstructor">~`</a>           <a id="plfa_plfa-part2-Bisimulation-5252" class="Symbol">()</a>
<a id="plfa_plfa-part2-Bisimulation-5255" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5155" class="Function">~val</a> <a id="plfa_plfa-part2-Bisimulation-5260" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-5261" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3831" class="InductiveConstructor Operator">~ƛ</a> <a id="plfa_plfa-part2-Bisimulation-5264" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5264" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-5266" class="Symbol">)</a>      <a id="plfa_plfa-part2-Bisimulation-5273" href="../More/#plfa_plfa-part2-More-19226" class="InductiveConstructor">V-ƛ</a>  <a id="plfa_plfa-part2-Bisimulation-5278" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-5281" href="../More/#plfa_plfa-part2-More-19226" class="InductiveConstructor">V-ƛ</a>
<a id="plfa_plfa-part2-Bisimulation-5285" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5155" class="Function">~val</a> <a id="plfa_plfa-part2-Bisimulation-5290" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-5291" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5291" class="Bound">~L</a> <a id="plfa_plfa-part2-Bisimulation-5294" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3916" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-5297" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5297" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-5299" class="Symbol">)</a>   <a id="plfa_plfa-part2-Bisimulation-5303" class="Symbol">()</a>
<a id="plfa_plfa-part2-Bisimulation-5306" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5155" class="Function">~val</a> <a id="plfa_plfa-part2-Bisimulation-5311" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-5312" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4040" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-5317" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5317" class="Bound">~M</a> <a id="plfa_plfa-part2-Bisimulation-5320" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5320" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-5322" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-5324" class="Symbol">()</a>
</pre><p>It is a straightforward case analysis, where here the only value of interest is a lambda abstraction.</p><h4 id="exercise-val¹-practice">Exercise <code>~val⁻¹</code> (practice)</h4><p>Show that this also holds in the reverse direction: if <code>M ~ M†</code> and <code>Value M†</code> then <code>Value M</code>.</p><pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-5573" class="Comment">-- Your code goes here</a>
</pre><h2 id="simulation-commutes-with-renaming">Simulation commutes with renaming</h2><p>The next technical result is that simulation commutes with renaming. That is, if <code>ρ</code> maps any judgment <code>Γ ∋ A</code> to a judgment <code>Δ ∋ A</code>, and if <code>M ~ M†</code> then <code>rename ρ M ~ rename ρ M†</code>:</p><pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-~rename"></a><a id="plfa_plfa-part2-Bisimulation-5832" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5832" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-5840" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-5842" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-5844" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-5845" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5845" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-5847" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5847" class="Bound">Δ</a><a id="plfa_plfa-part2-Bisimulation-5848" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-5852" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-5854" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-5855" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5855" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-5857" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-5859" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-5861" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-5862" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5862" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-5863" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-5865" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-5867" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5845" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-5869" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-5871" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5862" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-5873" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-5875" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5847" class="Bound">Δ</a> <a id="plfa_plfa-part2-Bisimulation-5877" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-5879" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5862" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-5880" class="Symbol">)</a>
    <a id="plfa_plfa-part2-Bisimulation-5886" class="Comment">----------------------------------------------------------</a>
  <a id="plfa_plfa-part2-Bisimulation-5947" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-5949" class="Symbol">(∀</a> <a id="plfa_plfa-part2-Bisimulation-5952" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-5953" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5953" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-5954" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-5956" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-5957" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5957" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-5959" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5959" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-5962" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-5964" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5845" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-5966" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-5968" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5953" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-5969" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-5971" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-5973" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5957" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-5975" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-5977" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5959" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-5980" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-5982" href="../More/#plfa_plfa-part2-More-16887" class="Function">rename</a> <a id="plfa_plfa-part2-Bisimulation-5989" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5855" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-5991" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5957" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-5993" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-5995" href="../More/#plfa_plfa-part2-More-16887" class="Function">rename</a> <a id="plfa_plfa-part2-Bisimulation-6002" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5855" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6004" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5959" class="Bound">M†</a><a id="plfa_plfa-part2-Bisimulation-6006" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-6008" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5832" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6016" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6016" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6018" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6019" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3773" class="InductiveConstructor">~`</a><a id="plfa_plfa-part2-Bisimulation-6021" class="Symbol">)</a>          <a id="plfa_plfa-part2-Bisimulation-6032" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-6035" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3773" class="InductiveConstructor">~`</a>
<a id="plfa_plfa-part2-Bisimulation-6038" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5832" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6046" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6046" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6048" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6049" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3831" class="InductiveConstructor Operator">~ƛ</a> <a id="plfa_plfa-part2-Bisimulation-6052" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6052" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-6054" class="Symbol">)</a>       <a id="plfa_plfa-part2-Bisimulation-6062" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-6065" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3831" class="InductiveConstructor Operator">~ƛ</a> <a id="plfa_plfa-part2-Bisimulation-6068" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6069" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5832" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6077" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6078" href="../More/#plfa_plfa-part2-More-16716" class="Function">ext</a> <a id="plfa_plfa-part2-Bisimulation-6082" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6046" class="Bound">ρ</a><a id="plfa_plfa-part2-Bisimulation-6083" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-6085" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6052" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-6087" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-6089" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5832" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6097" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6097" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6099" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6100" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6100" class="Bound">~L</a> <a id="plfa_plfa-part2-Bisimulation-6103" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3916" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-6106" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6106" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-6108" class="Symbol">)</a>    <a id="plfa_plfa-part2-Bisimulation-6113" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-6116" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6117" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5832" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6125" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6097" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6127" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6100" class="Bound">~L</a><a id="plfa_plfa-part2-Bisimulation-6129" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-6131" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3916" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-6134" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6135" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5832" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6143" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6097" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6145" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6106" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-6147" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-6149" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5832" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6157" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6157" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6159" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6160" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4040" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-6165" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6165" class="Bound">~M</a> <a id="plfa_plfa-part2-Bisimulation-6168" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6168" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-6170" class="Symbol">)</a>  <a id="plfa_plfa-part2-Bisimulation-6173" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-6176" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4040" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-6181" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6182" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5832" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6190" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6157" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6192" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6165" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-6194" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-6196" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6197" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5832" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6205" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6206" href="../More/#plfa_plfa-part2-More-16716" class="Function">ext</a> <a id="plfa_plfa-part2-Bisimulation-6210" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6157" class="Bound">ρ</a><a id="plfa_plfa-part2-Bisimulation-6211" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-6213" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6168" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-6215" class="Symbol">)</a>
</pre><p>The structure of the proof is similar to the structure of renaming itself: reconstruct each term with recursive invocation, extending the environment where appropriate (in this case, only for the body of an abstraction).</p><h2 id="simulation-commutes-with-substitution">Simulation commutes with substitution</h2><p>The third technical result is that simulation commutes with substitution. It is more complex than renaming, because where we had one renaming map <code>ρ</code> here we need two substitution maps, <code>σ</code> and <code>σ†</code>.</p>The proof first requires we establish an analogue of extension. If <code>σ</code> and <code>σ†</code> both map any judgment <code>Γ ∋ A</code> to a judgment <code>Δ ⊢ A</code>, such that for every <code>x</code> in <code>Γ ∋ A</code> we have <code>σ x ~ σ† x</code>, then for any <code>x</code> in <code>Γ , B ∋ A</code> we have <code>exts σ x ~ exts σ† x</code>:<pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-~exts"></a><a id="plfa_plfa-part2-Bisimulation-6949" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6949" class="Function">~exts</a> <a id="plfa_plfa-part2-Bisimulation-6955" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-6957" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-6959" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-6960" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6960" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-6962" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6962" class="Bound">Δ</a><a id="plfa_plfa-part2-Bisimulation-6963" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-6967" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-6969" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-6970" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6970" class="Bound">σ</a>  <a id="plfa_plfa-part2-Bisimulation-6973" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-6975" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-6977" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-6978" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6978" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-6979" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-6981" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-6983" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6960" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-6985" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-6987" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6978" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-6989" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-6991" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6962" class="Bound">Δ</a> <a id="plfa_plfa-part2-Bisimulation-6993" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-6995" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6978" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-6996" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-7000" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7002" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7003" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7003" class="Bound">σ†</a> <a id="plfa_plfa-part2-Bisimulation-7006" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-7008" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-7010" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7011" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7011" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7012" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-7014" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7016" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6960" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-7018" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-7020" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7011" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-7022" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7024" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6962" class="Bound">Δ</a> <a id="plfa_plfa-part2-Bisimulation-7026" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-7028" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7011" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7029" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-7033" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7035" class="Symbol">(∀</a> <a id="plfa_plfa-part2-Bisimulation-7038" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7039" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7039" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7040" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-7042" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7044" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-7045" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7045" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-7047" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-7049" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6960" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-7051" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-7053" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7039" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7054" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-7056" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7058" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6970" class="Bound">σ</a> <a id="plfa_plfa-part2-Bisimulation-7060" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7045" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-7062" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-7064" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7003" class="Bound">σ†</a> <a id="plfa_plfa-part2-Bisimulation-7067" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7045" class="Bound">x</a><a id="plfa_plfa-part2-Bisimulation-7068" class="Symbol">)</a>
    <a id="plfa_plfa-part2-Bisimulation-7074" class="Comment">--------------------------------------------------</a>
  <a id="plfa_plfa-part2-Bisimulation-7127" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7129" class="Symbol">(∀</a> <a id="plfa_plfa-part2-Bisimulation-7132" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7133" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7133" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-7135" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7135" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-7136" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-7138" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7140" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-7141" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7141" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-7143" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-7145" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6960" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-7147" href="../More/#plfa_plfa-part2-More-14667" class="InductiveConstructor Operator">,</a> <a id="plfa_plfa-part2-Bisimulation-7149" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7135" class="Bound">B</a> <a id="plfa_plfa-part2-Bisimulation-7151" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-7153" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7133" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7154" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-7156" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7158" href="../More/#plfa_plfa-part2-More-17742" class="Function">exts</a> <a id="plfa_plfa-part2-Bisimulation-7163" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6970" class="Bound">σ</a> <a id="plfa_plfa-part2-Bisimulation-7165" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7141" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-7167" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-7169" href="../More/#plfa_plfa-part2-More-17742" class="Function">exts</a> <a id="plfa_plfa-part2-Bisimulation-7174" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7003" class="Bound">σ†</a> <a id="plfa_plfa-part2-Bisimulation-7177" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7141" class="Bound">x</a><a id="plfa_plfa-part2-Bisimulation-7178" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-7180" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6949" class="Function">~exts</a> <a id="plfa_plfa-part2-Bisimulation-7186" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7186" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-7189" href="../More/#plfa_plfa-part2-More-14791" class="InductiveConstructor">Z</a>      <a id="plfa_plfa-part2-Bisimulation-7196" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-7199" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3773" class="InductiveConstructor">~`</a>
<a id="plfa_plfa-part2-Bisimulation-7202" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6949" class="Function">~exts</a> <a id="plfa_plfa-part2-Bisimulation-7208" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7208" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-7211" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-7212" href="../More/#plfa_plfa-part2-More-14838" class="InductiveConstructor Operator">S</a> <a id="plfa_plfa-part2-Bisimulation-7214" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7214" class="Bound">x</a><a id="plfa_plfa-part2-Bisimulation-7215" class="Symbol">)</a>  <a id="plfa_plfa-part2-Bisimulation-7218" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-7221" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5832" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-7229" href="../More/#plfa_plfa-part2-More-14838" class="InductiveConstructor Operator">S_</a> <a id="plfa_plfa-part2-Bisimulation-7232" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-7233" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7208" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-7236" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7214" class="Bound">x</a><a id="plfa_plfa-part2-Bisimulation-7237" class="Symbol">)</a>
</pre><p>The structure of the proof is similar to the structure of extension itself. The newly introduced variable trivially relates to itself, and otherwise we apply renaming to the hypothesis.</p>With extension under our belts, it is straightforward to show substitution commutes. If <code>σ</code> and <code>σ†</code> both map any judgment <code>Γ ∋ A</code> to a judgment <code>Δ ⊢ A</code>, such that for every <code>x</code> in <code>Γ ∋ A</code> we have <code>σ x ~ σ† x</code>, and if <code>M ~ M†</code>, then <code>subst σ M ~ subst σ† M†</code>:<pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-~subst"></a><a id="plfa_plfa-part2-Bisimulation-7699" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7699" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-7706" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-7708" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-7710" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7711" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7711" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-7713" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7713" class="Bound">Δ</a><a id="plfa_plfa-part2-Bisimulation-7714" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-7718" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7720" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7721" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7721" class="Bound">σ</a>  <a id="plfa_plfa-part2-Bisimulation-7724" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-7726" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-7728" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7729" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7729" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7730" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-7732" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7734" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7711" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-7736" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-7738" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7729" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-7740" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7742" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7713" class="Bound">Δ</a> <a id="plfa_plfa-part2-Bisimulation-7744" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-7746" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7729" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7747" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-7751" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7753" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7754" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7754" class="Bound">σ†</a> <a id="plfa_plfa-part2-Bisimulation-7757" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-7759" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-7761" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7762" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7762" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7763" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-7765" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7767" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7711" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-7769" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-7771" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7762" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-7773" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7775" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7713" class="Bound">Δ</a> <a id="plfa_plfa-part2-Bisimulation-7777" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-7779" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7762" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7780" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-7784" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7786" class="Symbol">(∀</a> <a id="plfa_plfa-part2-Bisimulation-7789" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7790" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7790" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7791" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-7793" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7795" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-7796" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7796" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-7798" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-7800" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7711" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-7802" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-7804" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7790" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7805" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-7807" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7809" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7721" class="Bound">σ</a> <a id="plfa_plfa-part2-Bisimulation-7811" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7796" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-7813" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-7815" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7754" class="Bound">σ†</a> <a id="plfa_plfa-part2-Bisimulation-7818" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7796" class="Bound">x</a><a id="plfa_plfa-part2-Bisimulation-7819" class="Symbol">)</a>
    <a id="plfa_plfa-part2-Bisimulation-7825" class="Comment">---------------------------------------------------------</a>
  <a id="plfa_plfa-part2-Bisimulation-7885" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7887" class="Symbol">(∀</a> <a id="plfa_plfa-part2-Bisimulation-7890" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7891" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7891" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7892" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-7894" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7895" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7895" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-7897" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7897" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-7900" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-7902" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7711" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-7904" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-7906" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7891" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7907" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-7909" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7911" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7895" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-7913" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-7915" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7897" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-7918" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7920" href="../More/#plfa_plfa-part2-More-17874" class="Function">subst</a> <a id="plfa_plfa-part2-Bisimulation-7926" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7721" class="Bound">σ</a> <a id="plfa_plfa-part2-Bisimulation-7928" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7895" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-7930" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-7932" href="../More/#plfa_plfa-part2-More-17874" class="Function">subst</a> <a id="plfa_plfa-part2-Bisimulation-7938" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7754" class="Bound">σ†</a> <a id="plfa_plfa-part2-Bisimulation-7941" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7897" class="Bound">M†</a><a id="plfa_plfa-part2-Bisimulation-7943" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-7945" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7699" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-7952" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7952" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-7955" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-7956" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3773" class="InductiveConstructor">~`</a> <a id="plfa_plfa-part2-Bisimulation-7959" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7960" class="Argument">x</a> <a id="plfa_plfa-part2-Bisimulation-7962" class="Symbol">=</a> <a id="plfa_plfa-part2-Bisimulation-7964" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7964" class="Bound">x</a><a id="plfa_plfa-part2-Bisimulation-7965" class="Symbol">})</a>  <a id="plfa_plfa-part2-Bisimulation-7969" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-7972" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7952" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-7975" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7964" class="Bound">x</a>
<a id="plfa_plfa-part2-Bisimulation-7977" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7699" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-7984" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7984" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-7987" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-7988" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3831" class="InductiveConstructor Operator">~ƛ</a> <a id="plfa_plfa-part2-Bisimulation-7991" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7991" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-7993" class="Symbol">)</a>       <a id="plfa_plfa-part2-Bisimulation-8001" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-8004" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3831" class="InductiveConstructor Operator">~ƛ</a> <a id="plfa_plfa-part2-Bisimulation-8007" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8008" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7699" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8015" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8016" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6949" class="Function">~exts</a> <a id="plfa_plfa-part2-Bisimulation-8022" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7984" class="Bound">~σ</a><a id="plfa_plfa-part2-Bisimulation-8024" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-8026" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7991" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-8028" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-8030" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7699" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8037" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8037" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-8040" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8041" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8041" class="Bound">~L</a> <a id="plfa_plfa-part2-Bisimulation-8044" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3916" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-8047" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8047" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-8049" class="Symbol">)</a>    <a id="plfa_plfa-part2-Bisimulation-8054" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-8057" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8058" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7699" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8065" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8037" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-8068" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8041" class="Bound">~L</a><a id="plfa_plfa-part2-Bisimulation-8070" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-8072" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3916" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-8075" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8076" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7699" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8083" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8037" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-8086" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8047" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-8088" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-8090" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7699" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8097" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8097" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-8100" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8101" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4040" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-8106" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8106" class="Bound">~M</a> <a id="plfa_plfa-part2-Bisimulation-8109" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8109" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-8111" class="Symbol">)</a>  <a id="plfa_plfa-part2-Bisimulation-8114" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-8117" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4040" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-8122" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8123" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7699" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8130" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8097" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-8133" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8106" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-8135" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-8137" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8138" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7699" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8145" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8146" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6949" class="Function">~exts</a> <a id="plfa_plfa-part2-Bisimulation-8152" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8097" class="Bound">~σ</a><a id="plfa_plfa-part2-Bisimulation-8154" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-8156" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8109" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-8158" class="Symbol">)</a>
</pre><p>Again, the structure of the proof is similar to the structure of substitution itself: reconstruct each term with recursive invocation, extending the environment where appropriate (in this case, only for the body of an abstraction).</p>From the general case of substitution, it is also easy to derive the required special case. If <code>N ~ N†</code> and <code>M ~ M†</code>, then <code>N [ M ] ~ N† [ M† ]</code>:<pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-~sub"></a><a id="plfa_plfa-part2-Bisimulation-8552" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8552" class="Function">~sub</a> <a id="plfa_plfa-part2-Bisimulation-8557" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-8559" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-8561" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8562" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8562" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-8564" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8564" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-8566" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8566" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-8567" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-8569" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8570" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8570" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-8572" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8572" class="Bound">N†</a> <a id="plfa_plfa-part2-Bisimulation-8575" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-8577" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8562" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-8579" href="../More/#plfa_plfa-part2-More-14667" class="InductiveConstructor Operator">,</a> <a id="plfa_plfa-part2-Bisimulation-8581" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8566" class="Bound">B</a> <a id="plfa_plfa-part2-Bisimulation-8583" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-8585" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8564" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-8586" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-8588" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8589" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8589" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-8591" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8591" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-8594" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-8596" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8562" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-8598" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-8600" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8566" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-8601" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-8605" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8607" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8570" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-8609" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-8611" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8572" class="Bound">N†</a>
  <a id="plfa_plfa-part2-Bisimulation-8616" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8618" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8589" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-8620" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-8622" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8591" class="Bound">M†</a>
    <a id="plfa_plfa-part2-Bisimulation-8629" class="Comment">-----------------------</a>
  <a id="plfa_plfa-part2-Bisimulation-8655" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8657" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8658" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8570" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-8660" href="../More/#plfa_plfa-part2-More-18773" class="Function Operator">[</a> <a id="plfa_plfa-part2-Bisimulation-8662" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8589" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-8664" href="../More/#plfa_plfa-part2-More-18773" class="Function Operator">]</a><a id="plfa_plfa-part2-Bisimulation-8665" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-8667" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-8669" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8670" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8572" class="Bound">N†</a> <a id="plfa_plfa-part2-Bisimulation-8673" href="../More/#plfa_plfa-part2-More-18773" class="Function Operator">[</a> <a id="plfa_plfa-part2-Bisimulation-8675" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8591" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-8678" href="../More/#plfa_plfa-part2-More-18773" class="Function Operator">]</a><a id="plfa_plfa-part2-Bisimulation-8679" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-8681" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8552" class="Function">~sub</a> <a id="plfa_plfa-part2-Bisimulation-8686" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8687" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8687" class="Bound">Γ</a><a id="plfa_plfa-part2-Bisimulation-8688" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-8690" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8691" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8691" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-8692" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-8694" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8695" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8695" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-8696" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-8698" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8698" class="Bound">~N</a> <a id="plfa_plfa-part2-Bisimulation-8701" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8701" class="Bound">~M</a> <a id="plfa_plfa-part2-Bisimulation-8704" class="Symbol">=</a> <a id="plfa_plfa-part2-Bisimulation-8706" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7699" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8713" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8714" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8687" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-8716" href="../More/#plfa_plfa-part2-More-14667" class="InductiveConstructor Operator">,</a> <a id="plfa_plfa-part2-Bisimulation-8718" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8695" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-8719" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-8721" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8722" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8687" class="Bound">Γ</a><a id="plfa_plfa-part2-Bisimulation-8723" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-8725" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8745" class="Function">~σ</a> <a id="plfa_plfa-part2-Bisimulation-8728" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8729" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8691" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-8730" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-8732" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8698" class="Bound">~N</a>
  <a id="plfa_plfa-part2-Bisimulation-8737" class="Keyword">where</a>
  <a id="plfa_plfa-part2-Bisimulation-8745" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8745" class="Function">~σ</a> <a id="plfa_plfa-part2-Bisimulation-8748" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-8750" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-8752" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8753" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8753" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-8754" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-8756" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8758" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8759" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8759" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-8761" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-8763" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8687" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-8765" href="../More/#plfa_plfa-part2-More-14667" class="InductiveConstructor Operator">,</a> <a id="plfa_plfa-part2-Bisimulation-8767" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8695" class="Bound">B</a> <a id="plfa_plfa-part2-Bisimulation-8769" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-8771" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8753" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-8772" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-8774" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8776" class="Symbol">_</a> <a id="plfa_plfa-part2-Bisimulation-8778" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-8780" class="Symbol">_</a>
  <a id="plfa_plfa-part2-Bisimulation-8784" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8745" class="Function">~σ</a> <a id="plfa_plfa-part2-Bisimulation-8787" href="../More/#plfa_plfa-part2-More-14791" class="InductiveConstructor">Z</a>      <a id="plfa_plfa-part2-Bisimulation-8794" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-8797" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8701" class="Bound">~M</a>
  <a id="plfa_plfa-part2-Bisimulation-8802" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8745" class="Function">~σ</a> <a id="plfa_plfa-part2-Bisimulation-8805" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8806" href="../More/#plfa_plfa-part2-More-14838" class="InductiveConstructor Operator">S</a> <a id="plfa_plfa-part2-Bisimulation-8808" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8808" class="Bound">x</a><a id="plfa_plfa-part2-Bisimulation-8809" class="Symbol">)</a>  <a id="plfa_plfa-part2-Bisimulation-8812" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-8815" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3773" class="InductiveConstructor">~`</a>
</pre><p>Once more, the structure of the proof resembles the original.</p><h2 id="the-relation-is-a-simulation">The relation is a simulation</h2><p>Finally, we can show that the relation actually is a simulation. In fact, we will show the stronger condition of a lock-step simulation. What we wish to show is:</p><p><em>Lock-step simulation</em>: For every <code>M</code>, <code>M†</code>, and <code>N</code>: If <code>M ~ M†</code> and <code>M —→ N</code> then <code>M† —→ N†</code> and <code>N ~ N†</code> for some <code>N†</code>.</p><p>Or, in a diagram:</p><pre><code>M  --- —→ --- N
|             |
|             |
~             ~
|             |
|             |
M† --- —→ --- N†</code></pre>We first formulate a concept corresponding to the lower leg of the diagram, that is, its right and bottom edges:<pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-9488" class="Keyword">data</a> <a id="plfa_plfa-part2-Bisimulation-Leg"></a><a id="plfa_plfa-part2-Bisimulation-9493" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9493" class="Datatype">Leg</a> <a id="plfa_plfa-part2-Bisimulation-9497" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-9498" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9498" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-9500" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9500" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-9501" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-9503" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-9504" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9504" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-9507" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9507" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-9509" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-9511" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9498" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-9513" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-9515" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9500" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-9516" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-9518" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-9520" href="https://agda.github.io/agda-stdlib/v1.7.1/Agda.Primitive.html#326" class="Primitive">Set</a> <a id="plfa_plfa-part2-Bisimulation-9524" class="Keyword">where</a>

  <a id="plfa_plfa-part2-Bisimulation-Leg.leg"></a><a id="plfa_plfa-part2-Bisimulation-9533" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9533" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-9537" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-9539" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-9541" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-9542" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9542" class="Bound">N†</a> <a id="plfa_plfa-part2-Bisimulation-9545" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-9547" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9498" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-9549" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-9551" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9500" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-9552" class="Symbol">}</a>
    <a id="plfa_plfa-part2-Bisimulation-9558" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-9560" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9507" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-9562" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-9564" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9542" class="Bound">N†</a>
    <a id="plfa_plfa-part2-Bisimulation-9571" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-9573" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9504" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-9576" href="../More/#plfa_plfa-part2-More-19832" class="Datatype Operator">—→</a> <a id="plfa_plfa-part2-Bisimulation-9579" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9542" class="Bound">N†</a>
      <a id="plfa_plfa-part2-Bisimulation-9588" class="Comment">--------</a>
    <a id="plfa_plfa-part2-Bisimulation-9601" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-9603" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9493" class="Datatype">Leg</a> <a id="plfa_plfa-part2-Bisimulation-9607" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9504" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-9610" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9507" class="Bound">N</a>
</pre><p>For our formalisation, in this case, we can use a stronger relation than <code>—↠</code>, replacing it by <code>—→</code>.</p>We can now state and prove that the relation is a simulation. Again, in this case, we can use a stronger relation than <code>—↠</code>, replacing it by <code>—→</code>:<pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-sim"></a><a id="plfa_plfa-part2-Bisimulation-9873" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9873" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-9877" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-9879" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-9881" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-9882" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9882" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-9884" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9884" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-9885" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-9887" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-9888" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9888" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-9890" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9890" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-9893" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9893" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-9895" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-9897" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9882" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-9899" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-9901" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9884" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-9902" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-9906" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-9908" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9888" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-9910" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3724" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-9912" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9890" class="Bound">M†</a>
  <a id="plfa_plfa-part2-Bisimulation-9917" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-9919" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9888" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-9921" href="../More/#plfa_plfa-part2-More-19832" class="Datatype Operator">—→</a> <a id="plfa_plfa-part2-Bisimulation-9924" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9893" class="Bound">N</a>
    <a id="plfa_plfa-part2-Bisimulation-9930" class="Comment">---------</a>
  <a id="plfa_plfa-part2-Bisimulation-9942" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-9944" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9493" class="Datatype">Leg</a>  <a id="plfa_plfa-part2-Bisimulation-9949" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9890" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-9952" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9893" class="Bound">N</a>
<a id="plfa_plfa-part2-Bisimulation-9954" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9873" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-9958" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3773" class="InductiveConstructor">~`</a>              <a id="plfa_plfa-part2-Bisimulation-9974" class="Symbol">()</a>
<a id="plfa_plfa-part2-Bisimulation-9977" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9873" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-9981" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-9982" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3831" class="InductiveConstructor Operator">~ƛ</a> <a id="plfa_plfa-part2-Bisimulation-9985" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9985" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-9987" class="Symbol">)</a>         <a id="plfa_plfa-part2-Bisimulation-9997" class="Symbol">()</a>
<a id="plfa_plfa-part2-Bisimulation-10000" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9873" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10004" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10005" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10005" class="Bound">~L</a> <a id="plfa_plfa-part2-Bisimulation-10008" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3916" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-10011" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10011" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-10013" class="Symbol">)</a>      <a id="plfa_plfa-part2-Bisimulation-10020" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10021" href="../More/#plfa_plfa-part2-More-19898" class="InductiveConstructor">ξ-·₁</a> <a id="plfa_plfa-part2-Bisimulation-10026" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10026" class="Bound">L—→</a><a id="plfa_plfa-part2-Bisimulation-10029" class="Symbol">)</a>
  <a id="plfa_plfa-part2-Bisimulation-10033" class="Keyword">with</a> <a id="plfa_plfa-part2-Bisimulation-10038" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9873" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10042" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10005" class="Bound">~L</a> <a id="plfa_plfa-part2-Bisimulation-10045" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10026" class="Bound">L—→</a>
<a id="plfa_plfa-part2-Bisimulation-10049" class="Symbol">...</a>  <a id="plfa_plfa-part2-Bisimulation-10054" class="Symbol">|</a> <a id="plfa_plfa-part2-Bisimulation-10056" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9533" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-10060" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10060" class="Bound">~L′</a> <a id="plfa_plfa-part2-Bisimulation-10064" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10064" class="Bound">L†—→</a>                 <a id="plfa_plfa-part2-Bisimulation-10085" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-10088" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9533" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-10092" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10093" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10060" class="Bound">~L′</a> <a id="plfa_plfa-part2-Bisimulation-10097" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3916" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-10100" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-10102" class="Symbol">)</a>   <a id="plfa_plfa-part2-Bisimulation-10106" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10107" href="../More/#plfa_plfa-part2-More-19898" class="InductiveConstructor">ξ-·₁</a> <a id="plfa_plfa-part2-Bisimulation-10112" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10064" class="Bound">L†—→</a><a id="plfa_plfa-part2-Bisimulation-10116" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-10118" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9873" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10122" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10123" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10123" class="Bound">~V</a> <a id="plfa_plfa-part2-Bisimulation-10126" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3916" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-10129" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10129" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-10131" class="Symbol">)</a>      <a id="plfa_plfa-part2-Bisimulation-10138" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10139" href="../More/#plfa_plfa-part2-More-20007" class="InductiveConstructor">ξ-·₂</a> <a id="plfa_plfa-part2-Bisimulation-10144" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10144" class="Bound">VV</a> <a id="plfa_plfa-part2-Bisimulation-10147" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10147" class="Bound">M—→</a><a id="plfa_plfa-part2-Bisimulation-10150" class="Symbol">)</a>
  <a id="plfa_plfa-part2-Bisimulation-10154" class="Keyword">with</a> <a id="plfa_plfa-part2-Bisimulation-10159" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9873" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10163" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10129" class="Bound">~M</a> <a id="plfa_plfa-part2-Bisimulation-10166" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10147" class="Bound">M—→</a>
<a id="plfa_plfa-part2-Bisimulation-10170" class="Symbol">...</a>  <a id="plfa_plfa-part2-Bisimulation-10175" class="Symbol">|</a> <a id="plfa_plfa-part2-Bisimulation-10177" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9533" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-10181" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10181" class="Bound">~M′</a> <a id="plfa_plfa-part2-Bisimulation-10185" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10185" class="Bound">M†—→</a>                 <a id="plfa_plfa-part2-Bisimulation-10206" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-10209" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9533" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-10213" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10214" class="Bound">~V</a> <a id="plfa_plfa-part2-Bisimulation-10217" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3916" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-10220" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10181" class="Bound">~M′</a><a id="plfa_plfa-part2-Bisimulation-10223" class="Symbol">)</a>   <a id="plfa_plfa-part2-Bisimulation-10227" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10228" href="../More/#plfa_plfa-part2-More-20007" class="InductiveConstructor">ξ-·₂</a> <a id="plfa_plfa-part2-Bisimulation-10233" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10234" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5155" class="Function">~val</a> <a id="plfa_plfa-part2-Bisimulation-10239" class="Bound">~V</a> <a id="plfa_plfa-part2-Bisimulation-10242" class="Bound">VV</a><a id="plfa_plfa-part2-Bisimulation-10244" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-10246" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10185" class="Bound">M†—→</a><a id="plfa_plfa-part2-Bisimulation-10250" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-10252" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9873" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10256" class="Symbol">((</a><a id="plfa_plfa-part2-Bisimulation-10258" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3831" class="InductiveConstructor Operator">~ƛ</a> <a id="plfa_plfa-part2-Bisimulation-10261" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10261" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-10263" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-10265" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-3916" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-10268" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10268" class="Bound">~V</a><a id="plfa_plfa-part2-Bisimulation-10270" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-10272" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10273" href="../More/#plfa_plfa-part2-More-20130" class="InductiveConstructor">β-ƛ</a> <a id="plfa_plfa-part2-Bisimulation-10277" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10277" class="Bound">VV</a><a id="plfa_plfa-part2-Bisimulation-10279" class="Symbol">)</a>        <a id="plfa_plfa-part2-Bisimulation-10288" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-10291" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9533" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-10295" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10296" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8552" class="Function">~sub</a> <a id="plfa_plfa-part2-Bisimulation-10301" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10261" class="Bound">~N</a> <a id="plfa_plfa-part2-Bisimulation-10304" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10268" class="Bound">~V</a><a id="plfa_plfa-part2-Bisimulation-10306" class="Symbol">)</a>  <a id="plfa_plfa-part2-Bisimulation-10309" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10310" href="../More/#plfa_plfa-part2-More-20130" class="InductiveConstructor">β-ƛ</a> <a id="plfa_plfa-part2-Bisimulation-10314" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10315" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5155" class="Function">~val</a> <a id="plfa_plfa-part2-Bisimulation-10320" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10268" class="Bound">~V</a> <a id="plfa_plfa-part2-Bisimulation-10323" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10277" class="Bound">VV</a><a id="plfa_plfa-part2-Bisimulation-10325" class="Symbol">))</a>
<a id="plfa_plfa-part2-Bisimulation-10328" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9873" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10332" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10333" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4040" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-10338" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10338" class="Bound">~M</a> <a id="plfa_plfa-part2-Bisimulation-10341" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10341" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-10343" class="Symbol">)</a>    <a id="plfa_plfa-part2-Bisimulation-10348" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10349" href="../More/#plfa_plfa-part2-More-21180" class="InductiveConstructor">ξ-let</a> <a id="plfa_plfa-part2-Bisimulation-10355" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10355" class="Bound">M—→</a><a id="plfa_plfa-part2-Bisimulation-10358" class="Symbol">)</a>
  <a id="plfa_plfa-part2-Bisimulation-10362" class="Keyword">with</a> <a id="plfa_plfa-part2-Bisimulation-10367" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9873" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10371" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10338" class="Bound">~M</a> <a id="plfa_plfa-part2-Bisimulation-10374" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10355" class="Bound">M—→</a>
<a id="plfa_plfa-part2-Bisimulation-10378" class="Symbol">...</a>  <a id="plfa_plfa-part2-Bisimulation-10383" class="Symbol">|</a> <a id="plfa_plfa-part2-Bisimulation-10385" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9533" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-10389" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10389" class="Bound">~M′</a> <a id="plfa_plfa-part2-Bisimulation-10393" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10393" class="Bound">M†—→</a>                 <a id="plfa_plfa-part2-Bisimulation-10414" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-10417" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9533" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-10421" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10422" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4040" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-10427" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10389" class="Bound">~M′</a> <a id="plfa_plfa-part2-Bisimulation-10431" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-10433" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-10435" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10436" href="../More/#plfa_plfa-part2-More-20007" class="InductiveConstructor">ξ-·₂</a> <a id="plfa_plfa-part2-Bisimulation-10441" href="../More/#plfa_plfa-part2-More-19226" class="InductiveConstructor">V-ƛ</a> <a id="plfa_plfa-part2-Bisimulation-10445" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10393" class="Bound">M†—→</a><a id="plfa_plfa-part2-Bisimulation-10449" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-10451" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9873" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10455" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10456" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4040" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-10461" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10461" class="Bound">~V</a> <a id="plfa_plfa-part2-Bisimulation-10464" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10464" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-10466" class="Symbol">)</a>    <a id="plfa_plfa-part2-Bisimulation-10471" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10472" href="../More/#plfa_plfa-part2-More-21302" class="InductiveConstructor">β-let</a> <a id="plfa_plfa-part2-Bisimulation-10478" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10478" class="Bound">VV</a><a id="plfa_plfa-part2-Bisimulation-10480" class="Symbol">)</a>      <a id="plfa_plfa-part2-Bisimulation-10487" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-10490" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9533" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-10494" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10495" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8552" class="Function">~sub</a> <a id="plfa_plfa-part2-Bisimulation-10500" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10464" class="Bound">~N</a> <a id="plfa_plfa-part2-Bisimulation-10503" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10461" class="Bound">~V</a><a id="plfa_plfa-part2-Bisimulation-10505" class="Symbol">)</a>  <a id="plfa_plfa-part2-Bisimulation-10508" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10509" href="../More/#plfa_plfa-part2-More-20130" class="InductiveConstructor">β-ƛ</a> <a id="plfa_plfa-part2-Bisimulation-10513" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10514" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5155" class="Function">~val</a> <a id="plfa_plfa-part2-Bisimulation-10519" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10461" class="Bound">~V</a> <a id="plfa_plfa-part2-Bisimulation-10522" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10478" class="Bound">VV</a><a id="plfa_plfa-part2-Bisimulation-10524" class="Symbol">))</a>
</pre><p>The proof is by case analysis, examining each possible instance of <code>M ~ M†</code> and each possible instance of <code>M —→ M†</code>, using recursive invocation whenever the reduction is by a <code>ξ</code> rule, and hence contains another reduction. In its structure, it looks a little bit like a proof of progress:</p><ul><li><p>If the related terms are variables, no reduction applies.</p></li><li><p>If the related terms are abstractions, no reduction applies.</p></li><li><p>If the related terms are applications, there are three subcases:</p><ul><li><p>The source term reduces via <code>ξ-·₁</code>, in which case the target term does as well. Recursive invocation gives us</p><pre><code>L  --- —→ ---  L′
|              |
|              |
~              ~
|              |
|              |
L† --- —→ --- L′†</code></pre><p>from which follows:</p><pre><code> L · M  --- —→ ---  L′ · M
   |                   |
   |                   |
   ~                   ~
   |                   |
   |                   |
L† · M† --- —→ --- L′† · M†</code></pre></li><li><p>The source term reduces via <code>ξ-·₂</code>, in which case the target term does as well. Recursive invocation gives us</p><pre><code>M  --- —→ ---  M′
|              |
|              |
~              ~
|              |
|              |
M† --- —→ --- M′†</code></pre><p>from which follows:</p><pre><code> V · M  --- —→ ---  V · M′
   |                  |
   |                  |
   ~                  ~
   |                  |
   |                  |
V† · M† --- —→ --- V† · M′†</code></pre><p>Since simulation commutes with values and <code>V</code> is a value, <code>V†</code> is also a value.</p></li><li><p>The source term reduces via <code>β-ƛ</code>, in which case the target term does as well:</p><pre><code> (ƛ x ⇒ N) · V  --- —→ ---  N [ x := V ]
      |                           |
      |                           |
      ~                           ~
      |                           |
      |                           |
(ƛ x ⇒ N†) · V† --- —→ --- N† [ x :=  V† ]</code></pre><p>Since simulation commutes with values and <code>V</code> is a value, <code>V†</code> is also a value. Since simulation commutes with substitution and <code>N ~ N†</code> and <code>V ~ V†</code>, we have <code>N [ x := V ] ~ N† [ x := V† ]</code>.</p></li></ul></li><li><p>If the related terms are a let and an application of an abstraction, there are two subcases:</p><ul><li><p>The source term reduces via <code>ξ-let</code>, in which case the target term reduces via <code>ξ-·₂</code>. Recursive invocation gives us</p><pre><code>M  --- —→ ---  M′
|              |
|              |
~              ~
|              |
|              |
M† --- —→ --- M′†</code></pre><p>from which follows:</p><pre><code>let x = M in N --- —→ --- let x = M′ in N
      |                         |
      |                         |
      ~                         ~
      |                         |
      |                         |
(ƛ x ⇒ N) · M  --- —→ --- (ƛ x ⇒ N) · M′</code></pre></li><li><p>The source term reduces via <code>β-let</code>, in which case the target term reduces via <code>β-ƛ</code>:</p><pre><code>let x = V in N  --- —→ ---  N [ x := V ]
      |                         |
      |                         |
      ~                         ~
      |                         |
      |                         |
(ƛ x ⇒ N†) · V† --- —→ --- N† [ x := V† ]</code></pre><p>Since simulation commutes with values and <code>V</code> is a value, <code>V†</code> is also a value. Since simulation commutes with substitution and <code>N ~ N†</code> and <code>V ~ V†</code>, we have <code>N [ x := V ] ~ N† [ x := V† ]</code>.</p></li></ul></li></ul><h4 id="exercise-sim¹-practice">Exercise <code>sim⁻¹</code> (practice)</h4><p>Show that we also have a simulation in the other direction, and hence that we have a bisimulation.</p><pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-14310" class="Comment">-- Your code goes here</a>
</pre><h4 id="exercise-products-practice">Exercise <code>products</code> (practice)</h4><p>Show that the two formulations of products in Chapter <a href="../More/">More</a> are in bisimulation. The only constructs you need to include are variables, and those connected to functions and products. In this case, the simulation is <em>not</em> lock-step.</p><pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-14626" class="Comment">-- Your code goes here</a>
</pre><h2 id="unicode">Unicode</h2><p>This chapter uses the following unicode:</p><pre><code>†  U+2020  DAGGER (\dag)
⁻  U+207B  SUPERSCRIPT MINUS (\^-)
¹  U+00B9  SUPERSCRIPT ONE (\^1)</code></pre></div><nav class="pager"><ul class="pagination"><li><a class="pagelink" href="../More/">Prev</a></li><li class="separator">•</li><li><a class="pagelink" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/part2/Bisimulation.lagda.md">Source</a></li><li class="separator">•</li><li><a class="pagelink" href="../Inference/">Next</a></li><li class="separator">•</li></ul></nav></article></div></main><footer class="site-footer h-card"><data class="u-url" href="../"></data><div class="wrapper"><h2 class="footer-heading">Programming Language Foundations in Agda</h2><div class="footer-col-wrapper"><div class="footer-col footer-col-1"><ul class="contact-list"><li class="p-name">Philip Wadler</li><li><a class="u-email" href="mailto:wadler@inf.ed.ac.uk"><i class="far fa-envelope"></i>  wadler@inf.ed.ac.uk</a></li></ul></div><div class="footer-col footer-col-2"><ul class="social-media-list"><li><a rel="me" href="https://github.com/wadler" title="wadler"><i class="fab fa-github"></i>  wadler</a></li></ul></div><div class="footer-col footer-col-3"></div></div><div class="footer-col-wrapper"><div class="footer-col footer-col-1"><ul class="contact-list"><li class="p-name">Wen Kokke</li><li><a class="u-email" href="mailto:me@wen.works"><i class="far fa-envelope"></i>  me@wen.works</a></li></ul></div><div class="footer-col footer-col-2"><ul class="social-media-list"><li><a rel="me" href="https://github.com/wenkokke" title="wenkokke"><i class="fab fa-github"></i>  wenkokke</a></li><li><a rel="me" href="https://twitter.com/wenkokke" title="wenkokke"><i class="fab fa-twitter"></i>  wenkokke</a></li></ul></div><div class="footer-col footer-col-3"></div></div><div class="footer-col-wrapper"><div class="footer-col footer-col-1"><ul class="contact-list"><li class="p-name">Jeremy G. Siek</li><li><a class="u-email" href="mailto:jsiek@indiana.edu"><i class="far fa-envelope"></i>  jsiek@indiana.edu</a></li></ul></div><div class="footer-col footer-col-2"><ul class="social-media-list"><li><a rel="me" href="https://github.com/jsiek" title="jsiek"><i class="fab fa-github"></i>  jsiek</a></li><li><a rel="me" href="https://twitter.com/jeremysiek" title="jeremysiek"><i class="fab fa-twitter"></i>  jeremysiek</a></li></ul></div><div class="footer-col footer-col-3"></div></div>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a></div></footer></body></html>