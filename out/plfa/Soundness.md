---
src       : "src/plfa/Soundness.lagda.md"
title     : "Soundness: of reduction with respect to denotational semantics"
layout    : page
prev      : /Compositional/
permalink : /Soundness/
next      : /Adequacy/
---

{% raw %}<pre class="Agda"><a id="183" class="Keyword">module</a> <a id="190" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}" class="Module">plfa.Soundness</a> <a id="205" class="Keyword">where</a>
</pre>{% endraw %}

## Introduction

In this chapter we prove that the reduction semantics is sound with
respect to the denotational semantics, i.e., for any term L

    L —↠ ƛ N  implies  ℰ L ≃ ℰ (ƛ N)

The proof is by induction on the reduction sequence, so the main lemma
concerns a single reduction step. We prove that if any term `M` steps
to a term `N`, then `M` and `N` are denotationally equal. We shall
prove each direction of this if-and-only-if separately. One direction
will look just like a type preservation proof. The other direction is
like proving type preservation for reduction going in reverse.  Recall
that type preservation is sometimes called subject
reduction. Preservation in reverse is a well-known property and is
called _subject expansion_. It is also well-known that subject
expansion is false for most typed lambda calculi!


## Imports

{% raw %}<pre class="Agda"><a id="1069" class="Keyword">open</a> <a id="1074" class="Keyword">import</a> <a id="1081" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}" class="Module">plfa.Untyped</a>
  <a id="1096" class="Keyword">using</a> <a id="1102" class="Symbol">(</a><a id="1103" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3130" class="Datatype">Context</a><a id="1110" class="Symbol">;</a> <a id="1112" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">_,_</a><a id="1115" class="Symbol">;</a> <a id="1117" href="plfa.Untyped.html#3483" class="Datatype Operator">_∋_</a><a id="1120" class="Symbol">;</a> <a id="1122" href="plfa.Untyped.html#4252" class="Datatype Operator">_⊢_</a><a id="1125" class="Symbol">;</a> <a id="1127" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="1128" class="Symbol">;</a> <a id="1130" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="1131" class="Symbol">;</a> <a id="1133" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a><a id="1135" class="Symbol">;</a> <a id="1137" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`_</a><a id="1139" class="Symbol">;</a> <a id="1141" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ_</a><a id="1143" class="Symbol">;</a> <a id="1145" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">_·_</a><a id="1148" class="Symbol">;</a>
         <a id="1159" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6921" class="Function">subst</a><a id="1164" class="Symbol">;</a> <a id="1166" href="plfa.Untyped.html#7449" class="Function Operator">_[_]</a><a id="1170" class="Symbol">;</a> <a id="1172" href="plfa.Untyped.html#7333" class="Function">subst-zero</a><a id="1182" class="Symbol">;</a> <a id="1184" href="plfa.Untyped.html#5883" class="Function">ext</a><a id="1187" class="Symbol">;</a> <a id="1189" href="plfa.Untyped.html#6193" class="Function">rename</a><a id="1195" class="Symbol">;</a> <a id="1197" href="plfa.Untyped.html#6629" class="Function">exts</a><a id="1201" class="Symbol">;</a>
         <a id="1212" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10105" class="Datatype Operator">_—→_</a><a id="1216" class="Symbol">;</a> <a id="1218" href="plfa.Untyped.html#10155" class="InductiveConstructor">ξ₁</a><a id="1220" class="Symbol">;</a> <a id="1222" href="plfa.Untyped.html#10245" class="InductiveConstructor">ξ₂</a><a id="1224" class="Symbol">;</a> <a id="1226" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a><a id="1227" class="Symbol">;</a> <a id="1229" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a><a id="1230" class="Symbol">;</a> <a id="1232" href="plfa.Untyped.html#11203" class="Datatype Operator">_—↠_</a><a id="1236" class="Symbol">;</a> <a id="1238" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">_—→⟨_⟩_</a><a id="1245" class="Symbol">;</a> <a id="1247" href="plfa.Untyped.html#11253" class="InductiveConstructor Operator">_∎</a><a id="1249" class="Symbol">)</a>
<a id="1251" class="Keyword">open</a> <a id="1256" class="Keyword">import</a> <a id="1263" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Substitution.md %}{% raw %}" class="Module">plfa.Substitution</a> <a id="1281" class="Keyword">using</a> <a id="1287" class="Symbol">(</a><a id="1288" href="plfa.Substitution.html#2233" class="Function">Rename</a><a id="1294" class="Symbol">;</a> <a id="1296" href="plfa.Substitution.html#2446" class="Function">Subst</a><a id="1301" class="Symbol">;</a> <a id="1303" href="plfa.Substitution.html#3087" class="Function">ids</a><a id="1306" class="Symbol">)</a>
<a id="1308" class="Keyword">open</a> <a id="1313" class="Keyword">import</a> <a id="1320" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}" class="Module">plfa.Denotational</a>
  <a id="1340" class="Keyword">using</a> <a id="1346" class="Symbol">(</a><a id="1347" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#3962" class="Datatype">Value</a><a id="1352" class="Symbol">;</a> <a id="1354" href="plfa.Denotational.html#3982" class="InductiveConstructor">⊥</a><a id="1355" class="Symbol">;</a> <a id="1357" href="plfa.Denotational.html#7100" class="Function">Env</a><a id="1360" class="Symbol">;</a> <a id="1362" href="plfa.Denotational.html#9274" class="Datatype Operator">_⊢_↓_</a><a id="1367" class="Symbol">;</a> <a id="1369" href="plfa.Denotational.html#7257" class="Function Operator">_`,_</a><a id="1373" class="Symbol">;</a> <a id="1375" href="plfa.Denotational.html#4317" class="Datatype Operator">_⊑_</a><a id="1378" class="Symbol">;</a> <a id="1380" href="plfa.Denotational.html#8062" class="Function Operator">_`⊑_</a><a id="1384" class="Symbol">;</a> <a id="1386" href="plfa.Denotational.html#8265" class="Function">`⊥</a><a id="1388" class="Symbol">;</a> <a id="1390" href="plfa.Denotational.html#8294" class="Function Operator">_`⊔_</a><a id="1394" class="Symbol">;</a> <a id="1396" href="plfa.Denotational.html#7494" class="Function">init</a><a id="1400" class="Symbol">;</a> <a id="1402" href="plfa.Denotational.html#7549" class="Function">last</a><a id="1406" class="Symbol">;</a> <a id="1408" href="plfa.Denotational.html#7598" class="Function">init-last</a><a id="1417" class="Symbol">;</a>
         <a id="1428" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#5471" class="Function">Refl⊑</a><a id="1433" class="Symbol">;</a> <a id="1435" href="plfa.Denotational.html#4614" class="InductiveConstructor">Trans⊑</a><a id="1441" class="Symbol">;</a> <a id="1443" href="plfa.Denotational.html#8548" class="Function">`Refl⊑</a><a id="1449" class="Symbol">;</a> <a id="1451" href="plfa.Denotational.html#25220" class="Function">Env⊑</a><a id="1455" class="Symbol">;</a> <a id="1457" href="plfa.Denotational.html#8616" class="Function">EnvConjR1⊑</a><a id="1467" class="Symbol">;</a> <a id="1469" href="plfa.Denotational.html#8713" class="Function">EnvConjR2⊑</a><a id="1479" class="Symbol">;</a> <a id="1481" href="plfa.Denotational.html#25648" class="Function">up-env</a><a id="1487" class="Symbol">;</a>
         <a id="1498" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9328" class="InductiveConstructor">var</a><a id="1501" class="Symbol">;</a> <a id="1503" href="plfa.Denotational.html#9407" class="InductiveConstructor">↦-elim</a><a id="1509" class="Symbol">;</a> <a id="1511" href="plfa.Denotational.html#9545" class="InductiveConstructor">↦-intro</a><a id="1518" class="Symbol">;</a> <a id="1520" href="plfa.Denotational.html#9669" class="InductiveConstructor">⊥-intro</a><a id="1527" class="Symbol">;</a> <a id="1529" href="plfa.Denotational.html#9744" class="InductiveConstructor">⊔-intro</a><a id="1536" class="Symbol">;</a> <a id="1538" href="plfa.Denotational.html#9875" class="InductiveConstructor">sub</a><a id="1541" class="Symbol">;</a>
         <a id="1552" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#23628" class="Function">rename-pres</a><a id="1563" class="Symbol">;</a> <a id="1565" href="plfa.Denotational.html#17427" class="Function">ℰ</a><a id="1566" class="Symbol">;</a> <a id="1568" href="plfa.Denotational.html#17609" class="Function Operator">_≃_</a><a id="1571" class="Symbol">;</a> <a id="1573" href="plfa.Denotational.html#18014" class="Function">≃-trans</a><a id="1580" class="Symbol">)</a>
<a id="1582" class="Keyword">open</a> <a id="1587" class="Keyword">import</a> <a id="1594" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}" class="Module">plfa.Compositional</a> <a id="1613" class="Keyword">using</a> <a id="1619" class="Symbol">(</a><a id="1620" href="plfa.Compositional.html#3566" class="Function">lambda-inversion</a><a id="1636" class="Symbol">;</a> <a id="1638" href="plfa.Compositional.html#9665" class="Function">var-inv</a><a id="1645" class="Symbol">)</a>

<a id="1648" class="Keyword">open</a> <a id="1653" class="Keyword">import</a> <a id="1660" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>
  <a id="1700" class="Keyword">using</a> <a id="1706" class="Symbol">(</a><a id="1707" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">_≡_</a><a id="1710" class="Symbol">;</a> <a id="1712" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#799" class="Function Operator">_≢_</a><a id="1715" class="Symbol">;</a> <a id="1717" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="1721" class="Symbol">;</a> <a id="1723" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a><a id="1726" class="Symbol">;</a> <a id="1728" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a><a id="1732" class="Symbol">;</a> <a id="1734" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1436" class="Function">cong₂</a><a id="1739" class="Symbol">;</a> <a id="1741" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1308" class="Function">cong-app</a><a id="1749" class="Symbol">)</a>
<a id="1751" class="Keyword">open</a> <a id="1756" class="Keyword">import</a> <a id="1763" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html" class="Module">Data.Product</a> <a id="1776" class="Keyword">using</a> <a id="1782" class="Symbol">(</a><a id="1783" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">_×_</a><a id="1786" class="Symbol">;</a> <a id="1788" href="Agda.Builtin.Sigma.html#139" class="Record">Σ</a><a id="1789" class="Symbol">;</a> <a id="1791" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ-syntax</a><a id="1799" class="Symbol">;</a> <a id="1801" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1364" class="Function">∃</a><a id="1802" class="Symbol">;</a> <a id="1804" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1783" class="Function">∃-syntax</a><a id="1812" class="Symbol">;</a> <a id="1814" href="Agda.Builtin.Sigma.html#225" class="Field">proj₁</a><a id="1819" class="Symbol">;</a> <a id="1821" href="Agda.Builtin.Sigma.html#237" class="Field">proj₂</a><a id="1826" class="Symbol">)</a>
  <a id="1830" class="Keyword">renaming</a> <a id="1839" class="Symbol">(</a><a id="1840" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">_,_</a> <a id="1844" class="Symbol">to</a> <a id="1847" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="1852" class="Symbol">)</a>
<a id="1854" class="Keyword">open</a> <a id="1859" class="Keyword">import</a> <a id="1866" href="Agda.Primitive.html" class="Module">Agda.Primitive</a> <a id="1881" class="Keyword">using</a> <a id="1887" class="Symbol">(</a><a id="1888" href="Agda.Primitive.html#611" class="Primitive">lzero</a><a id="1893" class="Symbol">)</a>
<a id="1895" class="Keyword">open</a> <a id="1900" class="Keyword">import</a> <a id="1907" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="1924" class="Keyword">using</a> <a id="1930" class="Symbol">(</a><a id="1931" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#535" class="Function Operator">¬_</a><a id="1933" class="Symbol">)</a>
<a id="1935" class="Keyword">open</a> <a id="1940" class="Keyword">import</a> <a id="1947" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="1973" class="Keyword">using</a> <a id="1979" class="Symbol">(</a><a id="1980" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Negation.html#809" class="Function">contradiction</a><a id="1993" class="Symbol">)</a>
<a id="1995" class="Keyword">open</a> <a id="2000" class="Keyword">import</a> <a id="2007" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html" class="Module">Data.Empty</a> <a id="2018" class="Keyword">using</a> <a id="2024" class="Symbol">(</a><a id="2025" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#294" class="Function">⊥-elim</a><a id="2031" class="Symbol">)</a>
<a id="2033" class="Keyword">open</a> <a id="2038" class="Keyword">import</a> <a id="2045" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="2062" class="Keyword">using</a> <a id="2068" class="Symbol">(</a><a id="2069" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#605" class="Datatype">Dec</a><a id="2072" class="Symbol">;</a> <a id="2074" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a><a id="2077" class="Symbol">;</a> <a id="2079" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a><a id="2081" class="Symbol">)</a>
<a id="2083" class="Keyword">open</a> <a id="2088" class="Keyword">import</a> <a id="2095" href="https://agda.github.io/agda-stdlib/v1.1/Function.html" class="Module">Function</a> <a id="2104" class="Keyword">using</a> <a id="2110" class="Symbol">(</a><a id="2111" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">_∘_</a><a id="2114" class="Symbol">)</a>
<a id="2116" class="Comment">-- open import plfa.Isomorphism using (extensionality)  -- causes a bug!</a>
</pre>{% endraw %}
## Forward reduction preserves denotations

The proof of preservation in this section mixes techniques from
previous chapters. Like the proof of preservation for the STLC, we are
preserving a relation defined separately from the syntax, in contrast
to the inherently typed terms. On the other hand, we are using de
Bruijn indices for variables.

The outline of the proof remains the same in that we must prove lemmas
concerning all of the auxiliary functions used in the reduction
relation: substitution, renaming, and extension.


### Simultaneous substitution preserves denotations

Our next goal is to prove that simultaneous substitution preserves
meaning.  That is, if `M` results in `v` in environment `γ`, then applying a
substitution `σ` to `M` gives us a program that also results in `v`, but in
an environment `δ` in which, for every variable `x`, `σ x` results in the
same value as the one for `x` in the original environment `γ`.
We write `δ ⊢ σ ↓ γ` for this condition.

{% raw %}<pre class="Agda"><a id="3182" class="Keyword">infix</a> <a id="3188" class="Number">3</a> <a id="3190" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#3197" class="Function Operator">_`⊢_↓_</a>
<a id="_`⊢_↓_"></a><a id="3197" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#3197" class="Function Operator">_`⊢_↓_</a> <a id="3204" class="Symbol">:</a> <a id="3206" class="Symbol">∀{</a><a id="3208" href="plfa.Soundness.html#3208" class="Bound">Δ</a> <a id="3210" href="plfa.Soundness.html#3210" class="Bound">Γ</a><a id="3211" class="Symbol">}</a> <a id="3213" class="Symbol">→</a> <a id="3215" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="3219" href="plfa.Soundness.html#3208" class="Bound">Δ</a> <a id="3221" class="Symbol">→</a> <a id="3223" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Substitution.md %}{% raw %}#2446" class="Function">Subst</a> <a id="3229" href="plfa.Soundness.html#3210" class="Bound">Γ</a> <a id="3231" href="plfa.Soundness.html#3208" class="Bound">Δ</a> <a id="3233" class="Symbol">→</a> <a id="3235" href="plfa.Denotational.html#7100" class="Function">Env</a> <a id="3239" href="plfa.Soundness.html#3210" class="Bound">Γ</a> <a id="3241" class="Symbol">→</a> <a id="3243" class="PrimitiveType">Set</a>
<a id="3247" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#3197" class="Function Operator">_`⊢_↓_</a> <a id="3254" class="Symbol">{</a><a id="3255" href="plfa.Soundness.html#3255" class="Bound">Δ</a><a id="3256" class="Symbol">}{</a><a id="3258" href="plfa.Soundness.html#3258" class="Bound">Γ</a><a id="3259" class="Symbol">}</a> <a id="3261" href="plfa.Soundness.html#3261" class="Bound">δ</a> <a id="3263" href="plfa.Soundness.html#3263" class="Bound">σ</a> <a id="3265" href="plfa.Soundness.html#3265" class="Bound">γ</a> <a id="3267" class="Symbol">=</a> <a id="3269" class="Symbol">(∀</a> <a id="3272" class="Symbol">(</a><a id="3273" href="plfa.Soundness.html#3273" class="Bound">x</a> <a id="3275" class="Symbol">:</a> <a id="3277" href="plfa.Soundness.html#3258" class="Bound">Γ</a> <a id="3279" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3483" class="Datatype Operator">∋</a> <a id="3281" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="3282" class="Symbol">)</a> <a id="3284" class="Symbol">→</a> <a id="3286" href="plfa.Soundness.html#3261" class="Bound">δ</a> <a id="3288" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="3290" href="plfa.Soundness.html#3263" class="Bound">σ</a> <a id="3292" href="plfa.Soundness.html#3273" class="Bound">x</a> <a id="3294" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="3296" href="plfa.Soundness.html#3265" class="Bound">γ</a> <a id="3298" href="plfa.Soundness.html#3273" class="Bound">x</a><a id="3299" class="Symbol">)</a>
</pre>{% endraw %}
As usual, to prepare for lambda abstraction, we prove an extension
lemma. It says that applying the `exts` function to a substitution
produces a new substitution that maps variables to terms that when
evaluated in `δ , v` produce the values in `γ , v`.

{% raw %}<pre class="Agda"><a id="subst-ext"></a><a id="3564" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#3564" class="Function">subst-ext</a> <a id="3574" class="Symbol">:</a> <a id="3576" class="Symbol">∀</a> <a id="3578" class="Symbol">{</a><a id="3579" href="plfa.Soundness.html#3579" class="Bound">Γ</a> <a id="3581" href="plfa.Soundness.html#3581" class="Bound">Δ</a> <a id="3583" href="plfa.Soundness.html#3583" class="Bound">v</a><a id="3584" class="Symbol">}</a> <a id="3586" class="Symbol">{</a><a id="3587" href="plfa.Soundness.html#3587" class="Bound">γ</a> <a id="3589" class="Symbol">:</a> <a id="3591" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="3595" href="plfa.Soundness.html#3579" class="Bound">Γ</a><a id="3596" class="Symbol">}</a> <a id="3598" class="Symbol">{</a><a id="3599" href="plfa.Soundness.html#3599" class="Bound">δ</a> <a id="3601" class="Symbol">:</a> <a id="3603" href="plfa.Denotational.html#7100" class="Function">Env</a> <a id="3607" href="plfa.Soundness.html#3581" class="Bound">Δ</a><a id="3608" class="Symbol">}</a>
  <a id="3612" class="Symbol">→</a> <a id="3614" class="Symbol">(</a><a id="3615" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#3615" class="Bound">σ</a> <a id="3617" class="Symbol">:</a> <a id="3619" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Substitution.md %}{% raw %}#2446" class="Function">Subst</a> <a id="3625" href="plfa.Soundness.html#3579" class="Bound">Γ</a> <a id="3627" href="plfa.Soundness.html#3581" class="Bound">Δ</a><a id="3628" class="Symbol">)</a>
  <a id="3632" class="Symbol">→</a> <a id="3634" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#3599" class="Bound">δ</a> <a id="3636" href="plfa.Soundness.html#3197" class="Function Operator">`⊢</a> <a id="3639" href="plfa.Soundness.html#3615" class="Bound">σ</a> <a id="3641" href="plfa.Soundness.html#3197" class="Function Operator">↓</a> <a id="3643" href="plfa.Soundness.html#3587" class="Bound">γ</a>
   <a id="3648" class="Comment">--------------------------</a>
  <a id="3677" class="Symbol">→</a> <a id="3679" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#3599" class="Bound">δ</a> <a id="3681" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7257" class="Function Operator">`,</a> <a id="3684" href="plfa.Soundness.html#3583" class="Bound">v</a> <a id="3686" href="plfa.Soundness.html#3197" class="Function Operator">`⊢</a> <a id="3689" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6629" class="Function">exts</a> <a id="3694" href="plfa.Soundness.html#3615" class="Bound">σ</a> <a id="3696" href="plfa.Soundness.html#3197" class="Function Operator">↓</a> <a id="3698" href="plfa.Soundness.html#3587" class="Bound">γ</a> <a id="3700" href="plfa.Denotational.html#7257" class="Function Operator">`,</a> <a id="3703" href="plfa.Soundness.html#3583" class="Bound">v</a>
<a id="3705" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#3564" class="Function">subst-ext</a> <a id="3715" href="plfa.Soundness.html#3715" class="Bound">σ</a> <a id="3717" href="plfa.Soundness.html#3717" class="Bound">d</a> <a id="3719" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3519" class="InductiveConstructor">Z</a> <a id="3721" class="Symbol">=</a> <a id="3723" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9328" class="InductiveConstructor">var</a>
<a id="3727" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#3564" class="Function">subst-ext</a> <a id="3737" href="plfa.Soundness.html#3737" class="Bound">σ</a> <a id="3739" href="plfa.Soundness.html#3739" class="Bound">d</a> <a id="3741" class="Symbol">(</a><a id="3742" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3564" class="InductiveConstructor Operator">S</a> <a id="3744" href="plfa.Soundness.html#3744" class="Bound">x′</a><a id="3746" class="Symbol">)</a> <a id="3748" class="Symbol">=</a> <a id="3750" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#23628" class="Function">rename-pres</a> <a id="3762" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a> <a id="3765" class="Symbol">(λ</a> <a id="3768" href="plfa.Soundness.html#3768" class="Bound">_</a> <a id="3770" class="Symbol">→</a> <a id="3772" href="plfa.Denotational.html#5471" class="Function">Refl⊑</a><a id="3777" class="Symbol">)</a> <a id="3779" class="Symbol">(</a><a id="3780" href="plfa.Soundness.html#3739" class="Bound">d</a> <a id="3782" href="plfa.Soundness.html#3744" class="Bound">x′</a><a id="3784" class="Symbol">)</a>
</pre>{% endraw %}
The proof is by cases on the de Bruijn index `x`.

* If it is `Z`, then we need to show that `δ , v ⊢ # 0 ↓ v`,
  which we have by rule `var`.

* If it is `S x′`,then we need to show that
  `δ , v ⊢ rename S_ (σ x′) ↓ nth x′ γ`,
  which we obtain by the `rename-pres` lemma.

With the extension lemma in hand, the proof that simultaneous
substitution preserves meaning is straightforward.  Let's dive in!

{% raw %}<pre class="Agda"><a id="subst-pres"></a><a id="4201" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4212" class="Symbol">:</a> <a id="4214" class="Symbol">∀</a> <a id="4216" class="Symbol">{</a><a id="4217" href="plfa.Soundness.html#4217" class="Bound">Γ</a> <a id="4219" href="plfa.Soundness.html#4219" class="Bound">Δ</a> <a id="4221" href="plfa.Soundness.html#4221" class="Bound">v</a><a id="4222" class="Symbol">}</a> <a id="4224" class="Symbol">{</a><a id="4225" href="plfa.Soundness.html#4225" class="Bound">γ</a> <a id="4227" class="Symbol">:</a> <a id="4229" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="4233" href="plfa.Soundness.html#4217" class="Bound">Γ</a><a id="4234" class="Symbol">}</a> <a id="4236" class="Symbol">{</a><a id="4237" href="plfa.Soundness.html#4237" class="Bound">δ</a> <a id="4239" class="Symbol">:</a> <a id="4241" href="plfa.Denotational.html#7100" class="Function">Env</a> <a id="4245" href="plfa.Soundness.html#4219" class="Bound">Δ</a><a id="4246" class="Symbol">}</a> <a id="4248" class="Symbol">{</a><a id="4249" href="plfa.Soundness.html#4249" class="Bound">M</a> <a id="4251" class="Symbol">:</a> <a id="4253" href="plfa.Soundness.html#4217" class="Bound">Γ</a> <a id="4255" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4252" class="Datatype Operator">⊢</a> <a id="4257" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="4258" class="Symbol">}</a>
  <a id="4262" class="Symbol">→</a> <a id="4264" class="Symbol">(</a><a id="4265" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#4265" class="Bound">σ</a> <a id="4267" class="Symbol">:</a> <a id="4269" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Substitution.md %}{% raw %}#2446" class="Function">Subst</a> <a id="4275" href="plfa.Soundness.html#4217" class="Bound">Γ</a> <a id="4277" href="plfa.Soundness.html#4219" class="Bound">Δ</a><a id="4278" class="Symbol">)</a>
  <a id="4282" class="Symbol">→</a> <a id="4284" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#4237" class="Bound">δ</a> <a id="4286" href="plfa.Soundness.html#3197" class="Function Operator">`⊢</a> <a id="4289" href="plfa.Soundness.html#4265" class="Bound">σ</a> <a id="4291" href="plfa.Soundness.html#3197" class="Function Operator">↓</a> <a id="4293" href="plfa.Soundness.html#4225" class="Bound">γ</a>
  <a id="4297" class="Symbol">→</a> <a id="4299" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#4225" class="Bound">γ</a> <a id="4301" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="4303" href="plfa.Soundness.html#4249" class="Bound">M</a> <a id="4305" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="4307" href="plfa.Soundness.html#4221" class="Bound">v</a>
    <a id="4313" class="Comment">------------------</a>
  <a id="4334" class="Symbol">→</a> <a id="4336" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#4237" class="Bound">δ</a> <a id="4338" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="4340" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6921" class="Function">subst</a> <a id="4346" href="plfa.Soundness.html#4265" class="Bound">σ</a> <a id="4348" href="plfa.Soundness.html#4249" class="Bound">M</a> <a id="4350" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="4352" href="plfa.Soundness.html#4221" class="Bound">v</a>
<a id="4354" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4365" href="plfa.Soundness.html#4365" class="Bound">σ</a> <a id="4367" href="plfa.Soundness.html#4367" class="Bound">s</a> <a id="4369" class="Symbol">(</a><a id="4370" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9328" class="InductiveConstructor">var</a> <a id="4374" class="Symbol">{</a><a id="4375" class="Argument">x</a> <a id="4377" class="Symbol">=</a> <a id="4379" href="plfa.Soundness.html#4379" class="Bound">x</a><a id="4380" class="Symbol">})</a> <a id="4383" class="Symbol">=</a> <a id="4385" class="Symbol">(</a><a id="4386" href="plfa.Soundness.html#4367" class="Bound">s</a> <a id="4388" href="plfa.Soundness.html#4379" class="Bound">x</a><a id="4389" class="Symbol">)</a>
<a id="4391" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4402" href="plfa.Soundness.html#4402" class="Bound">σ</a> <a id="4404" href="plfa.Soundness.html#4404" class="Bound">s</a> <a id="4406" class="Symbol">(</a><a id="4407" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="4414" href="plfa.Soundness.html#4414" class="Bound">d₁</a> <a id="4417" href="plfa.Soundness.html#4417" class="Bound">d₂</a><a id="4419" class="Symbol">)</a> <a id="4421" class="Symbol">=</a>
  <a id="4425" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="4432" class="Symbol">(</a><a id="4433" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4444" href="plfa.Soundness.html#4402" class="Bound">σ</a> <a id="4446" href="plfa.Soundness.html#4404" class="Bound">s</a> <a id="4448" href="plfa.Soundness.html#4414" class="Bound">d₁</a><a id="4450" class="Symbol">)</a> <a id="4452" class="Symbol">(</a><a id="4453" href="plfa.Soundness.html#4201" class="Function">subst-pres</a> <a id="4464" href="plfa.Soundness.html#4402" class="Bound">σ</a> <a id="4466" href="plfa.Soundness.html#4404" class="Bound">s</a> <a id="4468" href="plfa.Soundness.html#4417" class="Bound">d₂</a><a id="4470" class="Symbol">)</a>
<a id="4472" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4483" href="plfa.Soundness.html#4483" class="Bound">σ</a> <a id="4485" href="plfa.Soundness.html#4485" class="Bound">s</a> <a id="4487" class="Symbol">(</a><a id="4488" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9545" class="InductiveConstructor">↦-intro</a> <a id="4496" href="plfa.Soundness.html#4496" class="Bound">d</a><a id="4497" class="Symbol">)</a> <a id="4499" class="Symbol">=</a>
  <a id="4503" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9545" class="InductiveConstructor">↦-intro</a> <a id="4511" class="Symbol">(</a><a id="4512" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4523" class="Symbol">(λ</a> <a id="4526" class="Symbol">{</a><a id="4527" href="plfa.Soundness.html#4527" class="Bound">A</a><a id="4528" class="Symbol">}</a> <a id="4530" class="Symbol">→</a> <a id="4532" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6629" class="Function">exts</a> <a id="4537" href="plfa.Soundness.html#4483" class="Bound">σ</a><a id="4538" class="Symbol">)</a> <a id="4540" class="Symbol">(</a><a id="4541" href="plfa.Soundness.html#3564" class="Function">subst-ext</a> <a id="4551" href="plfa.Soundness.html#4483" class="Bound">σ</a> <a id="4553" href="plfa.Soundness.html#4485" class="Bound">s</a><a id="4554" class="Symbol">)</a> <a id="4556" href="plfa.Soundness.html#4496" class="Bound">d</a><a id="4557" class="Symbol">)</a>
<a id="4559" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4570" href="plfa.Soundness.html#4570" class="Bound">σ</a> <a id="4572" href="plfa.Soundness.html#4572" class="Bound">s</a> <a id="4574" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9669" class="InductiveConstructor">⊥-intro</a> <a id="4582" class="Symbol">=</a> <a id="4584" href="plfa.Denotational.html#9669" class="InductiveConstructor">⊥-intro</a>
<a id="4592" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4603" href="plfa.Soundness.html#4603" class="Bound">σ</a> <a id="4605" href="plfa.Soundness.html#4605" class="Bound">s</a> <a id="4607" class="Symbol">(</a><a id="4608" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9744" class="InductiveConstructor">⊔-intro</a> <a id="4616" href="plfa.Soundness.html#4616" class="Bound">d₁</a> <a id="4619" href="plfa.Soundness.html#4619" class="Bound">d₂</a><a id="4621" class="Symbol">)</a> <a id="4623" class="Symbol">=</a>
  <a id="4627" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9744" class="InductiveConstructor">⊔-intro</a> <a id="4635" class="Symbol">(</a><a id="4636" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4647" href="plfa.Soundness.html#4603" class="Bound">σ</a> <a id="4649" href="plfa.Soundness.html#4605" class="Bound">s</a> <a id="4651" href="plfa.Soundness.html#4616" class="Bound">d₁</a><a id="4653" class="Symbol">)</a> <a id="4655" class="Symbol">(</a><a id="4656" href="plfa.Soundness.html#4201" class="Function">subst-pres</a> <a id="4667" href="plfa.Soundness.html#4603" class="Bound">σ</a> <a id="4669" href="plfa.Soundness.html#4605" class="Bound">s</a> <a id="4671" href="plfa.Soundness.html#4619" class="Bound">d₂</a><a id="4673" class="Symbol">)</a>
<a id="4675" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4686" href="plfa.Soundness.html#4686" class="Bound">σ</a> <a id="4688" href="plfa.Soundness.html#4688" class="Bound">s</a> <a id="4690" class="Symbol">(</a><a id="4691" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9875" class="InductiveConstructor">sub</a> <a id="4695" href="plfa.Soundness.html#4695" class="Bound">d</a> <a id="4697" href="plfa.Soundness.html#4697" class="Bound">lt</a><a id="4699" class="Symbol">)</a> <a id="4701" class="Symbol">=</a> <a id="4703" href="plfa.Denotational.html#9875" class="InductiveConstructor">sub</a> <a id="4707" class="Symbol">(</a><a id="4708" href="plfa.Soundness.html#4201" class="Function">subst-pres</a> <a id="4719" href="plfa.Soundness.html#4686" class="Bound">σ</a> <a id="4721" href="plfa.Soundness.html#4688" class="Bound">s</a> <a id="4723" href="plfa.Soundness.html#4695" class="Bound">d</a><a id="4724" class="Symbol">)</a> <a id="4726" href="plfa.Soundness.html#4697" class="Bound">lt</a>
</pre>{% endraw %}
The proof is by induction on the semantics of `M`.  The two interesting
cases are for variables and lambda abstractions.

* For a variable `x`, we have that `v ⊑ nth x γ` and we need to show that
  `δ ⊢ σ x ↓ v`.  From the premise applied to `x`, we have that
  `δ ⊢ σ x ↓ nth x γ`, so we conclude by the `sub` rule.

* For a lambda abstraction, we must extend the substitution
  for the induction hypothesis. We apply the `subst-ext` lemma
  to show that the extended substitution maps variables to
  terms that result in the appropriate values.


### Single substitution preserves denotations

For β reduction, `(ƛ N) · M —→ N [ M ]`, we need to show that the
semantics is preserved when substituting `M` for de Bruijn index 0 in
term `N`. By inversion on the rules `↦-elim` and `↦-intro`,
we have that `γ , v ⊢ M ↓ w` and `γ ⊢ N ↓ v`.
So we need to show that `γ ⊢ M [ N ] ↓ w`, or equivalently,
that `γ ⊢ subst (subst-zero N) M ↓ w`.

{% raw %}<pre class="Agda"><a id="substitution"></a><a id="5676" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#5676" class="Function">substitution</a> <a id="5689" class="Symbol">:</a> <a id="5691" class="Symbol">∀</a> <a id="5693" class="Symbol">{</a><a id="5694" href="plfa.Soundness.html#5694" class="Bound">Γ</a><a id="5695" class="Symbol">}</a> <a id="5697" class="Symbol">{</a><a id="5698" href="plfa.Soundness.html#5698" class="Bound">γ</a> <a id="5700" class="Symbol">:</a> <a id="5702" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="5706" href="plfa.Soundness.html#5694" class="Bound">Γ</a><a id="5707" class="Symbol">}</a> <a id="5709" class="Symbol">{</a><a id="5710" href="plfa.Soundness.html#5710" class="Bound">N</a> <a id="5712" href="plfa.Soundness.html#5712" class="Bound">M</a> <a id="5714" href="plfa.Soundness.html#5714" class="Bound">v</a> <a id="5716" href="plfa.Soundness.html#5716" class="Bound">w</a><a id="5717" class="Symbol">}</a>
   <a id="5722" class="Symbol">→</a> <a id="5724" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#5698" class="Bound">γ</a> <a id="5726" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7257" class="Function Operator">`,</a> <a id="5729" href="plfa.Soundness.html#5714" class="Bound">v</a> <a id="5731" href="plfa.Denotational.html#9274" class="Datatype Operator">⊢</a> <a id="5733" href="plfa.Soundness.html#5710" class="Bound">N</a> <a id="5735" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="5737" href="plfa.Soundness.html#5716" class="Bound">w</a>
   <a id="5742" class="Symbol">→</a> <a id="5744" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#5698" class="Bound">γ</a> <a id="5746" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="5748" href="plfa.Soundness.html#5712" class="Bound">M</a> <a id="5750" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="5752" href="plfa.Soundness.html#5714" class="Bound">v</a>
     <a id="5759" class="Comment">---------------</a>
   <a id="5778" class="Symbol">→</a> <a id="5780" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#5698" class="Bound">γ</a> <a id="5782" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="5784" href="plfa.Soundness.html#5710" class="Bound">N</a> <a id="5786" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7449" class="Function Operator">[</a> <a id="5788" href="plfa.Soundness.html#5712" class="Bound">M</a> <a id="5790" href="plfa.Untyped.html#7449" class="Function Operator">]</a> <a id="5792" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="5794" href="plfa.Soundness.html#5716" class="Bound">w</a>
<a id="5796" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#5676" class="Function">substitution</a><a id="5808" class="Symbol">{</a><a id="5809" href="plfa.Soundness.html#5809" class="Bound">Γ</a><a id="5810" class="Symbol">}{</a><a id="5812" href="plfa.Soundness.html#5812" class="Bound">γ</a><a id="5813" class="Symbol">}{</a><a id="5815" href="plfa.Soundness.html#5815" class="Bound">N</a><a id="5816" class="Symbol">}{</a><a id="5818" href="plfa.Soundness.html#5818" class="Bound">M</a><a id="5819" class="Symbol">}{</a><a id="5821" href="plfa.Soundness.html#5821" class="Bound">v</a><a id="5822" class="Symbol">}{</a><a id="5824" href="plfa.Soundness.html#5824" class="Bound">w</a><a id="5825" class="Symbol">}</a> <a id="5827" href="plfa.Soundness.html#5827" class="Bound">dn</a> <a id="5830" href="plfa.Soundness.html#5830" class="Bound">dm</a> <a id="5833" class="Symbol">=</a>
  <a id="5837" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="5848" class="Symbol">(</a><a id="5849" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7333" class="Function">subst-zero</a> <a id="5860" href="plfa.Soundness.html#5818" class="Bound">M</a><a id="5861" class="Symbol">)</a> <a id="5863" href="plfa.Soundness.html#5885" class="Function">sub-z-ok</a> <a id="5872" href="plfa.Soundness.html#5827" class="Bound">dn</a>
  <a id="5877" class="Keyword">where</a>
  <a id="5885" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#5885" class="Function">sub-z-ok</a> <a id="5894" class="Symbol">:</a> <a id="5896" href="plfa.Soundness.html#5812" class="Bound">γ</a> <a id="5898" href="plfa.Soundness.html#3197" class="Function Operator">`⊢</a> <a id="5901" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7333" class="Function">subst-zero</a> <a id="5912" href="plfa.Soundness.html#5818" class="Bound">M</a> <a id="5914" href="plfa.Soundness.html#3197" class="Function Operator">↓</a> <a id="5916" class="Symbol">(</a><a id="5917" href="plfa.Soundness.html#5812" class="Bound">γ</a> <a id="5919" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7257" class="Function Operator">`,</a> <a id="5922" href="plfa.Soundness.html#5821" class="Bound">v</a><a id="5923" class="Symbol">)</a>
  <a id="5927" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#5885" class="Function">sub-z-ok</a> <a id="5936" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3519" class="InductiveConstructor">Z</a> <a id="5938" class="Symbol">=</a> <a id="5940" href="plfa.Soundness.html#5830" class="Bound">dm</a>
  <a id="5945" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#5885" class="Function">sub-z-ok</a> <a id="5954" class="Symbol">(</a><a id="5955" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3564" class="InductiveConstructor Operator">S</a> <a id="5957" href="plfa.Soundness.html#5957" class="Bound">x</a><a id="5958" class="Symbol">)</a> <a id="5960" class="Symbol">=</a> <a id="5962" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9328" class="InductiveConstructor">var</a>
</pre>{% endraw %}
This result is a corollary of the lemma for simultaneous substitution.
To use the lemma, we just need to show that `subst-zero M` maps
variables to terms that produces the same values as those in `γ , v`.
Let `y` be an arbitrary variable (de Bruijn index).

* If it is `Z`, then `(subst-zero M) y = M` and `nth y (γ , v) = v`.
  By the premise we conclude that `γ ⊢ M ↓ v`.

* If it is `S x`, then `(subst-zero M) (S x) = x` and
  `nth (S x) (γ , v) = nth x γ`.  So we conclude that
  `γ ⊢ x ↓ nth x γ` by rule `var`.


### Reduction preserves denotations

With the substitution lemma in hand, it is straightforward to prove
that reduction preserves denotations.

{% raw %}<pre class="Agda"><a id="preserve"></a><a id="6639" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="6648" class="Symbol">:</a> <a id="6650" class="Symbol">∀</a> <a id="6652" class="Symbol">{</a><a id="6653" href="plfa.Soundness.html#6653" class="Bound">Γ</a><a id="6654" class="Symbol">}</a> <a id="6656" class="Symbol">{</a><a id="6657" href="plfa.Soundness.html#6657" class="Bound">γ</a> <a id="6659" class="Symbol">:</a> <a id="6661" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="6665" href="plfa.Soundness.html#6653" class="Bound">Γ</a><a id="6666" class="Symbol">}</a> <a id="6668" class="Symbol">{</a><a id="6669" href="plfa.Soundness.html#6669" class="Bound">M</a> <a id="6671" href="plfa.Soundness.html#6671" class="Bound">N</a> <a id="6673" href="plfa.Soundness.html#6673" class="Bound">v</a><a id="6674" class="Symbol">}</a>
  <a id="6678" class="Symbol">→</a> <a id="6680" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#6657" class="Bound">γ</a> <a id="6682" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="6684" href="plfa.Soundness.html#6669" class="Bound">M</a> <a id="6686" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="6688" href="plfa.Soundness.html#6673" class="Bound">v</a>
  <a id="6692" class="Symbol">→</a> <a id="6694" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#6669" class="Bound">M</a> <a id="6696" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10105" class="Datatype Operator">—→</a> <a id="6699" href="plfa.Soundness.html#6671" class="Bound">N</a>
    <a id="6705" class="Comment">----------</a>
  <a id="6718" class="Symbol">→</a> <a id="6720" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#6657" class="Bound">γ</a> <a id="6722" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="6724" href="plfa.Soundness.html#6671" class="Bound">N</a> <a id="6726" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="6728" href="plfa.Soundness.html#6673" class="Bound">v</a>
<a id="6730" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="6739" class="Symbol">(</a><a id="6740" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9328" class="InductiveConstructor">var</a><a id="6743" class="Symbol">)</a> <a id="6745" class="Symbol">()</a>
<a id="6748" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="6757" class="Symbol">(</a><a id="6758" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="6765" href="plfa.Soundness.html#6765" class="Bound">d₁</a> <a id="6768" href="plfa.Soundness.html#6768" class="Bound">d₂</a><a id="6770" class="Symbol">)</a> <a id="6772" class="Symbol">(</a><a id="6773" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10155" class="InductiveConstructor">ξ₁</a> <a id="6776" href="plfa.Soundness.html#6776" class="Bound">r</a><a id="6777" class="Symbol">)</a> <a id="6779" class="Symbol">=</a> <a id="6781" href="plfa.Denotational.html#9407" class="InductiveConstructor">↦-elim</a> <a id="6788" class="Symbol">(</a><a id="6789" href="plfa.Soundness.html#6639" class="Function">preserve</a> <a id="6798" href="plfa.Soundness.html#6765" class="Bound">d₁</a> <a id="6801" href="plfa.Soundness.html#6776" class="Bound">r</a><a id="6802" class="Symbol">)</a> <a id="6804" href="plfa.Soundness.html#6768" class="Bound">d₂</a>
<a id="6807" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="6816" class="Symbol">(</a><a id="6817" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="6824" href="plfa.Soundness.html#6824" class="Bound">d₁</a> <a id="6827" href="plfa.Soundness.html#6827" class="Bound">d₂</a><a id="6829" class="Symbol">)</a> <a id="6831" class="Symbol">(</a><a id="6832" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10245" class="InductiveConstructor">ξ₂</a> <a id="6835" href="plfa.Soundness.html#6835" class="Bound">r</a><a id="6836" class="Symbol">)</a> <a id="6838" class="Symbol">=</a> <a id="6840" href="plfa.Denotational.html#9407" class="InductiveConstructor">↦-elim</a> <a id="6847" href="plfa.Soundness.html#6824" class="Bound">d₁</a> <a id="6850" class="Symbol">(</a><a id="6851" href="plfa.Soundness.html#6639" class="Function">preserve</a> <a id="6860" href="plfa.Soundness.html#6827" class="Bound">d₂</a> <a id="6863" href="plfa.Soundness.html#6835" class="Bound">r</a><a id="6864" class="Symbol">)</a>
<a id="6866" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="6875" class="Symbol">(</a><a id="6876" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="6883" href="plfa.Soundness.html#6883" class="Bound">d₁</a> <a id="6886" href="plfa.Soundness.html#6886" class="Bound">d₂</a><a id="6888" class="Symbol">)</a> <a id="6890" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10335" class="InductiveConstructor">β</a> <a id="6892" class="Symbol">=</a> <a id="6894" href="plfa.Soundness.html#5676" class="Function">substitution</a> <a id="6907" class="Symbol">(</a><a id="6908" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3566" class="Function">lambda-inversion</a> <a id="6925" href="plfa.Soundness.html#6883" class="Bound">d₁</a><a id="6927" class="Symbol">)</a> <a id="6929" href="plfa.Soundness.html#6886" class="Bound">d₂</a>
<a id="6932" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="6941" class="Symbol">(</a><a id="6942" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9545" class="InductiveConstructor">↦-intro</a> <a id="6950" href="plfa.Soundness.html#6950" class="Bound">d</a><a id="6951" class="Symbol">)</a> <a id="6953" class="Symbol">(</a><a id="6954" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10443" class="InductiveConstructor">ζ</a> <a id="6956" href="plfa.Soundness.html#6956" class="Bound">r</a><a id="6957" class="Symbol">)</a> <a id="6959" class="Symbol">=</a> <a id="6961" href="plfa.Denotational.html#9545" class="InductiveConstructor">↦-intro</a> <a id="6969" class="Symbol">(</a><a id="6970" href="plfa.Soundness.html#6639" class="Function">preserve</a> <a id="6979" href="plfa.Soundness.html#6950" class="Bound">d</a> <a id="6981" href="plfa.Soundness.html#6956" class="Bound">r</a><a id="6982" class="Symbol">)</a>
<a id="6984" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="6993" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9669" class="InductiveConstructor">⊥-intro</a> <a id="7001" href="plfa.Soundness.html#7001" class="Bound">r</a> <a id="7003" class="Symbol">=</a> <a id="7005" href="plfa.Denotational.html#9669" class="InductiveConstructor">⊥-intro</a>
<a id="7013" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="7022" class="Symbol">(</a><a id="7023" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9744" class="InductiveConstructor">⊔-intro</a> <a id="7031" href="plfa.Soundness.html#7031" class="Bound">d</a> <a id="7033" href="plfa.Soundness.html#7033" class="Bound">d₁</a><a id="7035" class="Symbol">)</a> <a id="7037" href="plfa.Soundness.html#7037" class="Bound">r</a> <a id="7039" class="Symbol">=</a> <a id="7041" href="plfa.Denotational.html#9744" class="InductiveConstructor">⊔-intro</a> <a id="7049" class="Symbol">(</a><a id="7050" href="plfa.Soundness.html#6639" class="Function">preserve</a> <a id="7059" href="plfa.Soundness.html#7031" class="Bound">d</a> <a id="7061" href="plfa.Soundness.html#7037" class="Bound">r</a><a id="7062" class="Symbol">)</a> <a id="7064" class="Symbol">(</a><a id="7065" href="plfa.Soundness.html#6639" class="Function">preserve</a> <a id="7074" href="plfa.Soundness.html#7033" class="Bound">d₁</a> <a id="7077" href="plfa.Soundness.html#7037" class="Bound">r</a><a id="7078" class="Symbol">)</a>
<a id="7080" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="7089" class="Symbol">(</a><a id="7090" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9875" class="InductiveConstructor">sub</a> <a id="7094" href="plfa.Soundness.html#7094" class="Bound">d</a> <a id="7096" href="plfa.Soundness.html#7096" class="Bound">lt</a><a id="7098" class="Symbol">)</a> <a id="7100" href="plfa.Soundness.html#7100" class="Bound">r</a> <a id="7102" class="Symbol">=</a> <a id="7104" href="plfa.Denotational.html#9875" class="InductiveConstructor">sub</a> <a id="7108" class="Symbol">(</a><a id="7109" href="plfa.Soundness.html#6639" class="Function">preserve</a> <a id="7118" href="plfa.Soundness.html#7094" class="Bound">d</a> <a id="7120" href="plfa.Soundness.html#7100" class="Bound">r</a><a id="7121" class="Symbol">)</a> <a id="7123" href="plfa.Soundness.html#7096" class="Bound">lt</a>
</pre>{% endraw %}
We proceed by induction on the semantics of `M` with case analysis on
the reduction.

* If `M` is a variable, then there is no such reduction.

* If `M` is an application, then the reduction is either a congruence
  (ξ₁ or ξ₂) or β. For each congruence, we use the induction
  hypothesis. For β reduction we use the substitution lemma and the
  `sub` rule.

* The rest of the cases are straightforward.

## Reduction reflects denotations

This section proves that reduction reflects the denotation of a
term. That is, if `N` results in `v`, and if `M` reduces to `N`, then
`M` also results in `v`. While there are some broad similarities
between this proof and the above proof of semantic preservation, we
shall require a few more technical lemmas to obtain this result.

The main challenge is dealing with the substitution in β reduction:

    (ƛ N) · M —→ N [ M ]

We have that `γ ⊢ N [ M ] ↓ v` and need to show that
`γ ⊢ (ƛ N) · M ↓ v`. Now consider the derivation of `γ ⊢ N [ M ] ↓ v`.
The term `M` may occur 0, 1, or many times inside `N [ M ]`. At each of
those occurences, `M` may result in a different value. But to build a
derivation for `(ƛ N) · M`, we need a single value for `M`.  If `M`
occured more than 1 time, then we can join all of the different values
using `⊔`. If `M` occured 0 times, then we do not need any information
about `M` and can therefore use `⊥` for the value of `M`.


### Renaming reflects meaning

Previously we showed that renaming variables preserves meaning.  Now
we prove the opposite, that it reflects meaning. That is,
if `δ ⊢ rename ρ M ↓ v`, then `γ ⊢ M ↓ v`, where `(δ ∘ ρ) `⊑ γ`.

First, we need a variant of a lemma given earlier.
{% raw %}<pre class="Agda"><a id="nth-ext"></a><a id="8813" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#8813" class="Function">nth-ext</a> <a id="8821" class="Symbol">:</a> <a id="8823" class="Symbol">∀</a> <a id="8825" class="Symbol">{</a><a id="8826" href="plfa.Soundness.html#8826" class="Bound">Γ</a> <a id="8828" href="plfa.Soundness.html#8828" class="Bound">Δ</a> <a id="8830" href="plfa.Soundness.html#8830" class="Bound">v</a><a id="8831" class="Symbol">}</a> <a id="8833" class="Symbol">{</a><a id="8834" href="plfa.Soundness.html#8834" class="Bound">γ</a> <a id="8836" class="Symbol">:</a> <a id="8838" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="8842" href="plfa.Soundness.html#8826" class="Bound">Γ</a><a id="8843" class="Symbol">}</a> <a id="8845" class="Symbol">{</a><a id="8846" href="plfa.Soundness.html#8846" class="Bound">δ</a> <a id="8848" class="Symbol">:</a> <a id="8850" href="plfa.Denotational.html#7100" class="Function">Env</a> <a id="8854" href="plfa.Soundness.html#8828" class="Bound">Δ</a><a id="8855" class="Symbol">}</a>
  <a id="8859" class="Symbol">→</a> <a id="8861" class="Symbol">(</a><a id="8862" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#8862" class="Bound">ρ</a> <a id="8864" class="Symbol">:</a> <a id="8866" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Substitution.md %}{% raw %}#2233" class="Function">Rename</a> <a id="8873" href="plfa.Soundness.html#8826" class="Bound">Γ</a> <a id="8875" href="plfa.Soundness.html#8828" class="Bound">Δ</a><a id="8876" class="Symbol">)</a>
  <a id="8880" class="Symbol">→</a> <a id="8882" class="Symbol">(</a><a id="8883" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#8846" class="Bound">δ</a> <a id="8885" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="8887" href="plfa.Soundness.html#8862" class="Bound">ρ</a><a id="8888" class="Symbol">)</a> <a id="8890" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#8062" class="Function Operator">`⊑</a> <a id="8893" href="plfa.Soundness.html#8834" class="Bound">γ</a>
    <a id="8899" class="Comment">------------------------------</a>
  <a id="8932" class="Symbol">→</a> <a id="8934" class="Symbol">((</a><a id="8936" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#8846" class="Bound">δ</a> <a id="8938" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7257" class="Function Operator">`,</a> <a id="8941" href="plfa.Soundness.html#8830" class="Bound">v</a><a id="8942" class="Symbol">)</a> <a id="8944" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="8946" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#5883" class="Function">ext</a> <a id="8950" href="plfa.Soundness.html#8862" class="Bound">ρ</a><a id="8951" class="Symbol">)</a> <a id="8953" href="plfa.Denotational.html#8062" class="Function Operator">`⊑</a> <a id="8956" class="Symbol">(</a><a id="8957" href="plfa.Soundness.html#8834" class="Bound">γ</a> <a id="8959" href="plfa.Denotational.html#7257" class="Function Operator">`,</a> <a id="8962" href="plfa.Soundness.html#8830" class="Bound">v</a><a id="8963" class="Symbol">)</a>
<a id="8965" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#8813" class="Function">nth-ext</a> <a id="8973" href="plfa.Soundness.html#8973" class="Bound">ρ</a> <a id="8975" href="plfa.Soundness.html#8975" class="Bound">lt</a> <a id="8978" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3519" class="InductiveConstructor">Z</a> <a id="8980" class="Symbol">=</a> <a id="8982" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#5471" class="Function">Refl⊑</a>
<a id="8988" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#8813" class="Function">nth-ext</a> <a id="8996" href="plfa.Soundness.html#8996" class="Bound">ρ</a> <a id="8998" href="plfa.Soundness.html#8998" class="Bound">lt</a> <a id="9001" class="Symbol">(</a><a id="9002" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3564" class="InductiveConstructor Operator">S</a> <a id="9004" href="plfa.Soundness.html#9004" class="Bound">x</a><a id="9005" class="Symbol">)</a> <a id="9007" class="Symbol">=</a> <a id="9009" href="plfa.Soundness.html#8998" class="Bound">lt</a> <a id="9012" href="plfa.Soundness.html#9004" class="Bound">x</a>
</pre>{% endraw %}
The proof is then as follows.
{% raw %}<pre class="Agda"><a id="rename-reflect"></a><a id="9053" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9053" class="Function">rename-reflect</a> <a id="9068" class="Symbol">:</a> <a id="9070" class="Symbol">∀</a> <a id="9072" class="Symbol">{</a><a id="9073" href="plfa.Soundness.html#9073" class="Bound">Γ</a> <a id="9075" href="plfa.Soundness.html#9075" class="Bound">Δ</a> <a id="9077" href="plfa.Soundness.html#9077" class="Bound">v</a><a id="9078" class="Symbol">}</a> <a id="9080" class="Symbol">{</a><a id="9081" href="plfa.Soundness.html#9081" class="Bound">γ</a> <a id="9083" class="Symbol">:</a> <a id="9085" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="9089" href="plfa.Soundness.html#9073" class="Bound">Γ</a><a id="9090" class="Symbol">}</a> <a id="9092" class="Symbol">{</a><a id="9093" href="plfa.Soundness.html#9093" class="Bound">δ</a> <a id="9095" class="Symbol">:</a> <a id="9097" href="plfa.Denotational.html#7100" class="Function">Env</a> <a id="9101" href="plfa.Soundness.html#9075" class="Bound">Δ</a><a id="9102" class="Symbol">}</a> <a id="9104" class="Symbol">{</a> <a id="9106" href="plfa.Soundness.html#9106" class="Bound">M</a> <a id="9108" class="Symbol">:</a> <a id="9110" href="plfa.Soundness.html#9073" class="Bound">Γ</a> <a id="9112" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4252" class="Datatype Operator">⊢</a> <a id="9114" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="9115" class="Symbol">}</a>
  <a id="9119" class="Symbol">→</a> <a id="9121" class="Symbol">{</a><a id="9122" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9122" class="Bound">ρ</a> <a id="9124" class="Symbol">:</a> <a id="9126" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Substitution.md %}{% raw %}#2233" class="Function">Rename</a> <a id="9133" href="plfa.Soundness.html#9073" class="Bound">Γ</a> <a id="9135" href="plfa.Soundness.html#9075" class="Bound">Δ</a><a id="9136" class="Symbol">}</a>
  <a id="9140" class="Symbol">→</a> <a id="9142" class="Symbol">(</a><a id="9143" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9093" class="Bound">δ</a> <a id="9145" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="9147" href="plfa.Soundness.html#9122" class="Bound">ρ</a><a id="9148" class="Symbol">)</a> <a id="9150" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#8062" class="Function Operator">`⊑</a> <a id="9153" href="plfa.Soundness.html#9081" class="Bound">γ</a>
  <a id="9157" class="Symbol">→</a> <a id="9159" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9093" class="Bound">δ</a> <a id="9161" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="9163" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6193" class="Function">rename</a> <a id="9170" href="plfa.Soundness.html#9122" class="Bound">ρ</a> <a id="9172" href="plfa.Soundness.html#9106" class="Bound">M</a> <a id="9174" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="9176" href="plfa.Soundness.html#9077" class="Bound">v</a>
    <a id="9182" class="Comment">------------------------------------</a>
  <a id="9221" class="Symbol">→</a> <a id="9223" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9081" class="Bound">γ</a> <a id="9225" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="9227" href="plfa.Soundness.html#9106" class="Bound">M</a> <a id="9229" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="9231" href="plfa.Soundness.html#9077" class="Bound">v</a>
<a id="9233" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9053" class="Function">rename-reflect</a> <a id="9248" class="Symbol">{</a><a id="9249" class="Argument">M</a> <a id="9251" class="Symbol">=</a> <a id="9253" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4288" class="InductiveConstructor Operator">`</a> <a id="9255" href="plfa.Soundness.html#9255" class="Bound">x</a><a id="9256" class="Symbol">}</a> <a id="9258" href="plfa.Soundness.html#9258" class="Bound">all-n</a> <a id="9264" href="plfa.Soundness.html#9264" class="Bound">d</a> <a id="9266" class="Keyword">with</a> <a id="9271" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9665" class="Function">var-inv</a> <a id="9279" href="plfa.Soundness.html#9264" class="Bound">d</a>
<a id="9281" class="Symbol">...</a> <a id="9285" class="Symbol">|</a> <a id="9287" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9287" class="Bound">lt</a> <a id="9290" class="Symbol">=</a>  <a id="9293" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9875" class="InductiveConstructor">sub</a> <a id="9297" href="plfa.Denotational.html#9328" class="InductiveConstructor">var</a> <a id="9301" class="Symbol">(</a><a id="9302" href="plfa.Denotational.html#4614" class="InductiveConstructor">Trans⊑</a> <a id="9309" href="plfa.Soundness.html#9287" class="Bound">lt</a> <a id="9312" class="Symbol">(</a><a id="9313" class="Bound">all-n</a> <a id="9319" class="Bound">x</a><a id="9320" class="Symbol">))</a>
<a id="9323" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9053" class="Function">rename-reflect</a> <a id="9338" class="Symbol">{</a><a id="9339" class="Argument">M</a> <a id="9341" class="Symbol">=</a> <a id="9343" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="9345" href="plfa.Soundness.html#9345" class="Bound">N</a><a id="9346" class="Symbol">}{</a><a id="9348" class="Argument">ρ</a> <a id="9350" class="Symbol">=</a> <a id="9352" href="plfa.Soundness.html#9352" class="Bound">ρ</a><a id="9353" class="Symbol">}</a> <a id="9355" href="plfa.Soundness.html#9355" class="Bound">all-n</a> <a id="9361" class="Symbol">(</a><a id="9362" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9545" class="InductiveConstructor">↦-intro</a> <a id="9370" href="plfa.Soundness.html#9370" class="Bound">d</a><a id="9371" class="Symbol">)</a> <a id="9373" class="Symbol">=</a>
   <a id="9378" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9545" class="InductiveConstructor">↦-intro</a> <a id="9386" class="Symbol">(</a><a id="9387" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9053" class="Function">rename-reflect</a> <a id="9402" class="Symbol">(</a><a id="9403" href="plfa.Soundness.html#8813" class="Function">nth-ext</a> <a id="9411" href="plfa.Soundness.html#9352" class="Bound">ρ</a> <a id="9413" href="plfa.Soundness.html#9355" class="Bound">all-n</a><a id="9418" class="Symbol">)</a> <a id="9420" href="plfa.Soundness.html#9370" class="Bound">d</a><a id="9421" class="Symbol">)</a>
<a id="9423" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9053" class="Function">rename-reflect</a> <a id="9438" class="Symbol">{</a><a id="9439" class="Argument">M</a> <a id="9441" class="Symbol">=</a> <a id="9443" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="9445" href="plfa.Soundness.html#9445" class="Bound">N</a><a id="9446" class="Symbol">}</a> <a id="9448" href="plfa.Soundness.html#9448" class="Bound">all-n</a> <a id="9454" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9669" class="InductiveConstructor">⊥-intro</a> <a id="9462" class="Symbol">=</a> <a id="9464" href="plfa.Denotational.html#9669" class="InductiveConstructor">⊥-intro</a>
<a id="9472" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9053" class="Function">rename-reflect</a> <a id="9487" class="Symbol">{</a><a id="9488" class="Argument">M</a> <a id="9490" class="Symbol">=</a> <a id="9492" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="9494" href="plfa.Soundness.html#9494" class="Bound">N</a><a id="9495" class="Symbol">}</a> <a id="9497" href="plfa.Soundness.html#9497" class="Bound">all-n</a> <a id="9503" class="Symbol">(</a><a id="9504" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9744" class="InductiveConstructor">⊔-intro</a> <a id="9512" href="plfa.Soundness.html#9512" class="Bound">d₁</a> <a id="9515" href="plfa.Soundness.html#9515" class="Bound">d₂</a><a id="9517" class="Symbol">)</a> <a id="9519" class="Symbol">=</a>
   <a id="9524" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9744" class="InductiveConstructor">⊔-intro</a> <a id="9532" class="Symbol">(</a><a id="9533" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9053" class="Function">rename-reflect</a> <a id="9548" href="plfa.Soundness.html#9497" class="Bound">all-n</a> <a id="9554" href="plfa.Soundness.html#9512" class="Bound">d₁</a><a id="9556" class="Symbol">)</a> <a id="9558" class="Symbol">(</a><a id="9559" href="plfa.Soundness.html#9053" class="Function">rename-reflect</a> <a id="9574" href="plfa.Soundness.html#9497" class="Bound">all-n</a> <a id="9580" href="plfa.Soundness.html#9515" class="Bound">d₂</a><a id="9582" class="Symbol">)</a>
<a id="9584" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9053" class="Function">rename-reflect</a> <a id="9599" class="Symbol">{</a><a id="9600" class="Argument">M</a> <a id="9602" class="Symbol">=</a> <a id="9604" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="9606" href="plfa.Soundness.html#9606" class="Bound">N</a><a id="9607" class="Symbol">}</a> <a id="9609" href="plfa.Soundness.html#9609" class="Bound">all-n</a> <a id="9615" class="Symbol">(</a><a id="9616" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9875" class="InductiveConstructor">sub</a> <a id="9620" href="plfa.Soundness.html#9620" class="Bound">d₁</a> <a id="9623" href="plfa.Soundness.html#9623" class="Bound">lt</a><a id="9625" class="Symbol">)</a> <a id="9627" class="Symbol">=</a>
   <a id="9632" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9875" class="InductiveConstructor">sub</a> <a id="9636" class="Symbol">(</a><a id="9637" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9053" class="Function">rename-reflect</a> <a id="9652" href="plfa.Soundness.html#9609" class="Bound">all-n</a> <a id="9658" href="plfa.Soundness.html#9620" class="Bound">d₁</a><a id="9660" class="Symbol">)</a> <a id="9662" href="plfa.Soundness.html#9623" class="Bound">lt</a>
<a id="9665" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9053" class="Function">rename-reflect</a> <a id="9680" class="Symbol">{</a><a id="9681" class="Argument">M</a> <a id="9683" class="Symbol">=</a> <a id="9685" href="plfa.Soundness.html#9685" class="Bound">L</a> <a id="9687" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4400" class="InductiveConstructor Operator">·</a> <a id="9689" href="plfa.Soundness.html#9689" class="Bound">M</a><a id="9690" class="Symbol">}</a> <a id="9692" href="plfa.Soundness.html#9692" class="Bound">all-n</a> <a id="9698" class="Symbol">(</a><a id="9699" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="9706" href="plfa.Soundness.html#9706" class="Bound">d₁</a> <a id="9709" href="plfa.Soundness.html#9709" class="Bound">d₂</a><a id="9711" class="Symbol">)</a> <a id="9713" class="Symbol">=</a>
   <a id="9718" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="9725" class="Symbol">(</a><a id="9726" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9053" class="Function">rename-reflect</a> <a id="9741" href="plfa.Soundness.html#9692" class="Bound">all-n</a> <a id="9747" href="plfa.Soundness.html#9706" class="Bound">d₁</a><a id="9749" class="Symbol">)</a> <a id="9751" class="Symbol">(</a><a id="9752" href="plfa.Soundness.html#9053" class="Function">rename-reflect</a> <a id="9767" href="plfa.Soundness.html#9692" class="Bound">all-n</a> <a id="9773" href="plfa.Soundness.html#9709" class="Bound">d₂</a><a id="9775" class="Symbol">)</a>
<a id="9777" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9053" class="Function">rename-reflect</a> <a id="9792" class="Symbol">{</a><a id="9793" class="Argument">M</a> <a id="9795" class="Symbol">=</a> <a id="9797" href="plfa.Soundness.html#9797" class="Bound">L</a> <a id="9799" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4400" class="InductiveConstructor Operator">·</a> <a id="9801" href="plfa.Soundness.html#9801" class="Bound">M</a><a id="9802" class="Symbol">}</a> <a id="9804" href="plfa.Soundness.html#9804" class="Bound">all-n</a> <a id="9810" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9669" class="InductiveConstructor">⊥-intro</a> <a id="9818" class="Symbol">=</a> <a id="9820" href="plfa.Denotational.html#9669" class="InductiveConstructor">⊥-intro</a>
<a id="9828" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9053" class="Function">rename-reflect</a> <a id="9843" class="Symbol">{</a><a id="9844" class="Argument">M</a> <a id="9846" class="Symbol">=</a> <a id="9848" href="plfa.Soundness.html#9848" class="Bound">L</a> <a id="9850" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4400" class="InductiveConstructor Operator">·</a> <a id="9852" href="plfa.Soundness.html#9852" class="Bound">M</a><a id="9853" class="Symbol">}</a> <a id="9855" href="plfa.Soundness.html#9855" class="Bound">all-n</a> <a id="9861" class="Symbol">(</a><a id="9862" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9744" class="InductiveConstructor">⊔-intro</a> <a id="9870" href="plfa.Soundness.html#9870" class="Bound">d₁</a> <a id="9873" href="plfa.Soundness.html#9873" class="Bound">d₂</a><a id="9875" class="Symbol">)</a> <a id="9877" class="Symbol">=</a>
   <a id="9882" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9744" class="InductiveConstructor">⊔-intro</a> <a id="9890" class="Symbol">(</a><a id="9891" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9053" class="Function">rename-reflect</a> <a id="9906" href="plfa.Soundness.html#9855" class="Bound">all-n</a> <a id="9912" href="plfa.Soundness.html#9870" class="Bound">d₁</a><a id="9914" class="Symbol">)</a> <a id="9916" class="Symbol">(</a><a id="9917" href="plfa.Soundness.html#9053" class="Function">rename-reflect</a> <a id="9932" href="plfa.Soundness.html#9855" class="Bound">all-n</a> <a id="9938" href="plfa.Soundness.html#9873" class="Bound">d₂</a><a id="9940" class="Symbol">)</a>
<a id="9942" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9053" class="Function">rename-reflect</a> <a id="9957" class="Symbol">{</a><a id="9958" class="Argument">M</a> <a id="9960" class="Symbol">=</a> <a id="9962" href="plfa.Soundness.html#9962" class="Bound">L</a> <a id="9964" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4400" class="InductiveConstructor Operator">·</a> <a id="9966" href="plfa.Soundness.html#9966" class="Bound">M</a><a id="9967" class="Symbol">}</a> <a id="9969" href="plfa.Soundness.html#9969" class="Bound">all-n</a> <a id="9975" class="Symbol">(</a><a id="9976" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9875" class="InductiveConstructor">sub</a> <a id="9980" href="plfa.Soundness.html#9980" class="Bound">d₁</a> <a id="9983" href="plfa.Soundness.html#9983" class="Bound">lt</a><a id="9985" class="Symbol">)</a> <a id="9987" class="Symbol">=</a>
   <a id="9992" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9875" class="InductiveConstructor">sub</a> <a id="9996" class="Symbol">(</a><a id="9997" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#9053" class="Function">rename-reflect</a> <a id="10012" href="plfa.Soundness.html#9969" class="Bound">all-n</a> <a id="10018" href="plfa.Soundness.html#9980" class="Bound">d₁</a><a id="10020" class="Symbol">)</a> <a id="10022" href="plfa.Soundness.html#9983" class="Bound">lt</a>
</pre>{% endraw %}
We cannot prove this lemma by induction on the derivation of
`δ ⊢ rename ρ M ↓ v`, so instead we proceed by induction on `M`.

* If it is a variable, we apply the inversion lemma to obtain
  that `v ⊑ nth (ρ x) δ`. Instantiating the premise to `x` we have
  `nth (ρ x) δ = nth x γ`, so we conclude by the `var` rule.

* If it is a lambda abstraction `ƛ N`, we have
  rename `ρ (ƛ N) = ƛ (rename (ext ρ) N)`.
  We proceed by cases on `δ ⊢ ƛ (rename (ext ρ) N) ↓ v`.

  * Rule `↦-intro`: To satisfy the premise of the induction
    hypothesis, we prove that the renaming can be extended to be a
    mapping from `γ , v₁ to δ , v₁`.

  * Rule `⊥-intro`: We simply apply `⊥-intro`.

  * Rule `⊔-intro`: We apply the induction hypotheses and `⊔-intro`.

  * Rule `sub`: We apply the induction hypothesis and `sub`.

* If it is an application `L · M`, we have
  `rename ρ (L · M) = (rename ρ L) · (rename ρ M)`.
  We proceed by cases on `δ ⊢ (rename ρ L) · (rename ρ M) ↓ v`
  and all the cases are straightforward.

In the upcoming uses of `rename-reflect`, the renaming will always be
the increment function. So we prove a corollary for that special case.

{% raw %}<pre class="Agda"><a id="rename-inc-reflect"></a><a id="11187" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#11187" class="Function">rename-inc-reflect</a> <a id="11206" class="Symbol">:</a> <a id="11208" class="Symbol">∀</a> <a id="11210" class="Symbol">{</a><a id="11211" href="plfa.Soundness.html#11211" class="Bound">Γ</a> <a id="11213" href="plfa.Soundness.html#11213" class="Bound">v′</a> <a id="11216" href="plfa.Soundness.html#11216" class="Bound">v</a><a id="11217" class="Symbol">}</a> <a id="11219" class="Symbol">{</a><a id="11220" href="plfa.Soundness.html#11220" class="Bound">γ</a> <a id="11222" class="Symbol">:</a> <a id="11224" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="11228" href="plfa.Soundness.html#11211" class="Bound">Γ</a><a id="11229" class="Symbol">}</a> <a id="11231" class="Symbol">{</a> <a id="11233" href="plfa.Soundness.html#11233" class="Bound">M</a> <a id="11235" class="Symbol">:</a> <a id="11237" href="plfa.Soundness.html#11211" class="Bound">Γ</a> <a id="11239" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4252" class="Datatype Operator">⊢</a> <a id="11241" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="11242" class="Symbol">}</a>
  <a id="11246" class="Symbol">→</a> <a id="11248" class="Symbol">(</a><a id="11249" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#11220" class="Bound">γ</a> <a id="11251" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7257" class="Function Operator">`,</a> <a id="11254" href="plfa.Soundness.html#11213" class="Bound">v′</a><a id="11256" class="Symbol">)</a> <a id="11258" href="plfa.Denotational.html#9274" class="Datatype Operator">⊢</a> <a id="11260" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6193" class="Function">rename</a> <a id="11267" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a> <a id="11270" href="plfa.Soundness.html#11233" class="Bound">M</a> <a id="11272" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="11274" href="plfa.Soundness.html#11216" class="Bound">v</a>
    <a id="11280" class="Comment">----------------------------</a>
  <a id="11311" class="Symbol">→</a> <a id="11313" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#11220" class="Bound">γ</a> <a id="11315" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="11317" href="plfa.Soundness.html#11233" class="Bound">M</a> <a id="11319" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="11321" href="plfa.Soundness.html#11216" class="Bound">v</a>
<a id="11323" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#11187" class="Function">rename-inc-reflect</a> <a id="11342" href="plfa.Soundness.html#11342" class="Bound">d</a> <a id="11344" class="Symbol">=</a> <a id="11346" href="plfa.Soundness.html#9053" class="Function">rename-reflect</a> <a id="11361" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#8548" class="Function">`Refl⊑</a> <a id="11368" href="plfa.Soundness.html#11342" class="Bound">d</a>
</pre>{% endraw %}

### Substitution reflects denotations, the variable case

We are almost ready to begin proving that simultaneous substitution
reflects denotations. That is, if `γ ⊢ (subst σ M) ↓ v`, then
`γ ⊢ σ k ↓ nth k δ` and `δ ⊢ M ↓ v` for any `k` and some `δ`.
We shall start with the case in which `M` is a variable `x`.
So instead the premise is `γ ⊢ σ x ↓ v` and we need to show that
`δ ⊢ x ↓ v` for some `δ`. The `δ` that we choose shall be the
environment that maps `x` to `v` and every other variable to `⊥`.

Next we define the environment that maps `x` to `v` and every other
variable to `⊥`, that is `const-env x v`. To tell variables apart, we
define the following function for deciding equality of variables.

{% raw %}<pre class="Agda"><a id="_var≟_"></a><a id="12090" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12090" class="Function Operator">_var≟_</a> <a id="12097" class="Symbol">:</a> <a id="12099" class="Symbol">∀</a> <a id="12101" class="Symbol">{</a><a id="12102" href="plfa.Soundness.html#12102" class="Bound">Γ</a><a id="12103" class="Symbol">}</a> <a id="12105" class="Symbol">→</a> <a id="12107" class="Symbol">(</a><a id="12108" href="plfa.Soundness.html#12108" class="Bound">x</a> <a id="12110" href="plfa.Soundness.html#12110" class="Bound">y</a> <a id="12112" class="Symbol">:</a> <a id="12114" href="plfa.Soundness.html#12102" class="Bound">Γ</a> <a id="12116" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3483" class="Datatype Operator">∋</a> <a id="12118" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="12119" class="Symbol">)</a> <a id="12121" class="Symbol">→</a> <a id="12123" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#605" class="Datatype">Dec</a> <a id="12127" class="Symbol">(</a><a id="12128" href="plfa.Soundness.html#12108" class="Bound">x</a> <a id="12130" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12132" href="plfa.Soundness.html#12110" class="Bound">y</a><a id="12133" class="Symbol">)</a>
<a id="12135" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3519" class="InductiveConstructor">Z</a> <a id="12137" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12090" class="Function Operator">var≟</a> <a id="12142" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a>  <a id="12145" class="Symbol">=</a>  <a id="12148" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12152" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="12157" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3519" class="InductiveConstructor">Z</a> <a id="12159" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12090" class="Function Operator">var≟</a> <a id="12164" class="Symbol">(</a><a id="12165" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="12167" class="Symbol">_)</a>  <a id="12171" class="Symbol">=</a>  <a id="12174" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12177" class="Symbol">λ()</a>
<a id="12181" class="Symbol">(</a><a id="12182" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3564" class="InductiveConstructor Operator">S</a> <a id="12184" class="Symbol">_)</a> <a id="12187" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12090" class="Function Operator">var≟</a> <a id="12192" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a>  <a id="12195" class="Symbol">=</a>  <a id="12198" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12201" class="Symbol">λ()</a>
<a id="12205" class="Symbol">(</a><a id="12206" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3564" class="InductiveConstructor Operator">S</a> <a id="12208" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12208" class="Bound">x</a><a id="12209" class="Symbol">)</a> <a id="12211" href="plfa.Soundness.html#12090" class="Function Operator">var≟</a> <a id="12216" class="Symbol">(</a><a id="12217" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="12219" href="plfa.Soundness.html#12219" class="Bound">y</a><a id="12220" class="Symbol">)</a> <a id="12222" class="Keyword">with</a>  <a id="12228" href="plfa.Soundness.html#12208" class="Bound">x</a> <a id="12230" href="plfa.Soundness.html#12090" class="Function Operator">var≟</a> <a id="12235" href="plfa.Soundness.html#12219" class="Bound">y</a>
<a id="12237" class="Symbol">...</a>                 <a id="12257" class="Symbol">|</a>  <a id="12260" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12264" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="12269" class="Symbol">=</a>  <a id="12272" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12276" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="12281" class="Symbol">...</a>                 <a id="12301" class="Symbol">|</a>  <a id="12304" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12307" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12307" class="Bound">neq</a>   <a id="12313" class="Symbol">=</a>  <a id="12316" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12319" class="Symbol">λ{</a><a id="12321" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="12326" class="Symbol">→</a> <a id="12328" href="plfa.Soundness.html#12307" class="Bound">neq</a> <a id="12332" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="12336" class="Symbol">}</a>

<a id="var≟-refl"></a><a id="12339" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12339" class="Function">var≟-refl</a> <a id="12349" class="Symbol">:</a> <a id="12351" class="Symbol">∀</a> <a id="12353" class="Symbol">{</a><a id="12354" href="plfa.Soundness.html#12354" class="Bound">Γ</a><a id="12355" class="Symbol">}</a> <a id="12357" class="Symbol">(</a><a id="12358" href="plfa.Soundness.html#12358" class="Bound">x</a> <a id="12360" class="Symbol">:</a> <a id="12362" href="plfa.Soundness.html#12354" class="Bound">Γ</a> <a id="12364" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3483" class="Datatype Operator">∋</a> <a id="12366" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="12367" class="Symbol">)</a> <a id="12369" class="Symbol">→</a> <a id="12371" class="Symbol">(</a><a id="12372" href="plfa.Soundness.html#12358" class="Bound">x</a> <a id="12374" href="plfa.Soundness.html#12090" class="Function Operator">var≟</a> <a id="12379" href="plfa.Soundness.html#12358" class="Bound">x</a><a id="12380" class="Symbol">)</a> <a id="12382" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12384" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12388" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="12393" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12339" class="Function">var≟-refl</a> <a id="12403" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3519" class="InductiveConstructor">Z</a> <a id="12405" class="Symbol">=</a> <a id="12407" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="12412" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12339" class="Function">var≟-refl</a> <a id="12422" class="Symbol">(</a><a id="12423" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3564" class="InductiveConstructor Operator">S</a> <a id="12425" href="plfa.Soundness.html#12425" class="Bound">x</a><a id="12426" class="Symbol">)</a> <a id="12428" class="Keyword">rewrite</a> <a id="12436" href="plfa.Soundness.html#12339" class="Function">var≟-refl</a> <a id="12446" href="plfa.Soundness.html#12425" class="Bound">x</a> <a id="12448" class="Symbol">=</a> <a id="12450" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>{% endraw %}
Now we use `var≟` to define `const-env`.

{% raw %}<pre class="Agda"><a id="const-env"></a><a id="12506" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12506" class="Function">const-env</a> <a id="12516" class="Symbol">:</a> <a id="12518" class="Symbol">∀{</a><a id="12520" href="plfa.Soundness.html#12520" class="Bound">Γ</a><a id="12521" class="Symbol">}</a> <a id="12523" class="Symbol">→</a> <a id="12525" class="Symbol">(</a><a id="12526" href="plfa.Soundness.html#12526" class="Bound">x</a> <a id="12528" class="Symbol">:</a> <a id="12530" href="plfa.Soundness.html#12520" class="Bound">Γ</a> <a id="12532" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3483" class="Datatype Operator">∋</a> <a id="12534" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="12535" class="Symbol">)</a> <a id="12537" class="Symbol">→</a> <a id="12539" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#3962" class="Datatype">Value</a> <a id="12545" class="Symbol">→</a> <a id="12547" href="plfa.Denotational.html#7100" class="Function">Env</a> <a id="12551" href="plfa.Soundness.html#12520" class="Bound">Γ</a>
<a id="12553" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12506" class="Function">const-env</a> <a id="12563" href="plfa.Soundness.html#12563" class="Bound">x</a> <a id="12565" href="plfa.Soundness.html#12565" class="Bound">v</a> <a id="12567" href="plfa.Soundness.html#12567" class="Bound">y</a> <a id="12569" class="Keyword">with</a> <a id="12574" href="plfa.Soundness.html#12563" class="Bound">x</a> <a id="12576" href="plfa.Soundness.html#12090" class="Function Operator">var≟</a> <a id="12581" href="plfa.Soundness.html#12567" class="Bound">y</a>
<a id="12583" class="Symbol">...</a>             <a id="12599" class="Symbol">|</a> <a id="12601" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12605" class="Symbol">_</a>       <a id="12613" class="Symbol">=</a> <a id="12615" class="Bound">v</a>
<a id="12617" class="Symbol">...</a>             <a id="12633" class="Symbol">|</a> <a id="12635" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12638" class="Symbol">_</a>        <a id="12647" class="Symbol">=</a> <a id="12649" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#3982" class="InductiveConstructor">⊥</a>
</pre>{% endraw %}
Of course, `const-env x v` maps `x` to value `v`

{% raw %}<pre class="Agda"><a id="same-const-env"></a><a id="12710" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12710" class="Function">same-const-env</a> <a id="12725" class="Symbol">:</a> <a id="12727" class="Symbol">∀{</a><a id="12729" href="plfa.Soundness.html#12729" class="Bound">Γ</a><a id="12730" class="Symbol">}</a> <a id="12732" class="Symbol">{</a><a id="12733" href="plfa.Soundness.html#12733" class="Bound">x</a> <a id="12735" class="Symbol">:</a> <a id="12737" href="plfa.Soundness.html#12729" class="Bound">Γ</a> <a id="12739" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3483" class="Datatype Operator">∋</a> <a id="12741" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="12742" class="Symbol">}</a> <a id="12744" class="Symbol">{</a><a id="12745" href="plfa.Soundness.html#12745" class="Bound">v</a><a id="12746" class="Symbol">}</a> <a id="12748" class="Symbol">→</a> <a id="12750" class="Symbol">(</a><a id="12751" href="plfa.Soundness.html#12506" class="Function">const-env</a> <a id="12761" href="plfa.Soundness.html#12733" class="Bound">x</a> <a id="12763" href="plfa.Soundness.html#12745" class="Bound">v</a><a id="12764" class="Symbol">)</a> <a id="12766" href="plfa.Soundness.html#12733" class="Bound">x</a> <a id="12768" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12770" href="plfa.Soundness.html#12745" class="Bound">v</a>
<a id="12772" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12710" class="Function">same-const-env</a> <a id="12787" class="Symbol">{</a><a id="12788" class="Argument">x</a> <a id="12790" class="Symbol">=</a> <a id="12792" href="plfa.Soundness.html#12792" class="Bound">x</a><a id="12793" class="Symbol">}</a> <a id="12795" class="Keyword">rewrite</a> <a id="12803" href="plfa.Soundness.html#12339" class="Function">var≟-refl</a> <a id="12813" href="plfa.Soundness.html#12792" class="Bound">x</a> <a id="12815" class="Symbol">=</a> <a id="12817" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>{% endraw %}
and `const-env x v` maps `y` to `⊥, so long as `x ≢ y`.

{% raw %}<pre class="Agda"><a id="diff-nth-const-env"></a><a id="12888" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12888" class="Function">diff-nth-const-env</a> <a id="12907" class="Symbol">:</a> <a id="12909" class="Symbol">∀{</a><a id="12911" href="plfa.Soundness.html#12911" class="Bound">Γ</a><a id="12912" class="Symbol">}</a> <a id="12914" class="Symbol">{</a><a id="12915" href="plfa.Soundness.html#12915" class="Bound">x</a> <a id="12917" href="plfa.Soundness.html#12917" class="Bound">y</a> <a id="12919" class="Symbol">:</a> <a id="12921" href="plfa.Soundness.html#12911" class="Bound">Γ</a> <a id="12923" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3483" class="Datatype Operator">∋</a> <a id="12925" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="12926" class="Symbol">}</a> <a id="12928" class="Symbol">{</a><a id="12929" href="plfa.Soundness.html#12929" class="Bound">v</a><a id="12930" class="Symbol">}</a>
  <a id="12934" class="Symbol">→</a> <a id="12936" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12915" class="Bound">x</a> <a id="12938" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#799" class="Function Operator">≢</a> <a id="12940" href="plfa.Soundness.html#12917" class="Bound">y</a>
    <a id="12946" class="Comment">-------------------</a>
  <a id="12968" class="Symbol">→</a> <a id="12970" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12506" class="Function">const-env</a> <a id="12980" href="plfa.Soundness.html#12915" class="Bound">x</a> <a id="12982" href="plfa.Soundness.html#12929" class="Bound">v</a> <a id="12984" href="plfa.Soundness.html#12917" class="Bound">y</a> <a id="12986" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12988" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#3982" class="InductiveConstructor">⊥</a>
<a id="12990" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12888" class="Function">diff-nth-const-env</a> <a id="13009" class="Symbol">{</a><a id="13010" href="plfa.Soundness.html#13010" class="Bound">Γ</a><a id="13011" class="Symbol">}</a> <a id="13013" class="Symbol">{</a><a id="13014" href="plfa.Soundness.html#13014" class="Bound">x</a><a id="13015" class="Symbol">}</a> <a id="13017" class="Symbol">{</a><a id="13018" href="plfa.Soundness.html#13018" class="Bound">y</a><a id="13019" class="Symbol">}</a> <a id="13021" href="plfa.Soundness.html#13021" class="Bound">neq</a> <a id="13025" class="Keyword">with</a> <a id="13030" href="plfa.Soundness.html#13014" class="Bound">x</a> <a id="13032" href="plfa.Soundness.html#12090" class="Function Operator">var≟</a> <a id="13037" href="plfa.Soundness.html#13018" class="Bound">y</a>
<a id="13039" class="Symbol">...</a>  <a id="13044" class="Symbol">|</a> <a id="13046" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="13050" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#13050" class="Bound">eq</a>  <a id="13054" class="Symbol">=</a>  <a id="13057" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#294" class="Function">⊥-elim</a> <a id="13064" class="Symbol">(</a><a id="13065" class="Bound">neq</a> <a id="13069" href="plfa.Soundness.html#13050" class="Bound">eq</a><a id="13071" class="Symbol">)</a>
<a id="13073" class="Symbol">...</a>  <a id="13078" class="Symbol">|</a> <a id="13080" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="13083" class="Symbol">_</a>    <a id="13088" class="Symbol">=</a>  <a id="13091" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>{% endraw %}
So we choose `const-env x v` for `δ` and obtain `δ ⊢ x ↓ v`
with the `var` rule.

It remains to prove that `γ ⊢ σ ↓ δ` and `δ ⊢ M ↓ v` for any `k`, given that
we have chosen `const-env x v` for `δ`.  We shall have two cases to
consider, `x ≡ y` or `x ≢ y`.

Now to finish the two cases of the proof.

* In the case where `x ≡ y`, we need to show
  that `γ ⊢ σ y ↓ v`, but that's just our premise.
* In the case where `x ≢ y,` we need to show
  that `γ ⊢ σ y ↓ ⊥`, which we do via rule `⊥-intro`.

Thus, we have completed the variable case of the proof that
simultaneous substitution reflects denotations.  Here is the proof
again, formally.

{% raw %}<pre class="Agda"><a id="subst-reflect-var"></a><a id="13747" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#13747" class="Function">subst-reflect-var</a> <a id="13765" class="Symbol">:</a> <a id="13767" class="Symbol">∀</a> <a id="13769" class="Symbol">{</a><a id="13770" href="plfa.Soundness.html#13770" class="Bound">Γ</a> <a id="13772" href="plfa.Soundness.html#13772" class="Bound">Δ</a><a id="13773" class="Symbol">}</a> <a id="13775" class="Symbol">{</a><a id="13776" href="plfa.Soundness.html#13776" class="Bound">γ</a> <a id="13778" class="Symbol">:</a> <a id="13780" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="13784" href="plfa.Soundness.html#13772" class="Bound">Δ</a><a id="13785" class="Symbol">}</a> <a id="13787" class="Symbol">{</a><a id="13788" href="plfa.Soundness.html#13788" class="Bound">x</a> <a id="13790" class="Symbol">:</a> <a id="13792" href="plfa.Soundness.html#13770" class="Bound">Γ</a> <a id="13794" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3483" class="Datatype Operator">∋</a> <a id="13796" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="13797" class="Symbol">}</a> <a id="13799" class="Symbol">{</a><a id="13800" href="plfa.Soundness.html#13800" class="Bound">v</a><a id="13801" class="Symbol">}</a> <a id="13803" class="Symbol">{</a><a id="13804" href="plfa.Soundness.html#13804" class="Bound">σ</a> <a id="13806" class="Symbol">:</a> <a id="13808" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Substitution.md %}{% raw %}#2446" class="Function">Subst</a> <a id="13814" href="plfa.Soundness.html#13770" class="Bound">Γ</a> <a id="13816" href="plfa.Soundness.html#13772" class="Bound">Δ</a><a id="13817" class="Symbol">}</a>
  <a id="13821" class="Symbol">→</a> <a id="13823" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#13776" class="Bound">γ</a> <a id="13825" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="13827" href="plfa.Soundness.html#13804" class="Bound">σ</a> <a id="13829" href="plfa.Soundness.html#13788" class="Bound">x</a> <a id="13831" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="13833" href="plfa.Soundness.html#13800" class="Bound">v</a>
    <a id="13839" class="Comment">-----------------------------------------</a>
  <a id="13883" class="Symbol">→</a> <a id="13885" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="13888" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#13888" class="Bound">δ</a> <a id="13890" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="13892" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="13896" href="plfa.Soundness.html#13770" class="Bound">Γ</a> <a id="13898" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="13900" href="plfa.Soundness.html#13776" class="Bound">γ</a> <a id="13902" href="plfa.Soundness.html#3197" class="Function Operator">`⊢</a> <a id="13905" href="plfa.Soundness.html#13804" class="Bound">σ</a> <a id="13907" href="plfa.Soundness.html#3197" class="Function Operator">↓</a> <a id="13909" href="plfa.Soundness.html#13888" class="Bound">δ</a>  <a id="13912" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a>  <a id="13915" href="plfa.Soundness.html#13888" class="Bound">δ</a> <a id="13917" href="plfa.Denotational.html#9274" class="Datatype Operator">⊢</a> <a id="13919" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4288" class="InductiveConstructor Operator">`</a> <a id="13921" href="plfa.Soundness.html#13788" class="Bound">x</a> <a id="13923" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="13925" href="plfa.Soundness.html#13800" class="Bound">v</a>
<a id="13927" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#13747" class="Function">subst-reflect-var</a> <a id="13945" class="Symbol">{</a><a id="13946" href="plfa.Soundness.html#13946" class="Bound">Γ</a><a id="13947" class="Symbol">}{</a><a id="13949" href="plfa.Soundness.html#13949" class="Bound">Δ</a><a id="13950" class="Symbol">}{</a><a id="13952" href="plfa.Soundness.html#13952" class="Bound">γ</a><a id="13953" class="Symbol">}{</a><a id="13955" href="plfa.Soundness.html#13955" class="Bound">x</a><a id="13956" class="Symbol">}{</a><a id="13958" href="plfa.Soundness.html#13958" class="Bound">v</a><a id="13959" class="Symbol">}{</a><a id="13961" href="plfa.Soundness.html#13961" class="Bound">σ</a><a id="13962" class="Symbol">}</a> <a id="13964" href="plfa.Soundness.html#13964" class="Bound">xv</a>
  <a id="13969" class="Keyword">rewrite</a> <a id="13977" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="13981" class="Symbol">(</a><a id="13982" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12710" class="Function">same-const-env</a> <a id="13997" class="Symbol">{</a><a id="13998" href="plfa.Soundness.html#13946" class="Bound">Γ</a><a id="13999" class="Symbol">}{</a><a id="14001" href="plfa.Soundness.html#13955" class="Bound">x</a><a id="14002" class="Symbol">}{</a><a id="14004" href="plfa.Soundness.html#13958" class="Bound">v</a><a id="14005" class="Symbol">})</a> <a id="14008" class="Symbol">=</a>
    <a id="14014" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14016" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#12506" class="Function">const-env</a> <a id="14026" href="plfa.Soundness.html#13955" class="Bound">x</a> <a id="14028" href="plfa.Soundness.html#13958" class="Bound">v</a> <a id="14030" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14032" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14034" href="plfa.Soundness.html#14067" class="Function">const-env-ok</a> <a id="14047" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14049" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9328" class="InductiveConstructor">var</a> <a id="14053" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="14055" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
  <a id="14059" class="Keyword">where</a>
  <a id="14067" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#14067" class="Function">const-env-ok</a> <a id="14080" class="Symbol">:</a> <a id="14082" href="plfa.Soundness.html#13952" class="Bound">γ</a> <a id="14084" href="plfa.Soundness.html#3197" class="Function Operator">`⊢</a> <a id="14087" href="plfa.Soundness.html#13961" class="Bound">σ</a> <a id="14089" href="plfa.Soundness.html#3197" class="Function Operator">↓</a> <a id="14091" href="plfa.Soundness.html#12506" class="Function">const-env</a> <a id="14101" href="plfa.Soundness.html#13955" class="Bound">x</a> <a id="14103" href="plfa.Soundness.html#13958" class="Bound">v</a>
  <a id="14107" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#14067" class="Function">const-env-ok</a> <a id="14120" href="plfa.Soundness.html#14120" class="Bound">y</a> <a id="14122" class="Keyword">with</a> <a id="14127" href="plfa.Soundness.html#13955" class="Bound">x</a> <a id="14129" href="plfa.Soundness.html#12090" class="Function Operator">var≟</a> <a id="14134" href="plfa.Soundness.html#14120" class="Bound">y</a>
  <a id="14138" class="Symbol">...</a> <a id="14142" class="Symbol">|</a> <a id="14144" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="14148" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#14148" class="Bound">x≡y</a> <a id="14152" class="Keyword">rewrite</a> <a id="14160" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="14164" href="plfa.Soundness.html#14148" class="Bound">x≡y</a> <a id="14168" class="Symbol">|</a> <a id="14170" href="plfa.Soundness.html#12710" class="Function">same-const-env</a> <a id="14185" class="Symbol">{</a><a id="14186" href="plfa.Soundness.html#13946" class="Bound">Γ</a><a id="14187" class="Symbol">}{</a><a id="14189" href="plfa.Soundness.html#13955" class="Bound">x</a><a id="14190" class="Symbol">}{</a><a id="14192" href="plfa.Soundness.html#13958" class="Bound">v</a><a id="14193" class="Symbol">}</a> <a id="14195" class="Symbol">=</a> <a id="14197" href="plfa.Soundness.html#13964" class="Bound">xv</a>
  <a id="14202" class="Symbol">...</a> <a id="14206" class="Symbol">|</a> <a id="14208" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="14211" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#14211" class="Bound">x≢y</a> <a id="14215" class="Keyword">rewrite</a> <a id="14223" href="plfa.Soundness.html#12888" class="Function">diff-nth-const-env</a> <a id="14242" class="Symbol">{</a><a id="14243" href="plfa.Soundness.html#13946" class="Bound">Γ</a><a id="14244" class="Symbol">}{</a><a id="14246" href="plfa.Soundness.html#13955" class="Bound">x</a><a id="14247" class="Symbol">}{</a><a id="14249" class="Bound">y</a><a id="14250" class="Symbol">}{</a><a id="14252" href="plfa.Soundness.html#13958" class="Bound">v</a><a id="14253" class="Symbol">}</a> <a id="14255" href="plfa.Soundness.html#14211" class="Bound">x≢y</a> <a id="14259" class="Symbol">=</a> <a id="14261" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9669" class="InductiveConstructor">⊥-intro</a>
</pre>{% endraw %}

### Substitutions and environment construction

Every substitution produces terms that can evaluate to `⊥`.

{% raw %}<pre class="Agda"><a id="subst-⊥"></a><a id="14388" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#14388" class="Function">subst-⊥</a> <a id="14396" class="Symbol">:</a> <a id="14398" class="Symbol">∀{</a><a id="14400" href="plfa.Soundness.html#14400" class="Bound">Γ</a> <a id="14402" href="plfa.Soundness.html#14402" class="Bound">Δ</a><a id="14403" class="Symbol">}{</a><a id="14405" href="plfa.Soundness.html#14405" class="Bound">γ</a> <a id="14407" class="Symbol">:</a> <a id="14409" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="14413" href="plfa.Soundness.html#14402" class="Bound">Δ</a><a id="14414" class="Symbol">}{</a><a id="14416" href="plfa.Soundness.html#14416" class="Bound">σ</a> <a id="14418" class="Symbol">:</a> <a id="14420" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Substitution.md %}{% raw %}#2446" class="Function">Subst</a> <a id="14426" href="plfa.Soundness.html#14400" class="Bound">Γ</a> <a id="14428" href="plfa.Soundness.html#14402" class="Bound">Δ</a><a id="14429" class="Symbol">}</a>
    <a id="14435" class="Comment">-----------------</a>
  <a id="14455" class="Symbol">→</a> <a id="14457" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#14405" class="Bound">γ</a> <a id="14459" href="plfa.Soundness.html#3197" class="Function Operator">`⊢</a> <a id="14462" href="plfa.Soundness.html#14416" class="Bound">σ</a> <a id="14464" href="plfa.Soundness.html#3197" class="Function Operator">↓</a> <a id="14466" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#8265" class="Function">`⊥</a>
<a id="14469" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#14388" class="Function">subst-⊥</a> <a id="14477" href="plfa.Soundness.html#14477" class="Bound">x</a> <a id="14479" class="Symbol">=</a> <a id="14481" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9669" class="InductiveConstructor">⊥-intro</a>
</pre>{% endraw %}
If a substitution produces terms that evaluate to the values in
both `γ₁` and `γ₂`, then those terms also evaluate to the values in
`γ₁ ⊔ γ₂`.

{% raw %}<pre class="Agda"><a id="subst-⊔"></a><a id="14642" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#14642" class="Function">subst-⊔</a> <a id="14650" class="Symbol">:</a> <a id="14652" class="Symbol">∀{</a><a id="14654" href="plfa.Soundness.html#14654" class="Bound">Γ</a> <a id="14656" href="plfa.Soundness.html#14656" class="Bound">Δ</a><a id="14657" class="Symbol">}{</a><a id="14659" href="plfa.Soundness.html#14659" class="Bound">γ</a> <a id="14661" class="Symbol">:</a> <a id="14663" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="14667" href="plfa.Soundness.html#14656" class="Bound">Δ</a><a id="14668" class="Symbol">}{</a><a id="14670" href="plfa.Soundness.html#14670" class="Bound">γ₁</a> <a id="14673" href="plfa.Soundness.html#14673" class="Bound">γ₂</a> <a id="14676" class="Symbol">:</a> <a id="14678" href="plfa.Denotational.html#7100" class="Function">Env</a> <a id="14682" href="plfa.Soundness.html#14654" class="Bound">Γ</a><a id="14683" class="Symbol">}{</a><a id="14685" href="plfa.Soundness.html#14685" class="Bound">σ</a> <a id="14687" class="Symbol">:</a> <a id="14689" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Substitution.md %}{% raw %}#2446" class="Function">Subst</a> <a id="14695" href="plfa.Soundness.html#14654" class="Bound">Γ</a> <a id="14697" href="plfa.Soundness.html#14656" class="Bound">Δ</a><a id="14698" class="Symbol">}</a>
           <a id="14711" class="Symbol">→</a> <a id="14713" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#14659" class="Bound">γ</a> <a id="14715" href="plfa.Soundness.html#3197" class="Function Operator">`⊢</a> <a id="14718" href="plfa.Soundness.html#14685" class="Bound">σ</a> <a id="14720" href="plfa.Soundness.html#3197" class="Function Operator">↓</a> <a id="14722" href="plfa.Soundness.html#14670" class="Bound">γ₁</a>
           <a id="14736" class="Symbol">→</a> <a id="14738" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#14659" class="Bound">γ</a> <a id="14740" href="plfa.Soundness.html#3197" class="Function Operator">`⊢</a> <a id="14743" href="plfa.Soundness.html#14685" class="Bound">σ</a> <a id="14745" href="plfa.Soundness.html#3197" class="Function Operator">↓</a> <a id="14747" href="plfa.Soundness.html#14673" class="Bound">γ₂</a>
             <a id="14763" class="Comment">-------------------------</a>
           <a id="14800" class="Symbol">→</a> <a id="14802" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#14659" class="Bound">γ</a> <a id="14804" href="plfa.Soundness.html#3197" class="Function Operator">`⊢</a> <a id="14807" href="plfa.Soundness.html#14685" class="Bound">σ</a> <a id="14809" href="plfa.Soundness.html#3197" class="Function Operator">↓</a> <a id="14811" class="Symbol">(</a><a id="14812" href="plfa.Soundness.html#14670" class="Bound">γ₁</a> <a id="14815" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#8294" class="Function Operator">`⊔</a> <a id="14818" href="plfa.Soundness.html#14673" class="Bound">γ₂</a><a id="14820" class="Symbol">)</a>
<a id="14822" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#14642" class="Function">subst-⊔</a> <a id="14830" href="plfa.Soundness.html#14830" class="Bound">γ₁-ok</a> <a id="14836" href="plfa.Soundness.html#14836" class="Bound">γ₂-ok</a> <a id="14842" href="plfa.Soundness.html#14842" class="Bound">x</a> <a id="14844" class="Symbol">=</a> <a id="14846" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9744" class="InductiveConstructor">⊔-intro</a> <a id="14854" class="Symbol">(</a><a id="14855" href="plfa.Soundness.html#14830" class="Bound">γ₁-ok</a> <a id="14861" href="plfa.Soundness.html#14842" class="Bound">x</a><a id="14862" class="Symbol">)</a> <a id="14864" class="Symbol">(</a><a id="14865" href="plfa.Soundness.html#14836" class="Bound">γ₂-ok</a> <a id="14871" href="plfa.Soundness.html#14842" class="Bound">x</a><a id="14872" class="Symbol">)</a>
</pre>{% endraw %}
### The Lambda constructor is injective

{% raw %}<pre class="Agda"><a id="lambda-inj"></a><a id="14924" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#14924" class="Function">lambda-inj</a> <a id="14935" class="Symbol">:</a> <a id="14937" class="Symbol">∀</a> <a id="14939" class="Symbol">{</a><a id="14940" href="plfa.Soundness.html#14940" class="Bound">Γ</a><a id="14941" class="Symbol">}</a> <a id="14943" class="Symbol">{</a><a id="14944" href="plfa.Soundness.html#14944" class="Bound">M</a> <a id="14946" href="plfa.Soundness.html#14946" class="Bound">N</a> <a id="14948" class="Symbol">:</a> <a id="14950" href="plfa.Soundness.html#14940" class="Bound">Γ</a> <a id="14952" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3168" class="InductiveConstructor Operator">,</a> <a id="14954" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="14956" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="14958" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="14960" class="Symbol">}</a>
  <a id="14964" class="Symbol">→</a> <a id="14966" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">_≡_</a> <a id="14970" class="Symbol">{</a><a id="14971" class="Argument">A</a> <a id="14973" class="Symbol">=</a> <a id="14975" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#14940" class="Bound">Γ</a> <a id="14977" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4252" class="Datatype Operator">⊢</a> <a id="14979" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="14980" class="Symbol">}</a> <a id="14982" class="Symbol">(</a><a id="14983" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="14985" href="plfa.Soundness.html#14944" class="Bound">M</a><a id="14986" class="Symbol">)</a> <a id="14988" class="Symbol">(</a><a id="14989" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="14991" href="plfa.Soundness.html#14946" class="Bound">N</a><a id="14992" class="Symbol">)</a>
    <a id="14998" class="Comment">---------------------------</a>
  <a id="15028" class="Symbol">→</a> <a id="15030" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#14944" class="Bound">M</a> <a id="15032" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="15034" href="plfa.Soundness.html#14946" class="Bound">N</a>
<a id="15036" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#14924" class="Function">lambda-inj</a> <a id="15047" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="15052" class="Symbol">=</a> <a id="15054" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>{% endraw %}
### Simultaneous substitution reflects denotations

In this section we prove a central lemma, that
substitution reflects denotations. That is, if `γ ⊢ subst σ M ↓ v`, then
`δ ⊢ M ↓ v` and `γ ⊢ σ ↓ δ` for some `δ`. We shall proceed by induction on
the derivation of `γ ⊢ subst σ M ↓ v`. This requires a minor
restatement of the lemma, changing the premise to `γ ⊢ L ↓ v` and
`L ≡ subst σ M`.

{% raw %}<pre class="Agda"><a id="split"></a><a id="15460" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15460" class="Function">split</a> <a id="15466" class="Symbol">:</a> <a id="15468" class="Symbol">∀</a> <a id="15470" class="Symbol">{</a><a id="15471" href="plfa.Soundness.html#15471" class="Bound">Γ</a><a id="15472" class="Symbol">}</a> <a id="15474" class="Symbol">{</a><a id="15475" href="plfa.Soundness.html#15475" class="Bound">M</a> <a id="15477" class="Symbol">:</a> <a id="15479" href="plfa.Soundness.html#15471" class="Bound">Γ</a> <a id="15481" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3168" class="InductiveConstructor Operator">,</a> <a id="15483" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="15485" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="15487" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="15488" class="Symbol">}</a> <a id="15490" class="Symbol">{</a><a id="15491" href="plfa.Soundness.html#15491" class="Bound">δ</a> <a id="15493" class="Symbol">:</a> <a id="15495" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="15499" class="Symbol">(</a><a id="15500" href="plfa.Soundness.html#15471" class="Bound">Γ</a> <a id="15502" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="15504" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="15505" class="Symbol">)}</a> <a id="15508" class="Symbol">{</a><a id="15509" href="plfa.Soundness.html#15509" class="Bound">v</a><a id="15510" class="Symbol">}</a>
  <a id="15514" class="Symbol">→</a> <a id="15516" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15491" class="Bound">δ</a> <a id="15518" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="15520" href="plfa.Soundness.html#15475" class="Bound">M</a> <a id="15522" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="15524" href="plfa.Soundness.html#15509" class="Bound">v</a>
    <a id="15530" class="Comment">--------------------------</a>
  <a id="15559" class="Symbol">→</a> <a id="15561" class="Symbol">(</a><a id="15562" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7494" class="Function">init</a> <a id="15567" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15491" class="Bound">δ</a> <a id="15569" href="plfa.Denotational.html#7257" class="Function Operator">`,</a> <a id="15572" href="plfa.Denotational.html#7549" class="Function">last</a> <a id="15577" href="plfa.Soundness.html#15491" class="Bound">δ</a><a id="15578" class="Symbol">)</a> <a id="15580" href="plfa.Denotational.html#9274" class="Datatype Operator">⊢</a> <a id="15582" href="plfa.Soundness.html#15475" class="Bound">M</a> <a id="15584" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="15586" href="plfa.Soundness.html#15509" class="Bound">v</a>
<a id="15588" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15460" class="Function">split</a> <a id="15594" class="Symbol">{</a><a id="15595" class="Argument">δ</a> <a id="15597" class="Symbol">=</a> <a id="15599" href="plfa.Soundness.html#15599" class="Bound">δ</a><a id="15600" class="Symbol">}</a> <a id="15602" href="plfa.Soundness.html#15602" class="Bound">δMv</a> <a id="15606" class="Keyword">rewrite</a> <a id="15614" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7598" class="Function">init-last</a> <a id="15624" href="plfa.Soundness.html#15599" class="Bound">δ</a> <a id="15626" class="Symbol">=</a> <a id="15628" href="plfa.Soundness.html#15602" class="Bound">δMv</a>

<a id="subst-reflect"></a><a id="15633" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15633" class="Function">subst-reflect</a> <a id="15647" class="Symbol">:</a> <a id="15649" class="Symbol">∀</a> <a id="15651" class="Symbol">{</a><a id="15652" href="plfa.Soundness.html#15652" class="Bound">Γ</a> <a id="15654" href="plfa.Soundness.html#15654" class="Bound">Δ</a><a id="15655" class="Symbol">}</a> <a id="15657" class="Symbol">{</a><a id="15658" href="plfa.Soundness.html#15658" class="Bound">δ</a> <a id="15660" class="Symbol">:</a> <a id="15662" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="15666" href="plfa.Soundness.html#15654" class="Bound">Δ</a><a id="15667" class="Symbol">}</a> <a id="15669" class="Symbol">{</a><a id="15670" href="plfa.Soundness.html#15670" class="Bound">M</a> <a id="15672" class="Symbol">:</a> <a id="15674" href="plfa.Soundness.html#15652" class="Bound">Γ</a> <a id="15676" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4252" class="Datatype Operator">⊢</a> <a id="15678" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="15679" class="Symbol">}</a> <a id="15681" class="Symbol">{</a><a id="15682" href="plfa.Soundness.html#15682" class="Bound">v</a><a id="15683" class="Symbol">}</a> <a id="15685" class="Symbol">{</a><a id="15686" href="plfa.Soundness.html#15686" class="Bound">L</a> <a id="15688" class="Symbol">:</a> <a id="15690" href="plfa.Soundness.html#15654" class="Bound">Δ</a> <a id="15692" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="15694" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="15695" class="Symbol">}</a> <a id="15697" class="Symbol">{</a><a id="15698" href="plfa.Soundness.html#15698" class="Bound">σ</a> <a id="15700" class="Symbol">:</a> <a id="15702" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Substitution.md %}{% raw %}#2446" class="Function">Subst</a> <a id="15708" href="plfa.Soundness.html#15652" class="Bound">Γ</a> <a id="15710" href="plfa.Soundness.html#15654" class="Bound">Δ</a><a id="15711" class="Symbol">}</a>
  <a id="15715" class="Symbol">→</a> <a id="15717" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15658" class="Bound">δ</a> <a id="15719" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="15721" href="plfa.Soundness.html#15686" class="Bound">L</a> <a id="15723" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="15725" href="plfa.Soundness.html#15682" class="Bound">v</a>
  <a id="15729" class="Symbol">→</a> <a id="15731" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6921" class="Function">subst</a> <a id="15737" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15698" class="Bound">σ</a> <a id="15739" href="plfa.Soundness.html#15670" class="Bound">M</a> <a id="15741" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="15743" href="plfa.Soundness.html#15686" class="Bound">L</a>
    <a id="15749" class="Comment">---------------------------------------</a>
  <a id="15791" class="Symbol">→</a> <a id="15793" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="15796" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15796" class="Bound">γ</a> <a id="15798" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="15800" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="15804" href="plfa.Soundness.html#15652" class="Bound">Γ</a> <a id="15806" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="15808" href="plfa.Soundness.html#15658" class="Bound">δ</a> <a id="15810" href="plfa.Soundness.html#3197" class="Function Operator">`⊢</a> <a id="15813" href="plfa.Soundness.html#15698" class="Bound">σ</a> <a id="15815" href="plfa.Soundness.html#3197" class="Function Operator">↓</a> <a id="15817" href="plfa.Soundness.html#15796" class="Bound">γ</a>  <a id="15820" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a>  <a id="15823" href="plfa.Soundness.html#15796" class="Bound">γ</a> <a id="15825" href="plfa.Denotational.html#9274" class="Datatype Operator">⊢</a> <a id="15827" href="plfa.Soundness.html#15670" class="Bound">M</a> <a id="15829" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="15831" href="plfa.Soundness.html#15682" class="Bound">v</a>

<a id="15834" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15633" class="Function">subst-reflect</a> <a id="15848" class="Symbol">{</a><a id="15849" class="Argument">M</a> <a id="15851" class="Symbol">=</a> <a id="15853" href="plfa.Soundness.html#15853" class="Bound">M</a><a id="15854" class="Symbol">}{</a><a id="15856" class="Argument">σ</a> <a id="15858" class="Symbol">=</a> <a id="15860" href="plfa.Soundness.html#15860" class="Bound">σ</a><a id="15861" class="Symbol">}</a> <a id="15863" class="Symbol">(</a><a id="15864" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9328" class="InductiveConstructor">var</a> <a id="15868" class="Symbol">{</a><a id="15869" class="Argument">x</a> <a id="15871" class="Symbol">=</a> <a id="15873" href="plfa.Soundness.html#15873" class="Bound">y</a><a id="15874" class="Symbol">})</a> <a id="15877" href="plfa.Soundness.html#15877" class="Bound">eqL</a> <a id="15881" class="Keyword">with</a> <a id="15886" href="plfa.Soundness.html#15853" class="Bound">M</a>
<a id="15888" class="Symbol">...</a> <a id="15892" class="Symbol">|</a> <a id="15894" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4288" class="InductiveConstructor Operator">`</a> <a id="15896" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15896" class="Bound">x</a>  <a id="15899" class="Keyword">with</a> <a id="15904" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9328" class="InductiveConstructor">var</a> <a id="15908" class="Symbol">{</a><a id="15909" class="Argument">x</a> <a id="15911" class="Symbol">=</a> <a id="15913" class="Bound">y</a><a id="15914" class="Symbol">}</a>
<a id="15916" class="Symbol">...</a>           <a id="15930" class="Symbol">|</a> <a id="15932" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15932" class="Bound">yv</a>  <a id="15936" class="Keyword">rewrite</a> <a id="15944" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="15948" class="Bound">eqL</a> <a id="15952" class="Symbol">=</a> <a id="15954" href="plfa.Soundness.html#13747" class="Function">subst-reflect-var</a> <a id="15972" class="Symbol">{</a><a id="15973" class="Argument">σ</a> <a id="15975" class="Symbol">=</a> <a id="15977" class="Bound">σ</a><a id="15978" class="Symbol">}</a> <a id="15980" href="plfa.Soundness.html#15932" class="Bound">yv</a>
<a id="15983" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15633" class="Function">subst-reflect</a> <a id="15997" class="Symbol">{</a><a id="15998" class="Argument">M</a> <a id="16000" class="Symbol">=</a> <a id="16002" href="plfa.Soundness.html#16002" class="Bound">M</a><a id="16003" class="Symbol">}</a> <a id="16005" class="Symbol">(</a><a id="16006" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9328" class="InductiveConstructor">var</a> <a id="16010" class="Symbol">{</a><a id="16011" class="Argument">x</a> <a id="16013" class="Symbol">=</a> <a id="16015" href="plfa.Soundness.html#16015" class="Bound">y</a><a id="16016" class="Symbol">})</a> <a id="16019" class="Symbol">()</a> <a id="16022" class="Symbol">|</a> <a id="16024" href="plfa.Soundness.html#16024" class="Bound">M₁</a> <a id="16027" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4400" class="InductiveConstructor Operator">·</a> <a id="16029" href="plfa.Soundness.html#16029" class="Bound">M₂</a>
<a id="16032" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15633" class="Function">subst-reflect</a> <a id="16046" class="Symbol">{</a><a id="16047" class="Argument">M</a> <a id="16049" class="Symbol">=</a> <a id="16051" href="plfa.Soundness.html#16051" class="Bound">M</a><a id="16052" class="Symbol">}</a> <a id="16054" class="Symbol">(</a><a id="16055" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9328" class="InductiveConstructor">var</a> <a id="16059" class="Symbol">{</a><a id="16060" class="Argument">x</a> <a id="16062" class="Symbol">=</a> <a id="16064" href="plfa.Soundness.html#16064" class="Bound">y</a><a id="16065" class="Symbol">})</a> <a id="16068" class="Symbol">()</a> <a id="16071" class="Symbol">|</a> <a id="16073" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16075" href="plfa.Soundness.html#16075" class="Bound">M′</a>

<a id="16079" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15633" class="Function">subst-reflect</a> <a id="16093" class="Symbol">{</a><a id="16094" class="Argument">M</a> <a id="16096" class="Symbol">=</a> <a id="16098" href="plfa.Soundness.html#16098" class="Bound">M</a><a id="16099" class="Symbol">}{</a><a id="16101" class="Argument">σ</a> <a id="16103" class="Symbol">=</a> <a id="16105" href="plfa.Soundness.html#16105" class="Bound">σ</a><a id="16106" class="Symbol">}</a> <a id="16108" class="Symbol">(</a><a id="16109" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="16116" href="plfa.Soundness.html#16116" class="Bound">d₁</a> <a id="16119" href="plfa.Soundness.html#16119" class="Bound">d₂</a><a id="16121" class="Symbol">)</a> <a id="16123" href="plfa.Soundness.html#16123" class="Bound">eqL</a>
         <a id="16136" class="Keyword">with</a> <a id="16141" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#16098" class="Bound">M</a>
<a id="16143" class="Symbol">...</a>    <a id="16150" class="Symbol">|</a> <a id="16152" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4288" class="InductiveConstructor Operator">`</a> <a id="16154" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#16154" class="Bound">x</a> <a id="16156" class="Keyword">with</a> <a id="16161" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="16168" class="Bound">d₁</a> <a id="16171" class="Bound">d₂</a>
<a id="16174" class="Symbol">...</a>    <a id="16181" class="Symbol">|</a> <a id="16183" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#16183" class="Bound">d′</a> <a id="16186" class="Keyword">rewrite</a> <a id="16194" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="16198" class="Bound">eqL</a> <a id="16202" class="Symbol">=</a> <a id="16204" href="plfa.Soundness.html#13747" class="Function">subst-reflect-var</a> <a id="16222" class="Symbol">{</a><a id="16223" class="Argument">σ</a> <a id="16225" class="Symbol">=</a> <a id="16227" class="Bound">σ</a><a id="16228" class="Symbol">}</a> <a id="16230" href="plfa.Soundness.html#16183" class="Bound">d′</a>
<a id="16233" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15633" class="Function">subst-reflect</a> <a id="16247" class="Symbol">(</a><a id="16248" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="16255" href="plfa.Soundness.html#16255" class="Bound">d₁</a> <a id="16258" href="plfa.Soundness.html#16258" class="Bound">d₂</a><a id="16260" class="Symbol">)</a> <a id="16262" class="Symbol">()</a> <a id="16265" class="Symbol">|</a> <a id="16267" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16269" href="plfa.Soundness.html#16269" class="Bound">M′</a>
<a id="16272" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15633" class="Function">subst-reflect</a><a id="16285" class="Symbol">{</a><a id="16286" href="plfa.Soundness.html#16286" class="Bound">Γ</a><a id="16287" class="Symbol">}{</a><a id="16289" href="plfa.Soundness.html#16289" class="Bound">Δ</a><a id="16290" class="Symbol">}{</a><a id="16292" href="plfa.Soundness.html#16292" class="Bound">γ</a><a id="16293" class="Symbol">}{</a><a id="16295" class="Argument">σ</a> <a id="16297" class="Symbol">=</a> <a id="16299" href="plfa.Soundness.html#16299" class="Bound">σ</a><a id="16300" class="Symbol">}</a> <a id="16302" class="Symbol">(</a><a id="16303" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="16310" href="plfa.Soundness.html#16310" class="Bound">d₁</a> <a id="16313" href="plfa.Soundness.html#16313" class="Bound">d₂</a><a id="16315" class="Symbol">)</a>
   <a id="16320" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="16325" class="Symbol">|</a> <a id="16327" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#16327" class="Bound">M₁</a> <a id="16330" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4400" class="InductiveConstructor Operator">·</a> <a id="16332" href="plfa.Soundness.html#16332" class="Bound">M₂</a>
     <a id="16340" class="Keyword">with</a> <a id="16345" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15633" class="Function">subst-reflect</a> <a id="16359" class="Symbol">{</a><a id="16360" class="Argument">M</a> <a id="16362" class="Symbol">=</a> <a id="16364" href="plfa.Soundness.html#16327" class="Bound">M₁</a><a id="16366" class="Symbol">}</a> <a id="16368" href="plfa.Soundness.html#16310" class="Bound">d₁</a> <a id="16371" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="16376" class="Symbol">|</a> <a id="16378" href="plfa.Soundness.html#15633" class="Function">subst-reflect</a> <a id="16392" class="Symbol">{</a><a id="16393" class="Argument">M</a> <a id="16395" class="Symbol">=</a> <a id="16397" href="plfa.Soundness.html#16332" class="Bound">M₂</a><a id="16399" class="Symbol">}</a> <a id="16401" href="plfa.Soundness.html#16313" class="Bound">d₂</a> <a id="16404" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="16409" class="Symbol">...</a>     <a id="16417" class="Symbol">|</a> <a id="16419" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16421" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#16421" class="Bound">δ₁</a> <a id="16424" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16426" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16428" href="plfa.Soundness.html#16428" class="Bound">subst-δ₁</a> <a id="16437" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16439" href="plfa.Soundness.html#16439" class="Bound">m1</a> <a id="16442" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16444" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16446" class="Symbol">|</a> <a id="16448" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16450" href="plfa.Soundness.html#16450" class="Bound">δ₂</a> <a id="16453" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16455" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16457" href="plfa.Soundness.html#16457" class="Bound">subst-δ₂</a> <a id="16466" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16468" href="plfa.Soundness.html#16468" class="Bound">m2</a> <a id="16471" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16473" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16475" class="Symbol">=</a>
     <a id="16482" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16484" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#16421" class="Bound">δ₁</a> <a id="16487" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#8294" class="Function Operator">`⊔</a> <a id="16490" href="plfa.Soundness.html#16450" class="Bound">δ₂</a> <a id="16493" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16495" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16497" href="plfa.Soundness.html#14642" class="Function">subst-⊔</a> <a id="16505" class="Symbol">{</a><a id="16506" class="Argument">γ₁</a> <a id="16509" class="Symbol">=</a> <a id="16511" href="plfa.Soundness.html#16421" class="Bound">δ₁</a><a id="16513" class="Symbol">}{</a><a id="16515" class="Argument">γ₂</a> <a id="16518" class="Symbol">=</a> <a id="16520" href="plfa.Soundness.html#16450" class="Bound">δ₂</a><a id="16522" class="Symbol">}{</a><a id="16524" class="Argument">σ</a> <a id="16526" class="Symbol">=</a> <a id="16528" class="Bound">σ</a><a id="16529" class="Symbol">}</a> <a id="16531" href="plfa.Soundness.html#16428" class="Bound">subst-δ₁</a> <a id="16540" href="plfa.Soundness.html#16457" class="Bound">subst-δ₂</a> <a id="16549" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a>
                    <a id="16571" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="16578" class="Symbol">(</a><a id="16579" href="plfa.Denotational.html#25220" class="Function">Env⊑</a> <a id="16584" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#16439" class="Bound">m1</a> <a id="16587" class="Symbol">(</a><a id="16588" href="plfa.Denotational.html#8616" class="Function">EnvConjR1⊑</a> <a id="16599" href="plfa.Soundness.html#16421" class="Bound">δ₁</a> <a id="16602" href="plfa.Soundness.html#16450" class="Bound">δ₂</a><a id="16604" class="Symbol">))</a>
                           <a id="16634" class="Symbol">(</a><a id="16635" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#25220" class="Function">Env⊑</a> <a id="16640" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#16468" class="Bound">m2</a> <a id="16643" class="Symbol">(</a><a id="16644" href="plfa.Denotational.html#8713" class="Function">EnvConjR2⊑</a> <a id="16655" href="plfa.Soundness.html#16421" class="Bound">δ₁</a> <a id="16658" href="plfa.Soundness.html#16450" class="Bound">δ₂</a><a id="16660" class="Symbol">))</a> <a id="16663" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16665" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>

<a id="16668" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15633" class="Function">subst-reflect</a> <a id="16682" class="Symbol">{</a><a id="16683" class="Argument">M</a> <a id="16685" class="Symbol">=</a> <a id="16687" href="plfa.Soundness.html#16687" class="Bound">M</a><a id="16688" class="Symbol">}{</a><a id="16690" class="Argument">σ</a> <a id="16692" class="Symbol">=</a> <a id="16694" href="plfa.Soundness.html#16694" class="Bound">σ</a><a id="16695" class="Symbol">}</a> <a id="16697" class="Symbol">(</a><a id="16698" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9545" class="InductiveConstructor">↦-intro</a> <a id="16706" href="plfa.Soundness.html#16706" class="Bound">d</a><a id="16707" class="Symbol">)</a> <a id="16709" href="plfa.Soundness.html#16709" class="Bound">eqL</a> <a id="16713" class="Keyword">with</a> <a id="16718" href="plfa.Soundness.html#16687" class="Bound">M</a>
<a id="16720" class="Symbol">...</a>    <a id="16727" class="Symbol">|</a> <a id="16729" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4288" class="InductiveConstructor Operator">`</a> <a id="16731" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#16731" class="Bound">x</a> <a id="16733" class="Keyword">with</a> <a id="16738" class="Symbol">(</a><a id="16739" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9545" class="InductiveConstructor">↦-intro</a> <a id="16747" class="Bound">d</a><a id="16748" class="Symbol">)</a>
<a id="16750" class="Symbol">...</a>             <a id="16766" class="Symbol">|</a> <a id="16768" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#16768" class="Bound">d′</a> <a id="16771" class="Keyword">rewrite</a> <a id="16779" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="16783" class="Bound">eqL</a> <a id="16787" class="Symbol">=</a> <a id="16789" href="plfa.Soundness.html#13747" class="Function">subst-reflect-var</a> <a id="16807" class="Symbol">{</a><a id="16808" class="Argument">σ</a> <a id="16810" class="Symbol">=</a> <a id="16812" class="Bound">σ</a><a id="16813" class="Symbol">}</a> <a id="16815" href="plfa.Soundness.html#16768" class="Bound">d′</a>
<a id="16818" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15633" class="Function">subst-reflect</a> <a id="16832" class="Symbol">{</a><a id="16833" class="Argument">σ</a> <a id="16835" class="Symbol">=</a> <a id="16837" href="plfa.Soundness.html#16837" class="Bound">σ</a><a id="16838" class="Symbol">}</a> <a id="16840" class="Symbol">(</a><a id="16841" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9545" class="InductiveConstructor">↦-intro</a> <a id="16849" href="plfa.Soundness.html#16849" class="Bound">d</a><a id="16850" class="Symbol">)</a> <a id="16852" href="plfa.Soundness.html#16852" class="Bound">eq</a> <a id="16855" class="Symbol">|</a> <a id="16857" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16859" href="plfa.Soundness.html#16859" class="Bound">M′</a>
      <a id="16868" class="Keyword">with</a> <a id="16873" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15633" class="Function">subst-reflect</a> <a id="16887" class="Symbol">{</a><a id="16888" class="Argument">σ</a> <a id="16890" class="Symbol">=</a> <a id="16892" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6629" class="Function">exts</a> <a id="16897" href="plfa.Soundness.html#16837" class="Bound">σ</a><a id="16898" class="Symbol">}</a> <a id="16900" href="plfa.Soundness.html#16849" class="Bound">d</a> <a id="16902" class="Symbol">(</a><a id="16903" href="plfa.Soundness.html#14924" class="Function">lambda-inj</a> <a id="16914" href="plfa.Soundness.html#16852" class="Bound">eq</a><a id="16916" class="Symbol">)</a>
<a id="16918" class="Symbol">...</a> <a id="16922" class="Symbol">|</a> <a id="16924" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16926" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#16926" class="Bound">δ′</a> <a id="16929" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16931" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16933" href="plfa.Soundness.html#16933" class="Bound">exts-σ-δ′</a> <a id="16943" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16945" href="plfa.Soundness.html#16945" class="Bound">m′</a> <a id="16948" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16950" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16952" class="Symbol">=</a>
    <a id="16958" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16960" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7494" class="Function">init</a> <a id="16965" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#16926" class="Bound">δ′</a> <a id="16968" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16970" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16972" class="Symbol">((λ</a> <a id="16976" href="plfa.Soundness.html#16976" class="Bound">x</a> <a id="16978" class="Symbol">→</a> <a id="16980" href="plfa.Soundness.html#11187" class="Function">rename-inc-reflect</a> <a id="16999" class="Symbol">(</a><a id="17000" href="plfa.Soundness.html#16933" class="Bound">exts-σ-δ′</a> <a id="17010" class="Symbol">(</a><a id="17011" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3564" class="InductiveConstructor Operator">S</a> <a id="17013" href="plfa.Soundness.html#16976" class="Bound">x</a><a id="17014" class="Symbol">))))</a> <a id="17019" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a>
             <a id="17034" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9545" class="InductiveConstructor">↦-intro</a> <a id="17042" class="Symbol">(</a><a id="17043" href="plfa.Denotational.html#25648" class="Function">up-env</a> <a id="17050" class="Symbol">(</a><a id="17051" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15460" class="Function">split</a> <a id="17057" href="plfa.Soundness.html#16945" class="Bound">m′</a><a id="17059" class="Symbol">)</a> <a id="17061" class="Symbol">(</a><a id="17062" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9665" class="Function">var-inv</a> <a id="17070" class="Symbol">(</a><a id="17071" href="plfa.Soundness.html#16933" class="Bound">exts-σ-δ′</a> <a id="17081" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3519" class="InductiveConstructor">Z</a><a id="17082" class="Symbol">)))</a> <a id="17086" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17088" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="17090" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15633" class="Function">subst-reflect</a> <a id="17104" class="Symbol">(</a><a id="17105" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9545" class="InductiveConstructor">↦-intro</a> <a id="17113" href="plfa.Soundness.html#17113" class="Bound">d</a><a id="17114" class="Symbol">)</a> <a id="17116" class="Symbol">()</a> <a id="17119" class="Symbol">|</a> <a id="17121" href="plfa.Soundness.html#17121" class="Bound">M₁</a> <a id="17124" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4400" class="InductiveConstructor Operator">·</a> <a id="17126" href="plfa.Soundness.html#17126" class="Bound">M₂</a>

<a id="17130" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15633" class="Function">subst-reflect</a> <a id="17144" class="Symbol">{</a><a id="17145" class="Argument">σ</a> <a id="17147" class="Symbol">=</a> <a id="17149" href="plfa.Soundness.html#17149" class="Bound">σ</a><a id="17150" class="Symbol">}</a> <a id="17152" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9669" class="InductiveConstructor">⊥-intro</a> <a id="17160" href="plfa.Soundness.html#17160" class="Bound">eq</a> <a id="17163" class="Symbol">=</a>
    <a id="17169" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17171" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#8265" class="Function">`⊥</a> <a id="17174" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17176" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17178" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#14388" class="Function">subst-⊥</a> <a id="17186" class="Symbol">{</a><a id="17187" class="Argument">σ</a> <a id="17189" class="Symbol">=</a> <a id="17191" href="plfa.Soundness.html#17149" class="Bound">σ</a><a id="17192" class="Symbol">}</a> <a id="17194" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17196" href="plfa.Denotational.html#9669" class="InductiveConstructor">⊥-intro</a> <a id="17204" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17206" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>

<a id="17209" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15633" class="Function">subst-reflect</a> <a id="17223" class="Symbol">{</a><a id="17224" class="Argument">σ</a> <a id="17226" class="Symbol">=</a> <a id="17228" href="plfa.Soundness.html#17228" class="Bound">σ</a><a id="17229" class="Symbol">}</a> <a id="17231" class="Symbol">(</a><a id="17232" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9744" class="InductiveConstructor">⊔-intro</a> <a id="17240" href="plfa.Soundness.html#17240" class="Bound">d₁</a> <a id="17243" href="plfa.Soundness.html#17243" class="Bound">d₂</a><a id="17245" class="Symbol">)</a> <a id="17247" href="plfa.Soundness.html#17247" class="Bound">eq</a>
  <a id="17252" class="Keyword">with</a> <a id="17257" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15633" class="Function">subst-reflect</a> <a id="17271" class="Symbol">{</a><a id="17272" class="Argument">σ</a> <a id="17274" class="Symbol">=</a> <a id="17276" href="plfa.Soundness.html#17228" class="Bound">σ</a><a id="17277" class="Symbol">}</a> <a id="17279" href="plfa.Soundness.html#17240" class="Bound">d₁</a> <a id="17282" href="plfa.Soundness.html#17247" class="Bound">eq</a> <a id="17285" class="Symbol">|</a> <a id="17287" href="plfa.Soundness.html#15633" class="Function">subst-reflect</a> <a id="17301" class="Symbol">{</a><a id="17302" class="Argument">σ</a> <a id="17304" class="Symbol">=</a> <a id="17306" href="plfa.Soundness.html#17228" class="Bound">σ</a><a id="17307" class="Symbol">}</a> <a id="17309" href="plfa.Soundness.html#17243" class="Bound">d₂</a> <a id="17312" href="plfa.Soundness.html#17247" class="Bound">eq</a>
<a id="17315" class="Symbol">...</a> <a id="17319" class="Symbol">|</a> <a id="17321" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17323" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#17323" class="Bound">δ₁</a> <a id="17326" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17328" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17330" href="plfa.Soundness.html#17330" class="Bound">subst-δ₁</a> <a id="17339" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17341" href="plfa.Soundness.html#17341" class="Bound">m1</a> <a id="17344" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17346" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17348" class="Symbol">|</a> <a id="17350" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17352" href="plfa.Soundness.html#17352" class="Bound">δ₂</a> <a id="17355" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17357" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17359" href="plfa.Soundness.html#17359" class="Bound">subst-δ₂</a> <a id="17368" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17370" href="plfa.Soundness.html#17370" class="Bound">m2</a> <a id="17373" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17375" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17377" class="Symbol">=</a>
     <a id="17384" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17386" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#17323" class="Bound">δ₁</a> <a id="17389" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#8294" class="Function Operator">`⊔</a> <a id="17392" href="plfa.Soundness.html#17352" class="Bound">δ₂</a> <a id="17395" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17397" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17399" href="plfa.Soundness.html#14642" class="Function">subst-⊔</a> <a id="17407" class="Symbol">{</a><a id="17408" class="Argument">γ₁</a> <a id="17411" class="Symbol">=</a> <a id="17413" href="plfa.Soundness.html#17323" class="Bound">δ₁</a><a id="17415" class="Symbol">}{</a><a id="17417" class="Argument">γ₂</a> <a id="17420" class="Symbol">=</a> <a id="17422" href="plfa.Soundness.html#17352" class="Bound">δ₂</a><a id="17424" class="Symbol">}{</a><a id="17426" class="Argument">σ</a> <a id="17428" class="Symbol">=</a> <a id="17430" class="Bound">σ</a><a id="17431" class="Symbol">}</a> <a id="17433" href="plfa.Soundness.html#17330" class="Bound">subst-δ₁</a> <a id="17442" href="plfa.Soundness.html#17359" class="Bound">subst-δ₂</a> <a id="17451" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a>
                    <a id="17473" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9744" class="InductiveConstructor">⊔-intro</a> <a id="17481" class="Symbol">(</a><a id="17482" href="plfa.Denotational.html#25220" class="Function">Env⊑</a> <a id="17487" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#17341" class="Bound">m1</a> <a id="17490" class="Symbol">(</a><a id="17491" href="plfa.Denotational.html#8616" class="Function">EnvConjR1⊑</a> <a id="17502" href="plfa.Soundness.html#17323" class="Bound">δ₁</a> <a id="17505" href="plfa.Soundness.html#17352" class="Bound">δ₂</a><a id="17507" class="Symbol">))</a>
                            <a id="17538" class="Symbol">(</a><a id="17539" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#25220" class="Function">Env⊑</a> <a id="17544" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#17370" class="Bound">m2</a> <a id="17547" class="Symbol">(</a><a id="17548" href="plfa.Denotational.html#8713" class="Function">EnvConjR2⊑</a> <a id="17559" href="plfa.Soundness.html#17323" class="Bound">δ₁</a> <a id="17562" href="plfa.Soundness.html#17352" class="Bound">δ₂</a><a id="17564" class="Symbol">))</a> <a id="17567" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17569" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="17571" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15633" class="Function">subst-reflect</a> <a id="17585" class="Symbol">(</a><a id="17586" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9875" class="InductiveConstructor">sub</a> <a id="17590" href="plfa.Soundness.html#17590" class="Bound">d</a> <a id="17592" href="plfa.Soundness.html#17592" class="Bound">lt</a><a id="17594" class="Symbol">)</a> <a id="17596" href="plfa.Soundness.html#17596" class="Bound">eq</a>
    <a id="17603" class="Keyword">with</a> <a id="17608" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#15633" class="Function">subst-reflect</a> <a id="17622" href="plfa.Soundness.html#17590" class="Bound">d</a> <a id="17624" href="plfa.Soundness.html#17596" class="Bound">eq</a>
<a id="17627" class="Symbol">...</a> <a id="17631" class="Symbol">|</a> <a id="17633" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17635" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#17635" class="Bound">δ</a> <a id="17637" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17639" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17641" href="plfa.Soundness.html#17641" class="Bound">subst-δ</a> <a id="17649" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17651" href="plfa.Soundness.html#17651" class="Bound">m</a> <a id="17653" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17655" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17657" class="Symbol">=</a> <a id="17659" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17661" href="plfa.Soundness.html#17635" class="Bound">δ</a> <a id="17663" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17665" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17667" href="plfa.Soundness.html#17641" class="Bound">subst-δ</a> <a id="17675" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17677" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9875" class="InductiveConstructor">sub</a> <a id="17681" href="plfa.Soundness.html#17651" class="Bound">m</a> <a id="17683" class="Bound">lt</a> <a id="17686" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17688" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>{% endraw %}
* Case `var`: We have subst `σ M ≡ y`, so `M` must also be a variable, say `x`.
  We apply the lemma `subst-reflect-var` to conclude.

* Case `↦-elim`: We have `subst σ M ≡ L₁ · L₂`. We proceed by cases on `M`.
  * Case `M ≡ x`: We apply the `subst-reflect-var` lemma again to conclude.

  * Case `M ≡ M₁ · M₂`: By the induction hypothesis, we have
    some `δ₁` and `δ₂` such that `δ₁ ⊢ M₁ ↓ v₁ ↦ v₃` and `γ ⊢ σ ↓ δ₁`,
    as well as `δ₂ ⊢ M₂ ↓ v₁` and `γ ⊢ σ ↓ δ₂`.
    By `Env⊑` we have `δ₁ ⊔ δ₂ ⊢ M₁ ↓ v₁ ↦ v₃` and `δ₁ ⊔ δ₂ ⊢ M₂ ↓ v₁`
    (using `EnvConjR1⊑` and `EnvConjR2⊑`), and therefore
    `δ₁ ⊔ δ₂ ⊢ M₁ · M₂ ↓ v₃`.
    We conclude this case by obtaining `γ ⊢ σ ↓ δ₁ ⊔ δ₂`
    by the `subst-⊔` lemma.

* Case `↦-intro`: We have `subst σ M ≡ ƛ L′`. We proceed by cases on `M`.
  * Case `M ≡ x`: We apply the `subst-reflect-var` lemma.

  * Case `M ≡ ƛ M′`: By the induction hypothesis, we have
    `(δ′ , v′) ⊢ M′ ↓ v₂` and `(δ , v₁) ⊢ exts σ ↓ (δ′ , v′)`.
    From the later we have `(δ , v₁) ⊢ # 0 ↓ v′`.
    By the lemma `var-inv` we have `v′ ⊑ v₁`, so by the `up-env` lemma we
    have `(δ′ , v₁) ⊢ M′ ↓ v₂` and therefore `δ′ ⊢ ƛ M′ ↓ v₁ → v₂`.  We
    also need to show that `δ `⊢ σ ↓ δ′`.  Fix `k`. We have
    `(δ , v₁) ⊢ rename S_ σ k ↓ nth k δ′`.  We then apply the lemma
    `rename-inc-reflect` to obtain `δ ⊢ σ k ↓ nth k δ′`, so this case is
    complete.

* Case `⊥-intro`: We choose `⊥` for `δ`.
  We have `⊥ ⊢ M ↓ ⊥` by `⊥-intro`.
  We have `δ ⊢ σ ↓ ⊥` by the lemma `subst-empty`.

* Case `⊔-intro`: By the induction hypothesis we have
  `δ₁ ⊢ M ↓ v₁`, `δ₂ ⊢ M ↓ v₂`, `δ ⊢ σ ↓ δ₁`, and `δ ⊢ σ ↓ δ₂`.
  We have `δ₁ ⊔ δ₂ ⊢ M ↓ v₁` and `δ₁ ⊔ δ₂ ⊢ M ↓ v₂`
  by `Env⊑` with `EnvConjR1⊑` and `EnvConjR2⊑`.
  So by `⊔-intro` we have `δ₁ ⊔ δ₂ ⊢ M ↓ v₁ ⊔ v₂`.
  By `subst-⊔` we conclude that `δ ⊢ σ ↓ δ₁ ⊔ δ₂`.


### Single substitution reflects denotations

Most of the work is now behind us. We have proved that simultaneous
substitution reflects denotations. Of course, β reduction uses single
substitution, so we need a corollary that proves that single
substitution reflects denotations. That is,
given terms `N : (Γ , ★ ⊢ ★)` and `M : (Γ ⊢ ★)`,
if `γ ⊢ N [ M ] ↓ w`, then `γ ⊢ M ↓ v` and `(γ , v) ⊢ N ↓ w`
for some value `v`. We have `N [ M ] = subst (subst-zero M) N`.

We first prove a lemma about `subst-zero`, that if
`δ ⊢ subst-zero M ↓ γ`, then
`γ ⊑ (δ , w) × δ ⊢ M ↓ w` for some `w`.

{% raw %}<pre class="Agda"><a id="subst-zero-reflect"></a><a id="20112" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#20112" class="Function">subst-zero-reflect</a> <a id="20131" class="Symbol">:</a> <a id="20133" class="Symbol">∀</a> <a id="20135" class="Symbol">{</a><a id="20136" href="plfa.Soundness.html#20136" class="Bound">Δ</a><a id="20137" class="Symbol">}</a> <a id="20139" class="Symbol">{</a><a id="20140" href="plfa.Soundness.html#20140" class="Bound">δ</a> <a id="20142" class="Symbol">:</a> <a id="20144" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="20148" href="plfa.Soundness.html#20136" class="Bound">Δ</a><a id="20149" class="Symbol">}</a> <a id="20151" class="Symbol">{</a><a id="20152" href="plfa.Soundness.html#20152" class="Bound">γ</a> <a id="20154" class="Symbol">:</a> <a id="20156" href="plfa.Denotational.html#7100" class="Function">Env</a> <a id="20160" class="Symbol">(</a><a id="20161" href="plfa.Soundness.html#20136" class="Bound">Δ</a> <a id="20163" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3168" class="InductiveConstructor Operator">,</a> <a id="20165" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="20166" class="Symbol">)}</a> <a id="20169" class="Symbol">{</a><a id="20170" href="plfa.Soundness.html#20170" class="Bound">M</a> <a id="20172" class="Symbol">:</a> <a id="20174" href="plfa.Soundness.html#20136" class="Bound">Δ</a> <a id="20176" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="20178" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="20179" class="Symbol">}</a>
  <a id="20183" class="Symbol">→</a> <a id="20185" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#20140" class="Bound">δ</a> <a id="20187" href="plfa.Soundness.html#3197" class="Function Operator">`⊢</a> <a id="20190" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7333" class="Function">subst-zero</a> <a id="20201" href="plfa.Soundness.html#20170" class="Bound">M</a> <a id="20203" href="plfa.Soundness.html#3197" class="Function Operator">↓</a> <a id="20205" href="plfa.Soundness.html#20152" class="Bound">γ</a>
    <a id="20211" class="Comment">----------------------------------------</a>
  <a id="20254" class="Symbol">→</a> <a id="20256" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="20259" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#20259" class="Bound">w</a> <a id="20261" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="20263" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#3962" class="Datatype">Value</a> <a id="20269" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="20271" href="plfa.Soundness.html#20152" class="Bound">γ</a> <a id="20273" href="plfa.Denotational.html#8062" class="Function Operator">`⊑</a> <a id="20276" class="Symbol">(</a><a id="20277" href="plfa.Soundness.html#20140" class="Bound">δ</a> <a id="20279" href="plfa.Denotational.html#7257" class="Function Operator">`,</a> <a id="20282" href="plfa.Soundness.html#20259" class="Bound">w</a><a id="20283" class="Symbol">)</a> <a id="20285" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a> <a id="20287" href="plfa.Soundness.html#20140" class="Bound">δ</a> <a id="20289" href="plfa.Denotational.html#9274" class="Datatype Operator">⊢</a> <a id="20291" href="plfa.Soundness.html#20170" class="Bound">M</a> <a id="20293" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="20295" href="plfa.Soundness.html#20259" class="Bound">w</a>
<a id="20297" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#20112" class="Function">subst-zero-reflect</a> <a id="20316" class="Symbol">{</a><a id="20317" class="Argument">δ</a> <a id="20319" class="Symbol">=</a> <a id="20321" href="plfa.Soundness.html#20321" class="Bound">δ</a><a id="20322" class="Symbol">}</a> <a id="20324" class="Symbol">{</a><a id="20325" class="Argument">γ</a> <a id="20327" class="Symbol">=</a> <a id="20329" href="plfa.Soundness.html#20329" class="Bound">γ</a><a id="20330" class="Symbol">}</a> <a id="20332" href="plfa.Soundness.html#20332" class="Bound">δσγ</a> <a id="20336" class="Symbol">=</a> <a id="20338" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="20340" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7549" class="Function">last</a> <a id="20345" href="plfa.Soundness.html#20329" class="Bound">γ</a> <a id="20347" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="20349" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="20351" href="plfa.Soundness.html#20379" class="Function">lemma</a> <a id="20357" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="20359" href="plfa.Soundness.html#20332" class="Bound">δσγ</a> <a id="20363" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3519" class="InductiveConstructor">Z</a> <a id="20365" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="20367" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
  <a id="20371" class="Keyword">where</a>
  <a id="20379" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#20379" class="Function">lemma</a> <a id="20385" class="Symbol">:</a> <a id="20387" href="plfa.Soundness.html#20329" class="Bound">γ</a> <a id="20389" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#8062" class="Function Operator">`⊑</a> <a id="20392" class="Symbol">(</a><a id="20393" href="plfa.Soundness.html#20321" class="Bound">δ</a> <a id="20395" href="plfa.Denotational.html#7257" class="Function Operator">`,</a> <a id="20398" href="plfa.Denotational.html#7549" class="Function">last</a> <a id="20403" href="plfa.Soundness.html#20329" class="Bound">γ</a><a id="20404" class="Symbol">)</a>
  <a id="20408" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#20379" class="Function">lemma</a> <a id="20414" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3519" class="InductiveConstructor">Z</a>  <a id="20417" class="Symbol">=</a>  <a id="20420" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#5471" class="Function">Refl⊑</a>
  <a id="20428" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#20379" class="Function">lemma</a> <a id="20434" class="Symbol">(</a><a id="20435" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3564" class="InductiveConstructor Operator">S</a> <a id="20437" href="plfa.Soundness.html#20437" class="Bound">x</a><a id="20438" class="Symbol">)</a> <a id="20440" class="Symbol">=</a> <a id="20442" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9665" class="Function">var-inv</a> <a id="20450" class="Symbol">(</a><a id="20451" href="plfa.Soundness.html#20332" class="Bound">δσγ</a> <a id="20455" class="Symbol">(</a><a id="20456" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="20458" href="plfa.Soundness.html#20437" class="Bound">x</a><a id="20459" class="Symbol">))</a>
</pre>{% endraw %}
We choose `w` to be the last value in `γ` and we obtain `δ ⊢ M ↓ w`
by applying the premise to variable `Z`. Finally, to prove
`γ ⊑ (δ , w)`, we prove a lemma by induction in the input variable.
The base case is trivial because of our choice of `w`.
In the induction case, `S x`, the premise
`δ ⊢ subst-zero M ↓ γ` gives us `δ ⊢ x ↓ γ (S x)` and then
using `var-inv` we conclude that `γ (S x) ⊑ (δ `, w) (S x)`.

Now to prove that substitution reflects denotations.

{% raw %}<pre class="Agda"><a id="substitution-reflect"></a><a id="20938" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#20938" class="Function">substitution-reflect</a> <a id="20959" class="Symbol">:</a> <a id="20961" class="Symbol">∀</a> <a id="20963" class="Symbol">{</a><a id="20964" href="plfa.Soundness.html#20964" class="Bound">Δ</a><a id="20965" class="Symbol">}</a> <a id="20967" class="Symbol">{</a><a id="20968" href="plfa.Soundness.html#20968" class="Bound">δ</a> <a id="20970" class="Symbol">:</a> <a id="20972" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="20976" href="plfa.Soundness.html#20964" class="Bound">Δ</a><a id="20977" class="Symbol">}</a> <a id="20979" class="Symbol">{</a><a id="20980" href="plfa.Soundness.html#20980" class="Bound">N</a> <a id="20982" class="Symbol">:</a> <a id="20984" href="plfa.Soundness.html#20964" class="Bound">Δ</a> <a id="20986" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3168" class="InductiveConstructor Operator">,</a> <a id="20988" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="20990" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="20992" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="20993" class="Symbol">}</a> <a id="20995" class="Symbol">{</a><a id="20996" href="plfa.Soundness.html#20996" class="Bound">M</a> <a id="20998" class="Symbol">:</a> <a id="21000" href="plfa.Soundness.html#20964" class="Bound">Δ</a> <a id="21002" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="21004" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="21005" class="Symbol">}</a> <a id="21007" class="Symbol">{</a><a id="21008" href="plfa.Soundness.html#21008" class="Bound">v</a><a id="21009" class="Symbol">}</a>
  <a id="21013" class="Symbol">→</a> <a id="21015" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#20968" class="Bound">δ</a> <a id="21017" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="21019" href="plfa.Soundness.html#20980" class="Bound">N</a> <a id="21021" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7449" class="Function Operator">[</a> <a id="21023" href="plfa.Soundness.html#20996" class="Bound">M</a> <a id="21025" href="plfa.Untyped.html#7449" class="Function Operator">]</a> <a id="21027" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="21029" href="plfa.Soundness.html#21008" class="Bound">v</a>
    <a id="21035" class="Comment">------------------------------------------------</a>
  <a id="21086" class="Symbol">→</a> <a id="21088" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="21091" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21091" class="Bound">w</a> <a id="21093" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="21095" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#3962" class="Datatype">Value</a> <a id="21101" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="21103" href="plfa.Soundness.html#20968" class="Bound">δ</a> <a id="21105" href="plfa.Denotational.html#9274" class="Datatype Operator">⊢</a> <a id="21107" href="plfa.Soundness.html#20996" class="Bound">M</a> <a id="21109" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="21111" href="plfa.Soundness.html#21091" class="Bound">w</a>  <a id="21114" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a>  <a id="21117" class="Symbol">(</a><a id="21118" href="plfa.Soundness.html#20968" class="Bound">δ</a> <a id="21120" href="plfa.Denotational.html#7257" class="Function Operator">`,</a> <a id="21123" href="plfa.Soundness.html#21091" class="Bound">w</a><a id="21124" class="Symbol">)</a> <a id="21126" href="plfa.Denotational.html#9274" class="Datatype Operator">⊢</a> <a id="21128" href="plfa.Soundness.html#20980" class="Bound">N</a> <a id="21130" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="21132" href="plfa.Soundness.html#21008" class="Bound">v</a>
<a id="21134" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#20938" class="Function">substitution-reflect</a> <a id="21155" href="plfa.Soundness.html#21155" class="Bound">d</a> <a id="21157" class="Keyword">with</a> <a id="21162" href="plfa.Soundness.html#15633" class="Function">subst-reflect</a> <a id="21176" href="plfa.Soundness.html#21155" class="Bound">d</a> <a id="21178" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="21183" class="Symbol">...</a>  <a id="21188" class="Symbol">|</a> <a id="21190" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21192" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21192" class="Bound">γ</a> <a id="21194" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21196" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21198" href="plfa.Soundness.html#21198" class="Bound">δσγ</a> <a id="21202" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21204" href="plfa.Soundness.html#21204" class="Bound">γNv</a> <a id="21208" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21210" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21212" class="Keyword">with</a> <a id="21217" href="plfa.Soundness.html#20112" class="Function">subst-zero-reflect</a> <a id="21236" href="plfa.Soundness.html#21198" class="Bound">δσγ</a>
<a id="21240" class="Symbol">...</a>    <a id="21247" class="Symbol">|</a> <a id="21249" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21251" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21251" class="Bound">w</a> <a id="21253" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21255" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21257" href="plfa.Soundness.html#21257" class="Bound">ineq</a> <a id="21262" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21264" href="plfa.Soundness.html#21264" class="Bound">δMw</a> <a id="21268" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21270" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21272" class="Symbol">=</a> <a id="21274" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21276" href="plfa.Soundness.html#21251" class="Bound">w</a> <a id="21278" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21280" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21282" href="plfa.Soundness.html#21264" class="Bound">δMw</a> <a id="21286" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21288" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#25220" class="Function">Env⊑</a> <a id="21293" class="Bound">γNv</a> <a id="21297" href="plfa.Soundness.html#21257" class="Bound">ineq</a> <a id="21302" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21304" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>{% endraw %}
We apply the `subst-reflect` lemma to obtain
`δ ⊢ subst-zero M ↓ γ` and `γ ⊢ N ↓ v` for some `γ`.
Using the former, the `subst-zero-reflect` lemma gives
us `γ ⊑ (δ , w)` and `δ ⊢ M ↓ w`. We conclude that
`δ , w ⊢ N ↓ v` by applying the `Env⊑` lemma, using
`γ ⊢ N ↓ v` and `γ ⊑ (δ , w)`.


### Reduction reflects denotations

Now that we have proved that substitution reflects denotations, we can
easily prove that reduction does too.

{% raw %}<pre class="Agda"><a id="reflect-beta"></a><a id="21750" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21750" class="Function">reflect-beta</a> <a id="21763" class="Symbol">:</a> <a id="21765" class="Symbol">∀{</a><a id="21767" href="plfa.Soundness.html#21767" class="Bound">Γ</a><a id="21768" class="Symbol">}{</a><a id="21770" href="plfa.Soundness.html#21770" class="Bound">γ</a> <a id="21772" class="Symbol">:</a> <a id="21774" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="21778" href="plfa.Soundness.html#21767" class="Bound">Γ</a><a id="21779" class="Symbol">}{</a><a id="21781" href="plfa.Soundness.html#21781" class="Bound">M</a> <a id="21783" href="plfa.Soundness.html#21783" class="Bound">N</a><a id="21784" class="Symbol">}{</a><a id="21786" href="plfa.Soundness.html#21786" class="Bound">v</a><a id="21787" class="Symbol">}</a>
    <a id="21793" class="Symbol">→</a> <a id="21795" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21770" class="Bound">γ</a> <a id="21797" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="21799" class="Symbol">(</a><a id="21800" href="plfa.Soundness.html#21783" class="Bound">N</a> <a id="21802" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7449" class="Function Operator">[</a> <a id="21804" href="plfa.Soundness.html#21781" class="Bound">M</a> <a id="21806" href="plfa.Untyped.html#7449" class="Function Operator">]</a><a id="21807" class="Symbol">)</a> <a id="21809" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="21811" href="plfa.Soundness.html#21786" class="Bound">v</a>
    <a id="21817" class="Symbol">→</a> <a id="21819" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21770" class="Bound">γ</a> <a id="21821" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="21823" class="Symbol">(</a><a id="21824" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="21826" href="plfa.Soundness.html#21783" class="Bound">N</a><a id="21827" class="Symbol">)</a> <a id="21829" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="21831" href="plfa.Soundness.html#21781" class="Bound">M</a> <a id="21833" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="21835" href="plfa.Soundness.html#21786" class="Bound">v</a>
<a id="21837" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21750" class="Function">reflect-beta</a> <a id="21850" href="plfa.Soundness.html#21850" class="Bound">d</a>
    <a id="21856" class="Keyword">with</a> <a id="21861" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#20938" class="Function">substitution-reflect</a> <a id="21882" href="plfa.Soundness.html#21850" class="Bound">d</a>
<a id="21884" class="Symbol">...</a> <a id="21888" class="Symbol">|</a> <a id="21890" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21892" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21892" class="Bound">v₂′</a> <a id="21896" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21898" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21900" href="plfa.Soundness.html#21900" class="Bound">d₁′</a> <a id="21904" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21906" href="plfa.Soundness.html#21906" class="Bound">d₂′</a> <a id="21910" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21912" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21914" class="Symbol">=</a> <a id="21916" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="21923" class="Symbol">(</a><a id="21924" href="plfa.Denotational.html#9545" class="InductiveConstructor">↦-intro</a> <a id="21932" href="plfa.Soundness.html#21906" class="Bound">d₂′</a><a id="21935" class="Symbol">)</a> <a id="21937" href="plfa.Soundness.html#21900" class="Bound">d₁′</a>


<a id="reflect"></a><a id="21943" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21943" class="Function">reflect</a> <a id="21951" class="Symbol">:</a> <a id="21953" class="Symbol">∀</a> <a id="21955" class="Symbol">{</a><a id="21956" href="plfa.Soundness.html#21956" class="Bound">Γ</a><a id="21957" class="Symbol">}</a> <a id="21959" class="Symbol">{</a><a id="21960" href="plfa.Soundness.html#21960" class="Bound">γ</a> <a id="21962" class="Symbol">:</a> <a id="21964" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7100" class="Function">Env</a> <a id="21968" href="plfa.Soundness.html#21956" class="Bound">Γ</a><a id="21969" class="Symbol">}</a> <a id="21971" class="Symbol">{</a><a id="21972" href="plfa.Soundness.html#21972" class="Bound">M</a> <a id="21974" href="plfa.Soundness.html#21974" class="Bound">M′</a> <a id="21977" href="plfa.Soundness.html#21977" class="Bound">N</a> <a id="21979" href="plfa.Soundness.html#21979" class="Bound">v</a><a id="21980" class="Symbol">}</a>
  <a id="21984" class="Symbol">→</a> <a id="21986" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21960" class="Bound">γ</a> <a id="21988" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="21990" href="plfa.Soundness.html#21977" class="Bound">N</a> <a id="21992" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="21994" href="plfa.Soundness.html#21979" class="Bound">v</a>  <a id="21997" class="Symbol">→</a>  <a id="22000" href="plfa.Soundness.html#21972" class="Bound">M</a> <a id="22002" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10105" class="Datatype Operator">—→</a> <a id="22005" href="plfa.Soundness.html#21974" class="Bound">M′</a>  <a id="22009" class="Symbol">→</a>   <a id="22013" href="plfa.Soundness.html#21974" class="Bound">M′</a> <a id="22016" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="22018" href="plfa.Soundness.html#21977" class="Bound">N</a>
    <a id="22024" class="Comment">---------------------------------</a>
  <a id="22060" class="Symbol">→</a> <a id="22062" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21960" class="Bound">γ</a> <a id="22064" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9274" class="Datatype Operator">⊢</a> <a id="22066" href="plfa.Soundness.html#21972" class="Bound">M</a> <a id="22068" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="22070" href="plfa.Soundness.html#21979" class="Bound">v</a>
<a id="22072" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21943" class="Function">reflect</a> <a id="22080" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9328" class="InductiveConstructor">var</a> <a id="22084" class="Symbol">(</a><a id="22085" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10155" class="InductiveConstructor">ξ₁</a> <a id="22088" href="plfa.Soundness.html#22088" class="Bound">r</a><a id="22089" class="Symbol">)</a> <a id="22091" class="Symbol">()</a>
<a id="22094" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21943" class="Function">reflect</a> <a id="22102" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9328" class="InductiveConstructor">var</a> <a id="22106" class="Symbol">(</a><a id="22107" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10245" class="InductiveConstructor">ξ₂</a> <a id="22110" href="plfa.Soundness.html#22110" class="Bound">r</a><a id="22111" class="Symbol">)</a> <a id="22113" class="Symbol">()</a>
<a id="22116" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21943" class="Function">reflect</a><a id="22123" class="Symbol">{</a><a id="22124" class="Argument">γ</a> <a id="22126" class="Symbol">=</a> <a id="22128" href="plfa.Soundness.html#22128" class="Bound">γ</a><a id="22129" class="Symbol">}</a> <a id="22131" class="Symbol">(</a><a id="22132" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9328" class="InductiveConstructor">var</a><a id="22135" class="Symbol">{</a><a id="22136" class="Argument">x</a> <a id="22138" class="Symbol">=</a> <a id="22140" href="plfa.Soundness.html#22140" class="Bound">x</a><a id="22141" class="Symbol">})</a> <a id="22144" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10335" class="InductiveConstructor">β</a> <a id="22146" href="plfa.Soundness.html#22146" class="Bound">mn</a>
    <a id="22153" class="Keyword">with</a> <a id="22158" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9328" class="InductiveConstructor">var</a><a id="22161" class="Symbol">{</a><a id="22162" class="Argument">γ</a> <a id="22164" class="Symbol">=</a> <a id="22166" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#22128" class="Bound">γ</a><a id="22167" class="Symbol">}{</a><a id="22169" class="Argument">x</a> <a id="22171" class="Symbol">=</a> <a id="22173" href="plfa.Soundness.html#22140" class="Bound">x</a><a id="22174" class="Symbol">}</a>
<a id="22176" class="Symbol">...</a> <a id="22180" class="Symbol">|</a> <a id="22182" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#22182" class="Bound">d′</a> <a id="22185" class="Keyword">rewrite</a> <a id="22193" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="22197" class="Bound">mn</a> <a id="22200" class="Symbol">=</a> <a id="22202" href="plfa.Soundness.html#21750" class="Function">reflect-beta</a> <a id="22215" href="plfa.Soundness.html#22182" class="Bound">d′</a>
<a id="22218" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21943" class="Function">reflect</a> <a id="22226" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9328" class="InductiveConstructor">var</a> <a id="22230" class="Symbol">(</a><a id="22231" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10443" class="InductiveConstructor">ζ</a> <a id="22233" href="plfa.Soundness.html#22233" class="Bound">r</a><a id="22234" class="Symbol">)</a> <a id="22236" class="Symbol">()</a>
<a id="22239" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21943" class="Function">reflect</a> <a id="22247" class="Symbol">(</a><a id="22248" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="22255" href="plfa.Soundness.html#22255" class="Bound">d₁</a> <a id="22258" href="plfa.Soundness.html#22258" class="Bound">d₂</a><a id="22260" class="Symbol">)</a> <a id="22262" class="Symbol">(</a><a id="22263" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10155" class="InductiveConstructor">ξ₁</a> <a id="22266" href="plfa.Soundness.html#22266" class="Bound">r</a><a id="22267" class="Symbol">)</a> <a id="22269" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="22274" class="Symbol">=</a> <a id="22276" href="plfa.Denotational.html#9407" class="InductiveConstructor">↦-elim</a> <a id="22283" class="Symbol">(</a><a id="22284" href="plfa.Soundness.html#21943" class="Function">reflect</a> <a id="22292" href="plfa.Soundness.html#22255" class="Bound">d₁</a> <a id="22295" href="plfa.Soundness.html#22266" class="Bound">r</a> <a id="22297" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22301" class="Symbol">)</a> <a id="22303" href="plfa.Soundness.html#22258" class="Bound">d₂</a>
<a id="22306" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21943" class="Function">reflect</a> <a id="22314" class="Symbol">(</a><a id="22315" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="22322" href="plfa.Soundness.html#22322" class="Bound">d₁</a> <a id="22325" href="plfa.Soundness.html#22325" class="Bound">d₂</a><a id="22327" class="Symbol">)</a> <a id="22329" class="Symbol">(</a><a id="22330" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10245" class="InductiveConstructor">ξ₂</a> <a id="22333" href="plfa.Soundness.html#22333" class="Bound">r</a><a id="22334" class="Symbol">)</a> <a id="22336" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="22341" class="Symbol">=</a> <a id="22343" href="plfa.Denotational.html#9407" class="InductiveConstructor">↦-elim</a> <a id="22350" href="plfa.Soundness.html#22322" class="Bound">d₁</a> <a id="22353" class="Symbol">(</a><a id="22354" href="plfa.Soundness.html#21943" class="Function">reflect</a> <a id="22362" href="plfa.Soundness.html#22325" class="Bound">d₂</a> <a id="22365" href="plfa.Soundness.html#22333" class="Bound">r</a> <a id="22367" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22371" class="Symbol">)</a>
<a id="22373" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21943" class="Function">reflect</a> <a id="22381" class="Symbol">(</a><a id="22382" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="22389" href="plfa.Soundness.html#22389" class="Bound">d₁</a> <a id="22392" href="plfa.Soundness.html#22392" class="Bound">d₂</a><a id="22394" class="Symbol">)</a> <a id="22396" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10335" class="InductiveConstructor">β</a> <a id="22398" href="plfa.Soundness.html#22398" class="Bound">mn</a>
    <a id="22405" class="Keyword">with</a> <a id="22410" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="22417" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#22389" class="Bound">d₁</a> <a id="22420" href="plfa.Soundness.html#22392" class="Bound">d₂</a>
<a id="22423" class="Symbol">...</a> <a id="22427" class="Symbol">|</a> <a id="22429" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#22429" class="Bound">d′</a> <a id="22432" class="Keyword">rewrite</a> <a id="22440" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="22444" class="Bound">mn</a> <a id="22447" class="Symbol">=</a> <a id="22449" href="plfa.Soundness.html#21750" class="Function">reflect-beta</a> <a id="22462" href="plfa.Soundness.html#22429" class="Bound">d′</a>
<a id="22465" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21943" class="Function">reflect</a> <a id="22473" class="Symbol">(</a><a id="22474" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9407" class="InductiveConstructor">↦-elim</a> <a id="22481" href="plfa.Soundness.html#22481" class="Bound">d₁</a> <a id="22484" href="plfa.Soundness.html#22484" class="Bound">d₂</a><a id="22486" class="Symbol">)</a> <a id="22488" class="Symbol">(</a><a id="22489" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10443" class="InductiveConstructor">ζ</a> <a id="22491" href="plfa.Soundness.html#22491" class="Bound">r</a><a id="22492" class="Symbol">)</a> <a id="22494" class="Symbol">()</a>
<a id="22497" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21943" class="Function">reflect</a> <a id="22505" class="Symbol">(</a><a id="22506" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9545" class="InductiveConstructor">↦-intro</a> <a id="22514" href="plfa.Soundness.html#22514" class="Bound">d</a><a id="22515" class="Symbol">)</a> <a id="22517" class="Symbol">(</a><a id="22518" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10155" class="InductiveConstructor">ξ₁</a> <a id="22521" href="plfa.Soundness.html#22521" class="Bound">r</a><a id="22522" class="Symbol">)</a> <a id="22524" class="Symbol">()</a>
<a id="22527" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21943" class="Function">reflect</a> <a id="22535" class="Symbol">(</a><a id="22536" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9545" class="InductiveConstructor">↦-intro</a> <a id="22544" href="plfa.Soundness.html#22544" class="Bound">d</a><a id="22545" class="Symbol">)</a> <a id="22547" class="Symbol">(</a><a id="22548" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10245" class="InductiveConstructor">ξ₂</a> <a id="22551" href="plfa.Soundness.html#22551" class="Bound">r</a><a id="22552" class="Symbol">)</a> <a id="22554" class="Symbol">()</a>
<a id="22557" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21943" class="Function">reflect</a> <a id="22565" class="Symbol">(</a><a id="22566" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9545" class="InductiveConstructor">↦-intro</a> <a id="22574" href="plfa.Soundness.html#22574" class="Bound">d</a><a id="22575" class="Symbol">)</a> <a id="22577" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10335" class="InductiveConstructor">β</a> <a id="22579" href="plfa.Soundness.html#22579" class="Bound">mn</a>
    <a id="22586" class="Keyword">with</a> <a id="22591" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9545" class="InductiveConstructor">↦-intro</a> <a id="22599" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#22574" class="Bound">d</a>
<a id="22601" class="Symbol">...</a> <a id="22605" class="Symbol">|</a> <a id="22607" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#22607" class="Bound">d′</a> <a id="22610" class="Keyword">rewrite</a> <a id="22618" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="22622" class="Bound">mn</a> <a id="22625" class="Symbol">=</a> <a id="22627" href="plfa.Soundness.html#21750" class="Function">reflect-beta</a> <a id="22640" href="plfa.Soundness.html#22607" class="Bound">d′</a>
<a id="22643" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21943" class="Function">reflect</a> <a id="22651" class="Symbol">(</a><a id="22652" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9545" class="InductiveConstructor">↦-intro</a> <a id="22660" href="plfa.Soundness.html#22660" class="Bound">d</a><a id="22661" class="Symbol">)</a> <a id="22663" class="Symbol">(</a><a id="22664" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10443" class="InductiveConstructor">ζ</a> <a id="22666" href="plfa.Soundness.html#22666" class="Bound">r</a><a id="22667" class="Symbol">)</a> <a id="22669" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="22674" class="Symbol">=</a> <a id="22676" href="plfa.Denotational.html#9545" class="InductiveConstructor">↦-intro</a> <a id="22684" class="Symbol">(</a><a id="22685" href="plfa.Soundness.html#21943" class="Function">reflect</a> <a id="22693" href="plfa.Soundness.html#22660" class="Bound">d</a> <a id="22695" href="plfa.Soundness.html#22666" class="Bound">r</a> <a id="22697" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22701" class="Symbol">)</a>
<a id="22703" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21943" class="Function">reflect</a> <a id="22711" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9669" class="InductiveConstructor">⊥-intro</a> <a id="22719" href="plfa.Soundness.html#22719" class="Bound">r</a> <a id="22721" href="plfa.Soundness.html#22721" class="Bound">mn</a> <a id="22724" class="Symbol">=</a> <a id="22726" href="plfa.Denotational.html#9669" class="InductiveConstructor">⊥-intro</a>
<a id="22734" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21943" class="Function">reflect</a> <a id="22742" class="Symbol">(</a><a id="22743" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9744" class="InductiveConstructor">⊔-intro</a> <a id="22751" href="plfa.Soundness.html#22751" class="Bound">d₁</a> <a id="22754" href="plfa.Soundness.html#22754" class="Bound">d₂</a><a id="22756" class="Symbol">)</a> <a id="22758" href="plfa.Soundness.html#22758" class="Bound">r</a> <a id="22760" href="plfa.Soundness.html#22760" class="Bound">mn</a> <a id="22763" class="Keyword">rewrite</a> <a id="22771" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="22775" href="plfa.Soundness.html#22760" class="Bound">mn</a> <a id="22778" class="Symbol">=</a>
   <a id="22783" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9744" class="InductiveConstructor">⊔-intro</a> <a id="22791" class="Symbol">(</a><a id="22792" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21943" class="Function">reflect</a> <a id="22800" href="plfa.Soundness.html#22751" class="Bound">d₁</a> <a id="22803" href="plfa.Soundness.html#22758" class="Bound">r</a> <a id="22805" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22809" class="Symbol">)</a> <a id="22811" class="Symbol">(</a><a id="22812" href="plfa.Soundness.html#21943" class="Function">reflect</a> <a id="22820" href="plfa.Soundness.html#22754" class="Bound">d₂</a> <a id="22823" href="plfa.Soundness.html#22758" class="Bound">r</a> <a id="22825" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22829" class="Symbol">)</a>
<a id="22831" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#21943" class="Function">reflect</a> <a id="22839" class="Symbol">(</a><a id="22840" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9875" class="InductiveConstructor">sub</a> <a id="22844" href="plfa.Soundness.html#22844" class="Bound">d</a> <a id="22846" href="plfa.Soundness.html#22846" class="Bound">lt</a><a id="22848" class="Symbol">)</a> <a id="22850" href="plfa.Soundness.html#22850" class="Bound">r</a> <a id="22852" href="plfa.Soundness.html#22852" class="Bound">mn</a> <a id="22855" class="Symbol">=</a> <a id="22857" href="plfa.Denotational.html#9875" class="InductiveConstructor">sub</a> <a id="22861" class="Symbol">(</a><a id="22862" href="plfa.Soundness.html#21943" class="Function">reflect</a> <a id="22870" href="plfa.Soundness.html#22844" class="Bound">d</a> <a id="22872" href="plfa.Soundness.html#22850" class="Bound">r</a> <a id="22874" href="plfa.Soundness.html#22852" class="Bound">mn</a><a id="22876" class="Symbol">)</a> <a id="22878" href="plfa.Soundness.html#22846" class="Bound">lt</a>
</pre>{% endraw %}
## Reduction implies denotational equality

We have proved that reduction both preserves and reflects
denotations. Thus, reduction implies denotational equality.

{% raw %}<pre class="Agda"><a id="reduce-equal"></a><a id="23053" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#23053" class="Function">reduce-equal</a> <a id="23066" class="Symbol">:</a> <a id="23068" class="Symbol">∀</a> <a id="23070" class="Symbol">{</a><a id="23071" href="plfa.Soundness.html#23071" class="Bound">Γ</a><a id="23072" class="Symbol">}</a> <a id="23074" class="Symbol">{</a><a id="23075" href="plfa.Soundness.html#23075" class="Bound">M</a> <a id="23077" class="Symbol">:</a> <a id="23079" href="plfa.Soundness.html#23071" class="Bound">Γ</a> <a id="23081" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4252" class="Datatype Operator">⊢</a> <a id="23083" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="23084" class="Symbol">}</a> <a id="23086" class="Symbol">{</a><a id="23087" href="plfa.Soundness.html#23087" class="Bound">N</a> <a id="23089" class="Symbol">:</a> <a id="23091" href="plfa.Soundness.html#23071" class="Bound">Γ</a> <a id="23093" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="23095" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="23096" class="Symbol">}</a>
  <a id="23100" class="Symbol">→</a> <a id="23102" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#23075" class="Bound">M</a> <a id="23104" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10105" class="Datatype Operator">—→</a> <a id="23107" href="plfa.Soundness.html#23087" class="Bound">N</a>
    <a id="23113" class="Comment">---------</a>
  <a id="23125" class="Symbol">→</a> <a id="23127" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17427" class="Function">ℰ</a> <a id="23129" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#23075" class="Bound">M</a> <a id="23131" href="plfa.Denotational.html#17609" class="Function Operator">≃</a> <a id="23133" href="plfa.Denotational.html#17427" class="Function">ℰ</a> <a id="23135" href="plfa.Soundness.html#23087" class="Bound">N</a>
<a id="23137" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#23053" class="Function">reduce-equal</a> <a id="23150" class="Symbol">{</a><a id="23151" href="plfa.Soundness.html#23151" class="Bound">Γ</a><a id="23152" class="Symbol">}{</a><a id="23154" href="plfa.Soundness.html#23154" class="Bound">M</a><a id="23155" class="Symbol">}{</a><a id="23157" href="plfa.Soundness.html#23157" class="Bound">N</a><a id="23158" class="Symbol">}</a> <a id="23160" href="plfa.Soundness.html#23160" class="Bound">r</a> <a id="23162" href="plfa.Soundness.html#23162" class="Bound">γ</a> <a id="23164" href="plfa.Soundness.html#23164" class="Bound">v</a> <a id="23166" class="Symbol">=</a>
    <a id="23172" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="23174" class="Symbol">(λ</a> <a id="23177" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#23177" class="Bound">m</a> <a id="23179" class="Symbol">→</a> <a id="23181" href="plfa.Soundness.html#6639" class="Function">preserve</a> <a id="23190" href="plfa.Soundness.html#23177" class="Bound">m</a> <a id="23192" href="plfa.Soundness.html#23160" class="Bound">r</a><a id="23193" class="Symbol">)</a> <a id="23195" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="23197" class="Symbol">(λ</a> <a id="23200" href="plfa.Soundness.html#23200" class="Bound">n</a> <a id="23202" class="Symbol">→</a> <a id="23204" href="plfa.Soundness.html#21943" class="Function">reflect</a> <a id="23212" href="plfa.Soundness.html#23200" class="Bound">n</a> <a id="23214" href="plfa.Soundness.html#23160" class="Bound">r</a> <a id="23216" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="23220" class="Symbol">)</a> <a id="23222" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>{% endraw %}
We conclude with the _soundness property_, that multi-step reduction
to a lambda abstraction implies denotational equivalence with a lambda
abstraction.

{% raw %}<pre class="Agda"><a id="soundness"></a><a id="23387" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#23387" class="Function">soundness</a> <a id="23397" class="Symbol">:</a> <a id="23399" class="Symbol">∀{</a><a id="23401" href="plfa.Soundness.html#23401" class="Bound">Γ</a><a id="23402" class="Symbol">}</a> <a id="23404" class="Symbol">{</a><a id="23405" href="plfa.Soundness.html#23405" class="Bound">M</a> <a id="23407" class="Symbol">:</a> <a id="23409" href="plfa.Soundness.html#23401" class="Bound">Γ</a> <a id="23411" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4252" class="Datatype Operator">⊢</a> <a id="23413" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="23414" class="Symbol">}</a> <a id="23416" class="Symbol">{</a><a id="23417" href="plfa.Soundness.html#23417" class="Bound">N</a> <a id="23419" class="Symbol">:</a> <a id="23421" href="plfa.Soundness.html#23401" class="Bound">Γ</a> <a id="23423" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="23425" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="23427" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="23429" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="23430" class="Symbol">}</a>
  <a id="23434" class="Symbol">→</a> <a id="23436" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#23405" class="Bound">M</a> <a id="23438" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11203" class="Datatype Operator">—↠</a> <a id="23441" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="23443" href="plfa.Soundness.html#23417" class="Bound">N</a>
    <a id="23449" class="Comment">-----------------</a>
  <a id="23469" class="Symbol">→</a> <a id="23471" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17427" class="Function">ℰ</a> <a id="23473" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#23405" class="Bound">M</a> <a id="23475" href="plfa.Denotational.html#17609" class="Function Operator">≃</a> <a id="23477" href="plfa.Denotational.html#17427" class="Function">ℰ</a> <a id="23479" class="Symbol">(</a><a id="23480" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="23482" href="plfa.Soundness.html#23417" class="Bound">N</a><a id="23483" class="Symbol">)</a>
<a id="23485" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#23387" class="Function">soundness</a> <a id="23495" class="Symbol">(</a><a id="23496" class="DottedPattern Symbol">.(</a><a id="23498" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="DottedPattern InductiveConstructor Operator">ƛ</a> <a id="23500" class="DottedPattern Symbol">_)</a> <a id="23503" href="plfa.Untyped.html#11253" class="InductiveConstructor Operator">∎</a><a id="23504" class="Symbol">)</a> <a id="23506" href="plfa.Soundness.html#23506" class="Bound">γ</a> <a id="23508" href="plfa.Soundness.html#23508" class="Bound">v</a> <a id="23510" class="Symbol">=</a> <a id="23512" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="23514" class="Symbol">(λ</a> <a id="23517" href="plfa.Soundness.html#23517" class="Bound">x</a> <a id="23519" class="Symbol">→</a> <a id="23521" href="plfa.Soundness.html#23517" class="Bound">x</a><a id="23522" class="Symbol">)</a> <a id="23524" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="23526" class="Symbol">(λ</a> <a id="23529" href="plfa.Soundness.html#23529" class="Bound">x</a> <a id="23531" class="Symbol">→</a> <a id="23533" href="plfa.Soundness.html#23529" class="Bound">x</a><a id="23534" class="Symbol">)</a> <a id="23536" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="23538" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#23387" class="Function">soundness</a> <a id="23548" class="Symbol">{</a><a id="23549" href="plfa.Soundness.html#23549" class="Bound">Γ</a><a id="23550" class="Symbol">}</a> <a id="23552" class="Symbol">(</a><a id="23553" href="plfa.Soundness.html#23553" class="Bound">L</a> <a id="23555" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="23559" href="plfa.Soundness.html#23559" class="Bound">r</a> <a id="23561" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a> <a id="23563" href="plfa.Soundness.html#23563" class="Bound">M—↠N</a><a id="23567" class="Symbol">)</a> <a id="23569" href="plfa.Soundness.html#23569" class="Bound">γ</a> <a id="23571" href="plfa.Soundness.html#23571" class="Bound">v</a> <a id="23573" class="Symbol">=</a>
   <a id="23578" class="Keyword">let</a> <a id="23582" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#23582" class="Bound">ih</a> <a id="23585" class="Symbol">=</a> <a id="23587" href="plfa.Soundness.html#23387" class="Function">soundness</a> <a id="23597" href="plfa.Soundness.html#23563" class="Bound">M—↠N</a> <a id="23602" class="Keyword">in</a>
   <a id="23608" class="Keyword">let</a> <a id="23612" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#23612" class="Bound">e</a> <a id="23614" class="Symbol">=</a> <a id="23616" href="plfa.Soundness.html#23053" class="Function">reduce-equal</a> <a id="23629" href="plfa.Soundness.html#23559" class="Bound">r</a> <a id="23631" class="Keyword">in</a>
   <a id="23637" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18014" class="Function">≃-trans</a> <a id="23645" class="Symbol">{</a><a id="23646" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Soundness.md %}{% raw %}#23549" class="Bound">Γ</a><a id="23647" class="Symbol">}</a> <a id="23649" href="plfa.Soundness.html#23612" class="Bound">e</a> <a id="23651" href="plfa.Soundness.html#23582" class="Bound">ih</a> <a id="23654" href="plfa.Soundness.html#23569" class="Bound">γ</a> <a id="23656" href="plfa.Soundness.html#23571" class="Bound">v</a>
</pre>{% endraw %}

## Unicode

This chapter uses the following unicode:

    ≟  U+225F  QUESTIONED EQUAL TO (\?=)
