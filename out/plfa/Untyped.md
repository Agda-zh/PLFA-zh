---
src       : "src/plfa/Untyped.lagda.md"
title     : "Untyped: Untyped lambda calculus with full normalisation"
layout    : page
prev      : /Inference/
permalink : /Untyped/
next      : /Confluence/
---

{% raw %}<pre class="Agda"><a id="173" class="Keyword">module</a> <a id="180" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}" class="Module">plfa.Untyped</a> <a id="193" class="Keyword">where</a>
</pre>{% endraw %}
In this chapter we play with variations on a theme:

* Previous chapters consider inherently-typed calculi;
  here we consider one that is untyped but inherently scoped.

* Previous chapters consider call-by-value calculi;
  here we consider call-by-name.

* Previous chapters consider _weak head normal form_,
  where reduction stops at a lambda abstraction;
  here we consider _full normalisation_,
  where reduction continues underneath a lambda.

* Previous chapters consider _deterministic_ reduction,
  where there is at most one redex in a given term;
  here we consider _non-deterministic_ reduction
  where a term may contain many redexes and any one of them may reduce.

* Previous chapters consider reduction of _closed_ terms,
  those with no free variables;
  here we consider _open_ terms,
  those which may have free variables.

* Previous chapters consider lambda calculus extended
  with natural numbers and fixpoints;
  here we consider a tiny calculus with just variables,
  abstraction, and application, in which the other
  constructs may be encoded.

In general, one may mix and match these features,
save that full normalisation requires open terms and
encoding naturals and fixpoints requires being untyped.
The aim of this chapter is to give some appreciation for
the range of different lambda calculi one may encounter.


## Imports

{% raw %}<pre class="Agda"><a id="1568" class="Keyword">import</a> <a id="1575" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="1613" class="Symbol">as</a> <a id="1616" class="Module">Eq</a>
<a id="1619" class="Keyword">open</a> <a id="1624" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html" class="Module">Eq</a> <a id="1627" class="Keyword">using</a> <a id="1633" class="Symbol">(</a><a id="1634" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">_≡_</a><a id="1637" class="Symbol">;</a> <a id="1639" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="1643" class="Symbol">;</a> <a id="1645" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a><a id="1648" class="Symbol">;</a> <a id="1650" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#984" class="Function">trans</a><a id="1655" class="Symbol">;</a> <a id="1657" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a><a id="1661" class="Symbol">)</a>
<a id="1663" class="Keyword">open</a> <a id="1668" class="Keyword">import</a> <a id="1675" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html" class="Module">Data.Empty</a> <a id="1686" class="Keyword">using</a> <a id="1692" class="Symbol">(</a><a id="1693" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#279" class="Datatype">⊥</a><a id="1694" class="Symbol">;</a> <a id="1696" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#294" class="Function">⊥-elim</a><a id="1702" class="Symbol">)</a>
<a id="1704" class="Keyword">open</a> <a id="1709" class="Keyword">import</a> <a id="1716" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.html" class="Module">Data.Nat</a> <a id="1725" class="Keyword">using</a> <a id="1731" class="Symbol">(</a><a id="1732" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="1733" class="Symbol">;</a> <a id="1735" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a><a id="1739" class="Symbol">;</a> <a id="1741" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a><a id="1744" class="Symbol">;</a> <a id="1746" href="Agda.Builtin.Nat.html#298" class="Primitive Operator">_+_</a><a id="1749" class="Symbol">;</a> <a id="1751" href="Agda.Builtin.Nat.html#388" class="Primitive Operator">_∸_</a><a id="1754" class="Symbol">)</a>
<a id="1756" class="Keyword">open</a> <a id="1761" class="Keyword">import</a> <a id="1768" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html" class="Module">Data.Product</a> <a id="1781" class="Keyword">using</a> <a id="1787" class="Symbol">(</a><a id="1788" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">_×_</a><a id="1791" class="Symbol">)</a> <a id="1793" class="Keyword">renaming</a> <a id="1802" class="Symbol">(</a><a id="1803" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">_,_</a> <a id="1807" class="Symbol">to</a> <a id="1810" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="1815" class="Symbol">)</a>
<a id="1817" class="Keyword">open</a> <a id="1822" class="Keyword">import</a> <a id="1829" href="https://agda.github.io/agda-stdlib/v1.1/Data.Unit.html" class="Module">Data.Unit</a> <a id="1839" class="Keyword">using</a> <a id="1845" class="Symbol">(</a><a id="1846" href="Agda.Builtin.Unit.html#137" class="Record">⊤</a><a id="1847" class="Symbol">;</a> <a id="1849" href="Agda.Builtin.Unit.html#174" class="InductiveConstructor">tt</a><a id="1851" class="Symbol">)</a>
<a id="1853" class="Keyword">open</a> <a id="1858" class="Keyword">import</a> <a id="1865" href="https://agda.github.io/agda-stdlib/v1.1/Function.html" class="Module">Function</a> <a id="1874" class="Keyword">using</a> <a id="1880" class="Symbol">(</a><a id="1881" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">_∘_</a><a id="1884" class="Symbol">)</a>
<a id="1886" class="Keyword">open</a> <a id="1891" class="Keyword">import</a> <a id="1898" href="https://agda.github.io/agda-stdlib/v1.1/Function.Equivalence.html" class="Module">Function.Equivalence</a> <a id="1919" class="Keyword">using</a> <a id="1925" class="Symbol">(</a><a id="1926" href="https://agda.github.io/agda-stdlib/v1.1/Function.Equivalence.html#971" class="Function Operator">_⇔_</a><a id="1929" class="Symbol">;</a> <a id="1931" href="https://agda.github.io/agda-stdlib/v1.1/Function.Equivalence.html#1064" class="Function">equivalence</a><a id="1942" class="Symbol">)</a>
<a id="1944" class="Keyword">open</a> <a id="1949" class="Keyword">import</a> <a id="1956" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="1973" class="Keyword">using</a> <a id="1979" class="Symbol">(</a><a id="1980" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#535" class="Function Operator">¬_</a><a id="1982" class="Symbol">;</a> <a id="1984" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#605" class="Datatype">Dec</a><a id="1987" class="Symbol">;</a> <a id="1989" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a><a id="1992" class="Symbol">;</a> <a id="1994" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a><a id="1996" class="Symbol">)</a>
<a id="1998" class="Keyword">open</a> <a id="2003" class="Keyword">import</a> <a id="2010" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a> <a id="2037" class="Keyword">using</a> <a id="2043" class="Symbol">(</a><a id="2044" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Decidable.html#982" class="Function">map</a><a id="2047" class="Symbol">)</a>
<a id="2049" class="Keyword">open</a> <a id="2054" class="Keyword">import</a> <a id="2061" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="2087" class="Keyword">using</a> <a id="2093" class="Symbol">(</a><a id="2094" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Negation.html#880" class="Function">contraposition</a><a id="2108" class="Symbol">)</a>
<a id="2110" class="Keyword">open</a> <a id="2115" class="Keyword">import</a> <a id="2122" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Product.html" class="Module">Relation.Nullary.Product</a> <a id="2147" class="Keyword">using</a> <a id="2153" class="Symbol">(</a><a id="2154" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Product.html#585" class="Function Operator">_×-dec_</a><a id="2161" class="Symbol">)</a>
</pre>{% endraw %}

## Untyped is Uni-typed

Our development will be close to that in
Chapter [DeBruijn]({{ site.baseurl }}/DeBruijn/),
save that every term will have exactly the same type, written `★`
and pronounced "any".
This matches a slogan introduced by Dana Scott
and echoed by Robert Harper: "Untyped is Uni-typed".
One consequence of this approach is that constructs which previously
had to be given separately (such as natural numbers and fixpoints)
can now be defined in the language itself.


## Syntax

First, we get all our infix declarations out of the way:

{% raw %}<pre class="Agda"><a id="2727" class="Keyword">infix</a>  <a id="2734" class="Number">4</a>  <a id="2737" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4252" class="Datatype Operator">_⊢_</a>
<a id="2741" class="Keyword">infix</a>  <a id="2748" class="Number">4</a>  <a id="2751" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3483" class="Datatype Operator">_∋_</a>
<a id="2755" class="Keyword">infixl</a> <a id="2762" class="Number">5</a>  <a id="2765" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3168" class="InductiveConstructor Operator">_,_</a>

<a id="2770" class="Keyword">infix</a>  <a id="2777" class="Number">6</a>  <a id="2780" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ_</a>
<a id="2783" class="Keyword">infix</a>  <a id="2790" class="Number">6</a>  <a id="2793" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#8489" class="InductiveConstructor Operator">′_</a>
<a id="2796" class="Keyword">infixl</a> <a id="2803" class="Number">7</a>  <a id="2806" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4400" class="InductiveConstructor Operator">_·_</a>
</pre>{% endraw %}
## Types

We have just one type:
{% raw %}<pre class="Agda"><a id="2852" class="Keyword">data</a> <a id="Type"></a><a id="2857" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2857" class="Datatype">Type</a> <a id="2862" class="Symbol">:</a> <a id="2864" class="PrimitiveType">Set</a> <a id="2868" class="Keyword">where</a>
  <a id="Type.★"></a><a id="2876" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2876" class="InductiveConstructor">★</a> <a id="2878" class="Symbol">:</a> <a id="2880" href="plfa.Untyped.html#2857" class="Datatype">Type</a>
</pre>{% endraw %}
#### Exercise (`Type≃⊤`)

Show that `Type` is isomorphic to `⊤`, the unit type.

{% raw %}<pre class="Agda"><a id="2975" class="Comment">-- Your code goes here</a>
</pre>{% endraw %}
## Contexts

As before, a context is a list of types, with the type of the
most recently bound variable on the right:
{% raw %}<pre class="Agda"><a id="3125" class="Keyword">data</a> <a id="Context"></a><a id="3130" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3130" class="Datatype">Context</a> <a id="3138" class="Symbol">:</a> <a id="3140" class="PrimitiveType">Set</a> <a id="3144" class="Keyword">where</a>
  <a id="Context.∅"></a><a id="3152" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3152" class="InductiveConstructor">∅</a>   <a id="3156" class="Symbol">:</a> <a id="3158" href="plfa.Untyped.html#3130" class="Datatype">Context</a>
  <a id="Context._,_"></a><a id="3168" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3168" class="InductiveConstructor Operator">_,_</a> <a id="3172" class="Symbol">:</a> <a id="3174" href="plfa.Untyped.html#3130" class="Datatype">Context</a> <a id="3182" class="Symbol">→</a> <a id="3184" href="plfa.Untyped.html#2857" class="Datatype">Type</a> <a id="3189" class="Symbol">→</a> <a id="3191" href="plfa.Untyped.html#3130" class="Datatype">Context</a>
</pre>{% endraw %}We let `Γ` and `Δ` range over contexts.

#### Exercise (`Context≃ℕ`)

Show that `Context` is isomorphic to `ℕ`.

{% raw %}<pre class="Agda"><a id="3320" class="Comment">-- Your code goes here</a>
</pre>{% endraw %}
## Variables and the lookup judgment

Inherently typed variables correspond to the lookup judgment.  The
rules are as before:
{% raw %}<pre class="Agda"><a id="3478" class="Keyword">data</a> <a id="_∋_"></a><a id="3483" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3483" class="Datatype Operator">_∋_</a> <a id="3487" class="Symbol">:</a> <a id="3489" href="plfa.Untyped.html#3130" class="Datatype">Context</a> <a id="3497" class="Symbol">→</a> <a id="3499" href="plfa.Untyped.html#2857" class="Datatype">Type</a> <a id="3504" class="Symbol">→</a> <a id="3506" class="PrimitiveType">Set</a> <a id="3510" class="Keyword">where</a>

  <a id="_∋_.Z"></a><a id="3519" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3519" class="InductiveConstructor">Z</a> <a id="3521" class="Symbol">:</a> <a id="3523" class="Symbol">∀</a> <a id="3525" class="Symbol">{</a><a id="3526" href="plfa.Untyped.html#3526" class="Bound">Γ</a> <a id="3528" href="plfa.Untyped.html#3528" class="Bound">A</a><a id="3529" class="Symbol">}</a>
     <a id="3536" class="Comment">---------</a>
   <a id="3549" class="Symbol">→</a> <a id="3551" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3526" class="Bound">Γ</a> <a id="3553" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="3555" href="plfa.Untyped.html#3528" class="Bound">A</a> <a id="3557" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="3559" href="plfa.Untyped.html#3528" class="Bound">A</a>

  <a id="_∋_.S_"></a><a id="3564" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3564" class="InductiveConstructor Operator">S_</a> <a id="3567" class="Symbol">:</a> <a id="3569" class="Symbol">∀</a> <a id="3571" class="Symbol">{</a><a id="3572" href="plfa.Untyped.html#3572" class="Bound">Γ</a> <a id="3574" href="plfa.Untyped.html#3574" class="Bound">A</a> <a id="3576" href="plfa.Untyped.html#3576" class="Bound">B</a><a id="3577" class="Symbol">}</a>
    <a id="3583" class="Symbol">→</a> <a id="3585" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3572" class="Bound">Γ</a> <a id="3587" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="3589" href="plfa.Untyped.html#3574" class="Bound">A</a>
      <a id="3597" class="Comment">---------</a>
    <a id="3611" class="Symbol">→</a> <a id="3613" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3572" class="Bound">Γ</a> <a id="3615" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="3617" href="plfa.Untyped.html#3576" class="Bound">B</a> <a id="3619" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="3621" href="plfa.Untyped.html#3574" class="Bound">A</a>
</pre>{% endraw %}We could write the rules with all instances of `A` and `B`
replaced by `★`, but arguably it is clearer not to do so.

Because `★` is the only type, the judgment doesn't guarantee anything
useful about types.  But it does ensure that all variables are in
scope.  For instance, we cannot use `S S Z` in a context that only
binds two variables.


## Terms and the scoping judgment

Inherently typed terms correspond to the typing judgment, but with
`★` as the only type.  The result is that we check that terms are
well scoped — that is, that all variables they mention are in scope —
but not that they are well typed:
{% raw %}<pre class="Agda"><a id="4247" class="Keyword">data</a> <a id="_⊢_"></a><a id="4252" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4252" class="Datatype Operator">_⊢_</a> <a id="4256" class="Symbol">:</a> <a id="4258" href="plfa.Untyped.html#3130" class="Datatype">Context</a> <a id="4266" class="Symbol">→</a> <a id="4268" href="plfa.Untyped.html#2857" class="Datatype">Type</a> <a id="4273" class="Symbol">→</a> <a id="4275" class="PrimitiveType">Set</a> <a id="4279" class="Keyword">where</a>

  <a id="_⊢_.`_"></a><a id="4288" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4288" class="InductiveConstructor Operator">`_</a> <a id="4291" class="Symbol">:</a> <a id="4293" class="Symbol">∀</a> <a id="4295" class="Symbol">{</a><a id="4296" href="plfa.Untyped.html#4296" class="Bound">Γ</a> <a id="4298" href="plfa.Untyped.html#4298" class="Bound">A</a><a id="4299" class="Symbol">}</a>
    <a id="4305" class="Symbol">→</a> <a id="4307" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4296" class="Bound">Γ</a> <a id="4309" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="4311" href="plfa.Untyped.html#4298" class="Bound">A</a>
      <a id="4319" class="Comment">-----</a>
    <a id="4329" class="Symbol">→</a> <a id="4331" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4296" class="Bound">Γ</a> <a id="4333" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="4335" href="plfa.Untyped.html#4298" class="Bound">A</a>

  <a id="_⊢_.ƛ_"></a><a id="4340" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ_</a>  <a id="4344" class="Symbol">:</a>  <a id="4347" class="Symbol">∀</a> <a id="4349" class="Symbol">{</a><a id="4350" href="plfa.Untyped.html#4350" class="Bound">Γ</a><a id="4351" class="Symbol">}</a>
    <a id="4357" class="Symbol">→</a> <a id="4359" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4350" class="Bound">Γ</a> <a id="4361" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="4363" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="4365" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="4367" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a>
      <a id="4375" class="Comment">---------</a>
    <a id="4389" class="Symbol">→</a> <a id="4391" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4350" class="Bound">Γ</a> <a id="4393" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="4395" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a>

  <a id="_⊢_._·_"></a><a id="4400" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4400" class="InductiveConstructor Operator">_·_</a> <a id="4404" class="Symbol">:</a> <a id="4406" class="Symbol">∀</a> <a id="4408" class="Symbol">{</a><a id="4409" href="plfa.Untyped.html#4409" class="Bound">Γ</a><a id="4410" class="Symbol">}</a>
    <a id="4416" class="Symbol">→</a> <a id="4418" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4409" class="Bound">Γ</a> <a id="4420" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="4422" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a>
    <a id="4428" class="Symbol">→</a> <a id="4430" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4409" class="Bound">Γ</a> <a id="4432" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="4434" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a>
      <a id="4442" class="Comment">------</a>
    <a id="4453" class="Symbol">→</a> <a id="4455" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4409" class="Bound">Γ</a> <a id="4457" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="4459" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a>
</pre>{% endraw %}Now we have a tiny calculus, with only variables, abstraction, and
application.  Below we will see how to encode naturals and
fixpoints into this calculus.

## Writing variables as numerals

As before, we can convert a natural to the corresponding de Bruijn
index.  We no longer need to lookup the type in the context, since
every variable has the same type:
{% raw %}<pre class="Agda"><a id="count"></a><a id="4828" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4828" class="Function">count</a> <a id="4834" class="Symbol">:</a> <a id="4836" class="Symbol">∀</a> <a id="4838" class="Symbol">{</a><a id="4839" href="plfa.Untyped.html#4839" class="Bound">Γ</a><a id="4840" class="Symbol">}</a> <a id="4842" class="Symbol">→</a> <a id="4844" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="4846" class="Symbol">→</a> <a id="4848" href="plfa.Untyped.html#4839" class="Bound">Γ</a> <a id="4850" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="4852" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a>
<a id="4854" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4828" class="Function">count</a> <a id="4860" class="Symbol">{</a><a id="4861" href="plfa.Untyped.html#4861" class="Bound">Γ</a> <a id="4863" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="4865" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="4866" class="Symbol">}</a> <a id="4868" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a>     <a id="4877" class="Symbol">=</a>  <a id="4880" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a>
<a id="4882" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4828" class="Function">count</a> <a id="4888" class="Symbol">{</a><a id="4889" href="plfa.Untyped.html#4889" class="Bound">Γ</a> <a id="4891" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="4893" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="4894" class="Symbol">}</a> <a id="4896" class="Symbol">(</a><a id="4897" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="4901" href="plfa.Untyped.html#4901" class="Bound">n</a><a id="4902" class="Symbol">)</a>  <a id="4905" class="Symbol">=</a>  <a id="4908" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="4910" class="Symbol">(</a><a id="4911" href="plfa.Untyped.html#4828" class="Function">count</a> <a id="4917" href="plfa.Untyped.html#4901" class="Bound">n</a><a id="4918" class="Symbol">)</a>
<a id="4920" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4828" class="Function">count</a> <a id="4926" class="Symbol">{</a><a id="4927" href="plfa.Untyped.html#3152" class="InductiveConstructor">∅</a><a id="4928" class="Symbol">}</a>     <a id="4934" class="Symbol">_</a>        <a id="4943" class="Symbol">=</a>  <a id="4946" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#294" class="Function">⊥-elim</a> <a id="4953" href="plfa.Untyped.html#4982" class="Postulate">impossible</a>
  <a id="4966" class="Keyword">where</a> <a id="4972" class="Keyword">postulate</a> <a id="4982" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4982" class="Postulate">impossible</a> <a id="4993" class="Symbol">:</a> <a id="4995" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#279" class="Datatype">⊥</a>
</pre>{% endraw %}
We can then introduce a convenient abbreviation for variables:
{% raw %}<pre class="Agda"><a id="#_"></a><a id="5069" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#5069" class="Function Operator">#_</a> <a id="5072" class="Symbol">:</a> <a id="5074" class="Symbol">∀</a> <a id="5076" class="Symbol">{</a><a id="5077" href="plfa.Untyped.html#5077" class="Bound">Γ</a><a id="5078" class="Symbol">}</a> <a id="5080" class="Symbol">→</a> <a id="5082" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="5084" class="Symbol">→</a> <a id="5086" href="plfa.Untyped.html#5077" class="Bound">Γ</a> <a id="5088" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="5090" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a>
<a id="5092" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#5069" class="Function Operator">#</a> <a id="5094" href="plfa.Untyped.html#5094" class="Bound">n</a>  <a id="5097" class="Symbol">=</a>  <a id="5100" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="5102" href="plfa.Untyped.html#4828" class="Function">count</a> <a id="5108" href="plfa.Untyped.html#5094" class="Bound">n</a>
</pre>{% endraw %}
## Test examples

Our only example is computing two plus two on Church numerals:
{% raw %}<pre class="Agda"><a id="twoᶜ"></a><a id="5200" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#5200" class="Function">twoᶜ</a> <a id="5205" class="Symbol">:</a> <a id="5207" class="Symbol">∀</a> <a id="5209" class="Symbol">{</a><a id="5210" href="plfa.Untyped.html#5210" class="Bound">Γ</a><a id="5211" class="Symbol">}</a> <a id="5213" class="Symbol">→</a> <a id="5215" href="plfa.Untyped.html#5210" class="Bound">Γ</a> <a id="5217" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="5219" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a>
<a id="5221" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#5200" class="Function">twoᶜ</a> <a id="5226" class="Symbol">=</a> <a id="5228" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="5230" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="5232" class="Symbol">(</a><a id="5233" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="5235" class="Number">1</a> <a id="5237" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="5239" class="Symbol">(</a><a id="5240" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="5242" class="Number">1</a> <a id="5244" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="5246" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="5248" class="Number">0</a><a id="5249" class="Symbol">))</a>

<a id="fourᶜ"></a><a id="5253" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#5253" class="Function">fourᶜ</a> <a id="5259" class="Symbol">:</a> <a id="5261" class="Symbol">∀</a> <a id="5263" class="Symbol">{</a><a id="5264" href="plfa.Untyped.html#5264" class="Bound">Γ</a><a id="5265" class="Symbol">}</a> <a id="5267" class="Symbol">→</a> <a id="5269" href="plfa.Untyped.html#5264" class="Bound">Γ</a> <a id="5271" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="5273" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a>
<a id="5275" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#5253" class="Function">fourᶜ</a> <a id="5281" class="Symbol">=</a> <a id="5283" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="5285" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="5287" class="Symbol">(</a><a id="5288" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="5290" class="Number">1</a> <a id="5292" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="5294" class="Symbol">(</a><a id="5295" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="5297" class="Number">1</a> <a id="5299" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="5301" class="Symbol">(</a><a id="5302" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="5304" class="Number">1</a> <a id="5306" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="5308" class="Symbol">(</a><a id="5309" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="5311" class="Number">1</a> <a id="5313" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="5315" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="5317" class="Number">0</a><a id="5318" class="Symbol">))))</a>

<a id="plusᶜ"></a><a id="5324" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#5324" class="Function">plusᶜ</a> <a id="5330" class="Symbol">:</a> <a id="5332" class="Symbol">∀</a> <a id="5334" class="Symbol">{</a><a id="5335" href="plfa.Untyped.html#5335" class="Bound">Γ</a><a id="5336" class="Symbol">}</a> <a id="5338" class="Symbol">→</a> <a id="5340" href="plfa.Untyped.html#5335" class="Bound">Γ</a> <a id="5342" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="5344" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a>
<a id="5346" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#5324" class="Function">plusᶜ</a> <a id="5352" class="Symbol">=</a> <a id="5354" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="5356" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="5358" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="5360" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="5362" class="Symbol">(</a><a id="5363" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="5365" class="Number">3</a> <a id="5367" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="5369" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="5371" class="Number">1</a> <a id="5373" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="5375" class="Symbol">(</a><a id="5376" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="5378" class="Number">2</a> <a id="5380" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="5382" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="5384" class="Number">1</a> <a id="5386" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="5388" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="5390" class="Number">0</a><a id="5391" class="Symbol">))</a>

<a id="2+2ᶜ"></a><a id="5395" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#5395" class="Function">2+2ᶜ</a> <a id="5400" class="Symbol">:</a> <a id="5402" href="plfa.Untyped.html#3152" class="InductiveConstructor">∅</a> <a id="5404" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="5406" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a>
<a id="5408" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#5395" class="Function">2+2ᶜ</a> <a id="5413" class="Symbol">=</a> <a id="5415" href="plfa.Untyped.html#5324" class="Function">plusᶜ</a> <a id="5421" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="5423" href="plfa.Untyped.html#5200" class="Function">twoᶜ</a> <a id="5428" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="5430" href="plfa.Untyped.html#5200" class="Function">twoᶜ</a>
</pre>{% endraw %}Before, reduction stopped when we reached a lambda term, so we had to
compute `` plusᶜ · twoᶜ · twoᶜ · sucᶜ · `zero `` to ensure we reduced
to a representation of the natural four.  Now, reduction continues
under lambda, so we don't need the extra arguments.  It is convenient
to define a term to represent four as a Church numeral, as well as
two.

## Renaming

Our definition of renaming is as before.  First, we need an extension lemma:
{% raw %}<pre class="Agda"><a id="ext"></a><a id="5883" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#5883" class="Function">ext</a> <a id="5887" class="Symbol">:</a> <a id="5889" class="Symbol">∀</a> <a id="5891" class="Symbol">{</a><a id="5892" href="plfa.Untyped.html#5892" class="Bound">Γ</a> <a id="5894" href="plfa.Untyped.html#5894" class="Bound">Δ</a><a id="5895" class="Symbol">}</a> <a id="5897" class="Symbol">→</a> <a id="5899" class="Symbol">(∀</a> <a id="5902" class="Symbol">{</a><a id="5903" href="plfa.Untyped.html#5903" class="Bound">A</a><a id="5904" class="Symbol">}</a> <a id="5906" class="Symbol">→</a> <a id="5908" href="plfa.Untyped.html#5892" class="Bound">Γ</a> <a id="5910" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="5912" href="plfa.Untyped.html#5903" class="Bound">A</a> <a id="5914" class="Symbol">→</a> <a id="5916" href="plfa.Untyped.html#5894" class="Bound">Δ</a> <a id="5918" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="5920" href="plfa.Untyped.html#5903" class="Bound">A</a><a id="5921" class="Symbol">)</a>
    <a id="5927" class="Comment">-----------------------------------</a>
  <a id="5965" class="Symbol">→</a> <a id="5967" class="Symbol">(∀</a> <a id="5970" class="Symbol">{</a><a id="5971" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#5971" class="Bound">A</a> <a id="5973" href="plfa.Untyped.html#5973" class="Bound">B</a><a id="5974" class="Symbol">}</a> <a id="5976" class="Symbol">→</a> <a id="5978" href="plfa.Untyped.html#5892" class="Bound">Γ</a> <a id="5980" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="5982" href="plfa.Untyped.html#5973" class="Bound">B</a> <a id="5984" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="5986" href="plfa.Untyped.html#5971" class="Bound">A</a> <a id="5988" class="Symbol">→</a> <a id="5990" href="plfa.Untyped.html#5894" class="Bound">Δ</a> <a id="5992" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="5994" href="plfa.Untyped.html#5973" class="Bound">B</a> <a id="5996" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="5998" href="plfa.Untyped.html#5971" class="Bound">A</a><a id="5999" class="Symbol">)</a>
<a id="6001" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#5883" class="Function">ext</a> <a id="6005" href="plfa.Untyped.html#6005" class="Bound">ρ</a> <a id="6007" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a>      <a id="6014" class="Symbol">=</a>  <a id="6017" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a>
<a id="6019" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#5883" class="Function">ext</a> <a id="6023" href="plfa.Untyped.html#6023" class="Bound">ρ</a> <a id="6025" class="Symbol">(</a><a id="6026" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="6028" href="plfa.Untyped.html#6028" class="Bound">x</a><a id="6029" class="Symbol">)</a>  <a id="6032" class="Symbol">=</a>  <a id="6035" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="6037" class="Symbol">(</a><a id="6038" href="plfa.Untyped.html#6023" class="Bound">ρ</a> <a id="6040" href="plfa.Untyped.html#6028" class="Bound">x</a><a id="6041" class="Symbol">)</a>
</pre>{% endraw %}We could replace all instances of `A` and `B` by `★`, but arguably it is
clearer not to do so.

Now it is straightforward to define renaming:
{% raw %}<pre class="Agda"><a id="rename"></a><a id="6193" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6193" class="Function">rename</a> <a id="6200" class="Symbol">:</a> <a id="6202" class="Symbol">∀</a> <a id="6204" class="Symbol">{</a><a id="6205" href="plfa.Untyped.html#6205" class="Bound">Γ</a> <a id="6207" href="plfa.Untyped.html#6207" class="Bound">Δ</a><a id="6208" class="Symbol">}</a>
  <a id="6212" class="Symbol">→</a> <a id="6214" class="Symbol">(∀</a> <a id="6217" class="Symbol">{</a><a id="6218" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6218" class="Bound">A</a><a id="6219" class="Symbol">}</a> <a id="6221" class="Symbol">→</a> <a id="6223" href="plfa.Untyped.html#6205" class="Bound">Γ</a> <a id="6225" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="6227" href="plfa.Untyped.html#6218" class="Bound">A</a> <a id="6229" class="Symbol">→</a> <a id="6231" href="plfa.Untyped.html#6207" class="Bound">Δ</a> <a id="6233" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="6235" href="plfa.Untyped.html#6218" class="Bound">A</a><a id="6236" class="Symbol">)</a>
    <a id="6242" class="Comment">------------------------</a>
  <a id="6269" class="Symbol">→</a> <a id="6271" class="Symbol">(∀</a> <a id="6274" class="Symbol">{</a><a id="6275" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6275" class="Bound">A</a><a id="6276" class="Symbol">}</a> <a id="6278" class="Symbol">→</a> <a id="6280" href="plfa.Untyped.html#6205" class="Bound">Γ</a> <a id="6282" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="6284" href="plfa.Untyped.html#6275" class="Bound">A</a> <a id="6286" class="Symbol">→</a> <a id="6288" href="plfa.Untyped.html#6207" class="Bound">Δ</a> <a id="6290" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="6292" href="plfa.Untyped.html#6275" class="Bound">A</a><a id="6293" class="Symbol">)</a>
<a id="6295" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6193" class="Function">rename</a> <a id="6302" href="plfa.Untyped.html#6302" class="Bound">ρ</a> <a id="6304" class="Symbol">(</a><a id="6305" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="6307" href="plfa.Untyped.html#6307" class="Bound">x</a><a id="6308" class="Symbol">)</a>          <a id="6319" class="Symbol">=</a>  <a id="6322" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="6324" class="Symbol">(</a><a id="6325" href="plfa.Untyped.html#6302" class="Bound">ρ</a> <a id="6327" href="plfa.Untyped.html#6307" class="Bound">x</a><a id="6328" class="Symbol">)</a>
<a id="6330" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6193" class="Function">rename</a> <a id="6337" href="plfa.Untyped.html#6337" class="Bound">ρ</a> <a id="6339" class="Symbol">(</a><a id="6340" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="6342" href="plfa.Untyped.html#6342" class="Bound">N</a><a id="6343" class="Symbol">)</a>          <a id="6354" class="Symbol">=</a>  <a id="6357" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="6359" class="Symbol">(</a><a id="6360" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="6367" class="Symbol">(</a><a id="6368" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="6372" href="plfa.Untyped.html#6337" class="Bound">ρ</a><a id="6373" class="Symbol">)</a> <a id="6375" href="plfa.Untyped.html#6342" class="Bound">N</a><a id="6376" class="Symbol">)</a>
<a id="6378" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6193" class="Function">rename</a> <a id="6385" href="plfa.Untyped.html#6385" class="Bound">ρ</a> <a id="6387" class="Symbol">(</a><a id="6388" href="plfa.Untyped.html#6388" class="Bound">L</a> <a id="6390" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="6392" href="plfa.Untyped.html#6392" class="Bound">M</a><a id="6393" class="Symbol">)</a>        <a id="6402" class="Symbol">=</a>  <a id="6405" class="Symbol">(</a><a id="6406" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="6413" href="plfa.Untyped.html#6385" class="Bound">ρ</a> <a id="6415" href="plfa.Untyped.html#6388" class="Bound">L</a><a id="6416" class="Symbol">)</a> <a id="6418" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="6420" class="Symbol">(</a><a id="6421" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="6428" href="plfa.Untyped.html#6385" class="Bound">ρ</a> <a id="6430" href="plfa.Untyped.html#6392" class="Bound">M</a><a id="6431" class="Symbol">)</a>
</pre>{% endraw %}This is exactly as before, save that there are fewer term forms.

## Simultaneous substitution

Our definition of substitution is also exactly as before.
First we need an extension lemma:
{% raw %}<pre class="Agda"><a id="exts"></a><a id="6629" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6629" class="Function">exts</a> <a id="6634" class="Symbol">:</a> <a id="6636" class="Symbol">∀</a> <a id="6638" class="Symbol">{</a><a id="6639" href="plfa.Untyped.html#6639" class="Bound">Γ</a> <a id="6641" href="plfa.Untyped.html#6641" class="Bound">Δ</a><a id="6642" class="Symbol">}</a> <a id="6644" class="Symbol">→</a> <a id="6646" class="Symbol">(∀</a> <a id="6649" class="Symbol">{</a><a id="6650" href="plfa.Untyped.html#6650" class="Bound">A</a><a id="6651" class="Symbol">}</a> <a id="6653" class="Symbol">→</a> <a id="6655" href="plfa.Untyped.html#6639" class="Bound">Γ</a> <a id="6657" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="6659" href="plfa.Untyped.html#6650" class="Bound">A</a> <a id="6661" class="Symbol">→</a> <a id="6663" href="plfa.Untyped.html#6641" class="Bound">Δ</a> <a id="6665" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="6667" href="plfa.Untyped.html#6650" class="Bound">A</a><a id="6668" class="Symbol">)</a>
    <a id="6674" class="Comment">----------------------------------</a>
  <a id="6711" class="Symbol">→</a> <a id="6713" class="Symbol">(∀</a> <a id="6716" class="Symbol">{</a><a id="6717" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6717" class="Bound">A</a> <a id="6719" href="plfa.Untyped.html#6719" class="Bound">B</a><a id="6720" class="Symbol">}</a> <a id="6722" class="Symbol">→</a> <a id="6724" href="plfa.Untyped.html#6639" class="Bound">Γ</a> <a id="6726" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="6728" href="plfa.Untyped.html#6719" class="Bound">B</a> <a id="6730" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="6732" href="plfa.Untyped.html#6717" class="Bound">A</a> <a id="6734" class="Symbol">→</a> <a id="6736" href="plfa.Untyped.html#6641" class="Bound">Δ</a> <a id="6738" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="6740" href="plfa.Untyped.html#6719" class="Bound">B</a> <a id="6742" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="6744" href="plfa.Untyped.html#6717" class="Bound">A</a><a id="6745" class="Symbol">)</a>
<a id="6747" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6629" class="Function">exts</a> <a id="6752" href="plfa.Untyped.html#6752" class="Bound">σ</a> <a id="6754" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a>      <a id="6761" class="Symbol">=</a>  <a id="6764" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="6766" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a>
<a id="6768" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6629" class="Function">exts</a> <a id="6773" href="plfa.Untyped.html#6773" class="Bound">σ</a> <a id="6775" class="Symbol">(</a><a id="6776" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="6778" href="plfa.Untyped.html#6778" class="Bound">x</a><a id="6779" class="Symbol">)</a>  <a id="6782" class="Symbol">=</a>  <a id="6785" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="6792" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a> <a id="6795" class="Symbol">(</a><a id="6796" href="plfa.Untyped.html#6773" class="Bound">σ</a> <a id="6798" href="plfa.Untyped.html#6778" class="Bound">x</a><a id="6799" class="Symbol">)</a>
</pre>{% endraw %}Again, we could replace all instances of `A` and `B` by `★`.

Now it is straightforward to define substitution:
{% raw %}<pre class="Agda"><a id="subst"></a><a id="6921" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6921" class="Function">subst</a> <a id="6927" class="Symbol">:</a> <a id="6929" class="Symbol">∀</a> <a id="6931" class="Symbol">{</a><a id="6932" href="plfa.Untyped.html#6932" class="Bound">Γ</a> <a id="6934" href="plfa.Untyped.html#6934" class="Bound">Δ</a><a id="6935" class="Symbol">}</a>
  <a id="6939" class="Symbol">→</a> <a id="6941" class="Symbol">(∀</a> <a id="6944" class="Symbol">{</a><a id="6945" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6945" class="Bound">A</a><a id="6946" class="Symbol">}</a> <a id="6948" class="Symbol">→</a> <a id="6950" href="plfa.Untyped.html#6932" class="Bound">Γ</a> <a id="6952" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="6954" href="plfa.Untyped.html#6945" class="Bound">A</a> <a id="6956" class="Symbol">→</a> <a id="6958" href="plfa.Untyped.html#6934" class="Bound">Δ</a> <a id="6960" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="6962" href="plfa.Untyped.html#6945" class="Bound">A</a><a id="6963" class="Symbol">)</a>
    <a id="6969" class="Comment">------------------------</a>
  <a id="6996" class="Symbol">→</a> <a id="6998" class="Symbol">(∀</a> <a id="7001" class="Symbol">{</a><a id="7002" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7002" class="Bound">A</a><a id="7003" class="Symbol">}</a> <a id="7005" class="Symbol">→</a> <a id="7007" href="plfa.Untyped.html#6932" class="Bound">Γ</a> <a id="7009" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="7011" href="plfa.Untyped.html#7002" class="Bound">A</a> <a id="7013" class="Symbol">→</a> <a id="7015" href="plfa.Untyped.html#6934" class="Bound">Δ</a> <a id="7017" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="7019" href="plfa.Untyped.html#7002" class="Bound">A</a><a id="7020" class="Symbol">)</a>
<a id="7022" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6921" class="Function">subst</a> <a id="7028" href="plfa.Untyped.html#7028" class="Bound">σ</a> <a id="7030" class="Symbol">(</a><a id="7031" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="7033" href="plfa.Untyped.html#7033" class="Bound">k</a><a id="7034" class="Symbol">)</a>          <a id="7045" class="Symbol">=</a>  <a id="7048" href="plfa.Untyped.html#7028" class="Bound">σ</a> <a id="7050" href="plfa.Untyped.html#7033" class="Bound">k</a>
<a id="7052" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6921" class="Function">subst</a> <a id="7058" href="plfa.Untyped.html#7058" class="Bound">σ</a> <a id="7060" class="Symbol">(</a><a id="7061" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="7063" href="plfa.Untyped.html#7063" class="Bound">N</a><a id="7064" class="Symbol">)</a>          <a id="7075" class="Symbol">=</a>  <a id="7078" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="7080" class="Symbol">(</a><a id="7081" href="plfa.Untyped.html#6921" class="Function">subst</a> <a id="7087" class="Symbol">(</a><a id="7088" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="7093" href="plfa.Untyped.html#7058" class="Bound">σ</a><a id="7094" class="Symbol">)</a> <a id="7096" href="plfa.Untyped.html#7063" class="Bound">N</a><a id="7097" class="Symbol">)</a>
<a id="7099" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#6921" class="Function">subst</a> <a id="7105" href="plfa.Untyped.html#7105" class="Bound">σ</a> <a id="7107" class="Symbol">(</a><a id="7108" href="plfa.Untyped.html#7108" class="Bound">L</a> <a id="7110" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="7112" href="plfa.Untyped.html#7112" class="Bound">M</a><a id="7113" class="Symbol">)</a>        <a id="7122" class="Symbol">=</a>  <a id="7125" class="Symbol">(</a><a id="7126" href="plfa.Untyped.html#6921" class="Function">subst</a> <a id="7132" href="plfa.Untyped.html#7105" class="Bound">σ</a> <a id="7134" href="plfa.Untyped.html#7108" class="Bound">L</a><a id="7135" class="Symbol">)</a> <a id="7137" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="7139" class="Symbol">(</a><a id="7140" href="plfa.Untyped.html#6921" class="Function">subst</a> <a id="7146" href="plfa.Untyped.html#7105" class="Bound">σ</a> <a id="7148" href="plfa.Untyped.html#7112" class="Bound">M</a><a id="7149" class="Symbol">)</a>
</pre>{% endraw %}Again, this is exactly as before, save that there are fewer term forms.

## Single substitution

It is easy to define the special case of substitution for one free variable:
{% raw %}<pre class="Agda"><a id="subst-zero"></a><a id="7333" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7333" class="Function">subst-zero</a> <a id="7344" class="Symbol">:</a> <a id="7346" class="Symbol">∀</a> <a id="7348" class="Symbol">{</a><a id="7349" href="plfa.Untyped.html#7349" class="Bound">Γ</a> <a id="7351" href="plfa.Untyped.html#7351" class="Bound">B</a><a id="7352" class="Symbol">}</a> <a id="7354" class="Symbol">→</a> <a id="7356" class="Symbol">(</a><a id="7357" href="plfa.Untyped.html#7349" class="Bound">Γ</a> <a id="7359" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="7361" href="plfa.Untyped.html#7351" class="Bound">B</a><a id="7362" class="Symbol">)</a> <a id="7364" class="Symbol">→</a> <a id="7366" class="Symbol">∀</a> <a id="7368" class="Symbol">{</a><a id="7369" href="plfa.Untyped.html#7369" class="Bound">A</a><a id="7370" class="Symbol">}</a> <a id="7372" class="Symbol">→</a> <a id="7374" class="Symbol">(</a><a id="7375" href="plfa.Untyped.html#7349" class="Bound">Γ</a> <a id="7377" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="7379" href="plfa.Untyped.html#7351" class="Bound">B</a> <a id="7381" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="7383" href="plfa.Untyped.html#7369" class="Bound">A</a><a id="7384" class="Symbol">)</a> <a id="7386" class="Symbol">→</a> <a id="7388" class="Symbol">(</a><a id="7389" href="plfa.Untyped.html#7349" class="Bound">Γ</a> <a id="7391" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="7393" href="plfa.Untyped.html#7369" class="Bound">A</a><a id="7394" class="Symbol">)</a>
<a id="7396" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7333" class="Function">subst-zero</a> <a id="7407" href="plfa.Untyped.html#7407" class="Bound">M</a> <a id="7409" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a>      <a id="7416" class="Symbol">=</a>  <a id="7419" href="plfa.Untyped.html#7407" class="Bound">M</a>
<a id="7421" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7333" class="Function">subst-zero</a> <a id="7432" href="plfa.Untyped.html#7432" class="Bound">M</a> <a id="7434" class="Symbol">(</a><a id="7435" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="7437" href="plfa.Untyped.html#7437" class="Bound">x</a><a id="7438" class="Symbol">)</a>  <a id="7441" class="Symbol">=</a>  <a id="7444" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="7446" href="plfa.Untyped.html#7437" class="Bound">x</a>

<a id="_[_]"></a><a id="7449" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7449" class="Function Operator">_[_]</a> <a id="7454" class="Symbol">:</a> <a id="7456" class="Symbol">∀</a> <a id="7458" class="Symbol">{</a><a id="7459" href="plfa.Untyped.html#7459" class="Bound">Γ</a> <a id="7461" href="plfa.Untyped.html#7461" class="Bound">A</a> <a id="7463" href="plfa.Untyped.html#7463" class="Bound">B</a><a id="7464" class="Symbol">}</a>
        <a id="7474" class="Symbol">→</a> <a id="7476" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7459" class="Bound">Γ</a> <a id="7478" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="7480" href="plfa.Untyped.html#7463" class="Bound">B</a> <a id="7482" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="7484" href="plfa.Untyped.html#7461" class="Bound">A</a>
        <a id="7494" class="Symbol">→</a> <a id="7496" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7459" class="Bound">Γ</a> <a id="7498" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="7500" href="plfa.Untyped.html#7463" class="Bound">B</a>
          <a id="7512" class="Comment">---------</a>
        <a id="7530" class="Symbol">→</a> <a id="7532" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7459" class="Bound">Γ</a> <a id="7534" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="7536" href="plfa.Untyped.html#7461" class="Bound">A</a>
<a id="7538" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7449" class="Function Operator">_[_]</a> <a id="7543" class="Symbol">{</a><a id="7544" href="plfa.Untyped.html#7544" class="Bound">Γ</a><a id="7545" class="Symbol">}</a> <a id="7547" class="Symbol">{</a><a id="7548" href="plfa.Untyped.html#7548" class="Bound">A</a><a id="7549" class="Symbol">}</a> <a id="7551" class="Symbol">{</a><a id="7552" href="plfa.Untyped.html#7552" class="Bound">B</a><a id="7553" class="Symbol">}</a> <a id="7555" href="plfa.Untyped.html#7555" class="Bound">N</a> <a id="7557" href="plfa.Untyped.html#7557" class="Bound">M</a> <a id="7559" class="Symbol">=</a>  <a id="7562" href="plfa.Untyped.html#6921" class="Function">subst</a> <a id="7568" class="Symbol">{</a><a id="7569" href="plfa.Untyped.html#7544" class="Bound">Γ</a> <a id="7571" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="7573" href="plfa.Untyped.html#7552" class="Bound">B</a><a id="7574" class="Symbol">}</a> <a id="7576" class="Symbol">{</a><a id="7577" href="plfa.Untyped.html#7544" class="Bound">Γ</a><a id="7578" class="Symbol">}</a> <a id="7580" class="Symbol">(</a><a id="7581" href="plfa.Untyped.html#7333" class="Function">subst-zero</a> <a id="7592" href="plfa.Untyped.html#7557" class="Bound">M</a><a id="7593" class="Symbol">)</a> <a id="7595" class="Symbol">{</a><a id="7596" href="plfa.Untyped.html#7548" class="Bound">A</a><a id="7597" class="Symbol">}</a> <a id="7599" href="plfa.Untyped.html#7555" class="Bound">N</a>
</pre>{% endraw %}
## Neutral and normal terms

Reduction continues until a term is fully normalised.  Hence, instead
of values, we are now interested in _normal forms_.  Terms in normal
form are defined by mutual recursion with _neutral_ terms:
{% raw %}<pre class="Agda"><a id="7837" class="Keyword">data</a> <a id="Neutral"></a><a id="7842" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7842" class="Datatype">Neutral</a> <a id="7850" class="Symbol">:</a> <a id="7852" class="Symbol">∀</a> <a id="7854" class="Symbol">{</a><a id="7855" href="plfa.Untyped.html#7855" class="Bound">Γ</a> <a id="7857" href="plfa.Untyped.html#7857" class="Bound">A</a><a id="7858" class="Symbol">}</a> <a id="7860" class="Symbol">→</a> <a id="7862" href="plfa.Untyped.html#7855" class="Bound">Γ</a> <a id="7864" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="7866" href="plfa.Untyped.html#7857" class="Bound">A</a> <a id="7868" class="Symbol">→</a> <a id="7870" class="PrimitiveType">Set</a>
<a id="7874" class="Keyword">data</a> <a id="Normal"></a><a id="7879" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7879" class="Datatype">Normal</a>  <a id="7887" class="Symbol">:</a> <a id="7889" class="Symbol">∀</a> <a id="7891" class="Symbol">{</a><a id="7892" href="plfa.Untyped.html#7892" class="Bound">Γ</a> <a id="7894" href="plfa.Untyped.html#7894" class="Bound">A</a><a id="7895" class="Symbol">}</a> <a id="7897" class="Symbol">→</a> <a id="7899" href="plfa.Untyped.html#7892" class="Bound">Γ</a> <a id="7901" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="7903" href="plfa.Untyped.html#7894" class="Bound">A</a> <a id="7905" class="Symbol">→</a> <a id="7907" class="PrimitiveType">Set</a>
</pre>{% endraw %}Neutral terms arise because we now consider reduction of open terms,
which may contain free variables.  A term is neutral if it is a
variable or a neutral term applied to a normal term:
{% raw %}<pre class="Agda"><a id="8105" class="Keyword">data</a> <a id="8110" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7842" class="Datatype">Neutral</a> <a id="8118" class="Keyword">where</a>

  <a id="Neutral.`_"></a><a id="8127" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#8127" class="InductiveConstructor Operator">`_</a>  <a id="8131" class="Symbol">:</a> <a id="8133" class="Symbol">∀</a> <a id="8135" class="Symbol">{</a><a id="8136" href="plfa.Untyped.html#8136" class="Bound">Γ</a> <a id="8138" href="plfa.Untyped.html#8138" class="Bound">A</a><a id="8139" class="Symbol">}</a> <a id="8141" class="Symbol">(</a><a id="8142" href="plfa.Untyped.html#8142" class="Bound">x</a> <a id="8144" class="Symbol">:</a> <a id="8146" href="plfa.Untyped.html#8136" class="Bound">Γ</a> <a id="8148" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="8150" href="plfa.Untyped.html#8138" class="Bound">A</a><a id="8151" class="Symbol">)</a>
      <a id="8159" class="Comment">-------------</a>
    <a id="8177" class="Symbol">→</a> <a id="8179" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7842" class="Datatype">Neutral</a> <a id="8187" class="Symbol">(</a><a id="8188" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="8190" href="plfa.Untyped.html#8142" class="Bound">x</a><a id="8191" class="Symbol">)</a>

  <a id="Neutral._·_"></a><a id="8196" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#8196" class="InductiveConstructor Operator">_·_</a>  <a id="8201" class="Symbol">:</a> <a id="8203" class="Symbol">∀</a> <a id="8205" class="Symbol">{</a><a id="8206" href="plfa.Untyped.html#8206" class="Bound">Γ</a><a id="8207" class="Symbol">}</a> <a id="8209" class="Symbol">{</a><a id="8210" href="plfa.Untyped.html#8210" class="Bound">L</a> <a id="8212" href="plfa.Untyped.html#8212" class="Bound">M</a> <a id="8214" class="Symbol">:</a> <a id="8216" href="plfa.Untyped.html#8206" class="Bound">Γ</a> <a id="8218" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="8220" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="8221" class="Symbol">}</a>
    <a id="8227" class="Symbol">→</a> <a id="8229" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7842" class="Datatype">Neutral</a> <a id="8237" href="plfa.Untyped.html#8210" class="Bound">L</a>
    <a id="8243" class="Symbol">→</a> <a id="8245" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7879" class="Datatype">Normal</a> <a id="8252" href="plfa.Untyped.html#8212" class="Bound">M</a>
      <a id="8260" class="Comment">---------------</a>
    <a id="8280" class="Symbol">→</a> <a id="8282" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7842" class="Datatype">Neutral</a> <a id="8290" class="Symbol">(</a><a id="8291" href="plfa.Untyped.html#8210" class="Bound">L</a> <a id="8293" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="8295" href="plfa.Untyped.html#8212" class="Bound">M</a><a id="8296" class="Symbol">)</a>
</pre>{% endraw %}A term is a normal form if it is neutral or an abstraction where the
body is a normal form. We use `′_` to label neutral terms.
Like `` `_ ``, it is unobtrusive:
{% raw %}<pre class="Agda"><a id="8468" class="Keyword">data</a> <a id="8473" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7879" class="Datatype">Normal</a> <a id="8480" class="Keyword">where</a>

  <a id="Normal.′_"></a><a id="8489" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#8489" class="InductiveConstructor Operator">′_</a> <a id="8492" class="Symbol">:</a> <a id="8494" class="Symbol">∀</a> <a id="8496" class="Symbol">{</a><a id="8497" href="plfa.Untyped.html#8497" class="Bound">Γ</a> <a id="8499" href="plfa.Untyped.html#8499" class="Bound">A</a><a id="8500" class="Symbol">}</a> <a id="8502" class="Symbol">{</a><a id="8503" href="plfa.Untyped.html#8503" class="Bound">M</a> <a id="8505" class="Symbol">:</a> <a id="8507" href="plfa.Untyped.html#8497" class="Bound">Γ</a> <a id="8509" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="8511" href="plfa.Untyped.html#8499" class="Bound">A</a><a id="8512" class="Symbol">}</a>
    <a id="8518" class="Symbol">→</a> <a id="8520" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7842" class="Datatype">Neutral</a> <a id="8528" href="plfa.Untyped.html#8503" class="Bound">M</a>
      <a id="8536" class="Comment">---------</a>
    <a id="8550" class="Symbol">→</a> <a id="8552" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7879" class="Datatype">Normal</a> <a id="8559" href="plfa.Untyped.html#8503" class="Bound">M</a>

  <a id="Normal.ƛ_"></a><a id="8564" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#8564" class="InductiveConstructor Operator">ƛ_</a>  <a id="8568" class="Symbol">:</a> <a id="8570" class="Symbol">∀</a> <a id="8572" class="Symbol">{</a><a id="8573" href="plfa.Untyped.html#8573" class="Bound">Γ</a><a id="8574" class="Symbol">}</a> <a id="8576" class="Symbol">{</a><a id="8577" href="plfa.Untyped.html#8577" class="Bound">N</a> <a id="8579" class="Symbol">:</a> <a id="8581" href="plfa.Untyped.html#8573" class="Bound">Γ</a> <a id="8583" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="8585" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="8587" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="8589" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="8590" class="Symbol">}</a>
    <a id="8596" class="Symbol">→</a> <a id="8598" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7879" class="Datatype">Normal</a> <a id="8605" href="plfa.Untyped.html#8577" class="Bound">N</a>
      <a id="8613" class="Comment">------------</a>
    <a id="8630" class="Symbol">→</a> <a id="8632" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7879" class="Datatype">Normal</a> <a id="8639" class="Symbol">(</a><a id="8640" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="8642" href="plfa.Untyped.html#8577" class="Bound">N</a><a id="8643" class="Symbol">)</a>
</pre>{% endraw %}
We introduce a convenient abbreviation for evidence that a variable is neutral:
{% raw %}<pre class="Agda"><a id="#′_"></a><a id="8734" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#8734" class="Function Operator">#′_</a> <a id="8738" class="Symbol">:</a> <a id="8740" class="Symbol">∀</a> <a id="8742" class="Symbol">{</a><a id="8743" href="plfa.Untyped.html#8743" class="Bound">Γ</a><a id="8744" class="Symbol">}</a> <a id="8746" class="Symbol">(</a><a id="8747" href="plfa.Untyped.html#8747" class="Bound">n</a> <a id="8749" class="Symbol">:</a> <a id="8751" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="8752" class="Symbol">)</a> <a id="8754" class="Symbol">→</a> <a id="8756" href="plfa.Untyped.html#7842" class="Datatype">Neutral</a> <a id="8764" class="Symbol">{</a><a id="8765" href="plfa.Untyped.html#8743" class="Bound">Γ</a><a id="8766" class="Symbol">}</a> <a id="8768" class="Symbol">(</a><a id="8769" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="8771" href="plfa.Untyped.html#8747" class="Bound">n</a><a id="8772" class="Symbol">)</a>
<a id="8774" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#8734" class="Function Operator">#′</a> <a id="8777" href="plfa.Untyped.html#8777" class="Bound">n</a>  <a id="8780" class="Symbol">=</a>  <a id="8783" href="plfa.Untyped.html#8127" class="InductiveConstructor Operator">`</a> <a id="8785" href="plfa.Untyped.html#4828" class="Function">count</a> <a id="8791" href="plfa.Untyped.html#8777" class="Bound">n</a>
</pre>{% endraw %}
For example, here is the evidence that the Church numeral two is in
normal form:
{% raw %}<pre class="Agda"><a id="8883" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#8883" class="Function">_</a> <a id="8885" class="Symbol">:</a> <a id="8887" href="plfa.Untyped.html#7879" class="Datatype">Normal</a> <a id="8894" class="Symbol">(</a><a id="8895" href="plfa.Untyped.html#5200" class="Function">twoᶜ</a> <a id="8900" class="Symbol">{</a><a id="8901" href="plfa.Untyped.html#3152" class="InductiveConstructor">∅</a><a id="8902" class="Symbol">})</a>
<a id="8905" class="Symbol">_</a> <a id="8907" class="Symbol">=</a> <a id="8909" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#8564" class="InductiveConstructor Operator">ƛ</a> <a id="8911" href="plfa.Untyped.html#8564" class="InductiveConstructor Operator">ƛ</a> <a id="8913" class="Symbol">(</a><a id="8914" href="plfa.Untyped.html#8489" class="InductiveConstructor Operator">′</a> <a id="8916" href="plfa.Untyped.html#8734" class="Function Operator">#′</a> <a id="8919" class="Number">1</a> <a id="8921" href="plfa.Untyped.html#8196" class="InductiveConstructor Operator">·</a> <a id="8923" class="Symbol">(</a><a id="8924" href="plfa.Untyped.html#8489" class="InductiveConstructor Operator">′</a> <a id="8926" href="plfa.Untyped.html#8734" class="Function Operator">#′</a> <a id="8929" class="Number">1</a> <a id="8931" href="plfa.Untyped.html#8196" class="InductiveConstructor Operator">·</a> <a id="8933" class="Symbol">(</a><a id="8934" href="plfa.Untyped.html#8489" class="InductiveConstructor Operator">′</a> <a id="8936" href="plfa.Untyped.html#8734" class="Function Operator">#′</a> <a id="8939" class="Number">0</a><a id="8940" class="Symbol">)))</a>
</pre>{% endraw %}The evidence that a term is in normal form is almost identical to
the term itself, decorated with some additional primes to indicate
neutral terms, and using `#′` in place of `#`

We will also need to characterise terms that are applications:
{% raw %}<pre class="Agda"><a id="9195" class="Keyword">data</a> <a id="Application"></a><a id="9200" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#9200" class="Datatype">Application</a> <a id="9212" class="Symbol">:</a> <a id="9214" class="Symbol">∀</a> <a id="9216" class="Symbol">{</a><a id="9217" href="plfa.Untyped.html#9217" class="Bound">Γ</a> <a id="9219" href="plfa.Untyped.html#9219" class="Bound">A</a><a id="9220" class="Symbol">}</a> <a id="9222" class="Symbol">→</a> <a id="9224" href="plfa.Untyped.html#9217" class="Bound">Γ</a> <a id="9226" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="9228" href="plfa.Untyped.html#9219" class="Bound">A</a> <a id="9230" class="Symbol">→</a> <a id="9232" class="PrimitiveType">Set</a> <a id="9236" class="Keyword">where</a>

  <a id="Application.ap"></a><a id="9245" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#9245" class="InductiveConstructor">ap</a> <a id="9248" class="Symbol">:</a> <a id="9250" class="Symbol">∀</a> <a id="9252" class="Symbol">{</a><a id="9253" href="plfa.Untyped.html#9253" class="Bound">Γ</a><a id="9254" class="Symbol">}</a> <a id="9256" class="Symbol">{</a><a id="9257" href="plfa.Untyped.html#9257" class="Bound">L</a> <a id="9259" href="plfa.Untyped.html#9259" class="Bound">M</a> <a id="9261" class="Symbol">:</a> <a id="9263" href="plfa.Untyped.html#9253" class="Bound">Γ</a> <a id="9265" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="9267" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="9268" class="Symbol">}</a>
      <a id="9276" class="Comment">-------------------</a>
    <a id="9300" class="Symbol">→</a> <a id="9302" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#9200" class="Datatype">Application</a> <a id="9314" class="Symbol">(</a><a id="9315" href="plfa.Untyped.html#9257" class="Bound">L</a> <a id="9317" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="9319" href="plfa.Untyped.html#9259" class="Bound">M</a><a id="9320" class="Symbol">)</a>
</pre>{% endraw %}

## Reduction step

The reduction rules are altered to switch from call-by-value to
call-by-name and to enable full normalisation:

* The rule `ξ₁` remains the same as it was for the simply-typed
  lambda calculus.

* In rule `ξ₂`, the requirement that the term `L` is a value
  is dropped. So this rule can overlap with `ξ₁` and
  reduction is _non-deterministic_. One can choose to reduce
  a term inside either `L` or `M`.

* In rule `β`, the requirement that the argument is a value
  is dropped, corresponding to call-by-name evaluation.
  This introduces further non-determinism, as `β` overlaps
  with `ξ₂` when there are redexes in the argument.

* A new rule `ζ` is added, to enable reduction underneath a lambda.

Here are the formalised rules:
{% raw %}<pre class="Agda"><a id="10086" class="Keyword">infix</a> <a id="10092" class="Number">2</a> <a id="10094" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10105" class="Datatype Operator">_—→_</a>

<a id="10100" class="Keyword">data</a> <a id="_—→_"></a><a id="10105" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10105" class="Datatype Operator">_—→_</a> <a id="10110" class="Symbol">:</a> <a id="10112" class="Symbol">∀</a> <a id="10114" class="Symbol">{</a><a id="10115" href="plfa.Untyped.html#10115" class="Bound">Γ</a> <a id="10117" href="plfa.Untyped.html#10117" class="Bound">A</a><a id="10118" class="Symbol">}</a> <a id="10120" class="Symbol">→</a> <a id="10122" class="Symbol">(</a><a id="10123" href="plfa.Untyped.html#10115" class="Bound">Γ</a> <a id="10125" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="10127" href="plfa.Untyped.html#10117" class="Bound">A</a><a id="10128" class="Symbol">)</a> <a id="10130" class="Symbol">→</a> <a id="10132" class="Symbol">(</a><a id="10133" href="plfa.Untyped.html#10115" class="Bound">Γ</a> <a id="10135" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="10137" href="plfa.Untyped.html#10117" class="Bound">A</a><a id="10138" class="Symbol">)</a> <a id="10140" class="Symbol">→</a> <a id="10142" class="PrimitiveType">Set</a> <a id="10146" class="Keyword">where</a>

  <a id="_—→_.ξ₁"></a><a id="10155" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10155" class="InductiveConstructor">ξ₁</a> <a id="10158" class="Symbol">:</a> <a id="10160" class="Symbol">∀</a> <a id="10162" class="Symbol">{</a><a id="10163" href="plfa.Untyped.html#10163" class="Bound">Γ</a><a id="10164" class="Symbol">}</a> <a id="10166" class="Symbol">{</a><a id="10167" href="plfa.Untyped.html#10167" class="Bound">L</a> <a id="10169" href="plfa.Untyped.html#10169" class="Bound">L′</a> <a id="10172" href="plfa.Untyped.html#10172" class="Bound">M</a> <a id="10174" class="Symbol">:</a> <a id="10176" href="plfa.Untyped.html#10163" class="Bound">Γ</a> <a id="10178" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="10180" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="10181" class="Symbol">}</a>
    <a id="10187" class="Symbol">→</a> <a id="10189" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10167" class="Bound">L</a> <a id="10191" href="plfa.Untyped.html#10105" class="Datatype Operator">—→</a> <a id="10194" href="plfa.Untyped.html#10169" class="Bound">L′</a>
      <a id="10203" class="Comment">----------------</a>
    <a id="10224" class="Symbol">→</a> <a id="10226" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10167" class="Bound">L</a> <a id="10228" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="10230" href="plfa.Untyped.html#10172" class="Bound">M</a> <a id="10232" href="plfa.Untyped.html#10105" class="Datatype Operator">—→</a> <a id="10235" href="plfa.Untyped.html#10169" class="Bound">L′</a> <a id="10238" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="10240" href="plfa.Untyped.html#10172" class="Bound">M</a>

  <a id="_—→_.ξ₂"></a><a id="10245" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10245" class="InductiveConstructor">ξ₂</a> <a id="10248" class="Symbol">:</a> <a id="10250" class="Symbol">∀</a> <a id="10252" class="Symbol">{</a><a id="10253" href="plfa.Untyped.html#10253" class="Bound">Γ</a><a id="10254" class="Symbol">}</a> <a id="10256" class="Symbol">{</a><a id="10257" href="plfa.Untyped.html#10257" class="Bound">L</a> <a id="10259" href="plfa.Untyped.html#10259" class="Bound">M</a> <a id="10261" href="plfa.Untyped.html#10261" class="Bound">M′</a> <a id="10264" class="Symbol">:</a> <a id="10266" href="plfa.Untyped.html#10253" class="Bound">Γ</a> <a id="10268" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="10270" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="10271" class="Symbol">}</a>
    <a id="10277" class="Symbol">→</a> <a id="10279" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10259" class="Bound">M</a> <a id="10281" href="plfa.Untyped.html#10105" class="Datatype Operator">—→</a> <a id="10284" href="plfa.Untyped.html#10261" class="Bound">M′</a>
      <a id="10293" class="Comment">----------------</a>
    <a id="10314" class="Symbol">→</a> <a id="10316" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10257" class="Bound">L</a> <a id="10318" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="10320" href="plfa.Untyped.html#10259" class="Bound">M</a> <a id="10322" href="plfa.Untyped.html#10105" class="Datatype Operator">—→</a> <a id="10325" href="plfa.Untyped.html#10257" class="Bound">L</a> <a id="10327" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="10329" href="plfa.Untyped.html#10261" class="Bound">M′</a>

  <a id="_—→_.β"></a><a id="10335" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10335" class="InductiveConstructor">β</a> <a id="10337" class="Symbol">:</a> <a id="10339" class="Symbol">∀</a> <a id="10341" class="Symbol">{</a><a id="10342" href="plfa.Untyped.html#10342" class="Bound">Γ</a><a id="10343" class="Symbol">}</a> <a id="10345" class="Symbol">{</a><a id="10346" href="plfa.Untyped.html#10346" class="Bound">N</a> <a id="10348" class="Symbol">:</a> <a id="10350" href="plfa.Untyped.html#10342" class="Bound">Γ</a> <a id="10352" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="10354" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="10356" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="10358" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="10359" class="Symbol">}</a> <a id="10361" class="Symbol">{</a><a id="10362" href="plfa.Untyped.html#10362" class="Bound">M</a> <a id="10364" class="Symbol">:</a> <a id="10366" href="plfa.Untyped.html#10342" class="Bound">Γ</a> <a id="10368" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="10370" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="10371" class="Symbol">}</a>
      <a id="10379" class="Comment">---------------------------------</a>
    <a id="10417" class="Symbol">→</a> <a id="10419" class="Symbol">(</a><a id="10420" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="10422" href="plfa.Untyped.html#10346" class="Bound">N</a><a id="10423" class="Symbol">)</a> <a id="10425" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="10427" href="plfa.Untyped.html#10362" class="Bound">M</a> <a id="10429" href="plfa.Untyped.html#10105" class="Datatype Operator">—→</a> <a id="10432" href="plfa.Untyped.html#10346" class="Bound">N</a> <a id="10434" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="10436" href="plfa.Untyped.html#10362" class="Bound">M</a> <a id="10438" href="plfa.Untyped.html#7449" class="Function Operator">]</a>

  <a id="_—→_.ζ"></a><a id="10443" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10443" class="InductiveConstructor">ζ</a> <a id="10445" class="Symbol">:</a> <a id="10447" class="Symbol">∀</a> <a id="10449" class="Symbol">{</a><a id="10450" href="plfa.Untyped.html#10450" class="Bound">Γ</a><a id="10451" class="Symbol">}</a> <a id="10453" class="Symbol">{</a><a id="10454" href="plfa.Untyped.html#10454" class="Bound">N</a> <a id="10456" href="plfa.Untyped.html#10456" class="Bound">N′</a> <a id="10459" class="Symbol">:</a> <a id="10461" href="plfa.Untyped.html#10450" class="Bound">Γ</a> <a id="10463" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="10465" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="10467" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="10469" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="10470" class="Symbol">}</a>
    <a id="10476" class="Symbol">→</a> <a id="10478" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#10454" class="Bound">N</a> <a id="10480" href="plfa.Untyped.html#10105" class="Datatype Operator">—→</a> <a id="10483" href="plfa.Untyped.html#10456" class="Bound">N′</a>
      <a id="10492" class="Comment">-----------</a>
    <a id="10508" class="Symbol">→</a> <a id="10510" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="10512" href="plfa.Untyped.html#10454" class="Bound">N</a> <a id="10514" href="plfa.Untyped.html#10105" class="Datatype Operator">—→</a> <a id="10517" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="10519" href="plfa.Untyped.html#10456" class="Bound">N′</a>
</pre>{% endraw %}
#### Exercise (`variant-1`)

How would the rules change if we want call-by-value where terms
normalise completely?  Assume that `β` should not permit reduction
unless both terms are in normal form.

{% raw %}<pre class="Agda"><a id="10730" class="Comment">-- Your code goes here</a>
</pre>{% endraw %}
#### Exercise (`variant-2`)

How would the rules change if we want call-by-value where terms
do not reduce underneath lambda?  Assume that `β`
permits reduction when both terms are values (that is, lambda
abstractions).  What would `2+2ᶜ` reduce to in this case?

{% raw %}<pre class="Agda"><a id="11026" class="Comment">-- Your code goes here</a>
</pre>{% endraw %}

## Reflexive and transitive closure

We cut-and-paste the previous definition:
{% raw %}<pre class="Agda"><a id="11138" class="Keyword">infix</a>  <a id="11145" class="Number">2</a> <a id="11147" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11203" class="Datatype Operator">_—↠_</a>
<a id="11152" class="Keyword">infix</a>  <a id="11159" class="Number">1</a> <a id="11161" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11409" class="Function Operator">begin_</a>
<a id="11168" class="Keyword">infixr</a> <a id="11175" class="Number">2</a> <a id="11177" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11309" class="InductiveConstructor Operator">_—→⟨_⟩_</a>
<a id="11185" class="Keyword">infix</a>  <a id="11192" class="Number">3</a> <a id="11194" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11253" class="InductiveConstructor Operator">_∎</a>

<a id="11198" class="Keyword">data</a> <a id="_—↠_"></a><a id="11203" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11203" class="Datatype Operator">_—↠_</a> <a id="11208" class="Symbol">:</a> <a id="11210" class="Symbol">∀</a> <a id="11212" class="Symbol">{</a><a id="11213" href="plfa.Untyped.html#11213" class="Bound">Γ</a> <a id="11215" href="plfa.Untyped.html#11215" class="Bound">A</a><a id="11216" class="Symbol">}</a> <a id="11218" class="Symbol">→</a> <a id="11220" class="Symbol">(</a><a id="11221" href="plfa.Untyped.html#11213" class="Bound">Γ</a> <a id="11223" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="11225" href="plfa.Untyped.html#11215" class="Bound">A</a><a id="11226" class="Symbol">)</a> <a id="11228" class="Symbol">→</a> <a id="11230" class="Symbol">(</a><a id="11231" href="plfa.Untyped.html#11213" class="Bound">Γ</a> <a id="11233" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="11235" href="plfa.Untyped.html#11215" class="Bound">A</a><a id="11236" class="Symbol">)</a> <a id="11238" class="Symbol">→</a> <a id="11240" class="PrimitiveType">Set</a> <a id="11244" class="Keyword">where</a>

  <a id="_—↠_._∎"></a><a id="11253" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11253" class="InductiveConstructor Operator">_∎</a> <a id="11256" class="Symbol">:</a> <a id="11258" class="Symbol">∀</a> <a id="11260" class="Symbol">{</a><a id="11261" href="plfa.Untyped.html#11261" class="Bound">Γ</a> <a id="11263" href="plfa.Untyped.html#11263" class="Bound">A</a><a id="11264" class="Symbol">}</a> <a id="11266" class="Symbol">(</a><a id="11267" href="plfa.Untyped.html#11267" class="Bound">M</a> <a id="11269" class="Symbol">:</a> <a id="11271" href="plfa.Untyped.html#11261" class="Bound">Γ</a> <a id="11273" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="11275" href="plfa.Untyped.html#11263" class="Bound">A</a><a id="11276" class="Symbol">)</a>
      <a id="11284" class="Comment">--------</a>
    <a id="11297" class="Symbol">→</a> <a id="11299" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11267" class="Bound">M</a> <a id="11301" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="11304" href="plfa.Untyped.html#11267" class="Bound">M</a>

  <a id="_—↠_._—→⟨_⟩_"></a><a id="11309" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11309" class="InductiveConstructor Operator">_—→⟨_⟩_</a> <a id="11317" class="Symbol">:</a> <a id="11319" class="Symbol">∀</a> <a id="11321" class="Symbol">{</a><a id="11322" href="plfa.Untyped.html#11322" class="Bound">Γ</a> <a id="11324" href="plfa.Untyped.html#11324" class="Bound">A</a><a id="11325" class="Symbol">}</a> <a id="11327" class="Symbol">(</a><a id="11328" href="plfa.Untyped.html#11328" class="Bound">L</a> <a id="11330" class="Symbol">:</a> <a id="11332" href="plfa.Untyped.html#11322" class="Bound">Γ</a> <a id="11334" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="11336" href="plfa.Untyped.html#11324" class="Bound">A</a><a id="11337" class="Symbol">)</a> <a id="11339" class="Symbol">{</a><a id="11340" href="plfa.Untyped.html#11340" class="Bound">M</a> <a id="11342" href="plfa.Untyped.html#11342" class="Bound">N</a> <a id="11344" class="Symbol">:</a> <a id="11346" href="plfa.Untyped.html#11322" class="Bound">Γ</a> <a id="11348" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="11350" href="plfa.Untyped.html#11324" class="Bound">A</a><a id="11351" class="Symbol">}</a>
    <a id="11357" class="Symbol">→</a> <a id="11359" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11328" class="Bound">L</a> <a id="11361" href="plfa.Untyped.html#10105" class="Datatype Operator">—→</a> <a id="11364" href="plfa.Untyped.html#11340" class="Bound">M</a>
    <a id="11370" class="Symbol">→</a> <a id="11372" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11340" class="Bound">M</a> <a id="11374" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="11377" href="plfa.Untyped.html#11342" class="Bound">N</a>
      <a id="11385" class="Comment">---------</a>
    <a id="11399" class="Symbol">→</a> <a id="11401" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11328" class="Bound">L</a> <a id="11403" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="11406" href="plfa.Untyped.html#11342" class="Bound">N</a>

<a id="begin_"></a><a id="11409" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11409" class="Function Operator">begin_</a> <a id="11416" class="Symbol">:</a> <a id="11418" class="Symbol">∀</a> <a id="11420" class="Symbol">{</a><a id="11421" href="plfa.Untyped.html#11421" class="Bound">Γ</a><a id="11422" class="Symbol">}</a> <a id="11424" class="Symbol">{</a><a id="11425" href="plfa.Untyped.html#11425" class="Bound">A</a><a id="11426" class="Symbol">}</a> <a id="11428" class="Symbol">{</a><a id="11429" href="plfa.Untyped.html#11429" class="Bound">M</a> <a id="11431" href="plfa.Untyped.html#11431" class="Bound">N</a> <a id="11433" class="Symbol">:</a> <a id="11435" href="plfa.Untyped.html#11421" class="Bound">Γ</a> <a id="11437" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="11439" href="plfa.Untyped.html#11425" class="Bound">A</a><a id="11440" class="Symbol">}</a>
  <a id="11444" class="Symbol">→</a> <a id="11446" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11429" class="Bound">M</a> <a id="11448" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="11451" href="plfa.Untyped.html#11431" class="Bound">N</a>
    <a id="11457" class="Comment">------</a>
  <a id="11466" class="Symbol">→</a> <a id="11468" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11429" class="Bound">M</a> <a id="11470" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="11473" href="plfa.Untyped.html#11431" class="Bound">N</a>
<a id="11475" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11409" class="Function Operator">begin</a> <a id="11481" href="plfa.Untyped.html#11481" class="Bound">M—↠N</a> <a id="11486" class="Symbol">=</a> <a id="11488" href="plfa.Untyped.html#11481" class="Bound">M—↠N</a>
</pre>{% endraw %}

## Example reduction sequence

Here is the demonstration that two plus two is four:
{% raw %}<pre class="Agda"><a id="11587" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11587" class="Function">_</a> <a id="11589" class="Symbol">:</a> <a id="11591" href="plfa.Untyped.html#5395" class="Function">2+2ᶜ</a> <a id="11596" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="11599" href="plfa.Untyped.html#5253" class="Function">fourᶜ</a>
<a id="11605" class="Symbol">_</a> <a id="11607" class="Symbol">=</a>
  <a id="11611" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11409" class="Function Operator">begin</a>
    <a id="11621" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#5324" class="Function">plusᶜ</a> <a id="11627" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11629" href="plfa.Untyped.html#5200" class="Function">twoᶜ</a> <a id="11634" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11636" href="plfa.Untyped.html#5200" class="Function">twoᶜ</a>
  <a id="11643" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="11647" href="plfa.Untyped.html#10155" class="InductiveConstructor">ξ₁</a> <a id="11650" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a> <a id="11652" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a>
    <a id="11658" class="Symbol">(</a><a id="11659" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11661" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11663" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11665" href="plfa.Untyped.html#5200" class="Function">twoᶜ</a> <a id="11670" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11672" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11674" class="Number">1</a> <a id="11676" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11678" class="Symbol">(</a><a id="11679" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11681" class="Number">2</a> <a id="11683" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11685" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11687" class="Number">1</a> <a id="11689" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11691" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11693" class="Number">0</a><a id="11694" class="Symbol">))</a> <a id="11697" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11699" href="plfa.Untyped.html#5200" class="Function">twoᶜ</a>
  <a id="11706" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="11710" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a> <a id="11712" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a>
    <a id="11718" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11720" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11722" href="plfa.Untyped.html#5200" class="Function">twoᶜ</a> <a id="11727" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11729" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11731" class="Number">1</a> <a id="11733" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11735" class="Symbol">(</a><a id="11736" href="plfa.Untyped.html#5200" class="Function">twoᶜ</a> <a id="11741" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11743" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11745" class="Number">1</a> <a id="11747" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11749" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11751" class="Number">0</a><a id="11752" class="Symbol">)</a>
  <a id="11756" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="11760" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="11762" class="Symbol">(</a><a id="11763" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="11765" class="Symbol">(</a><a id="11766" href="plfa.Untyped.html#10155" class="InductiveConstructor">ξ₁</a> <a id="11769" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a><a id="11770" class="Symbol">))</a> <a id="11773" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a>
    <a id="11779" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11781" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11783" class="Symbol">((</a><a id="11785" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11787" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11789" class="Number">2</a> <a id="11791" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11793" class="Symbol">(</a><a id="11794" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11796" class="Number">2</a> <a id="11798" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11800" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11802" class="Number">0</a><a id="11803" class="Symbol">))</a> <a id="11806" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11808" class="Symbol">(</a><a id="11809" href="plfa.Untyped.html#5200" class="Function">twoᶜ</a> <a id="11814" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11816" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11818" class="Number">1</a> <a id="11820" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11822" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11824" class="Number">0</a><a id="11825" class="Symbol">))</a>
  <a id="11830" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="11834" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="11836" class="Symbol">(</a><a id="11837" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="11839" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a><a id="11840" class="Symbol">)</a> <a id="11842" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a>
    <a id="11848" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11850" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11852" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11854" class="Number">1</a> <a id="11856" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11858" class="Symbol">(</a><a id="11859" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11861" class="Number">1</a> <a id="11863" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11865" class="Symbol">(</a><a id="11866" href="plfa.Untyped.html#5200" class="Function">twoᶜ</a> <a id="11871" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11873" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11875" class="Number">1</a> <a id="11877" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11879" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11881" class="Number">0</a><a id="11882" class="Symbol">))</a>
  <a id="11887" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="11891" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="11893" class="Symbol">(</a><a id="11894" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="11896" class="Symbol">(</a><a id="11897" href="plfa.Untyped.html#10245" class="InductiveConstructor">ξ₂</a> <a id="11900" class="Symbol">(</a><a id="11901" href="plfa.Untyped.html#10245" class="InductiveConstructor">ξ₂</a> <a id="11904" class="Symbol">(</a><a id="11905" href="plfa.Untyped.html#10155" class="InductiveConstructor">ξ₁</a> <a id="11908" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a><a id="11909" class="Symbol">))))</a> <a id="11914" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a>
    <a id="11920" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11922" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11924" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11926" class="Number">1</a> <a id="11928" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11930" class="Symbol">(</a><a id="11931" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11933" class="Number">1</a> <a id="11935" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11937" class="Symbol">((</a><a id="11939" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11941" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11943" class="Number">2</a> <a id="11945" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11947" class="Symbol">(</a><a id="11948" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11950" class="Number">2</a> <a id="11952" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11954" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11956" class="Number">0</a><a id="11957" class="Symbol">))</a> <a id="11960" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="11962" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="11964" class="Number">0</a><a id="11965" class="Symbol">))</a>
  <a id="11970" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="11974" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="11976" class="Symbol">(</a><a id="11977" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="11979" class="Symbol">(</a><a id="11980" href="plfa.Untyped.html#10245" class="InductiveConstructor">ξ₂</a> <a id="11983" class="Symbol">(</a><a id="11984" href="plfa.Untyped.html#10245" class="InductiveConstructor">ξ₂</a> <a id="11987" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a><a id="11988" class="Symbol">)))</a> <a id="11992" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a>
   <a id="11997" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11999" class="Symbol">(</a><a id="12000" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="12002" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="12004" class="Number">1</a> <a id="12006" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="12008" class="Symbol">(</a><a id="12009" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="12011" class="Number">1</a> <a id="12013" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="12015" class="Symbol">(</a><a id="12016" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="12018" class="Number">1</a> <a id="12020" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="12022" class="Symbol">(</a><a id="12023" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="12025" class="Number">1</a> <a id="12027" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="12029" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="12031" class="Number">0</a><a id="12032" class="Symbol">))))</a>
  <a id="12039" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11253" class="InductiveConstructor Operator">∎</a>
</pre>{% endraw %}After just two steps the top-level term is an abstraction,
and `ζ` rules drive the rest of the normalisation. 


## Progress

Progress adapts.  Instead of claiming that every term either is a value
or takes a reduction step, we claim that every term is either in normal
form or takes a reduction step.

Previously, progress only applied to closed, well-typed terms.  We had
to rule out terms where we apply something other than a function (such
as `` `zero ``) or terms with a free variable.  Now we can demonstrate
it for open, well-scoped terms.  The definition of normal form permits
free variables, and we have no terms that are not functions.

A term makes progress if it can take a step or is in normal form:
{% raw %}<pre class="Agda"><a id="12764" class="Keyword">data</a> <a id="Progress"></a><a id="12769" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#12769" class="Datatype">Progress</a> <a id="12778" class="Symbol">{</a><a id="12779" href="plfa.Untyped.html#12779" class="Bound">Γ</a> <a id="12781" href="plfa.Untyped.html#12781" class="Bound">A</a><a id="12782" class="Symbol">}</a> <a id="12784" class="Symbol">(</a><a id="12785" href="plfa.Untyped.html#12785" class="Bound">M</a> <a id="12787" class="Symbol">:</a> <a id="12789" href="plfa.Untyped.html#12779" class="Bound">Γ</a> <a id="12791" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="12793" href="plfa.Untyped.html#12781" class="Bound">A</a><a id="12794" class="Symbol">)</a> <a id="12796" class="Symbol">:</a> <a id="12798" class="PrimitiveType">Set</a> <a id="12802" class="Keyword">where</a>

  <a id="Progress.step"></a><a id="12811" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#12811" class="InductiveConstructor">step</a> <a id="12816" class="Symbol">:</a> <a id="12818" class="Symbol">∀</a> <a id="12820" class="Symbol">{</a><a id="12821" href="plfa.Untyped.html#12821" class="Bound">N</a> <a id="12823" class="Symbol">:</a> <a id="12825" href="plfa.Untyped.html#12779" class="Bound">Γ</a> <a id="12827" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="12829" href="plfa.Untyped.html#12781" class="Bound">A</a><a id="12830" class="Symbol">}</a>
    <a id="12836" class="Symbol">→</a> <a id="12838" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#12785" class="Bound">M</a> <a id="12840" href="plfa.Untyped.html#10105" class="Datatype Operator">—→</a> <a id="12843" href="plfa.Untyped.html#12821" class="Bound">N</a>
      <a id="12851" class="Comment">----------</a>
    <a id="12866" class="Symbol">→</a> <a id="12868" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#12769" class="Datatype">Progress</a> <a id="12877" href="plfa.Untyped.html#12785" class="Bound">M</a>

  <a id="Progress.done"></a><a id="12882" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#12882" class="InductiveConstructor">done</a> <a id="12887" class="Symbol">:</a>
      <a id="12895" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7879" class="Datatype">Normal</a> <a id="12902" href="plfa.Untyped.html#12785" class="Bound">M</a>
      <a id="12910" class="Comment">----------</a>
    <a id="12925" class="Symbol">→</a> <a id="12927" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#12769" class="Datatype">Progress</a> <a id="12936" href="plfa.Untyped.html#12785" class="Bound">M</a>
</pre>{% endraw %}
If a term is well scoped then it satisfies progress:
{% raw %}<pre class="Agda"><a id="progress"></a><a id="13000" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#13000" class="Function">progress</a> <a id="13009" class="Symbol">:</a> <a id="13011" class="Symbol">∀</a> <a id="13013" class="Symbol">{</a><a id="13014" href="plfa.Untyped.html#13014" class="Bound">Γ</a> <a id="13016" href="plfa.Untyped.html#13016" class="Bound">A</a><a id="13017" class="Symbol">}</a> <a id="13019" class="Symbol">→</a> <a id="13021" class="Symbol">(</a><a id="13022" href="plfa.Untyped.html#13022" class="Bound">M</a> <a id="13024" class="Symbol">:</a> <a id="13026" href="plfa.Untyped.html#13014" class="Bound">Γ</a> <a id="13028" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="13030" href="plfa.Untyped.html#13016" class="Bound">A</a><a id="13031" class="Symbol">)</a> <a id="13033" class="Symbol">→</a> <a id="13035" href="plfa.Untyped.html#12769" class="Datatype">Progress</a> <a id="13044" href="plfa.Untyped.html#13022" class="Bound">M</a>
<a id="13046" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#13000" class="Function">progress</a> <a id="13055" class="Symbol">(</a><a id="13056" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="13058" href="plfa.Untyped.html#13058" class="Bound">x</a><a id="13059" class="Symbol">)</a>                                 <a id="13093" class="Symbol">=</a>  <a id="13096" href="plfa.Untyped.html#12882" class="InductiveConstructor">done</a> <a id="13101" class="Symbol">(</a><a id="13102" href="plfa.Untyped.html#8489" class="InductiveConstructor Operator">′</a> <a id="13104" href="plfa.Untyped.html#8127" class="InductiveConstructor Operator">`</a> <a id="13106" href="plfa.Untyped.html#13058" class="Bound">x</a><a id="13107" class="Symbol">)</a>
<a id="13109" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#13000" class="Function">progress</a> <a id="13118" class="Symbol">(</a><a id="13119" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="13121" href="plfa.Untyped.html#13121" class="Bound">N</a><a id="13122" class="Symbol">)</a>  <a id="13125" class="Keyword">with</a>  <a id="13131" href="plfa.Untyped.html#13000" class="Function">progress</a> <a id="13140" href="plfa.Untyped.html#13121" class="Bound">N</a>
<a id="13142" class="Symbol">...</a> <a id="13146" class="Symbol">|</a> <a id="13148" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#12811" class="InductiveConstructor">step</a> <a id="13153" href="plfa.Untyped.html#13153" class="Bound">N—→N′</a>                               <a id="13189" class="Symbol">=</a>  <a id="13192" href="plfa.Untyped.html#12811" class="InductiveConstructor">step</a> <a id="13197" class="Symbol">(</a><a id="13198" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="13200" href="plfa.Untyped.html#13153" class="Bound">N—→N′</a><a id="13205" class="Symbol">)</a>
<a id="13207" class="Symbol">...</a> <a id="13211" class="Symbol">|</a> <a id="13213" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#12882" class="InductiveConstructor">done</a> <a id="13218" href="plfa.Untyped.html#13218" class="Bound">NrmN</a>                                <a id="13254" class="Symbol">=</a>  <a id="13257" href="plfa.Untyped.html#12882" class="InductiveConstructor">done</a> <a id="13262" class="Symbol">(</a><a id="13263" href="plfa.Untyped.html#8564" class="InductiveConstructor Operator">ƛ</a> <a id="13265" href="plfa.Untyped.html#13218" class="Bound">NrmN</a><a id="13269" class="Symbol">)</a>
<a id="13271" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#13000" class="Function">progress</a> <a id="13280" class="Symbol">(</a><a id="13281" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="13283" href="plfa.Untyped.html#13283" class="Bound">x</a> <a id="13285" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="13287" href="plfa.Untyped.html#13287" class="Bound">M</a><a id="13288" class="Symbol">)</a> <a id="13290" class="Keyword">with</a> <a id="13295" href="plfa.Untyped.html#13000" class="Function">progress</a> <a id="13304" href="plfa.Untyped.html#13287" class="Bound">M</a>
<a id="13306" class="Symbol">...</a> <a id="13310" class="Symbol">|</a> <a id="13312" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#12811" class="InductiveConstructor">step</a> <a id="13317" href="plfa.Untyped.html#13317" class="Bound">M—→M′</a>                               <a id="13353" class="Symbol">=</a>  <a id="13356" href="plfa.Untyped.html#12811" class="InductiveConstructor">step</a> <a id="13361" class="Symbol">(</a><a id="13362" href="plfa.Untyped.html#10245" class="InductiveConstructor">ξ₂</a> <a id="13365" href="plfa.Untyped.html#13317" class="Bound">M—→M′</a><a id="13370" class="Symbol">)</a>
<a id="13372" class="Symbol">...</a> <a id="13376" class="Symbol">|</a> <a id="13378" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#12882" class="InductiveConstructor">done</a> <a id="13383" href="plfa.Untyped.html#13383" class="Bound">NrmM</a>                                <a id="13419" class="Symbol">=</a>  <a id="13422" href="plfa.Untyped.html#12882" class="InductiveConstructor">done</a> <a id="13427" class="Symbol">(</a><a id="13428" href="plfa.Untyped.html#8489" class="InductiveConstructor Operator">′</a> <a id="13430" class="Symbol">(</a><a id="13431" href="plfa.Untyped.html#8127" class="InductiveConstructor Operator">`</a> <a id="13433" class="Bound">x</a><a id="13434" class="Symbol">)</a> <a id="13436" href="plfa.Untyped.html#8196" class="InductiveConstructor Operator">·</a> <a id="13438" href="plfa.Untyped.html#13383" class="Bound">NrmM</a><a id="13442" class="Symbol">)</a>
<a id="13444" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#13000" class="Function">progress</a> <a id="13453" class="Symbol">((</a><a id="13455" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="13457" href="plfa.Untyped.html#13457" class="Bound">N</a><a id="13458" class="Symbol">)</a> <a id="13460" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="13462" href="plfa.Untyped.html#13462" class="Bound">M</a><a id="13463" class="Symbol">)</a>                           <a id="13491" class="Symbol">=</a>  <a id="13494" href="plfa.Untyped.html#12811" class="InductiveConstructor">step</a> <a id="13499" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a>
<a id="13501" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#13000" class="Function">progress</a> <a id="13510" class="Symbol">(</a><a id="13511" href="plfa.Untyped.html#13511" class="Bound">L</a><a id="13512" class="Symbol">@(_</a> <a id="13516" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="13518" class="Symbol">_)</a> <a id="13521" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="13523" href="plfa.Untyped.html#13523" class="Bound">M</a><a id="13524" class="Symbol">)</a> <a id="13526" class="Keyword">with</a> <a id="13531" href="plfa.Untyped.html#13000" class="Function">progress</a> <a id="13540" href="plfa.Untyped.html#13511" class="Bound">L</a>
<a id="13542" class="Symbol">...</a> <a id="13546" class="Symbol">|</a> <a id="13548" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#12811" class="InductiveConstructor">step</a> <a id="13553" href="plfa.Untyped.html#13553" class="Bound">L—→L′</a>                               <a id="13589" class="Symbol">=</a>  <a id="13592" href="plfa.Untyped.html#12811" class="InductiveConstructor">step</a> <a id="13597" class="Symbol">(</a><a id="13598" href="plfa.Untyped.html#10155" class="InductiveConstructor">ξ₁</a> <a id="13601" href="plfa.Untyped.html#13553" class="Bound">L—→L′</a><a id="13606" class="Symbol">)</a>
<a id="13608" class="Symbol">...</a> <a id="13612" class="Symbol">|</a> <a id="13614" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#12882" class="InductiveConstructor">done</a> <a id="13619" class="Symbol">(</a><a id="13620" href="plfa.Untyped.html#8489" class="InductiveConstructor Operator">′</a> <a id="13622" href="plfa.Untyped.html#13622" class="Bound">NeuL</a><a id="13626" class="Symbol">)</a> <a id="13628" class="Keyword">with</a> <a id="13633" href="plfa.Untyped.html#13000" class="Function">progress</a> <a id="13642" class="Bound">M</a>
<a id="13644" class="Symbol">...</a>    <a id="13651" class="Symbol">|</a> <a id="13653" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#12811" class="InductiveConstructor">step</a> <a id="13658" href="plfa.Untyped.html#13658" class="Bound">M—→M′</a>                            <a id="13691" class="Symbol">=</a>  <a id="13694" href="plfa.Untyped.html#12811" class="InductiveConstructor">step</a> <a id="13699" class="Symbol">(</a><a id="13700" href="plfa.Untyped.html#10245" class="InductiveConstructor">ξ₂</a> <a id="13703" href="plfa.Untyped.html#13658" class="Bound">M—→M′</a><a id="13708" class="Symbol">)</a>
<a id="13710" class="Symbol">...</a>    <a id="13717" class="Symbol">|</a> <a id="13719" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#12882" class="InductiveConstructor">done</a> <a id="13724" href="plfa.Untyped.html#13724" class="Bound">NrmM</a>                             <a id="13757" class="Symbol">=</a>  <a id="13760" href="plfa.Untyped.html#12882" class="InductiveConstructor">done</a> <a id="13765" class="Symbol">(</a><a id="13766" href="plfa.Untyped.html#8489" class="InductiveConstructor Operator">′</a> <a id="13768" class="Bound">NeuL</a> <a id="13773" href="plfa.Untyped.html#8196" class="InductiveConstructor Operator">·</a> <a id="13775" href="plfa.Untyped.html#13724" class="Bound">NrmM</a><a id="13779" class="Symbol">)</a>
</pre>{% endraw %}We induct on the evidence that the term is well scoped:

* If the term is a variable, then it is in normal form.
  (This contrasts with previous proofs, where the variable case was
  ruled out by the restriction to closed terms.)
* If the term is an abstraction, recursively invoke progress on the body.
  (This contrast with previous proofs, where an abstraction is
  immediately a value.):
  + If it steps, then the whole term steps via `ζ`.
  + If it is in normal form, then so is the whole term.
* If the term is an application, consider the function subterm:
  + If it is a variable, recursively invoke progress on the argument:
    - If it steps, then the whole term steps via `ξ₂`;
    - If it is normal, then so is the whole term.
  + If it is an abstraction, then the whole term steps via `β`.
  + If it is an application, recursively apply progress to the function subterm:
    - If it steps, then the whole term steps via `ξ₁`.
    - If it is normal, recursively apply progress to the argument subterm:
      * If it steps, then the whole term steps via `ξ₂`.
      * If it is normal, then so is the whole term.

The final equation for progress uses an _at pattern_ of the form `P@Q`,
which matches only if both pattern `P` and pattern `Q` match.  Character
`@` is one of the few that Agda doesn't allow in names, so spaces are not
required around it.  In this case, the pattern ensures that `L` is an
application.

## Evaluation

As previously, progress immediately yields an evaluator.

Gas is specified by a natural number:
{% raw %}<pre class="Agda"><a id="15327" class="Keyword">data</a> <a id="Gas"></a><a id="15332" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#15332" class="Datatype">Gas</a> <a id="15336" class="Symbol">:</a> <a id="15338" class="PrimitiveType">Set</a> <a id="15342" class="Keyword">where</a>
  <a id="Gas.gas"></a><a id="15350" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#15350" class="InductiveConstructor">gas</a> <a id="15354" class="Symbol">:</a> <a id="15356" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="15358" class="Symbol">→</a> <a id="15360" href="plfa.Untyped.html#15332" class="Datatype">Gas</a>
</pre>{% endraw %}When our evaluator returns a term `N`, it will either give evidence that
`N` is normal or indicate that it ran out of gas:
{% raw %}<pre class="Agda"><a id="15495" class="Keyword">data</a> <a id="Finished"></a><a id="15500" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#15500" class="Datatype">Finished</a> <a id="15509" class="Symbol">{</a><a id="15510" href="plfa.Untyped.html#15510" class="Bound">Γ</a> <a id="15512" href="plfa.Untyped.html#15512" class="Bound">A</a><a id="15513" class="Symbol">}</a> <a id="15515" class="Symbol">(</a><a id="15516" href="plfa.Untyped.html#15516" class="Bound">N</a> <a id="15518" class="Symbol">:</a> <a id="15520" href="plfa.Untyped.html#15510" class="Bound">Γ</a> <a id="15522" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="15524" href="plfa.Untyped.html#15512" class="Bound">A</a><a id="15525" class="Symbol">)</a> <a id="15527" class="Symbol">:</a> <a id="15529" class="PrimitiveType">Set</a> <a id="15533" class="Keyword">where</a>

   <a id="Finished.done"></a><a id="15543" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#15543" class="InductiveConstructor">done</a> <a id="15548" class="Symbol">:</a>
       <a id="15557" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#7879" class="Datatype">Normal</a> <a id="15564" href="plfa.Untyped.html#15516" class="Bound">N</a>
       <a id="15573" class="Comment">----------</a>
     <a id="15589" class="Symbol">→</a> <a id="15591" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#15500" class="Datatype">Finished</a> <a id="15600" href="plfa.Untyped.html#15516" class="Bound">N</a>

   <a id="Finished.out-of-gas"></a><a id="15606" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#15606" class="InductiveConstructor">out-of-gas</a> <a id="15617" class="Symbol">:</a>
       <a id="15626" class="Comment">----------</a>
       <a id="15644" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#15500" class="Datatype">Finished</a> <a id="15653" href="plfa.Untyped.html#15516" class="Bound">N</a>
</pre>{% endraw %}Given a term `L` of type `A`, the evaluator will, for some `N`, return
a reduction sequence from `L` to `N` and an indication of whether
reduction finished:
{% raw %}<pre class="Agda"><a id="15820" class="Keyword">data</a> <a id="Steps"></a><a id="15825" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#15825" class="Datatype">Steps</a> <a id="15831" class="Symbol">:</a> <a id="15833" class="Symbol">∀</a> <a id="15835" class="Symbol">{</a><a id="15836" href="plfa.Untyped.html#15836" class="Bound">Γ</a> <a id="15838" href="plfa.Untyped.html#15838" class="Bound">A</a><a id="15839" class="Symbol">}</a> <a id="15841" class="Symbol">→</a> <a id="15843" href="plfa.Untyped.html#15836" class="Bound">Γ</a> <a id="15845" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="15847" href="plfa.Untyped.html#15838" class="Bound">A</a> <a id="15849" class="Symbol">→</a> <a id="15851" class="PrimitiveType">Set</a> <a id="15855" class="Keyword">where</a>

  <a id="Steps.steps"></a><a id="15864" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#15864" class="InductiveConstructor">steps</a> <a id="15870" class="Symbol">:</a> <a id="15872" class="Symbol">∀</a> <a id="15874" class="Symbol">{</a><a id="15875" href="plfa.Untyped.html#15875" class="Bound">Γ</a> <a id="15877" href="plfa.Untyped.html#15877" class="Bound">A</a><a id="15878" class="Symbol">}</a> <a id="15880" class="Symbol">{</a><a id="15881" href="plfa.Untyped.html#15881" class="Bound">L</a> <a id="15883" href="plfa.Untyped.html#15883" class="Bound">N</a> <a id="15885" class="Symbol">:</a> <a id="15887" href="plfa.Untyped.html#15875" class="Bound">Γ</a> <a id="15889" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="15891" href="plfa.Untyped.html#15877" class="Bound">A</a><a id="15892" class="Symbol">}</a>
    <a id="15898" class="Symbol">→</a> <a id="15900" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#15881" class="Bound">L</a> <a id="15902" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="15905" href="plfa.Untyped.html#15883" class="Bound">N</a>
    <a id="15911" class="Symbol">→</a> <a id="15913" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#15500" class="Datatype">Finished</a> <a id="15922" href="plfa.Untyped.html#15883" class="Bound">N</a>
      <a id="15930" class="Comment">----------</a>
    <a id="15945" class="Symbol">→</a> <a id="15947" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#15825" class="Datatype">Steps</a> <a id="15953" href="plfa.Untyped.html#15881" class="Bound">L</a>
</pre>{% endraw %}The evaluator takes gas and a term and returns the corresponding steps:
{% raw %}<pre class="Agda"><a id="eval"></a><a id="16035" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#16035" class="Function">eval</a> <a id="16040" class="Symbol">:</a> <a id="16042" class="Symbol">∀</a> <a id="16044" class="Symbol">{</a><a id="16045" href="plfa.Untyped.html#16045" class="Bound">Γ</a> <a id="16047" href="plfa.Untyped.html#16047" class="Bound">A</a><a id="16048" class="Symbol">}</a>
  <a id="16052" class="Symbol">→</a> <a id="16054" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#15332" class="Datatype">Gas</a>
  <a id="16060" class="Symbol">→</a> <a id="16062" class="Symbol">(</a><a id="16063" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#16063" class="Bound">L</a> <a id="16065" class="Symbol">:</a> <a id="16067" href="plfa.Untyped.html#16045" class="Bound">Γ</a> <a id="16069" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="16071" href="plfa.Untyped.html#16047" class="Bound">A</a><a id="16072" class="Symbol">)</a>
    <a id="16078" class="Comment">-----------</a>
  <a id="16092" class="Symbol">→</a> <a id="16094" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#15825" class="Datatype">Steps</a> <a id="16100" href="plfa.Untyped.html#16063" class="Bound">L</a>
<a id="16102" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#16035" class="Function">eval</a> <a id="16107" class="Symbol">(</a><a id="16108" href="plfa.Untyped.html#15350" class="InductiveConstructor">gas</a> <a id="16112" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a><a id="16116" class="Symbol">)</a>    <a id="16121" href="plfa.Untyped.html#16121" class="Bound">L</a>                     <a id="16143" class="Symbol">=</a>  <a id="16146" href="plfa.Untyped.html#15864" class="InductiveConstructor">steps</a> <a id="16152" class="Symbol">(</a><a id="16153" href="plfa.Untyped.html#16121" class="Bound">L</a> <a id="16155" href="plfa.Untyped.html#11253" class="InductiveConstructor Operator">∎</a><a id="16156" class="Symbol">)</a> <a id="16158" href="plfa.Untyped.html#15606" class="InductiveConstructor">out-of-gas</a>
<a id="16169" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#16035" class="Function">eval</a> <a id="16174" class="Symbol">(</a><a id="16175" href="plfa.Untyped.html#15350" class="InductiveConstructor">gas</a> <a id="16179" class="Symbol">(</a><a id="16180" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="16184" href="plfa.Untyped.html#16184" class="Bound">m</a><a id="16185" class="Symbol">))</a> <a id="16188" href="plfa.Untyped.html#16188" class="Bound">L</a> <a id="16190" class="Keyword">with</a> <a id="16195" href="plfa.Untyped.html#13000" class="Function">progress</a> <a id="16204" href="plfa.Untyped.html#16188" class="Bound">L</a>
<a id="16206" class="Symbol">...</a> <a id="16210" class="Symbol">|</a> <a id="16212" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#12882" class="InductiveConstructor">done</a> <a id="16217" href="plfa.Untyped.html#16217" class="Bound">NrmL</a>                          <a id="16247" class="Symbol">=</a>  <a id="16250" href="plfa.Untyped.html#15864" class="InductiveConstructor">steps</a> <a id="16256" class="Symbol">(</a><a id="16257" class="Bound">L</a> <a id="16259" href="plfa.Untyped.html#11253" class="InductiveConstructor Operator">∎</a><a id="16260" class="Symbol">)</a> <a id="16262" class="Symbol">(</a><a id="16263" href="plfa.Untyped.html#15543" class="InductiveConstructor">done</a> <a id="16268" href="plfa.Untyped.html#16217" class="Bound">NrmL</a><a id="16272" class="Symbol">)</a>
<a id="16274" class="Symbol">...</a> <a id="16278" class="Symbol">|</a> <a id="16280" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#12811" class="InductiveConstructor">step</a> <a id="16285" class="Symbol">{</a><a id="16286" href="plfa.Untyped.html#16286" class="Bound">M</a><a id="16287" class="Symbol">}</a> <a id="16289" href="plfa.Untyped.html#16289" class="Bound">L—→M</a> <a id="16294" class="Keyword">with</a> <a id="16299" href="plfa.Untyped.html#16035" class="Function">eval</a> <a id="16304" class="Symbol">(</a><a id="16305" href="plfa.Untyped.html#15350" class="InductiveConstructor">gas</a> <a id="16309" class="Bound">m</a><a id="16310" class="Symbol">)</a> <a id="16312" href="plfa.Untyped.html#16286" class="Bound">M</a>
<a id="16314" class="Symbol">...</a>    <a id="16321" class="Symbol">|</a> <a id="16323" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#15864" class="InductiveConstructor">steps</a> <a id="16329" href="plfa.Untyped.html#16329" class="Bound">M—↠N</a> <a id="16334" href="plfa.Untyped.html#16334" class="Bound">fin</a>                  <a id="16355" class="Symbol">=</a>  <a id="16358" href="plfa.Untyped.html#15864" class="InductiveConstructor">steps</a> <a id="16364" class="Symbol">(</a><a id="16365" class="Bound">L</a> <a id="16367" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="16371" class="Bound">L—→M</a> <a id="16376" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a> <a id="16378" href="plfa.Untyped.html#16329" class="Bound">M—↠N</a><a id="16382" class="Symbol">)</a> <a id="16384" href="plfa.Untyped.html#16334" class="Bound">fin</a>
</pre>{% endraw %}The definition is as before, save that the empty context `∅`
generalises to an arbitrary context `Γ`.

## Example

We reiterate our previous example. Two plus two is four, with Church numerals:
{% raw %}<pre class="Agda"><a id="16590" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#16590" class="Function">_</a> <a id="16592" class="Symbol">:</a> <a id="16594" href="plfa.Untyped.html#16035" class="Function">eval</a> <a id="16599" class="Symbol">(</a><a id="16600" href="plfa.Untyped.html#15350" class="InductiveConstructor">gas</a> <a id="16604" class="Number">100</a><a id="16607" class="Symbol">)</a> <a id="16609" href="plfa.Untyped.html#5395" class="Function">2+2ᶜ</a> <a id="16614" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a>
  <a id="16618" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#15864" class="InductiveConstructor">steps</a>
   <a id="16627" class="Symbol">((</a><a id="16629" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a>
     <a id="16636" class="Symbol">(</a><a id="16637" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a>
      <a id="16645" class="Symbol">(</a><a id="16646" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a>
       <a id="16655" class="Symbol">(</a><a id="16656" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a>
        <a id="16666" class="Symbol">(</a><a id="16667" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4288" class="InductiveConstructor Operator">`</a> <a id="16669" class="Symbol">(</a><a id="16670" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="16672" class="Symbol">(</a><a id="16673" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="16675" class="Symbol">(</a><a id="16676" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="16678" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16679" class="Symbol">))))</a> <a id="16684" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="16686" class="Symbol">(</a><a id="16687" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16689" class="Symbol">(</a><a id="16690" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="16692" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16693" class="Symbol">))</a> <a id="16696" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a>
        <a id="16706" class="Symbol">((</a><a id="16708" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4288" class="InductiveConstructor Operator">`</a> <a id="16710" class="Symbol">(</a><a id="16711" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="16713" class="Symbol">(</a><a id="16714" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="16716" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16717" class="Symbol">)))</a> <a id="16721" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="16723" class="Symbol">(</a><a id="16724" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16726" class="Symbol">(</a><a id="16727" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="16729" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16730" class="Symbol">))</a> <a id="16733" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="16735" class="Symbol">(</a><a id="16736" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16738" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16739" class="Symbol">))))))</a>
    <a id="16750" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4400" class="InductiveConstructor Operator">·</a> <a id="16752" class="Symbol">(</a><a id="16753" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16755" class="Symbol">(</a><a id="16756" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16758" class="Symbol">(</a><a id="16759" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16761" class="Symbol">(</a><a id="16762" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="16764" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16765" class="Symbol">))</a> <a id="16768" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="16770" class="Symbol">((</a><a id="16772" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16774" class="Symbol">(</a><a id="16775" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="16777" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16778" class="Symbol">))</a> <a id="16781" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="16783" class="Symbol">(</a><a id="16784" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16786" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16787" class="Symbol">))))</a>
    <a id="16796" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4400" class="InductiveConstructor Operator">·</a> <a id="16798" class="Symbol">(</a><a id="16799" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16801" class="Symbol">(</a><a id="16802" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16804" class="Symbol">(</a><a id="16805" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16807" class="Symbol">(</a><a id="16808" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="16810" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16811" class="Symbol">))</a> <a id="16814" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="16816" class="Symbol">((</a><a id="16818" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16820" class="Symbol">(</a><a id="16821" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="16823" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16824" class="Symbol">))</a> <a id="16827" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="16829" class="Symbol">(</a><a id="16830" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16832" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16833" class="Symbol">))))</a>
   <a id="16841" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="16845" href="plfa.Untyped.html#10155" class="InductiveConstructor">ξ₁</a> <a id="16848" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a> <a id="16850" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a>
    <a id="16856" class="Symbol">(</a><a id="16857" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a>
     <a id="16864" class="Symbol">(</a><a id="16865" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a>
      <a id="16873" class="Symbol">(</a><a id="16874" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a>
       <a id="16883" class="Symbol">(</a><a id="16884" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16886" class="Symbol">(</a><a id="16887" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16889" class="Symbol">(</a><a id="16890" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16892" class="Symbol">(</a><a id="16893" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="16895" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16896" class="Symbol">))</a> <a id="16899" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="16901" class="Symbol">((</a><a id="16903" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16905" class="Symbol">(</a><a id="16906" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="16908" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16909" class="Symbol">))</a> <a id="16912" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="16914" class="Symbol">(</a><a id="16915" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16917" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16918" class="Symbol">))))</a> <a id="16923" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="16925" class="Symbol">(</a><a id="16926" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16928" class="Symbol">(</a><a id="16929" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="16931" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16932" class="Symbol">))</a> <a id="16935" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a>
       <a id="16944" class="Symbol">((</a><a id="16946" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4288" class="InductiveConstructor Operator">`</a> <a id="16948" class="Symbol">(</a><a id="16949" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="16951" class="Symbol">(</a><a id="16952" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="16954" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16955" class="Symbol">)))</a> <a id="16959" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="16961" class="Symbol">(</a><a id="16962" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16964" class="Symbol">(</a><a id="16965" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="16967" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16968" class="Symbol">))</a> <a id="16971" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="16973" class="Symbol">(</a><a id="16974" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16976" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16977" class="Symbol">)))))</a>
    <a id="16987" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4400" class="InductiveConstructor Operator">·</a> <a id="16989" class="Symbol">(</a><a id="16990" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16992" class="Symbol">(</a><a id="16993" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16995" class="Symbol">(</a><a id="16996" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16998" class="Symbol">(</a><a id="16999" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17001" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17002" class="Symbol">))</a> <a id="17005" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17007" class="Symbol">((</a><a id="17009" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17011" class="Symbol">(</a><a id="17012" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17014" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17015" class="Symbol">))</a> <a id="17018" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17020" class="Symbol">(</a><a id="17021" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17023" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17024" class="Symbol">))))</a>
   <a id="17032" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="17036" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a> <a id="17038" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a>
    <a id="17044" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a>
    <a id="17050" class="Symbol">(</a><a id="17051" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a>
     <a id="17058" class="Symbol">(</a><a id="17059" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="17061" class="Symbol">(</a><a id="17062" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="17064" class="Symbol">(</a><a id="17065" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17067" class="Symbol">(</a><a id="17068" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17070" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17071" class="Symbol">))</a> <a id="17074" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17076" class="Symbol">((</a><a id="17078" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17080" class="Symbol">(</a><a id="17081" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17083" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17084" class="Symbol">))</a> <a id="17087" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17089" class="Symbol">(</a><a id="17090" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17092" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17093" class="Symbol">))))</a> <a id="17098" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17100" class="Symbol">(</a><a id="17101" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17103" class="Symbol">(</a><a id="17104" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17106" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17107" class="Symbol">))</a> <a id="17110" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a>
     <a id="17117" class="Symbol">((</a><a id="17119" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="17121" class="Symbol">(</a><a id="17122" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="17124" class="Symbol">(</a><a id="17125" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17127" class="Symbol">(</a><a id="17128" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17130" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17131" class="Symbol">))</a> <a id="17134" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17136" class="Symbol">((</a><a id="17138" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17140" class="Symbol">(</a><a id="17141" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17143" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17144" class="Symbol">))</a> <a id="17147" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17149" class="Symbol">(</a><a id="17150" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17152" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17153" class="Symbol">))))</a> <a id="17158" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17160" class="Symbol">(</a><a id="17161" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17163" class="Symbol">(</a><a id="17164" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17166" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17167" class="Symbol">))</a> <a id="17170" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17172" class="Symbol">(</a><a id="17173" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17175" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17176" class="Symbol">)))</a>
   <a id="17183" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="17187" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="17189" class="Symbol">(</a><a id="17190" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="17192" class="Symbol">(</a><a id="17193" href="plfa.Untyped.html#10155" class="InductiveConstructor">ξ₁</a> <a id="17196" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a><a id="17197" class="Symbol">))</a> <a id="17200" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a>
    <a id="17206" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a>
    <a id="17212" class="Symbol">(</a><a id="17213" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a>
     <a id="17220" class="Symbol">(</a><a id="17221" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="17223" class="Symbol">(</a><a id="17224" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17226" class="Symbol">(</a><a id="17227" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17229" class="Symbol">(</a><a id="17230" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17232" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17233" class="Symbol">)))</a> <a id="17237" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17239" class="Symbol">((</a><a id="17241" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17243" class="Symbol">(</a><a id="17244" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17246" class="Symbol">(</a><a id="17247" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17249" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17250" class="Symbol">)))</a> <a id="17254" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17256" class="Symbol">(</a><a id="17257" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17259" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17260" class="Symbol">)))</a> <a id="17264" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a>
     <a id="17271" class="Symbol">((</a><a id="17273" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="17275" class="Symbol">(</a><a id="17276" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="17278" class="Symbol">(</a><a id="17279" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17281" class="Symbol">(</a><a id="17282" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17284" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17285" class="Symbol">))</a> <a id="17288" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17290" class="Symbol">((</a><a id="17292" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17294" class="Symbol">(</a><a id="17295" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17297" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17298" class="Symbol">))</a> <a id="17301" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17303" class="Symbol">(</a><a id="17304" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17306" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17307" class="Symbol">))))</a> <a id="17312" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17314" class="Symbol">(</a><a id="17315" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17317" class="Symbol">(</a><a id="17318" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17320" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17321" class="Symbol">))</a> <a id="17324" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17326" class="Symbol">(</a><a id="17327" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17329" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17330" class="Symbol">)))</a>
   <a id="17337" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="17341" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="17343" class="Symbol">(</a><a id="17344" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="17346" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a><a id="17347" class="Symbol">)</a> <a id="17349" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a>
    <a id="17355" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a>
    <a id="17361" class="Symbol">(</a><a id="17362" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a>
     <a id="17369" class="Symbol">(</a><a id="17370" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4288" class="InductiveConstructor Operator">`</a> <a id="17372" class="Symbol">(</a><a id="17373" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17375" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17376" class="Symbol">))</a> <a id="17379" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a>
     <a id="17386" class="Symbol">((</a><a id="17388" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4288" class="InductiveConstructor Operator">`</a> <a id="17390" class="Symbol">(</a><a id="17391" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17393" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17394" class="Symbol">))</a> <a id="17397" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a>
      <a id="17405" class="Symbol">((</a><a id="17407" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="17409" class="Symbol">(</a><a id="17410" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="17412" class="Symbol">(</a><a id="17413" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17415" class="Symbol">(</a><a id="17416" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17418" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17419" class="Symbol">))</a> <a id="17422" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17424" class="Symbol">((</a><a id="17426" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17428" class="Symbol">(</a><a id="17429" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17431" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17432" class="Symbol">))</a> <a id="17435" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17437" class="Symbol">(</a><a id="17438" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17440" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17441" class="Symbol">))))</a> <a id="17446" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17448" class="Symbol">(</a><a id="17449" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17451" class="Symbol">(</a><a id="17452" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17454" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17455" class="Symbol">))</a> <a id="17458" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17460" class="Symbol">(</a><a id="17461" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17463" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17464" class="Symbol">))))</a>
   <a id="17472" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="17476" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="17478" class="Symbol">(</a><a id="17479" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="17481" class="Symbol">(</a><a id="17482" href="plfa.Untyped.html#10245" class="InductiveConstructor">ξ₂</a> <a id="17485" class="Symbol">(</a><a id="17486" href="plfa.Untyped.html#10245" class="InductiveConstructor">ξ₂</a> <a id="17489" class="Symbol">(</a><a id="17490" href="plfa.Untyped.html#10155" class="InductiveConstructor">ξ₁</a> <a id="17493" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a><a id="17494" class="Symbol">))))</a> <a id="17499" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a>
    <a id="17505" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a>
    <a id="17511" class="Symbol">(</a><a id="17512" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a>
     <a id="17519" class="Symbol">(</a><a id="17520" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4288" class="InductiveConstructor Operator">`</a> <a id="17522" class="Symbol">(</a><a id="17523" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17525" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17526" class="Symbol">))</a> <a id="17529" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a>
     <a id="17536" class="Symbol">((</a><a id="17538" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4288" class="InductiveConstructor Operator">`</a> <a id="17540" class="Symbol">(</a><a id="17541" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17543" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17544" class="Symbol">))</a> <a id="17547" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a>
      <a id="17555" class="Symbol">((</a><a id="17557" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="17559" class="Symbol">(</a><a id="17560" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17562" class="Symbol">(</a><a id="17563" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17565" class="Symbol">(</a><a id="17566" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17568" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17569" class="Symbol">)))</a> <a id="17573" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17575" class="Symbol">((</a><a id="17577" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17579" class="Symbol">(</a><a id="17580" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17582" class="Symbol">(</a><a id="17583" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17585" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17586" class="Symbol">)))</a> <a id="17590" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17592" class="Symbol">(</a><a id="17593" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17595" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17596" class="Symbol">)))</a> <a id="17600" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17602" class="Symbol">(</a><a id="17603" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17605" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17606" class="Symbol">))))</a>
   <a id="17614" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="17618" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="17620" class="Symbol">(</a><a id="17621" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="17623" class="Symbol">(</a><a id="17624" href="plfa.Untyped.html#10245" class="InductiveConstructor">ξ₂</a> <a id="17627" class="Symbol">(</a><a id="17628" href="plfa.Untyped.html#10245" class="InductiveConstructor">ξ₂</a> <a id="17631" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a><a id="17632" class="Symbol">)))</a> <a id="17636" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a>
    <a id="17642" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="17644" class="Symbol">(</a><a id="17645" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="17647" class="Symbol">(</a><a id="17648" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17650" class="Symbol">(</a><a id="17651" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17653" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17654" class="Symbol">))</a> <a id="17657" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17659" class="Symbol">((</a><a id="17661" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17663" class="Symbol">(</a><a id="17664" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17666" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17667" class="Symbol">))</a> <a id="17670" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17672" class="Symbol">((</a><a id="17674" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17676" class="Symbol">(</a><a id="17677" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17679" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17680" class="Symbol">))</a> <a id="17683" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17685" class="Symbol">((</a><a id="17687" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17689" class="Symbol">(</a><a id="17690" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17692" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17693" class="Symbol">))</a> <a id="17696" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="17698" class="Symbol">(</a><a id="17699" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="17701" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17702" class="Symbol">)))))</a>
   <a id="17711" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#11253" class="InductiveConstructor Operator">∎</a><a id="17712" class="Symbol">)</a>
   <a id="17717" class="Symbol">(</a><a id="17718" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#15543" class="InductiveConstructor">done</a>
    <a id="17727" class="Symbol">(</a><a id="17728" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#8564" class="InductiveConstructor Operator">ƛ</a>
     <a id="17735" class="Symbol">(</a><a id="17736" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#8564" class="InductiveConstructor Operator">ƛ</a>
      <a id="17744" class="Symbol">(</a><a id="17745" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#8489" class="InductiveConstructor Operator">′</a>
       <a id="17754" class="Symbol">(</a><a id="17755" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#8127" class="InductiveConstructor Operator">`</a> <a id="17757" class="Symbol">(</a><a id="17758" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17760" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17761" class="Symbol">))</a> <a id="17764" href="plfa.Untyped.html#8196" class="InductiveConstructor Operator">·</a>
       <a id="17773" class="Symbol">(</a><a id="17774" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#8489" class="InductiveConstructor Operator">′</a> <a id="17776" class="Symbol">(</a><a id="17777" href="plfa.Untyped.html#8127" class="InductiveConstructor Operator">`</a> <a id="17779" class="Symbol">(</a><a id="17780" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17782" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17783" class="Symbol">))</a> <a id="17786" href="plfa.Untyped.html#8196" class="InductiveConstructor Operator">·</a> <a id="17788" class="Symbol">(</a><a id="17789" href="plfa.Untyped.html#8489" class="InductiveConstructor Operator">′</a> <a id="17791" class="Symbol">(</a><a id="17792" href="plfa.Untyped.html#8127" class="InductiveConstructor Operator">`</a> <a id="17794" class="Symbol">(</a><a id="17795" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17797" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17798" class="Symbol">))</a> <a id="17801" href="plfa.Untyped.html#8196" class="InductiveConstructor Operator">·</a> <a id="17803" class="Symbol">(</a><a id="17804" href="plfa.Untyped.html#8489" class="InductiveConstructor Operator">′</a> <a id="17806" class="Symbol">(</a><a id="17807" href="plfa.Untyped.html#8127" class="InductiveConstructor Operator">`</a> <a id="17809" class="Symbol">(</a><a id="17810" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="17812" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17813" class="Symbol">))</a> <a id="17816" href="plfa.Untyped.html#8196" class="InductiveConstructor Operator">·</a> <a id="17818" class="Symbol">(</a><a id="17819" href="plfa.Untyped.html#8489" class="InductiveConstructor Operator">′</a> <a id="17821" class="Symbol">(</a><a id="17822" href="plfa.Untyped.html#8127" class="InductiveConstructor Operator">`</a> <a id="17824" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="17825" class="Symbol">)))))))))</a>
<a id="17835" class="Symbol">_</a> <a id="17837" class="Symbol">=</a> <a id="17839" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>{% endraw %}
## Naturals and fixpoint

We could simulate naturals using Church numerals, but computing
predecessor is tricky and expensive.  Instead, we use a different
representation, called Scott numerals, where a number is essentially
defined by the expression that corresponds to its own case statement.

Recall that Church numerals apply a given function for the
corresponding number of times.  Using named terms, we represent the
first three Church numerals as follows:

    zero  =  ƛ s ⇒ ƛ z ⇒ z
    one   =  ƛ s ⇒ ƛ z ⇒ s · z
    two   =  ƛ s ⇒ ƛ z ⇒ s · (s · z)

In contrast, for Scott numerals, we represent the first three naturals
as follows:

    zero = ƛ s ⇒ ƛ z ⇒ z
    one  = ƛ s ⇒ ƛ z ⇒ s · zero
    two  = ƛ s ⇒ ƛ z ⇒ s · one

Each representation expects two arguments, one corresponding to
the successor branch of the case (it expects an additional argument,
the predecessor of the current argument) and one corresponding to the
zero branch of the case.  (The cases could be in either order.
We put the successor case first to ease comparison with Church numerals.)

Here is the representation of naturals encoded with de Bruijn indexes:
{% raw %}<pre class="Agda"><a id="`zero"></a><a id="18998" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#18998" class="Function">`zero</a> <a id="19004" class="Symbol">:</a> <a id="19006" class="Symbol">∀</a> <a id="19008" class="Symbol">{</a><a id="19009" href="plfa.Untyped.html#19009" class="Bound">Γ</a><a id="19010" class="Symbol">}</a> <a id="19012" class="Symbol">→</a> <a id="19014" class="Symbol">(</a><a id="19015" href="plfa.Untyped.html#19009" class="Bound">Γ</a> <a id="19017" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="19019" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="19020" class="Symbol">)</a>
<a id="19022" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#18998" class="Function">`zero</a> <a id="19028" class="Symbol">=</a> <a id="19030" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="19032" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="19034" class="Symbol">(</a><a id="19035" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="19037" class="Number">0</a><a id="19038" class="Symbol">)</a>

<a id="`suc_"></a><a id="19041" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#19041" class="Function Operator">`suc_</a> <a id="19047" class="Symbol">:</a> <a id="19049" class="Symbol">∀</a> <a id="19051" class="Symbol">{</a><a id="19052" href="plfa.Untyped.html#19052" class="Bound">Γ</a><a id="19053" class="Symbol">}</a> <a id="19055" class="Symbol">→</a> <a id="19057" class="Symbol">(</a><a id="19058" href="plfa.Untyped.html#19052" class="Bound">Γ</a> <a id="19060" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="19062" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="19063" class="Symbol">)</a> <a id="19065" class="Symbol">→</a> <a id="19067" class="Symbol">(</a><a id="19068" href="plfa.Untyped.html#19052" class="Bound">Γ</a> <a id="19070" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="19072" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="19073" class="Symbol">)</a>
<a id="19075" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#19041" class="Function Operator">`suc_</a> <a id="19081" href="plfa.Untyped.html#19081" class="Bound">M</a>  <a id="19084" class="Symbol">=</a> <a id="19086" class="Symbol">(</a><a id="19087" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="19089" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="19091" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="19093" class="Symbol">(</a><a id="19094" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="19096" class="Number">1</a> <a id="19098" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="19100" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="19102" class="Number">2</a><a id="19103" class="Symbol">))</a> <a id="19106" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="19108" href="plfa.Untyped.html#19081" class="Bound">M</a>

<a id="case"></a><a id="19111" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#19111" class="Function">case</a> <a id="19116" class="Symbol">:</a> <a id="19118" class="Symbol">∀</a> <a id="19120" class="Symbol">{</a><a id="19121" href="plfa.Untyped.html#19121" class="Bound">Γ</a><a id="19122" class="Symbol">}</a> <a id="19124" class="Symbol">→</a> <a id="19126" class="Symbol">(</a><a id="19127" href="plfa.Untyped.html#19121" class="Bound">Γ</a> <a id="19129" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="19131" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="19132" class="Symbol">)</a> <a id="19134" class="Symbol">→</a> <a id="19136" class="Symbol">(</a><a id="19137" href="plfa.Untyped.html#19121" class="Bound">Γ</a> <a id="19139" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="19141" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="19142" class="Symbol">)</a> <a id="19144" class="Symbol">→</a> <a id="19146" class="Symbol">(</a><a id="19147" href="plfa.Untyped.html#19121" class="Bound">Γ</a> <a id="19149" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="19151" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="19153" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="19155" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="19156" class="Symbol">)</a>  <a id="19159" class="Symbol">→</a> <a id="19161" class="Symbol">(</a><a id="19162" href="plfa.Untyped.html#19121" class="Bound">Γ</a> <a id="19164" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="19166" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="19167" class="Symbol">)</a>
<a id="19169" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#19111" class="Function">case</a> <a id="19174" href="plfa.Untyped.html#19174" class="Bound">L</a> <a id="19176" href="plfa.Untyped.html#19176" class="Bound">M</a> <a id="19178" href="plfa.Untyped.html#19178" class="Bound">N</a> <a id="19180" class="Symbol">=</a> <a id="19182" href="plfa.Untyped.html#19174" class="Bound">L</a> <a id="19184" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="19186" class="Symbol">(</a><a id="19187" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="19189" href="plfa.Untyped.html#19178" class="Bound">N</a><a id="19190" class="Symbol">)</a> <a id="19192" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="19194" href="plfa.Untyped.html#19176" class="Bound">M</a>
</pre>{% endraw %}Here we have been careful to retain the exact form of our previous
definitions.  The successor branch expects an additional variable to
be in scope (as indicated by its type), so it is converted to an
ordinary term using lambda abstraction.

We can also define fixpoint.  Using named terms, we define:

    μ f = (ƛ x ⇒ f · (x · x)) · (ƛ x ⇒ f · (x · x))

This works because:

      μ f
    ≡
      (ƛ x ⇒ f · (x · x)) · (ƛ x ⇒ f · (x · x))
    —→
      f · ((ƛ x ⇒ f · (x · x)) · (ƛ x ⇒ f · (x · x)))
    ≡
      f · (μ f)

With de Bruijn indices, we have the following:
{% raw %}<pre class="Agda"><a id="μ_"></a><a id="19776" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#19776" class="Function Operator">μ_</a> <a id="19779" class="Symbol">:</a> <a id="19781" class="Symbol">∀</a> <a id="19783" class="Symbol">{</a><a id="19784" href="plfa.Untyped.html#19784" class="Bound">Γ</a><a id="19785" class="Symbol">}</a> <a id="19787" class="Symbol">→</a> <a id="19789" class="Symbol">(</a><a id="19790" href="plfa.Untyped.html#19784" class="Bound">Γ</a> <a id="19792" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="19794" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="19796" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="19798" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="19799" class="Symbol">)</a> <a id="19801" class="Symbol">→</a> <a id="19803" class="Symbol">(</a><a id="19804" href="plfa.Untyped.html#19784" class="Bound">Γ</a> <a id="19806" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="19808" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="19809" class="Symbol">)</a>
<a id="19811" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#19776" class="Function Operator">μ</a> <a id="19813" href="plfa.Untyped.html#19813" class="Bound">N</a>  <a id="19816" class="Symbol">=</a>  <a id="19819" class="Symbol">(</a><a id="19820" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="19822" class="Symbol">((</a><a id="19824" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="19826" class="Symbol">(</a><a id="19827" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="19829" class="Number">1</a> <a id="19831" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="19833" class="Symbol">(</a><a id="19834" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="19836" class="Number">0</a> <a id="19838" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="19840" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="19842" class="Number">0</a><a id="19843" class="Symbol">)))</a> <a id="19847" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="19849" class="Symbol">(</a><a id="19850" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="19852" class="Symbol">(</a><a id="19853" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="19855" class="Number">1</a> <a id="19857" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="19859" class="Symbol">(</a><a id="19860" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="19862" class="Number">0</a> <a id="19864" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="19866" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="19868" class="Number">0</a><a id="19869" class="Symbol">)))))</a> <a id="19875" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="19877" class="Symbol">(</a><a id="19878" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="19880" href="plfa.Untyped.html#19813" class="Bound">N</a><a id="19881" class="Symbol">)</a>
</pre>{% endraw %}The argument to fixpoint is treated similarly to the successor branch of case.

We can now define two plus two exactly as before:
{% raw %}<pre class="Agda"><a id="20021" class="Keyword">infix</a> <a id="20027" class="Number">5</a> <a id="20029" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#19776" class="Function Operator">μ_</a>

<a id="two"></a><a id="20033" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#20033" class="Function">two</a> <a id="20037" class="Symbol">:</a> <a id="20039" class="Symbol">∀</a> <a id="20041" class="Symbol">{</a><a id="20042" href="plfa.Untyped.html#20042" class="Bound">Γ</a><a id="20043" class="Symbol">}</a> <a id="20045" class="Symbol">→</a> <a id="20047" href="plfa.Untyped.html#20042" class="Bound">Γ</a> <a id="20049" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="20051" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a>
<a id="20053" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#20033" class="Function">two</a> <a id="20057" class="Symbol">=</a> <a id="20059" href="plfa.Untyped.html#19041" class="Function Operator">`suc</a> <a id="20064" href="plfa.Untyped.html#19041" class="Function Operator">`suc</a> <a id="20069" href="plfa.Untyped.html#18998" class="Function">`zero</a>

<a id="four"></a><a id="20076" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#20076" class="Function">four</a> <a id="20081" class="Symbol">:</a> <a id="20083" class="Symbol">∀</a> <a id="20085" class="Symbol">{</a><a id="20086" href="plfa.Untyped.html#20086" class="Bound">Γ</a><a id="20087" class="Symbol">}</a> <a id="20089" class="Symbol">→</a> <a id="20091" href="plfa.Untyped.html#20086" class="Bound">Γ</a> <a id="20093" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="20095" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a>
<a id="20097" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#20076" class="Function">four</a> <a id="20102" class="Symbol">=</a> <a id="20104" href="plfa.Untyped.html#19041" class="Function Operator">`suc</a> <a id="20109" href="plfa.Untyped.html#19041" class="Function Operator">`suc</a> <a id="20114" href="plfa.Untyped.html#19041" class="Function Operator">`suc</a> <a id="20119" href="plfa.Untyped.html#19041" class="Function Operator">`suc</a> <a id="20124" href="plfa.Untyped.html#18998" class="Function">`zero</a>

<a id="plus"></a><a id="20131" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#20131" class="Function">plus</a> <a id="20136" class="Symbol">:</a> <a id="20138" class="Symbol">∀</a> <a id="20140" class="Symbol">{</a><a id="20141" href="plfa.Untyped.html#20141" class="Bound">Γ</a><a id="20142" class="Symbol">}</a> <a id="20144" class="Symbol">→</a> <a id="20146" href="plfa.Untyped.html#20141" class="Bound">Γ</a> <a id="20148" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="20150" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a>
<a id="20152" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#20131" class="Function">plus</a> <a id="20157" class="Symbol">=</a> <a id="20159" href="plfa.Untyped.html#19776" class="Function Operator">μ</a> <a id="20161" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="20163" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="20165" class="Symbol">(</a><a id="20166" href="plfa.Untyped.html#19111" class="Function">case</a> <a id="20171" class="Symbol">(</a><a id="20172" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="20174" class="Number">1</a><a id="20175" class="Symbol">)</a> <a id="20177" class="Symbol">(</a><a id="20178" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="20180" class="Number">0</a><a id="20181" class="Symbol">)</a> <a id="20183" class="Symbol">(</a><a id="20184" href="plfa.Untyped.html#19041" class="Function Operator">`suc</a> <a id="20189" class="Symbol">(</a><a id="20190" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="20192" class="Number">3</a> <a id="20194" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="20196" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="20198" class="Number">0</a> <a id="20200" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="20202" href="plfa.Untyped.html#5069" class="Function Operator">#</a> <a id="20204" class="Number">1</a><a id="20205" class="Symbol">)))</a>
</pre>{% endraw %}Because `` `suc `` is now a defined term rather than primitive,
it is no longer the case that `plus · two · two` reduces to `four`,
but they do both reduce to the same normal term.

#### Exercise `plus-eval`

Use the evaluator to confirm that `plus · two · two` and `four`
normalise to the same term.

{% raw %}<pre class="Agda"><a id="20519" class="Comment">-- Your code goes here</a>
</pre>{% endraw %}
#### Exercise `multiplication-untyped` (recommended)

Use the encodings above to translate your definition of
multiplication from previous chapters with the Scott
representation and the encoding of the fixpoint operator.
Confirm that two times two is four.

{% raw %}<pre class="Agda"><a id="20809" class="Comment">-- Your code goes here</a>
</pre>{% endraw %}
#### Exercise `encode-more` (stretch)

Along the lines above, encode all of the constructs of
Chapter [More]({{ site.baseurl }}/More/),
save for primitive numbers, in the untyped lambda calculus.

{% raw %}<pre class="Agda"><a id="21038" class="Comment">-- Your code goes here</a>
</pre>{% endraw %}

## Multi-step reduction is transitive

In our formulation of the reflexive transitive closure of reduction,
i.e., the `—↠` relation, there is not an explicit rule for
transitivity. Instead the relation mimics the structure of lists by
providing a case for an empty reduction sequence and a case for adding
one reduction to the front of a reduction sequence.  The following is
the proof of transitivity, which has the same structure as the append
function `_++_` on lists.

{% raw %}<pre class="Agda"><a id="—↠-trans"></a><a id="21544" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#21544" class="Function">—↠-trans</a> <a id="21553" class="Symbol">:</a> <a id="21555" class="Symbol">∀{</a><a id="21557" href="plfa.Untyped.html#21557" class="Bound">Γ</a><a id="21558" class="Symbol">}{</a><a id="21560" href="plfa.Untyped.html#21560" class="Bound">A</a><a id="21561" class="Symbol">}{</a><a id="21563" href="plfa.Untyped.html#21563" class="Bound">L</a> <a id="21565" href="plfa.Untyped.html#21565" class="Bound">M</a> <a id="21567" href="plfa.Untyped.html#21567" class="Bound">N</a> <a id="21569" class="Symbol">:</a> <a id="21571" href="plfa.Untyped.html#21557" class="Bound">Γ</a> <a id="21573" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="21575" href="plfa.Untyped.html#21560" class="Bound">A</a><a id="21576" class="Symbol">}</a>
         <a id="21587" class="Symbol">→</a> <a id="21589" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#21563" class="Bound">L</a> <a id="21591" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="21594" href="plfa.Untyped.html#21565" class="Bound">M</a>
         <a id="21605" class="Symbol">→</a> <a id="21607" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#21565" class="Bound">M</a> <a id="21609" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="21612" href="plfa.Untyped.html#21567" class="Bound">N</a>
         <a id="21623" class="Symbol">→</a> <a id="21625" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#21563" class="Bound">L</a> <a id="21627" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="21630" href="plfa.Untyped.html#21567" class="Bound">N</a>
<a id="21632" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#21544" class="Function">—↠-trans</a> <a id="21641" class="Symbol">(</a><a id="21642" href="plfa.Untyped.html#21642" class="Bound">M</a> <a id="21644" href="plfa.Untyped.html#11253" class="InductiveConstructor Operator">∎</a><a id="21645" class="Symbol">)</a> <a id="21647" href="plfa.Untyped.html#21647" class="Bound">mn</a> <a id="21650" class="Symbol">=</a> <a id="21652" href="plfa.Untyped.html#21647" class="Bound">mn</a>
<a id="21655" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#21544" class="Function">—↠-trans</a> <a id="21664" class="Symbol">(</a><a id="21665" href="plfa.Untyped.html#21665" class="Bound">L</a> <a id="21667" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="21671" href="plfa.Untyped.html#21671" class="Bound">r</a> <a id="21673" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a> <a id="21675" href="plfa.Untyped.html#21675" class="Bound">lm</a><a id="21677" class="Symbol">)</a> <a id="21679" href="plfa.Untyped.html#21679" class="Bound">mn</a> <a id="21682" class="Symbol">=</a> <a id="21684" href="plfa.Untyped.html#21665" class="Bound">L</a> <a id="21686" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="21690" href="plfa.Untyped.html#21671" class="Bound">r</a> <a id="21692" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a> <a id="21694" class="Symbol">(</a><a id="21695" href="plfa.Untyped.html#21544" class="Function">—↠-trans</a> <a id="21704" href="plfa.Untyped.html#21675" class="Bound">lm</a> <a id="21707" href="plfa.Untyped.html#21679" class="Bound">mn</a><a id="21709" class="Symbol">)</a>
</pre>{% endraw %}
The following notation makes it convenient to employ
transitivity of `—↠`.

{% raw %}<pre class="Agda"><a id="21796" class="Keyword">infixr</a> <a id="21803" class="Number">2</a> <a id="21805" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#21814" class="Function Operator">_—↠⟨_⟩_</a>

<a id="_—↠⟨_⟩_"></a><a id="21814" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#21814" class="Function Operator">_—↠⟨_⟩_</a> <a id="21822" class="Symbol">:</a> <a id="21824" class="Symbol">∀</a> <a id="21826" class="Symbol">{</a><a id="21827" href="plfa.Untyped.html#21827" class="Bound">Γ</a> <a id="21829" href="plfa.Untyped.html#21829" class="Bound">A</a><a id="21830" class="Symbol">}</a> <a id="21832" class="Symbol">(</a><a id="21833" href="plfa.Untyped.html#21833" class="Bound">L</a> <a id="21835" class="Symbol">:</a> <a id="21837" href="plfa.Untyped.html#21827" class="Bound">Γ</a> <a id="21839" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="21841" href="plfa.Untyped.html#21829" class="Bound">A</a><a id="21842" class="Symbol">)</a> <a id="21844" class="Symbol">{</a><a id="21845" href="plfa.Untyped.html#21845" class="Bound">M</a> <a id="21847" href="plfa.Untyped.html#21847" class="Bound">N</a> <a id="21849" class="Symbol">:</a> <a id="21851" href="plfa.Untyped.html#21827" class="Bound">Γ</a> <a id="21853" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="21855" href="plfa.Untyped.html#21829" class="Bound">A</a><a id="21856" class="Symbol">}</a>
    <a id="21862" class="Symbol">→</a> <a id="21864" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#21833" class="Bound">L</a> <a id="21866" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="21869" href="plfa.Untyped.html#21845" class="Bound">M</a>
    <a id="21875" class="Symbol">→</a> <a id="21877" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#21845" class="Bound">M</a> <a id="21879" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="21882" href="plfa.Untyped.html#21847" class="Bound">N</a>
      <a id="21890" class="Comment">---------</a>
    <a id="21904" class="Symbol">→</a> <a id="21906" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#21833" class="Bound">L</a> <a id="21908" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="21911" href="plfa.Untyped.html#21847" class="Bound">N</a>
<a id="21913" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#21913" class="Bound">L</a> <a id="21915" href="plfa.Untyped.html#21814" class="Function Operator">—↠⟨</a> <a id="21919" href="plfa.Untyped.html#21919" class="Bound">L—↠M</a> <a id="21924" href="plfa.Untyped.html#21814" class="Function Operator">⟩</a> <a id="21926" href="plfa.Untyped.html#21926" class="Bound">M—↠N</a> <a id="21931" class="Symbol">=</a> <a id="21933" href="plfa.Untyped.html#21544" class="Function">—↠-trans</a> <a id="21942" href="plfa.Untyped.html#21919" class="Bound">L—↠M</a> <a id="21947" href="plfa.Untyped.html#21926" class="Bound">M—↠N</a>
</pre>{% endraw %}
## Multi-step reduction is a congruence

Recall from Chapter [Induction]({{ site.baseurl }}/Induction/) that a
relation `R` is a _congruence_ for a given function `f` if it is
preserved by that function, i.e., if `R x y` then `R (f x) (f y)`.
The term constructors `ƛ_` and `_·_` are functions, and so
the notion of congruence applies to them as well. Furthermore, when a
relation is a congruence for all of the term constructors, we
say that the relation is a congruence for the language in question, in
this case the untyped lambda calculus.

The rules `ξ₁`, `ξ₂`, and `ζ` ensure that the reduction relation is a
congruence for the untyped lambda calculus. The multi-step reduction
relation `—↠` is also a congruence, which we prove in the following
three lemmas.

{% raw %}<pre class="Agda"><a id="appL-cong"></a><a id="22728" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#22728" class="Function">appL-cong</a> <a id="22738" class="Symbol">:</a> <a id="22740" class="Symbol">∀</a> <a id="22742" class="Symbol">{</a><a id="22743" href="plfa.Untyped.html#22743" class="Bound">Γ</a><a id="22744" class="Symbol">}</a> <a id="22746" class="Symbol">{</a><a id="22747" href="plfa.Untyped.html#22747" class="Bound">L</a> <a id="22749" href="plfa.Untyped.html#22749" class="Bound">L&#39;</a> <a id="22752" href="plfa.Untyped.html#22752" class="Bound">M</a> <a id="22754" class="Symbol">:</a> <a id="22756" href="plfa.Untyped.html#22743" class="Bound">Γ</a> <a id="22758" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="22760" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="22761" class="Symbol">}</a>
         <a id="22772" class="Symbol">→</a> <a id="22774" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#22747" class="Bound">L</a> <a id="22776" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="22779" href="plfa.Untyped.html#22749" class="Bound">L&#39;</a>
           <a id="22793" class="Comment">---------------</a>
         <a id="22818" class="Symbol">→</a> <a id="22820" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#22747" class="Bound">L</a> <a id="22822" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="22824" href="plfa.Untyped.html#22752" class="Bound">M</a> <a id="22826" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="22829" href="plfa.Untyped.html#22749" class="Bound">L&#39;</a> <a id="22832" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="22834" href="plfa.Untyped.html#22752" class="Bound">M</a>
<a id="22836" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#22728" class="Function">appL-cong</a> <a id="22846" class="Symbol">{</a><a id="22847" href="plfa.Untyped.html#22847" class="Bound">Γ</a><a id="22848" class="Symbol">}{</a><a id="22850" href="plfa.Untyped.html#22850" class="Bound">L</a><a id="22851" class="Symbol">}{</a><a id="22853" href="plfa.Untyped.html#22853" class="Bound">L&#39;</a><a id="22855" class="Symbol">}{</a><a id="22857" href="plfa.Untyped.html#22857" class="Bound">M</a><a id="22858" class="Symbol">}</a> <a id="22860" class="Symbol">(</a><a id="22861" href="plfa.Untyped.html#22850" class="Bound">L</a> <a id="22863" href="plfa.Untyped.html#11253" class="InductiveConstructor Operator">∎</a><a id="22864" class="Symbol">)</a> <a id="22866" class="Symbol">=</a> <a id="22868" href="plfa.Untyped.html#22850" class="Bound">L</a> <a id="22870" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="22872" href="plfa.Untyped.html#22857" class="Bound">M</a> <a id="22874" href="plfa.Untyped.html#11253" class="InductiveConstructor Operator">∎</a>
<a id="22876" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#22728" class="Function">appL-cong</a> <a id="22886" class="Symbol">{</a><a id="22887" href="plfa.Untyped.html#22887" class="Bound">Γ</a><a id="22888" class="Symbol">}{</a><a id="22890" href="plfa.Untyped.html#22890" class="Bound">L</a><a id="22891" class="Symbol">}{</a><a id="22893" href="plfa.Untyped.html#22893" class="Bound">L&#39;</a><a id="22895" class="Symbol">}{</a><a id="22897" href="plfa.Untyped.html#22897" class="Bound">M</a><a id="22898" class="Symbol">}</a> <a id="22900" class="Symbol">(</a><a id="22901" href="plfa.Untyped.html#22890" class="Bound">L</a> <a id="22903" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="22907" href="plfa.Untyped.html#22907" class="Bound">r</a> <a id="22909" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a> <a id="22911" href="plfa.Untyped.html#22911" class="Bound">rs</a><a id="22913" class="Symbol">)</a> <a id="22915" class="Symbol">=</a> <a id="22917" href="plfa.Untyped.html#22890" class="Bound">L</a> <a id="22919" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="22921" href="plfa.Untyped.html#22897" class="Bound">M</a> <a id="22923" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="22927" href="plfa.Untyped.html#10155" class="InductiveConstructor">ξ₁</a> <a id="22930" href="plfa.Untyped.html#22907" class="Bound">r</a> <a id="22932" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a> <a id="22934" href="plfa.Untyped.html#22728" class="Function">appL-cong</a> <a id="22944" href="plfa.Untyped.html#22911" class="Bound">rs</a>
</pre>{% endraw %}
The proof of `appL-cong` is by induction on the reduction sequence `L —↠ L'`.
* Suppose `L —↠ L` by `L ∎`. Then we have
  `L · M —↠ L · M` by `L · M ∎`.
* Suppose `L —↠ L''` by `L —→⟨ r ⟩ rs`, so
  `L —→ L'` by `r` and `L' —↠ L''` by `rs`.
  We have `L · M —→ L' · M` by `ξ₁ r` and
  `L' · M —↠ L'' · M` by the induction hypothesis applied to `rs`.
  We conclude that ``L · M —↠ L'' · M`` by putting these two
  facts together using `_—→⟨_⟩_`.

The proofs of `appR-cong` and `abs-cong` follow the same pattern as
the proof for `appL-cong`.

{% raw %}<pre class="Agda"><a id="appR-cong"></a><a id="23497" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#23497" class="Function">appR-cong</a> <a id="23507" class="Symbol">:</a> <a id="23509" class="Symbol">∀</a> <a id="23511" class="Symbol">{</a><a id="23512" href="plfa.Untyped.html#23512" class="Bound">Γ</a><a id="23513" class="Symbol">}</a> <a id="23515" class="Symbol">{</a><a id="23516" href="plfa.Untyped.html#23516" class="Bound">L</a> <a id="23518" href="plfa.Untyped.html#23518" class="Bound">M</a> <a id="23520" href="plfa.Untyped.html#23520" class="Bound">M&#39;</a> <a id="23523" class="Symbol">:</a> <a id="23525" href="plfa.Untyped.html#23512" class="Bound">Γ</a> <a id="23527" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="23529" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="23530" class="Symbol">}</a>
         <a id="23541" class="Symbol">→</a> <a id="23543" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#23518" class="Bound">M</a> <a id="23545" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="23548" href="plfa.Untyped.html#23520" class="Bound">M&#39;</a>
           <a id="23562" class="Comment">---------------</a>
         <a id="23587" class="Symbol">→</a> <a id="23589" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#23516" class="Bound">L</a> <a id="23591" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="23593" href="plfa.Untyped.html#23518" class="Bound">M</a> <a id="23595" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="23598" href="plfa.Untyped.html#23516" class="Bound">L</a> <a id="23600" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="23602" href="plfa.Untyped.html#23520" class="Bound">M&#39;</a>
<a id="23605" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#23497" class="Function">appR-cong</a> <a id="23615" class="Symbol">{</a><a id="23616" href="plfa.Untyped.html#23616" class="Bound">Γ</a><a id="23617" class="Symbol">}{</a><a id="23619" href="plfa.Untyped.html#23619" class="Bound">L</a><a id="23620" class="Symbol">}{</a><a id="23622" href="plfa.Untyped.html#23622" class="Bound">M</a><a id="23623" class="Symbol">}{</a><a id="23625" href="plfa.Untyped.html#23625" class="Bound">M&#39;</a><a id="23627" class="Symbol">}</a> <a id="23629" class="Symbol">(</a><a id="23630" href="plfa.Untyped.html#23622" class="Bound">M</a> <a id="23632" href="plfa.Untyped.html#11253" class="InductiveConstructor Operator">∎</a><a id="23633" class="Symbol">)</a> <a id="23635" class="Symbol">=</a> <a id="23637" href="plfa.Untyped.html#23619" class="Bound">L</a> <a id="23639" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="23641" href="plfa.Untyped.html#23622" class="Bound">M</a> <a id="23643" href="plfa.Untyped.html#11253" class="InductiveConstructor Operator">∎</a>
<a id="23645" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#23497" class="Function">appR-cong</a> <a id="23655" class="Symbol">{</a><a id="23656" href="plfa.Untyped.html#23656" class="Bound">Γ</a><a id="23657" class="Symbol">}{</a><a id="23659" href="plfa.Untyped.html#23659" class="Bound">L</a><a id="23660" class="Symbol">}{</a><a id="23662" href="plfa.Untyped.html#23662" class="Bound">M</a><a id="23663" class="Symbol">}{</a><a id="23665" href="plfa.Untyped.html#23665" class="Bound">M&#39;</a><a id="23667" class="Symbol">}</a> <a id="23669" class="Symbol">(</a><a id="23670" href="plfa.Untyped.html#23662" class="Bound">M</a> <a id="23672" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="23676" href="plfa.Untyped.html#23676" class="Bound">r</a> <a id="23678" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a> <a id="23680" href="plfa.Untyped.html#23680" class="Bound">rs</a><a id="23682" class="Symbol">)</a> <a id="23684" class="Symbol">=</a> <a id="23686" href="plfa.Untyped.html#23659" class="Bound">L</a> <a id="23688" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="23690" href="plfa.Untyped.html#23662" class="Bound">M</a> <a id="23692" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="23696" href="plfa.Untyped.html#10245" class="InductiveConstructor">ξ₂</a> <a id="23699" href="plfa.Untyped.html#23676" class="Bound">r</a> <a id="23701" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a> <a id="23703" href="plfa.Untyped.html#23497" class="Function">appR-cong</a> <a id="23713" href="plfa.Untyped.html#23680" class="Bound">rs</a>
</pre>{% endraw %}
{% raw %}<pre class="Agda"><a id="abs-cong"></a><a id="23725" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#23725" class="Function">abs-cong</a> <a id="23734" class="Symbol">:</a> <a id="23736" class="Symbol">∀</a> <a id="23738" class="Symbol">{</a><a id="23739" href="plfa.Untyped.html#23739" class="Bound">Γ</a><a id="23740" class="Symbol">}</a> <a id="23742" class="Symbol">{</a><a id="23743" href="plfa.Untyped.html#23743" class="Bound">N</a> <a id="23745" href="plfa.Untyped.html#23745" class="Bound">N&#39;</a> <a id="23748" class="Symbol">:</a> <a id="23750" href="plfa.Untyped.html#23739" class="Bound">Γ</a> <a id="23752" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="23754" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="23756" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="23758" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="23759" class="Symbol">}</a>
         <a id="23770" class="Symbol">→</a> <a id="23772" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#23743" class="Bound">N</a> <a id="23774" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="23777" href="plfa.Untyped.html#23745" class="Bound">N&#39;</a>
           <a id="23791" class="Comment">----------</a>
         <a id="23811" class="Symbol">→</a> <a id="23813" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4340" class="InductiveConstructor Operator">ƛ</a> <a id="23815" href="plfa.Untyped.html#23743" class="Bound">N</a> <a id="23817" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="23820" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="23822" href="plfa.Untyped.html#23745" class="Bound">N&#39;</a>
<a id="23825" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#23725" class="Function">abs-cong</a> <a id="23834" class="Symbol">(</a><a id="23835" href="plfa.Untyped.html#23835" class="Bound">M</a> <a id="23837" href="plfa.Untyped.html#11253" class="InductiveConstructor Operator">∎</a><a id="23838" class="Symbol">)</a> <a id="23840" class="Symbol">=</a> <a id="23842" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="23844" href="plfa.Untyped.html#23835" class="Bound">M</a> <a id="23846" href="plfa.Untyped.html#11253" class="InductiveConstructor Operator">∎</a>
<a id="23848" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#23725" class="Function">abs-cong</a> <a id="23857" class="Symbol">(</a><a id="23858" href="plfa.Untyped.html#23858" class="Bound">L</a> <a id="23860" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="23864" href="plfa.Untyped.html#23864" class="Bound">r</a> <a id="23866" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a> <a id="23868" href="plfa.Untyped.html#23868" class="Bound">rs</a><a id="23870" class="Symbol">)</a> <a id="23872" class="Symbol">=</a> <a id="23874" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="23876" href="plfa.Untyped.html#23858" class="Bound">L</a> <a id="23878" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="23882" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="23884" href="plfa.Untyped.html#23864" class="Bound">r</a> <a id="23886" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a> <a id="23888" href="plfa.Untyped.html#23725" class="Function">abs-cong</a> <a id="23897" href="plfa.Untyped.html#23868" class="Bound">rs</a>
</pre>{% endraw %}
## Unicode

This chapter uses the following unicode:

    ★  U+2605  BLACK STAR (\st)

The `\st` command permits navigation among many different stars;
the one we use is number 7.
