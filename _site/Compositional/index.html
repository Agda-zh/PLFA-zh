<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Compositional: The denotational semantics is compositional | 编程语言基础：Agda 语言描述
</title><!-- Begin Jekyll SEO tag v2.5.0 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Compositional: The denotational semantics is compositional" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="编程语言基础：Agda 语言描述" />
<meta property="og:description" content="编程语言基础：Agda 语言描述" />
<link rel="canonical" href="https://agda-zh.github.io/PLFA-zh/Compositional/" />
<meta property="og:url" content="https://agda-zh.github.io/PLFA-zh/Compositional/" />
<meta property="og:site_name" content="编程语言基础：Agda 语言描述" />
<script type="application/ld+json">
{"description":"编程语言基础：Agda 语言描述","@type":"WebPage","url":"https://agda-zh.github.io/PLFA-zh/Compositional/","headline":"Compositional: The denotational semantics is compositional","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/PLFA-zh/assets/main.css"></head>
<body><header class="site-header" role="banner">

    <div class="wrapper">

        <a class="site-title" href="/PLFA-zh/">编程语言基础：Agda 语言描述
</a>

        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="/PLFA-zh/">主页</a>
                <a class="page-link" href="/PLFA-zh/Announcements/">公告</a>
                <a class="page-link" href="/PLFA-zh/GettingStarted/">使用说明</a>
                <a class="page-link" href="/PLFA-zh/Citing/">引用</a>
                <a class="page-link" href="https://plfa.github.io/">English</a>
            </div>
        </nav>

    </div>

</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
      <h1 class="post-title">Compositional: The denotational semantics is compositional</h1>
  </header>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/PLFA-zh/Denotational/">上一章</a>
    
    
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/Agda-zh/PLFA-zh/blob/dev/src/plfa/Compositional.lagda.md">源代码</a>
    
    
    &bullet;
    
    
    <a alt="Next chapter" href="/PLFA-zh/Soundness/">下一章</a>
    
</p>


  <div class="post-content">
    <pre class="Agda"><a id="183" class="Keyword">module</a> <a id="190" href="/PLFA-zh/Compositional/" class="Module">plfa.Compositional</a> <a id="209" class="Keyword">where</a>
</pre>
<h2 id="introduction">Introduction</h2>

<p>In this chapter we prove that the denotational semantics is compositional,
which means we fill in the ellipses in the following equations.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ℰ (` x) ≃ ...
ℰ (ƛ M) ≃ ... ℰ M ...
ℰ (M · N) ≃ ... ℰ M ... ℰ N ...
</code></pre></div></div>

<p>Such equations would imply that the denotational semantics could be
instead defined as a recursive function. Indeed, we end this chapter
with such a definition and prove that it is equivalent to ℰ.</p>

<h2 id="imports">Imports</h2>

<pre class="Agda"><a id="674" class="Keyword">open</a> <a id="679" class="Keyword">import</a> <a id="686" href="/PLFA-zh/Untyped/" class="Module">plfa.Untyped</a>
  <a id="701" class="Keyword">using</a> <a id="707" class="Symbol">(</a><a id="708" href="/PLFA-zh/Untyped/#3130" class="Datatype">Context</a><a id="715" class="Symbol">;</a> <a id="717" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">_,_</a><a id="720" class="Symbol">;</a> <a id="722" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="723" class="Symbol">;</a> <a id="725" href="plfa.Untyped.html#3483" class="Datatype Operator">_∋_</a><a id="728" class="Symbol">;</a> <a id="730" href="plfa.Untyped.html#4252" class="Datatype Operator">_⊢_</a><a id="733" class="Symbol">;</a> <a id="735" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`_</a><a id="737" class="Symbol">;</a> <a id="739" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ_</a><a id="741" class="Symbol">;</a> <a id="743" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">_·_</a><a id="746" class="Symbol">)</a>
<a id="748" class="Keyword">open</a> <a id="753" class="Keyword">import</a> <a id="760" href="/PLFA-zh/Denotational/" class="Module">plfa.Denotational</a>
  <a id="780" class="Keyword">using</a> <a id="786" class="Symbol">(</a><a id="787" href="/PLFA-zh/Denotational/#3962" class="Datatype">Value</a><a id="792" class="Symbol">;</a> <a id="794" href="plfa.Denotational.html#3994" class="InductiveConstructor Operator">_↦_</a><a id="797" class="Symbol">;</a> <a id="799" href="plfa.Denotational.html#7257" class="Function Operator">_`,_</a><a id="803" class="Symbol">;</a> <a id="805" href="plfa.Denotational.html#4024" class="InductiveConstructor Operator">_⊔_</a><a id="808" class="Symbol">;</a> <a id="810" href="plfa.Denotational.html#3982" class="InductiveConstructor">⊥</a><a id="811" class="Symbol">;</a> <a id="813" href="plfa.Denotational.html#4317" class="Datatype Operator">_⊑_</a><a id="816" class="Symbol">;</a> <a id="818" href="plfa.Denotational.html#9274" class="Datatype Operator">_⊢_↓_</a><a id="823" class="Symbol">;</a>
         <a id="834" href="/PLFA-zh/Denotational/#4352" class="InductiveConstructor">Bot⊑</a><a id="838" class="Symbol">;</a> <a id="840" href="plfa.Denotational.html#4688" class="InductiveConstructor">Fun⊑</a><a id="844" class="Symbol">;</a> <a id="846" href="plfa.Denotational.html#4376" class="InductiveConstructor">ConjL⊑</a><a id="852" class="Symbol">;</a> <a id="854" href="plfa.Denotational.html#4466" class="InductiveConstructor">ConjR1⊑</a><a id="861" class="Symbol">;</a> <a id="863" href="plfa.Denotational.html#4540" class="InductiveConstructor">ConjR2⊑</a><a id="870" class="Symbol">;</a> <a id="872" href="plfa.Denotational.html#4802" class="InductiveConstructor">Dist⊑</a><a id="877" class="Symbol">;</a> <a id="879" href="plfa.Denotational.html#5471" class="Function">Refl⊑</a><a id="884" class="Symbol">;</a> <a id="886" href="plfa.Denotational.html#4614" class="InductiveConstructor">Trans⊑</a><a id="892" class="Symbol">;</a> <a id="894" href="plfa.Denotational.html#6094" class="Function">Dist⊔↦⊔</a><a id="901" class="Symbol">;</a>
         <a id="912" href="/PLFA-zh/Denotational/#9328" class="InductiveConstructor">var</a><a id="915" class="Symbol">;</a> <a id="917" href="plfa.Denotational.html#9545" class="InductiveConstructor">↦-intro</a><a id="924" class="Symbol">;</a> <a id="926" href="plfa.Denotational.html#9407" class="InductiveConstructor">↦-elim</a><a id="932" class="Symbol">;</a> <a id="934" href="plfa.Denotational.html#9744" class="InductiveConstructor">⊔-intro</a><a id="941" class="Symbol">;</a> <a id="943" href="plfa.Denotational.html#9669" class="InductiveConstructor">⊥-intro</a><a id="950" class="Symbol">;</a> <a id="952" href="plfa.Denotational.html#9875" class="InductiveConstructor">sub</a><a id="955" class="Symbol">;</a>
         <a id="966" href="/PLFA-zh/Denotational/#25648" class="Function">up-env</a><a id="972" class="Symbol">;</a> <a id="974" href="plfa.Denotational.html#17427" class="Function">ℰ</a><a id="975" class="Symbol">;</a> <a id="977" href="plfa.Denotational.html#17609" class="Function Operator">_≃_</a><a id="980" class="Symbol">;</a> <a id="982" href="plfa.Denotational.html#17881" class="Function">≃-sym</a><a id="987" class="Symbol">;</a> <a id="989" href="plfa.Denotational.html#17214" class="Function">Denotation</a><a id="999" class="Symbol">;</a> <a id="1001" href="plfa.Denotational.html#7100" class="Function">Env</a><a id="1004" class="Symbol">)</a>
<a id="1006" class="Keyword">open</a> <a id="1011" href="/PLFA-zh/Denotational/#18453" class="Module">plfa.Denotational.≃-Reasoning</a>

<a id="1042" class="Keyword">open</a> <a id="1047" class="Keyword">import</a> <a id="1054" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html" class="Module">Data.Product</a> <a id="1067" class="Keyword">using</a> <a id="1073" class="Symbol">(</a><a id="1074" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">_×_</a><a id="1077" class="Symbol">;</a> <a id="1079" href="Agda.Builtin.Sigma.html#139" class="Record">Σ</a><a id="1080" class="Symbol">;</a> <a id="1082" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ-syntax</a><a id="1090" class="Symbol">;</a> <a id="1092" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1364" class="Function">∃</a><a id="1093" class="Symbol">;</a> <a id="1095" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1783" class="Function">∃-syntax</a><a id="1103" class="Symbol">;</a> <a id="1105" href="Agda.Builtin.Sigma.html#225" class="Field">proj₁</a><a id="1110" class="Symbol">;</a> <a id="1112" href="Agda.Builtin.Sigma.html#237" class="Field">proj₂</a><a id="1117" class="Symbol">)</a>
  <a id="1121" class="Keyword">renaming</a> <a id="1130" class="Symbol">(</a><a id="1131" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">_,_</a> <a id="1135" class="Symbol">to</a> <a id="1138" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="1143" class="Symbol">)</a>
<a id="1145" class="Keyword">open</a> <a id="1150" class="Keyword">import</a> <a id="1157" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.html" class="Module">Data.Sum</a> <a id="1166" class="Keyword">using</a> <a id="1172" class="Symbol">(</a><a id="1173" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#612" class="Datatype Operator">_⊎_</a><a id="1176" class="Symbol">;</a> <a id="1178" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#662" class="InductiveConstructor">inj₁</a><a id="1182" class="Symbol">;</a> <a id="1184" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#687" class="InductiveConstructor">inj₂</a><a id="1188" class="Symbol">)</a>
<a id="1190" class="Keyword">open</a> <a id="1195" class="Keyword">import</a> <a id="1202" href="https://agda.github.io/agda-stdlib/v1.1/Data.Unit.html" class="Module">Data.Unit</a> <a id="1212" class="Keyword">using</a> <a id="1218" class="Symbol">(</a><a id="1219" href="Agda.Builtin.Unit.html#137" class="Record">⊤</a><a id="1220" class="Symbol">;</a> <a id="1222" href="Agda.Builtin.Unit.html#174" class="InductiveConstructor">tt</a><a id="1224" class="Symbol">)</a>
</pre>
<h2 id="equation-for-lambda-abstraction">Equation for lambda abstraction</h2>

<p>Regarding the first equation</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ℰ (ƛ M) ≃ ... ℰ M ...
</code></pre></div></div>

<p>we need to define a function that maps a <code class="highlighter-rouge">Denotation (Γ , ★)</code> to a
<code class="highlighter-rouge">Denotation Γ</code>. This function, let us name it <code class="highlighter-rouge">ℱ</code>, should mimic the
non-recursive part of the semantics when applied to a lambda term.  In
particular, we need to consider the rules <code class="highlighter-rouge">↦-intro</code>, <code class="highlighter-rouge">⊥-intro</code>, and
<code class="highlighter-rouge">⊔-intro</code>. So <code class="highlighter-rouge">ℱ</code> has three parameters, the denotation <code class="highlighter-rouge">D</code> of the
subterm <code class="highlighter-rouge">M</code>, an environment <code class="highlighter-rouge">γ</code>, and a value <code class="highlighter-rouge">v</code>.  If we define <code class="highlighter-rouge">ℱ</code> by
recursion on the value <code class="highlighter-rouge">v</code>, then it matches up nicely with the three
rules <code class="highlighter-rouge">↦-intro</code>, <code class="highlighter-rouge">⊥-intro</code>, and <code class="highlighter-rouge">⊔-intro</code>.</p>

<pre class="Agda"><a id="ℱ"></a><a id="1852" href="/PLFA-zh/Compositional/#1852" class="Function">ℱ</a> <a id="1854" class="Symbol">:</a> <a id="1856" class="Symbol">∀{</a><a id="1858" href="plfa.Compositional.html#1858" class="Bound">Γ</a><a id="1859" class="Symbol">}</a> <a id="1861" class="Symbol">→</a> <a id="1863" href="/PLFA-zh/Denotational/#17214" class="Function">Denotation</a> <a id="1874" class="Symbol">(</a><a id="1875" href="plfa.Compositional.html#1858" class="Bound">Γ</a> <a id="1877" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="1879" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="1880" class="Symbol">)</a> <a id="1882" class="Symbol">→</a> <a id="1884" href="plfa.Denotational.html#17214" class="Function">Denotation</a> <a id="1895" href="plfa.Compositional.html#1858" class="Bound">Γ</a>
<a id="1897" href="/PLFA-zh/Compositional/#1852" class="Function">ℱ</a> <a id="1899" href="plfa.Compositional.html#1899" class="Bound">D</a> <a id="1901" href="plfa.Compositional.html#1901" class="Bound">γ</a> <a id="1903" class="Symbol">(</a><a id="1904" href="plfa.Compositional.html#1904" class="Bound">v</a> <a id="1906" href="/PLFA-zh/Denotational/#3994" class="InductiveConstructor Operator">↦</a> <a id="1908" href="plfa.Compositional.html#1908" class="Bound">w</a><a id="1909" class="Symbol">)</a> <a id="1911" class="Symbol">=</a> <a id="1913" href="plfa.Compositional.html#1899" class="Bound">D</a> <a id="1915" class="Symbol">(</a><a id="1916" href="plfa.Compositional.html#1901" class="Bound">γ</a> <a id="1918" href="plfa.Denotational.html#7257" class="Function Operator">`,</a> <a id="1921" href="plfa.Compositional.html#1904" class="Bound">v</a><a id="1922" class="Symbol">)</a> <a id="1924" href="plfa.Compositional.html#1908" class="Bound">w</a>
<a id="1926" href="/PLFA-zh/Compositional/#1852" class="Function">ℱ</a> <a id="1928" href="plfa.Compositional.html#1928" class="Bound">D</a> <a id="1930" href="plfa.Compositional.html#1930" class="Bound">γ</a> <a id="1932" href="/PLFA-zh/Denotational/#3982" class="InductiveConstructor">⊥</a> <a id="1934" class="Symbol">=</a> <a id="1936" href="Agda.Builtin.Unit.html#137" class="Record">⊤</a>
<a id="1938" href="/PLFA-zh/Compositional/#1852" class="Function">ℱ</a> <a id="1940" href="plfa.Compositional.html#1940" class="Bound">D</a> <a id="1942" href="plfa.Compositional.html#1942" class="Bound">γ</a> <a id="1944" class="Symbol">(</a><a id="1945" href="plfa.Compositional.html#1945" class="Bound">u</a> <a id="1947" href="/PLFA-zh/Denotational/#4024" class="InductiveConstructor Operator">⊔</a> <a id="1949" href="plfa.Compositional.html#1949" class="Bound">v</a><a id="1950" class="Symbol">)</a> <a id="1952" class="Symbol">=</a> <a id="1954" class="Symbol">(</a><a id="1955" href="plfa.Compositional.html#1852" class="Function">ℱ</a> <a id="1957" href="plfa.Compositional.html#1940" class="Bound">D</a> <a id="1959" href="plfa.Compositional.html#1942" class="Bound">γ</a> <a id="1961" href="plfa.Compositional.html#1945" class="Bound">u</a><a id="1962" class="Symbol">)</a> <a id="1964" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a> <a id="1966" class="Symbol">(</a><a id="1967" href="plfa.Compositional.html#1852" class="Function">ℱ</a> <a id="1969" href="plfa.Compositional.html#1940" class="Bound">D</a> <a id="1971" href="plfa.Compositional.html#1942" class="Bound">γ</a> <a id="1973" href="plfa.Compositional.html#1949" class="Bound">v</a><a id="1974" class="Symbol">)</a>
</pre>
<p>[JGS: add comment about how ℱ can be viewed as curry.]</p>

<p>Using this <code class="highlighter-rouge">ℱ</code>, we hope to prove that</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ℰ (ƛ N) ≃ ℱ (ℰ N)
</code></pre></div></div>

<p>The function <code class="highlighter-rouge">ℱ</code> is preserved when going from a larger value <code class="highlighter-rouge">v</code> to a
smaller value <code class="highlighter-rouge">u</code>. The proof is a straightforward induction on the
derivation of <code class="highlighter-rouge">u ⊑ v</code>, using the <code class="highlighter-rouge">up-env</code> lemma in the case for the
<code class="highlighter-rouge">Fun⊑</code> rule.</p>

<pre class="Agda"><a id="sub-ℱ"></a><a id="2323" href="/PLFA-zh/Compositional/#2323" class="Function">sub-ℱ</a> <a id="2329" class="Symbol">:</a> <a id="2331" class="Symbol">∀{</a><a id="2333" href="plfa.Compositional.html#2333" class="Bound">Γ</a><a id="2334" class="Symbol">}{</a><a id="2336" href="plfa.Compositional.html#2336" class="Bound">N</a> <a id="2338" class="Symbol">:</a> <a id="2340" href="plfa.Compositional.html#2333" class="Bound">Γ</a> <a id="2342" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="2344" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="2346" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="2348" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="2349" class="Symbol">}{</a><a id="2351" href="plfa.Compositional.html#2351" class="Bound">γ</a> <a id="2353" href="plfa.Compositional.html#2353" class="Bound">v</a> <a id="2355" href="plfa.Compositional.html#2355" class="Bound">u</a><a id="2356" class="Symbol">}</a>
      <a id="2364" class="Symbol">→</a> <a id="2366" href="/PLFA-zh/Compositional/#1852" class="Function">ℱ</a> <a id="2368" class="Symbol">(</a><a id="2369" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="2371" href="plfa.Compositional.html#2336" class="Bound">N</a><a id="2372" class="Symbol">)</a> <a id="2374" href="plfa.Compositional.html#2351" class="Bound">γ</a> <a id="2376" href="plfa.Compositional.html#2353" class="Bound">v</a>
      <a id="2384" class="Symbol">→</a> <a id="2386" href="/PLFA-zh/Compositional/#2355" class="Bound">u</a> <a id="2388" href="/PLFA-zh/Denotational/#4317" class="Datatype Operator">⊑</a> <a id="2390" href="plfa.Compositional.html#2353" class="Bound">v</a>
        <a id="2400" class="Comment">------------</a>
      <a id="2419" class="Symbol">→</a> <a id="2421" href="/PLFA-zh/Compositional/#1852" class="Function">ℱ</a> <a id="2423" class="Symbol">(</a><a id="2424" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="2426" href="plfa.Compositional.html#2336" class="Bound">N</a><a id="2427" class="Symbol">)</a> <a id="2429" href="plfa.Compositional.html#2351" class="Bound">γ</a> <a id="2431" href="plfa.Compositional.html#2355" class="Bound">u</a>
<a id="2433" href="/PLFA-zh/Compositional/#2323" class="Function">sub-ℱ</a> <a id="2439" href="plfa.Compositional.html#2439" class="Bound">d</a> <a id="2441" href="/PLFA-zh/Denotational/#4352" class="InductiveConstructor">Bot⊑</a> <a id="2446" class="Symbol">=</a> <a id="2448" href="Agda.Builtin.Unit.html#174" class="InductiveConstructor">tt</a>
<a id="2451" href="/PLFA-zh/Compositional/#2323" class="Function">sub-ℱ</a> <a id="2457" href="plfa.Compositional.html#2457" class="Bound">d</a> <a id="2459" class="Symbol">(</a><a id="2460" href="/PLFA-zh/Denotational/#4688" class="InductiveConstructor">Fun⊑</a> <a id="2465" href="plfa.Compositional.html#2465" class="Bound">lt</a> <a id="2468" href="plfa.Compositional.html#2468" class="Bound">lt′</a><a id="2471" class="Symbol">)</a> <a id="2473" class="Symbol">=</a> <a id="2475" href="plfa.Denotational.html#9875" class="InductiveConstructor">sub</a> <a id="2479" class="Symbol">(</a><a id="2480" href="plfa.Denotational.html#25648" class="Function">up-env</a> <a id="2487" href="plfa.Compositional.html#2457" class="Bound">d</a> <a id="2489" href="plfa.Compositional.html#2465" class="Bound">lt</a><a id="2491" class="Symbol">)</a> <a id="2493" href="plfa.Compositional.html#2468" class="Bound">lt′</a>
<a id="2497" href="/PLFA-zh/Compositional/#2323" class="Function">sub-ℱ</a> <a id="2503" href="plfa.Compositional.html#2503" class="Bound">d</a> <a id="2505" class="Symbol">(</a><a id="2506" href="/PLFA-zh/Denotational/#4376" class="InductiveConstructor">ConjL⊑</a> <a id="2513" href="plfa.Compositional.html#2513" class="Bound">lt</a> <a id="2516" href="plfa.Compositional.html#2516" class="Bound">lt₁</a><a id="2519" class="Symbol">)</a> <a id="2521" class="Symbol">=</a> <a id="2523" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="2525" href="plfa.Compositional.html#2323" class="Function">sub-ℱ</a> <a id="2531" href="plfa.Compositional.html#2503" class="Bound">d</a> <a id="2533" href="plfa.Compositional.html#2513" class="Bound">lt</a> <a id="2536" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="2538" href="plfa.Compositional.html#2323" class="Function">sub-ℱ</a> <a id="2544" href="plfa.Compositional.html#2503" class="Bound">d</a> <a id="2546" href="plfa.Compositional.html#2516" class="Bound">lt₁</a> <a id="2550" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="2552" href="/PLFA-zh/Compositional/#2323" class="Function">sub-ℱ</a> <a id="2558" href="plfa.Compositional.html#2558" class="Bound">d</a> <a id="2560" class="Symbol">(</a><a id="2561" href="/PLFA-zh/Denotational/#4466" class="InductiveConstructor">ConjR1⊑</a> <a id="2569" href="plfa.Compositional.html#2569" class="Bound">lt</a><a id="2571" class="Symbol">)</a> <a id="2573" class="Symbol">=</a> <a id="2575" href="plfa.Compositional.html#2323" class="Function">sub-ℱ</a> <a id="2581" class="Symbol">(</a><a id="2582" href="Agda.Builtin.Sigma.html#225" class="Field">proj₁</a> <a id="2588" href="plfa.Compositional.html#2558" class="Bound">d</a><a id="2589" class="Symbol">)</a> <a id="2591" href="plfa.Compositional.html#2569" class="Bound">lt</a>
<a id="2594" href="/PLFA-zh/Compositional/#2323" class="Function">sub-ℱ</a> <a id="2600" href="plfa.Compositional.html#2600" class="Bound">d</a> <a id="2602" class="Symbol">(</a><a id="2603" href="/PLFA-zh/Denotational/#4540" class="InductiveConstructor">ConjR2⊑</a> <a id="2611" href="plfa.Compositional.html#2611" class="Bound">lt</a><a id="2613" class="Symbol">)</a> <a id="2615" class="Symbol">=</a> <a id="2617" href="plfa.Compositional.html#2323" class="Function">sub-ℱ</a> <a id="2623" class="Symbol">(</a><a id="2624" href="Agda.Builtin.Sigma.html#237" class="Field">proj₂</a> <a id="2630" href="plfa.Compositional.html#2600" class="Bound">d</a><a id="2631" class="Symbol">)</a> <a id="2633" href="plfa.Compositional.html#2611" class="Bound">lt</a>
<a id="2636" href="/PLFA-zh/Compositional/#2323" class="Function">sub-ℱ</a> <a id="2642" class="Symbol">{</a><a id="2643" class="Argument">v</a> <a id="2645" class="Symbol">=</a> <a id="2647" href="plfa.Compositional.html#2647" class="Bound">v₁</a> <a id="2650" href="/PLFA-zh/Denotational/#3994" class="InductiveConstructor Operator">↦</a> <a id="2652" href="plfa.Compositional.html#2652" class="Bound">v₂</a> <a id="2655" href="plfa.Denotational.html#4024" class="InductiveConstructor Operator">⊔</a> <a id="2657" href="plfa.Compositional.html#2647" class="Bound">v₁</a> <a id="2660" href="plfa.Denotational.html#3994" class="InductiveConstructor Operator">↦</a> <a id="2662" href="plfa.Compositional.html#2662" class="Bound">v₃</a><a id="2664" class="Symbol">}</a> <a id="2666" class="Symbol">{</a><a id="2667" href="plfa.Compositional.html#2647" class="Bound">v₁</a> <a id="2670" href="plfa.Denotational.html#3994" class="InductiveConstructor Operator">↦</a> <a id="2672" class="Symbol">(</a><a id="2673" href="plfa.Compositional.html#2652" class="Bound">v₂</a> <a id="2676" href="plfa.Denotational.html#4024" class="InductiveConstructor Operator">⊔</a> <a id="2678" href="plfa.Compositional.html#2662" class="Bound">v₃</a><a id="2680" class="Symbol">)}</a> <a id="2683" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="2685" href="plfa.Compositional.html#2685" class="Bound">N2</a> <a id="2688" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="2690" href="plfa.Compositional.html#2690" class="Bound">N3</a> <a id="2693" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="2695" href="plfa.Denotational.html#4802" class="InductiveConstructor">Dist⊑</a> <a id="2701" class="Symbol">=</a>
   <a id="2706" href="/PLFA-zh/Denotational/#9744" class="InductiveConstructor">⊔-intro</a> <a id="2714" href="/PLFA-zh/Compositional/#2685" class="Bound">N2</a> <a id="2717" href="plfa.Compositional.html#2690" class="Bound">N3</a>
<a id="2720" href="/PLFA-zh/Compositional/#2323" class="Function">sub-ℱ</a> <a id="2726" href="plfa.Compositional.html#2726" class="Bound">d</a> <a id="2728" class="Symbol">(</a><a id="2729" href="/PLFA-zh/Denotational/#4614" class="InductiveConstructor">Trans⊑</a> <a id="2736" href="plfa.Compositional.html#2736" class="Bound">x₁</a> <a id="2739" href="plfa.Compositional.html#2739" class="Bound">x₂</a><a id="2741" class="Symbol">)</a> <a id="2743" class="Symbol">=</a> <a id="2745" href="plfa.Compositional.html#2323" class="Function">sub-ℱ</a> <a id="2751" class="Symbol">(</a><a id="2752" href="plfa.Compositional.html#2323" class="Function">sub-ℱ</a> <a id="2758" href="plfa.Compositional.html#2726" class="Bound">d</a> <a id="2760" href="plfa.Compositional.html#2739" class="Bound">x₂</a><a id="2762" class="Symbol">)</a> <a id="2764" href="plfa.Compositional.html#2736" class="Bound">x₁</a>
</pre>
<p>[PLW:
  If denotations were strengthened to be downward closed,
  we could rewrite the signature replacing (ℰ N) by d : Denotation (Γ , ★)]
[JGS: I’ll look into this.]</p>

<p>With this subsumption property in hand, we can prove the forward
direction of the semantic equation for lambda.  The proof is by
induction on the semantics, using <code class="highlighter-rouge">sub-ℱ</code> in the case for the <code class="highlighter-rouge">sub</code>
rule.</p>

<pre class="Agda"><a id="ℰƛ→ℱℰ"></a><a id="3149" href="/PLFA-zh/Compositional/#3149" class="Function">ℰƛ→ℱℰ</a> <a id="3155" class="Symbol">:</a> <a id="3157" class="Symbol">∀{</a><a id="3159" href="plfa.Compositional.html#3159" class="Bound">Γ</a><a id="3160" class="Symbol">}{</a><a id="3162" href="plfa.Compositional.html#3162" class="Bound">γ</a> <a id="3164" class="Symbol">:</a> <a id="3166" href="/PLFA-zh/Denotational/#7100" class="Function">Env</a> <a id="3170" href="plfa.Compositional.html#3159" class="Bound">Γ</a><a id="3171" class="Symbol">}{</a><a id="3173" href="plfa.Compositional.html#3173" class="Bound">N</a> <a id="3175" class="Symbol">:</a> <a id="3177" href="plfa.Compositional.html#3159" class="Bound">Γ</a> <a id="3179" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="3181" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="3183" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="3185" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="3186" class="Symbol">}{</a><a id="3188" href="plfa.Compositional.html#3188" class="Bound">v</a> <a id="3190" class="Symbol">:</a> <a id="3192" href="plfa.Denotational.html#3962" class="Datatype">Value</a><a id="3197" class="Symbol">}</a>
        <a id="3207" class="Symbol">→</a> <a id="3209" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="3211" class="Symbol">(</a><a id="3212" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="3214" href="/PLFA-zh/Compositional/#3173" class="Bound">N</a><a id="3215" class="Symbol">)</a> <a id="3217" href="plfa.Compositional.html#3162" class="Bound">γ</a> <a id="3219" href="plfa.Compositional.html#3188" class="Bound">v</a>
          <a id="3231" class="Comment">------------</a>
        <a id="3252" class="Symbol">→</a> <a id="3254" href="/PLFA-zh/Compositional/#1852" class="Function">ℱ</a> <a id="3256" class="Symbol">(</a><a id="3257" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="3259" href="plfa.Compositional.html#3173" class="Bound">N</a><a id="3260" class="Symbol">)</a> <a id="3262" href="plfa.Compositional.html#3162" class="Bound">γ</a> <a id="3264" href="plfa.Compositional.html#3188" class="Bound">v</a>
<a id="3266" href="/PLFA-zh/Compositional/#3149" class="Function">ℰƛ→ℱℰ</a> <a id="3272" class="Symbol">(</a><a id="3273" href="/PLFA-zh/Denotational/#9545" class="InductiveConstructor">↦-intro</a> <a id="3281" href="plfa.Compositional.html#3281" class="Bound">d</a><a id="3282" class="Symbol">)</a> <a id="3284" class="Symbol">=</a> <a id="3286" href="plfa.Compositional.html#3281" class="Bound">d</a>
<a id="3288" href="/PLFA-zh/Compositional/#3149" class="Function">ℰƛ→ℱℰ</a> <a id="3294" href="/PLFA-zh/Denotational/#9669" class="InductiveConstructor">⊥-intro</a> <a id="3302" class="Symbol">=</a> <a id="3304" href="Agda.Builtin.Unit.html#174" class="InductiveConstructor">tt</a>
<a id="3307" href="/PLFA-zh/Compositional/#3149" class="Function">ℰƛ→ℱℰ</a> <a id="3313" class="Symbol">(</a><a id="3314" href="/PLFA-zh/Denotational/#9744" class="InductiveConstructor">⊔-intro</a> <a id="3322" href="plfa.Compositional.html#3322" class="Bound">d₁</a> <a id="3325" href="plfa.Compositional.html#3325" class="Bound">d₂</a><a id="3327" class="Symbol">)</a> <a id="3329" class="Symbol">=</a> <a id="3331" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="3333" href="plfa.Compositional.html#3149" class="Function">ℰƛ→ℱℰ</a> <a id="3339" href="plfa.Compositional.html#3322" class="Bound">d₁</a> <a id="3342" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="3344" href="plfa.Compositional.html#3149" class="Function">ℰƛ→ℱℰ</a> <a id="3350" href="plfa.Compositional.html#3325" class="Bound">d₂</a> <a id="3353" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="3355" href="/PLFA-zh/Compositional/#3149" class="Function">ℰƛ→ℱℰ</a> <a id="3361" class="Symbol">(</a><a id="3362" href="/PLFA-zh/Denotational/#9875" class="InductiveConstructor">sub</a> <a id="3366" href="plfa.Compositional.html#3366" class="Bound">d</a> <a id="3368" href="plfa.Compositional.html#3368" class="Bound">lt</a><a id="3370" class="Symbol">)</a> <a id="3372" class="Symbol">=</a> <a id="3374" href="plfa.Compositional.html#2323" class="Function">sub-ℱ</a> <a id="3380" class="Symbol">(</a><a id="3381" href="plfa.Compositional.html#3149" class="Function">ℰƛ→ℱℰ</a> <a id="3387" href="plfa.Compositional.html#3366" class="Bound">d</a><a id="3388" class="Symbol">)</a> <a id="3390" href="plfa.Compositional.html#3368" class="Bound">lt</a>
</pre>
<p>The “inversion lemma” for lambda abstraction is a special case of the
above. The inversion lemma is useful in proving that denotations are
preserved by reduction.</p>

<pre class="Agda"><a id="lambda-inversion"></a><a id="3566" href="/PLFA-zh/Compositional/#3566" class="Function">lambda-inversion</a> <a id="3583" class="Symbol">:</a> <a id="3585" class="Symbol">∀{</a><a id="3587" href="plfa.Compositional.html#3587" class="Bound">Γ</a><a id="3588" class="Symbol">}{</a><a id="3590" href="plfa.Compositional.html#3590" class="Bound">γ</a> <a id="3592" class="Symbol">:</a> <a id="3594" href="/PLFA-zh/Denotational/#7100" class="Function">Env</a> <a id="3598" href="plfa.Compositional.html#3587" class="Bound">Γ</a><a id="3599" class="Symbol">}{</a><a id="3601" href="plfa.Compositional.html#3601" class="Bound">N</a> <a id="3603" class="Symbol">:</a> <a id="3605" href="plfa.Compositional.html#3587" class="Bound">Γ</a> <a id="3607" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="3609" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="3611" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="3613" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="3614" class="Symbol">}{</a><a id="3616" href="plfa.Compositional.html#3616" class="Bound">v₁</a> <a id="3619" href="plfa.Compositional.html#3619" class="Bound">v₂</a> <a id="3622" class="Symbol">:</a> <a id="3624" href="plfa.Denotational.html#3962" class="Datatype">Value</a><a id="3629" class="Symbol">}</a>
  <a id="3633" class="Symbol">→</a> <a id="3635" href="/PLFA-zh/Compositional/#3590" class="Bound">γ</a> <a id="3637" href="/PLFA-zh/Denotational/#9274" class="Datatype Operator">⊢</a> <a id="3639" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="3641" href="plfa.Compositional.html#3601" class="Bound">N</a> <a id="3643" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="3645" href="plfa.Compositional.html#3616" class="Bound">v₁</a> <a id="3648" href="plfa.Denotational.html#3994" class="InductiveConstructor Operator">↦</a> <a id="3650" href="plfa.Compositional.html#3619" class="Bound">v₂</a>
    <a id="3657" class="Comment">-----------------</a>
  <a id="3677" class="Symbol">→</a> <a id="3679" class="Symbol">(</a><a id="3680" href="/PLFA-zh/Compositional/#3590" class="Bound">γ</a> <a id="3682" href="/PLFA-zh/Denotational/#7257" class="Function Operator">`,</a> <a id="3685" href="plfa.Compositional.html#3616" class="Bound">v₁</a><a id="3687" class="Symbol">)</a> <a id="3689" href="plfa.Denotational.html#9274" class="Datatype Operator">⊢</a> <a id="3691" href="plfa.Compositional.html#3601" class="Bound">N</a> <a id="3693" href="plfa.Denotational.html#9274" class="Datatype Operator">↓</a> <a id="3695" href="plfa.Compositional.html#3619" class="Bound">v₂</a>
<a id="3698" href="/PLFA-zh/Compositional/#3566" class="Function">lambda-inversion</a><a id="3714" class="Symbol">{</a><a id="3715" class="Argument">v₁</a> <a id="3718" class="Symbol">=</a> <a id="3720" href="plfa.Compositional.html#3720" class="Bound">v₁</a><a id="3722" class="Symbol">}{</a><a id="3724" class="Argument">v₂</a> <a id="3727" class="Symbol">=</a> <a id="3729" href="plfa.Compositional.html#3729" class="Bound">v₂</a><a id="3731" class="Symbol">}</a> <a id="3733" href="plfa.Compositional.html#3733" class="Bound">d</a> <a id="3735" class="Symbol">=</a> <a id="3737" href="plfa.Compositional.html#3149" class="Function">ℰƛ→ℱℰ</a><a id="3742" class="Symbol">{</a><a id="3743" class="Argument">v</a> <a id="3745" class="Symbol">=</a> <a id="3747" href="plfa.Compositional.html#3720" class="Bound">v₁</a> <a id="3750" href="/PLFA-zh/Denotational/#3994" class="InductiveConstructor Operator">↦</a> <a id="3752" href="plfa.Compositional.html#3729" class="Bound">v₂</a><a id="3754" class="Symbol">}</a> <a id="3756" href="plfa.Compositional.html#3733" class="Bound">d</a>
</pre>
<p>The backward direction of the semantic equation for lambda is even
easier to prove than the forward direction. We proceed by induction on
the value v.</p>

<pre class="Agda"><a id="ℱℰ→ℰƛ"></a><a id="3919" href="/PLFA-zh/Compositional/#3919" class="Function">ℱℰ→ℰƛ</a> <a id="3925" class="Symbol">:</a> <a id="3927" class="Symbol">∀{</a><a id="3929" href="plfa.Compositional.html#3929" class="Bound">Γ</a><a id="3930" class="Symbol">}{</a><a id="3932" href="plfa.Compositional.html#3932" class="Bound">γ</a> <a id="3934" class="Symbol">:</a> <a id="3936" href="/PLFA-zh/Denotational/#7100" class="Function">Env</a> <a id="3940" href="plfa.Compositional.html#3929" class="Bound">Γ</a><a id="3941" class="Symbol">}{</a><a id="3943" href="plfa.Compositional.html#3943" class="Bound">N</a> <a id="3945" class="Symbol">:</a> <a id="3947" href="plfa.Compositional.html#3929" class="Bound">Γ</a> <a id="3949" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="3951" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="3953" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="3955" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="3956" class="Symbol">}{</a><a id="3958" href="plfa.Compositional.html#3958" class="Bound">v</a> <a id="3960" class="Symbol">:</a> <a id="3962" href="plfa.Denotational.html#3962" class="Datatype">Value</a><a id="3967" class="Symbol">}</a>
        <a id="3977" class="Symbol">→</a> <a id="3979" href="/PLFA-zh/Compositional/#1852" class="Function">ℱ</a> <a id="3981" class="Symbol">(</a><a id="3982" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="3984" href="plfa.Compositional.html#3943" class="Bound">N</a><a id="3985" class="Symbol">)</a> <a id="3987" href="plfa.Compositional.html#3932" class="Bound">γ</a> <a id="3989" href="plfa.Compositional.html#3958" class="Bound">v</a>
          <a id="4001" class="Comment">------------</a>
        <a id="4022" class="Symbol">→</a> <a id="4024" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="4026" class="Symbol">(</a><a id="4027" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="4029" href="/PLFA-zh/Compositional/#3943" class="Bound">N</a><a id="4030" class="Symbol">)</a> <a id="4032" href="plfa.Compositional.html#3932" class="Bound">γ</a> <a id="4034" href="plfa.Compositional.html#3958" class="Bound">v</a>
<a id="4036" href="/PLFA-zh/Compositional/#3919" class="Function">ℱℰ→ℰƛ</a> <a id="4042" class="Symbol">{</a><a id="4043" class="Argument">v</a> <a id="4045" class="Symbol">=</a> <a id="4047" href="/PLFA-zh/Denotational/#3982" class="InductiveConstructor">⊥</a><a id="4048" class="Symbol">}</a> <a id="4050" href="plfa.Compositional.html#4050" class="Bound">d</a> <a id="4052" class="Symbol">=</a> <a id="4054" href="plfa.Denotational.html#9669" class="InductiveConstructor">⊥-intro</a>
<a id="4062" href="/PLFA-zh/Compositional/#3919" class="Function">ℱℰ→ℰƛ</a> <a id="4068" class="Symbol">{</a><a id="4069" class="Argument">v</a> <a id="4071" class="Symbol">=</a> <a id="4073" href="plfa.Compositional.html#4073" class="Bound">v₁</a> <a id="4076" href="/PLFA-zh/Denotational/#3994" class="InductiveConstructor Operator">↦</a> <a id="4078" href="plfa.Compositional.html#4078" class="Bound">v₂</a><a id="4080" class="Symbol">}</a> <a id="4082" href="plfa.Compositional.html#4082" class="Bound">d</a> <a id="4084" class="Symbol">=</a> <a id="4086" href="plfa.Denotational.html#9545" class="InductiveConstructor">↦-intro</a> <a id="4094" href="plfa.Compositional.html#4082" class="Bound">d</a>
<a id="4096" href="/PLFA-zh/Compositional/#3919" class="Function">ℱℰ→ℰƛ</a> <a id="4102" class="Symbol">{</a><a id="4103" class="Argument">v</a> <a id="4105" class="Symbol">=</a> <a id="4107" href="plfa.Compositional.html#4107" class="Bound">v₁</a> <a id="4110" href="/PLFA-zh/Denotational/#4024" class="InductiveConstructor Operator">⊔</a> <a id="4112" href="plfa.Compositional.html#4112" class="Bound">v₂</a><a id="4114" class="Symbol">}</a> <a id="4116" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="4118" href="plfa.Compositional.html#4118" class="Bound">d1</a> <a id="4121" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="4123" href="plfa.Compositional.html#4123" class="Bound">d2</a> <a id="4126" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="4128" class="Symbol">=</a> <a id="4130" href="plfa.Denotational.html#9744" class="InductiveConstructor">⊔-intro</a> <a id="4138" class="Symbol">(</a><a id="4139" href="plfa.Compositional.html#3919" class="Function">ℱℰ→ℰƛ</a> <a id="4145" href="plfa.Compositional.html#4118" class="Bound">d1</a><a id="4147" class="Symbol">)</a> <a id="4149" class="Symbol">(</a><a id="4150" href="plfa.Compositional.html#3919" class="Function">ℱℰ→ℰƛ</a> <a id="4156" href="plfa.Compositional.html#4123" class="Bound">d2</a><a id="4158" class="Symbol">)</a>
</pre>
<p>So indeed, the denotational semantics is compositional with respect
to lambda abstraction, as witnessed by the function <code class="highlighter-rouge">ℱ</code>.</p>

<pre class="Agda"><a id="lam-equiv"></a><a id="4295" href="/PLFA-zh/Compositional/#4295" class="Function">lam-equiv</a> <a id="4305" class="Symbol">:</a> <a id="4307" class="Symbol">∀{</a><a id="4309" href="plfa.Compositional.html#4309" class="Bound">Γ</a><a id="4310" class="Symbol">}{</a><a id="4312" href="plfa.Compositional.html#4312" class="Bound">N</a> <a id="4314" class="Symbol">:</a> <a id="4316" href="plfa.Compositional.html#4309" class="Bound">Γ</a> <a id="4318" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="4320" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="4322" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="4324" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="4325" class="Symbol">}</a>
          <a id="4337" class="Symbol">→</a> <a id="4339" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="4341" class="Symbol">(</a><a id="4342" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="4344" href="/PLFA-zh/Compositional/#4312" class="Bound">N</a><a id="4345" class="Symbol">)</a> <a id="4347" href="plfa.Denotational.html#17609" class="Function Operator">≃</a> <a id="4349" href="plfa.Compositional.html#1852" class="Function">ℱ</a> <a id="4351" class="Symbol">(</a><a id="4352" href="plfa.Denotational.html#17427" class="Function">ℰ</a> <a id="4354" href="plfa.Compositional.html#4312" class="Bound">N</a><a id="4355" class="Symbol">)</a>
<a id="4357" href="/PLFA-zh/Compositional/#4295" class="Function">lam-equiv</a> <a id="4367" href="plfa.Compositional.html#4367" class="Bound">γ</a> <a id="4369" href="plfa.Compositional.html#4369" class="Bound">v</a> <a id="4371" class="Symbol">=</a> <a id="4373" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="4375" href="plfa.Compositional.html#3149" class="Function">ℰƛ→ℱℰ</a> <a id="4381" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="4383" href="plfa.Compositional.html#3919" class="Function">ℱℰ→ℰƛ</a> <a id="4389" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>

<h2 id="equation-for-function-application">Equation for function application</h2>

<p>Next we fill in the ellipses for the equation concerning function
application.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ℰ (M · N) ≃ ... ℰ M ... ℰ N ...
</code></pre></div></div>

<p>For this we need to define a function that takes two denotations, both
in context <code class="highlighter-rouge">Γ</code>, and produces another one in context <code class="highlighter-rouge">Γ</code>. This
function, let us name it <code class="highlighter-rouge">●</code>, needs to mimic the non-recursive aspects
of the semantics of an application <code class="highlighter-rouge">L · M</code>.  We cannot proceed as
easily as for <code class="highlighter-rouge">ℱ</code> and define the function by recursion on value <code class="highlighter-rouge">v</code>
because, for example, the rule <code class="highlighter-rouge">↦-elim</code> applies to any value. Instead
we shall define <code class="highlighter-rouge">●</code> in a way that directly deals with the <code class="highlighter-rouge">↦-elim</code> and
<code class="highlighter-rouge">⊥-intro</code> rules but ignores <code class="highlighter-rouge">⊔-intro</code>. This makes the forward
direction of the proof more difficult, and the case for <code class="highlighter-rouge">⊔-intro</code>
demonstrates why the <code class="highlighter-rouge">Dist⊑</code> rule is important.</p>

<p>So we define the application of <code class="highlighter-rouge">D₁</code> to <code class="highlighter-rouge">D₂</code>, written <code class="highlighter-rouge">D₁ ● D₂</code>, to include
any value <code class="highlighter-rouge">w</code> equivalent to <code class="highlighter-rouge">⊥</code>, for the <code class="highlighter-rouge">⊥-intro</code> rule, and to include any
value <code class="highlighter-rouge">w</code> that is the output of an entry <code class="highlighter-rouge">v ↦ w</code> in <code class="highlighter-rouge">D₁</code>, provided the
input <code class="highlighter-rouge">v</code> is in <code class="highlighter-rouge">D₂</code>, for the <code class="highlighter-rouge">↦-elim</code> rule.</p>

<pre class="Agda"><a id="5481" class="Keyword">infixl</a> <a id="5488" class="Number">7</a> <a id="5490" href="/PLFA-zh/Compositional/#5495" class="Function Operator">_●_</a>

<a id="_●_"></a><a id="5495" href="/PLFA-zh/Compositional/#5495" class="Function Operator">_●_</a> <a id="5499" class="Symbol">:</a> <a id="5501" class="Symbol">∀{</a><a id="5503" href="plfa.Compositional.html#5503" class="Bound">Γ</a><a id="5504" class="Symbol">}</a> <a id="5506" class="Symbol">→</a> <a id="5508" href="/PLFA-zh/Denotational/#17214" class="Function">Denotation</a> <a id="5519" href="plfa.Compositional.html#5503" class="Bound">Γ</a> <a id="5521" class="Symbol">→</a> <a id="5523" href="plfa.Denotational.html#17214" class="Function">Denotation</a> <a id="5534" href="plfa.Compositional.html#5503" class="Bound">Γ</a> <a id="5536" class="Symbol">→</a> <a id="5538" href="plfa.Denotational.html#17214" class="Function">Denotation</a> <a id="5549" href="plfa.Compositional.html#5503" class="Bound">Γ</a>
<a id="5551" class="Symbol">(</a><a id="5552" href="/PLFA-zh/Compositional/#5552" class="Bound">D₁</a> <a id="5555" href="plfa.Compositional.html#5495" class="Function Operator">●</a> <a id="5557" href="plfa.Compositional.html#5557" class="Bound">D₂</a><a id="5559" class="Symbol">)</a> <a id="5561" href="plfa.Compositional.html#5561" class="Bound">γ</a> <a id="5563" href="plfa.Compositional.html#5563" class="Bound">w</a> <a id="5565" class="Symbol">=</a> <a id="5567" href="plfa.Compositional.html#5563" class="Bound">w</a> <a id="5569" href="/PLFA-zh/Denotational/#4317" class="Datatype Operator">⊑</a> <a id="5571" href="plfa.Denotational.html#3982" class="InductiveConstructor">⊥</a> <a id="5573" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#612" class="Datatype Operator">⊎</a> <a id="5575" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="5578" href="plfa.Compositional.html#5578" class="Bound">v</a> <a id="5580" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="5582" href="plfa.Denotational.html#3962" class="Datatype">Value</a> <a id="5588" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a><a id="5589" class="Symbol">(</a> <a id="5591" href="plfa.Compositional.html#5552" class="Bound">D₁</a> <a id="5594" href="plfa.Compositional.html#5561" class="Bound">γ</a> <a id="5596" class="Symbol">(</a><a id="5597" href="plfa.Compositional.html#5578" class="Bound">v</a> <a id="5599" href="plfa.Denotational.html#3994" class="InductiveConstructor Operator">↦</a> <a id="5601" href="plfa.Compositional.html#5563" class="Bound">w</a><a id="5602" class="Symbol">)</a> <a id="5604" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a> <a id="5606" href="plfa.Compositional.html#5557" class="Bound">D₂</a> <a id="5609" href="plfa.Compositional.html#5561" class="Bound">γ</a> <a id="5611" href="plfa.Compositional.html#5578" class="Bound">v</a> <a id="5613" class="Symbol">)</a>
</pre>
<p>[JGS: add comment about how ● can be viewed as apply.]</p>

<p>Next we consider the inversion lemma for application, which is also
the forward direction of the semantic equation for application.  We
describe the proof below.</p>

<pre class="Agda"><a id="ℰ·→●ℰ"></a><a id="5843" href="/PLFA-zh/Compositional/#5843" class="Function">ℰ·→●ℰ</a> <a id="5849" class="Symbol">:</a> <a id="5851" class="Symbol">∀{</a><a id="5853" href="plfa.Compositional.html#5853" class="Bound">Γ</a><a id="5854" class="Symbol">}{</a><a id="5856" href="plfa.Compositional.html#5856" class="Bound">γ</a> <a id="5858" class="Symbol">:</a> <a id="5860" href="/PLFA-zh/Denotational/#7100" class="Function">Env</a> <a id="5864" href="plfa.Compositional.html#5853" class="Bound">Γ</a><a id="5865" class="Symbol">}{</a><a id="5867" href="plfa.Compositional.html#5867" class="Bound">L</a> <a id="5869" href="plfa.Compositional.html#5869" class="Bound">M</a> <a id="5871" class="Symbol">:</a> <a id="5873" href="plfa.Compositional.html#5853" class="Bound">Γ</a> <a id="5875" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="5877" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="5878" class="Symbol">}{</a><a id="5880" href="plfa.Compositional.html#5880" class="Bound">v</a> <a id="5882" class="Symbol">:</a> <a id="5884" href="plfa.Denotational.html#3962" class="Datatype">Value</a><a id="5889" class="Symbol">}</a>
        <a id="5899" class="Symbol">→</a> <a id="5901" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="5903" class="Symbol">(</a><a id="5904" href="/PLFA-zh/Compositional/#5867" class="Bound">L</a> <a id="5906" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="5908" href="plfa.Compositional.html#5869" class="Bound">M</a><a id="5909" class="Symbol">)</a> <a id="5911" href="plfa.Compositional.html#5856" class="Bound">γ</a> <a id="5913" href="plfa.Compositional.html#5880" class="Bound">v</a>
          <a id="5925" class="Comment">----------------</a>
        <a id="5950" class="Symbol">→</a> <a id="5952" class="Symbol">(</a><a id="5953" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="5955" href="/PLFA-zh/Compositional/#5867" class="Bound">L</a> <a id="5957" href="plfa.Compositional.html#5495" class="Function Operator">●</a> <a id="5959" href="plfa.Denotational.html#17427" class="Function">ℰ</a> <a id="5961" href="plfa.Compositional.html#5869" class="Bound">M</a><a id="5962" class="Symbol">)</a> <a id="5964" href="plfa.Compositional.html#5856" class="Bound">γ</a> <a id="5966" href="plfa.Compositional.html#5880" class="Bound">v</a>
<a id="5968" href="/PLFA-zh/Compositional/#5843" class="Function">ℰ·→●ℰ</a> <a id="5974" class="Symbol">(</a><a id="5975" href="/PLFA-zh/Denotational/#9407" class="InductiveConstructor">↦-elim</a><a id="5981" class="Symbol">{</a><a id="5982" class="Argument">v</a> <a id="5984" class="Symbol">=</a> <a id="5986" href="plfa.Compositional.html#5986" class="Bound">v′</a><a id="5988" class="Symbol">}</a> <a id="5990" href="plfa.Compositional.html#5990" class="Bound">d₁</a> <a id="5993" href="plfa.Compositional.html#5993" class="Bound">d₂</a><a id="5995" class="Symbol">)</a> <a id="5997" class="Symbol">=</a> <a id="5999" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#687" class="InductiveConstructor">inj₂</a> <a id="6004" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6006" href="plfa.Compositional.html#5986" class="Bound">v′</a> <a id="6009" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6011" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6013" href="plfa.Compositional.html#5990" class="Bound">d₁</a> <a id="6016" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6018" href="plfa.Compositional.html#5993" class="Bound">d₂</a> <a id="6021" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="6023" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="6025" href="/PLFA-zh/Compositional/#5843" class="Function">ℰ·→●ℰ</a> <a id="6031" class="Symbol">{</a><a id="6032" class="Argument">v</a> <a id="6034" class="Symbol">=</a> <a id="6036" href="/PLFA-zh/Denotational/#3982" class="InductiveConstructor">⊥</a><a id="6037" class="Symbol">}</a> <a id="6039" href="plfa.Denotational.html#9669" class="InductiveConstructor">⊥-intro</a> <a id="6047" class="Symbol">=</a> <a id="6049" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#662" class="InductiveConstructor">inj₁</a> <a id="6054" href="plfa.Denotational.html#4352" class="InductiveConstructor">Bot⊑</a>
<a id="6059" href="/PLFA-zh/Compositional/#5843" class="Function">ℰ·→●ℰ</a> <a id="6065" class="Symbol">{</a><a id="6066" href="plfa.Compositional.html#6066" class="Bound">Γ</a><a id="6067" class="Symbol">}{</a><a id="6069" href="plfa.Compositional.html#6069" class="Bound">γ</a><a id="6070" class="Symbol">}{</a><a id="6072" href="plfa.Compositional.html#6072" class="Bound">L</a><a id="6073" class="Symbol">}{</a><a id="6075" href="plfa.Compositional.html#6075" class="Bound">M</a><a id="6076" class="Symbol">}{</a><a id="6078" href="plfa.Compositional.html#6078" class="Bound">v</a><a id="6079" class="Symbol">}</a> <a id="6081" class="Symbol">(</a><a id="6082" href="/PLFA-zh/Denotational/#9744" class="InductiveConstructor">⊔-intro</a><a id="6089" class="Symbol">{</a><a id="6090" class="Argument">v</a> <a id="6092" class="Symbol">=</a> <a id="6094" href="plfa.Compositional.html#6094" class="Bound">v₁</a><a id="6096" class="Symbol">}{</a><a id="6098" class="Argument">w</a> <a id="6100" class="Symbol">=</a> <a id="6102" href="plfa.Compositional.html#6102" class="Bound">v₂</a><a id="6104" class="Symbol">}</a> <a id="6106" href="plfa.Compositional.html#6106" class="Bound">d₁</a> <a id="6109" href="plfa.Compositional.html#6109" class="Bound">d₂</a><a id="6111" class="Symbol">)</a>
    <a id="6117" class="Keyword">with</a> <a id="6122" href="/PLFA-zh/Compositional/#5843" class="Function">ℰ·→●ℰ</a> <a id="6128" href="plfa.Compositional.html#6106" class="Bound">d₁</a> <a id="6131" class="Symbol">|</a> <a id="6133" href="plfa.Compositional.html#5843" class="Function">ℰ·→●ℰ</a> <a id="6139" href="plfa.Compositional.html#6109" class="Bound">d₂</a>
<a id="6142" class="Symbol">...</a> <a id="6146" class="Symbol">|</a> <a id="6148" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#662" class="InductiveConstructor">inj₁</a> <a id="6153" href="/PLFA-zh/Compositional/#6153" class="Bound">lt1</a> <a id="6157" class="Symbol">|</a> <a id="6159" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#662" class="InductiveConstructor">inj₁</a> <a id="6164" href="plfa.Compositional.html#6164" class="Bound">lt2</a> <a id="6168" class="Symbol">=</a> <a id="6170" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#662" class="InductiveConstructor">inj₁</a> <a id="6175" class="Symbol">(</a><a id="6176" href="/PLFA-zh/Denotational/#4376" class="InductiveConstructor">ConjL⊑</a> <a id="6183" href="plfa.Compositional.html#6153" class="Bound">lt1</a> <a id="6187" href="plfa.Compositional.html#6164" class="Bound">lt2</a><a id="6190" class="Symbol">)</a>
<a id="6192" class="Symbol">...</a> <a id="6196" class="Symbol">|</a> <a id="6198" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#662" class="InductiveConstructor">inj₁</a> <a id="6203" href="/PLFA-zh/Compositional/#6203" class="Bound">lt1</a> <a id="6207" class="Symbol">|</a> <a id="6209" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#687" class="InductiveConstructor">inj₂</a> <a id="6214" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6216" href="plfa.Compositional.html#6216" class="Bound">v₁′</a> <a id="6220" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6222" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6224" href="plfa.Compositional.html#6224" class="Bound">L↓v12</a> <a id="6230" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6232" href="plfa.Compositional.html#6232" class="Bound">M↓v3</a> <a id="6237" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="6239" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="6241" class="Symbol">=</a>
      <a id="6249" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#687" class="InductiveConstructor">inj₂</a> <a id="6254" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6256" href="/PLFA-zh/Compositional/#6216" class="Bound">v₁′</a> <a id="6260" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6262" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6264" href="/PLFA-zh/Denotational/#9875" class="InductiveConstructor">sub</a> <a id="6268" href="plfa.Compositional.html#6224" class="Bound">L↓v12</a> <a id="6274" href="plfa.Compositional.html#6300" class="Function">lt</a> <a id="6277" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6279" href="plfa.Compositional.html#6232" class="Bound">M↓v3</a> <a id="6284" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="6286" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
      <a id="6294" class="Keyword">where</a> <a id="6300" href="/PLFA-zh/Compositional/#6300" class="Function">lt</a> <a id="6303" class="Symbol">:</a> <a id="6305" href="plfa.Compositional.html#6216" class="Bound">v₁′</a> <a id="6309" href="/PLFA-zh/Denotational/#3994" class="InductiveConstructor Operator">↦</a> <a id="6311" class="Symbol">(</a><a id="6312" class="Bound">v₁</a> <a id="6315" href="plfa.Denotational.html#4024" class="InductiveConstructor Operator">⊔</a> <a id="6317" class="Bound">v₂</a><a id="6319" class="Symbol">)</a> <a id="6321" href="plfa.Denotational.html#4317" class="Datatype Operator">⊑</a> <a id="6323" href="plfa.Compositional.html#6216" class="Bound">v₁′</a> <a id="6327" href="plfa.Denotational.html#3994" class="InductiveConstructor Operator">↦</a> <a id="6329" class="Bound">v₂</a>
            <a id="6344" href="/PLFA-zh/Compositional/#6300" class="Function">lt</a> <a id="6347" class="Symbol">=</a> <a id="6349" class="Symbol">(</a><a id="6350" href="/PLFA-zh/Denotational/#4688" class="InductiveConstructor">Fun⊑</a> <a id="6355" href="plfa.Denotational.html#5471" class="Function">Refl⊑</a> <a id="6361" class="Symbol">(</a><a id="6362" href="plfa.Denotational.html#4376" class="InductiveConstructor">ConjL⊑</a> <a id="6369" class="Symbol">(</a><a id="6370" href="plfa.Denotational.html#4614" class="InductiveConstructor">Trans⊑</a> <a id="6377" href="plfa.Compositional.html#6203" class="Bound">lt1</a> <a id="6381" href="plfa.Denotational.html#4352" class="InductiveConstructor">Bot⊑</a><a id="6385" class="Symbol">)</a> <a id="6387" href="plfa.Denotational.html#5471" class="Function">Refl⊑</a><a id="6392" class="Symbol">))</a>
<a id="6395" class="Symbol">...</a> <a id="6399" class="Symbol">|</a> <a id="6401" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#687" class="InductiveConstructor">inj₂</a> <a id="6406" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6408" href="/PLFA-zh/Compositional/#6408" class="Bound">v₁′</a> <a id="6412" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6414" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6416" href="plfa.Compositional.html#6416" class="Bound">L↓v12</a> <a id="6422" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6424" href="plfa.Compositional.html#6424" class="Bound">M↓v3</a> <a id="6429" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="6431" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="6433" class="Symbol">|</a> <a id="6435" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#662" class="InductiveConstructor">inj₁</a> <a id="6440" href="plfa.Compositional.html#6440" class="Bound">lt2</a> <a id="6444" class="Symbol">=</a>
      <a id="6452" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#687" class="InductiveConstructor">inj₂</a> <a id="6457" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6459" href="/PLFA-zh/Compositional/#6408" class="Bound">v₁′</a> <a id="6463" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6465" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6467" href="/PLFA-zh/Denotational/#9875" class="InductiveConstructor">sub</a> <a id="6471" href="plfa.Compositional.html#6416" class="Bound">L↓v12</a> <a id="6477" href="plfa.Compositional.html#6503" class="Function">lt</a> <a id="6480" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6482" href="plfa.Compositional.html#6424" class="Bound">M↓v3</a> <a id="6487" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="6489" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
      <a id="6497" class="Keyword">where</a> <a id="6503" href="/PLFA-zh/Compositional/#6503" class="Function">lt</a> <a id="6506" class="Symbol">:</a> <a id="6508" href="plfa.Compositional.html#6408" class="Bound">v₁′</a> <a id="6512" href="/PLFA-zh/Denotational/#3994" class="InductiveConstructor Operator">↦</a> <a id="6514" class="Symbol">(</a><a id="6515" class="Bound">v₁</a> <a id="6518" href="plfa.Denotational.html#4024" class="InductiveConstructor Operator">⊔</a> <a id="6520" class="Bound">v₂</a><a id="6522" class="Symbol">)</a> <a id="6524" href="plfa.Denotational.html#4317" class="Datatype Operator">⊑</a> <a id="6526" href="plfa.Compositional.html#6408" class="Bound">v₁′</a> <a id="6530" href="plfa.Denotational.html#3994" class="InductiveConstructor Operator">↦</a> <a id="6532" class="Bound">v₁</a>
            <a id="6547" href="/PLFA-zh/Compositional/#6503" class="Function">lt</a> <a id="6550" class="Symbol">=</a> <a id="6552" class="Symbol">(</a><a id="6553" href="/PLFA-zh/Denotational/#4688" class="InductiveConstructor">Fun⊑</a> <a id="6558" href="plfa.Denotational.html#5471" class="Function">Refl⊑</a> <a id="6564" class="Symbol">(</a><a id="6565" href="plfa.Denotational.html#4376" class="InductiveConstructor">ConjL⊑</a> <a id="6572" href="plfa.Denotational.html#5471" class="Function">Refl⊑</a> <a id="6578" class="Symbol">(</a><a id="6579" href="plfa.Denotational.html#4614" class="InductiveConstructor">Trans⊑</a> <a id="6586" href="plfa.Compositional.html#6440" class="Bound">lt2</a> <a id="6590" href="plfa.Denotational.html#4352" class="InductiveConstructor">Bot⊑</a><a id="6594" class="Symbol">)))</a>
<a id="6598" class="Symbol">...</a> <a id="6602" class="Symbol">|</a> <a id="6604" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#687" class="InductiveConstructor">inj₂</a> <a id="6609" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6611" href="/PLFA-zh/Compositional/#6611" class="Bound">v₁′</a> <a id="6615" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6617" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6619" href="plfa.Compositional.html#6619" class="Bound">L↓v12</a> <a id="6625" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6627" href="plfa.Compositional.html#6627" class="Bound">M↓v3</a> <a id="6632" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="6634" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="6636" class="Symbol">|</a> <a id="6638" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#687" class="InductiveConstructor">inj₂</a> <a id="6643" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6645" href="plfa.Compositional.html#6645" class="Bound">v₁′′</a> <a id="6650" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6652" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6654" href="plfa.Compositional.html#6654" class="Bound">L↓v12′</a> <a id="6661" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6663" href="plfa.Compositional.html#6663" class="Bound">M↓v3′</a> <a id="6669" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="6671" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="6673" class="Symbol">=</a>
      <a id="6681" class="Keyword">let</a> <a id="6685" href="/PLFA-zh/Compositional/#6685" class="Bound">L↓⊔</a> <a id="6689" class="Symbol">=</a> <a id="6691" href="/PLFA-zh/Denotational/#9744" class="InductiveConstructor">⊔-intro</a> <a id="6699" href="plfa.Compositional.html#6619" class="Bound">L↓v12</a> <a id="6705" href="plfa.Compositional.html#6654" class="Bound">L↓v12′</a> <a id="6712" class="Keyword">in</a>
      <a id="6721" class="Keyword">let</a> <a id="6725" href="/PLFA-zh/Compositional/#6725" class="Bound">M↓⊔</a> <a id="6729" class="Symbol">=</a> <a id="6731" href="/PLFA-zh/Denotational/#9744" class="InductiveConstructor">⊔-intro</a> <a id="6739" href="plfa.Compositional.html#6627" class="Bound">M↓v3</a> <a id="6744" href="plfa.Compositional.html#6663" class="Bound">M↓v3′</a> <a id="6750" class="Keyword">in</a>
      <a id="6759" class="Keyword">let</a> <a id="6763" href="/PLFA-zh/Compositional/#6763" class="Bound">x</a> <a id="6765" class="Symbol">=</a> <a id="6767" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#687" class="InductiveConstructor">inj₂</a> <a id="6772" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6774" href="plfa.Compositional.html#6611" class="Bound">v₁′</a> <a id="6778" href="/PLFA-zh/Denotational/#4024" class="InductiveConstructor Operator">⊔</a> <a id="6780" href="plfa.Compositional.html#6645" class="Bound">v₁′′</a> <a id="6785" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6787" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6789" href="plfa.Denotational.html#9875" class="InductiveConstructor">sub</a> <a id="6793" href="plfa.Compositional.html#6685" class="Bound">L↓⊔</a> <a id="6797" href="plfa.Denotational.html#6094" class="Function">Dist⊔↦⊔</a> <a id="6805" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6807" href="plfa.Compositional.html#6725" class="Bound">M↓⊔</a> <a id="6811" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="6813" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="6815" class="Keyword">in</a>
      <a id="6824" href="/PLFA-zh/Compositional/#6763" class="Bound">x</a>
<a id="6826" href="/PLFA-zh/Compositional/#5843" class="Function">ℰ·→●ℰ</a> <a id="6832" class="Symbol">{</a><a id="6833" href="plfa.Compositional.html#6833" class="Bound">Γ</a><a id="6834" class="Symbol">}{</a><a id="6836" href="plfa.Compositional.html#6836" class="Bound">γ</a><a id="6837" class="Symbol">}{</a><a id="6839" href="plfa.Compositional.html#6839" class="Bound">L</a><a id="6840" class="Symbol">}{</a><a id="6842" href="plfa.Compositional.html#6842" class="Bound">M</a><a id="6843" class="Symbol">}{</a><a id="6845" href="plfa.Compositional.html#6845" class="Bound">v</a><a id="6846" class="Symbol">}</a> <a id="6848" class="Symbol">(</a><a id="6849" href="/PLFA-zh/Denotational/#9875" class="InductiveConstructor">sub</a> <a id="6853" href="plfa.Compositional.html#6853" class="Bound">d</a> <a id="6855" href="plfa.Compositional.html#6855" class="Bound">lt</a><a id="6857" class="Symbol">)</a>
    <a id="6863" class="Keyword">with</a> <a id="6868" href="/PLFA-zh/Compositional/#5843" class="Function">ℰ·→●ℰ</a> <a id="6874" href="plfa.Compositional.html#6853" class="Bound">d</a>
<a id="6876" class="Symbol">...</a> <a id="6880" class="Symbol">|</a> <a id="6882" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#662" class="InductiveConstructor">inj₁</a> <a id="6887" href="/PLFA-zh/Compositional/#6887" class="Bound">lt2</a> <a id="6891" class="Symbol">=</a> <a id="6893" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#662" class="InductiveConstructor">inj₁</a> <a id="6898" class="Symbol">(</a><a id="6899" href="/PLFA-zh/Denotational/#4614" class="InductiveConstructor">Trans⊑</a> <a id="6906" class="Bound">lt</a> <a id="6909" href="plfa.Compositional.html#6887" class="Bound">lt2</a><a id="6912" class="Symbol">)</a>
<a id="6914" class="Symbol">...</a> <a id="6918" class="Symbol">|</a> <a id="6920" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#687" class="InductiveConstructor">inj₂</a> <a id="6925" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6927" href="/PLFA-zh/Compositional/#6927" class="Bound">v₁</a> <a id="6930" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6932" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6934" href="plfa.Compositional.html#6934" class="Bound">L↓v12</a> <a id="6940" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6942" href="plfa.Compositional.html#6942" class="Bound">M↓v3</a> <a id="6947" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="6949" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="6951" class="Symbol">=</a>
      <a id="6959" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#687" class="InductiveConstructor">inj₂</a> <a id="6964" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6966" href="/PLFA-zh/Compositional/#6927" class="Bound">v₁</a> <a id="6969" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6971" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6973" href="/PLFA-zh/Denotational/#9875" class="InductiveConstructor">sub</a> <a id="6977" href="plfa.Compositional.html#6934" class="Bound">L↓v12</a> <a id="6983" class="Symbol">(</a><a id="6984" href="plfa.Denotational.html#4688" class="InductiveConstructor">Fun⊑</a> <a id="6989" href="plfa.Denotational.html#5471" class="Function">Refl⊑</a> <a id="6995" class="Bound">lt</a><a id="6997" class="Symbol">)</a> <a id="6999" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="7001" href="plfa.Compositional.html#6942" class="Bound">M↓v3</a> <a id="7006" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="7008" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>We proceed by induction on the semantics.</p>

<ul>
  <li>
    <p>In case <code class="highlighter-rouge">↦-elim</code> we have <code class="highlighter-rouge">γ ⊢ L ↓ (v′ ↦ v)</code> and <code class="highlighter-rouge">γ ⊢ M ↓ v′</code>,
which is all we need to show <code class="highlighter-rouge">(ℰ L ● ℰ M) γ v</code>.</p>
  </li>
  <li>
    <p>In case <code class="highlighter-rouge">⊥-intro</code> we have <code class="highlighter-rouge">v = ⊥</code>. We conclude that <code class="highlighter-rouge">v ⊑ ⊥</code>.</p>
  </li>
  <li>
    <p>In case <code class="highlighter-rouge">⊔-intro</code> we have <code class="highlighter-rouge">ℰ (L · M) γ v₁</code> and <code class="highlighter-rouge">ℰ (L · M) γ v₂</code>
and need to show <code class="highlighter-rouge">(ℰ L ● ℰ M) γ (v₁ ⊔ v₂)</code>. By the induction
hypothesis, we have <code class="highlighter-rouge">(ℰ L ● ℰ M) γ v₁</code> and <code class="highlighter-rouge">(ℰ L ● ℰ M) γ v₂</code>.
We have four subcases to consider.</p>

    <ul>
      <li>Suppose <code class="highlighter-rouge">v₁ ⊑ ⊥</code> and <code class="highlighter-rouge">v₂ ⊑ ⊥</code>. Then <code class="highlighter-rouge">v₁ ⊔ v₂ ⊑ ⊥</code>.</li>
      <li>Suppose <code class="highlighter-rouge">v₁ ⊑ ⊥</code>, <code class="highlighter-rouge">γ ⊢ L ↓ v₁′ ↦ v₂</code>, and <code class="highlighter-rouge">γ ⊢ M ↓ v₁′</code>.
We have <code class="highlighter-rouge">γ ⊢ L ↓ v₁′ ↦ (v₁ ⊔ v₂)</code> by rule <code class="highlighter-rouge">sub</code>
because <code class="highlighter-rouge">v₁′ ↦ (v₁ ⊔ v₂) ⊑ v₁′ ↦ v₂</code>.</li>
      <li>Suppose <code class="highlighter-rouge">γ ⊢ L ↓ v₁′ ↦ v₁</code>, <code class="highlighter-rouge">γ ⊢ M ↓ v₁′</code>, and <code class="highlighter-rouge">v₂ ⊑ ⊥</code>.
We have <code class="highlighter-rouge">γ ⊢ L ↓ v₁′ ↦ (v₁ ⊔ v₂)</code> by rule <code class="highlighter-rouge">sub</code>
because <code class="highlighter-rouge">v₁′ ↦ (v₁ ⊔ v₂) ⊑ v₁′ ↦ v₁</code>.</li>
      <li>
        <p>Suppose <code class="highlighter-rouge">γ ⊢ L ↓ v₁′′ ↦ v₁, γ ⊢ M ↓ v₁′′</code>,
<code class="highlighter-rouge">γ ⊢ L ↓ v₁′ ↦ v₂</code>, and <code class="highlighter-rouge">γ ⊢ M ↓ v₁′</code>.
This case is the most interesting.
By two uses of the rule <code class="highlighter-rouge">⊔-intro</code> we have
<code class="highlighter-rouge">γ ⊢ L ↓ (v₁′ ↦ v₂) ⊔ (v₁′′ ↦ v₁)</code> and
<code class="highlighter-rouge">γ ⊢ M ↓ (v₁′ ⊔ v₁′′)</code>. But this does not yet match
what we need for <code class="highlighter-rouge">ℰ L ● ℰ M</code> because the result of
<code class="highlighter-rouge">L</code> must be an <code class="highlighter-rouge">↦</code> whose input entry is <code class="highlighter-rouge">v₁′ ⊔ v₁′′</code>.
So we use the <code class="highlighter-rouge">sub</code> rule to obtain
<code class="highlighter-rouge">γ ⊢ L ↓ (v₁′ ⊔ v₁′′) ↦ (v₁ ⊔ v₂)</code>,
using the <code class="highlighter-rouge">Dist⊔→⊔</code> lemma (thanks to the <code class="highlighter-rouge">Dist⊑</code> rule) to
show that</p>

        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  (v₁′ ⊔ v₁′′) ↦ (v₁ ⊔ v₂) ⊑ (v₁′ ↦ v₂) ⊔ (v₁′′ ↦ v₁)
</code></pre></div>        </div>

        <p>So we have proved what is needed for this case.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>In case <code class="highlighter-rouge">sub</code> we have <code class="highlighter-rouge">Γ ⊢ L · M ↓ v₁</code> and <code class="highlighter-rouge">v ⊑ v₁</code>.
By the induction hypothesis, we have <code class="highlighter-rouge">(ℰ L ● ℰ M) γ v₁</code>.
We have two subcases to consider.</p>

    <ul>
      <li>Suppose <code class="highlighter-rouge">v₁ ⊑ ⊥</code>. We conclude that <code class="highlighter-rouge">v ⊑ ⊥</code>.</li>
      <li>Suppose <code class="highlighter-rouge">Γ ⊢ L ↓ v′ → v₁</code> and <code class="highlighter-rouge">Γ ⊢ M ↓ v′</code>.
We conclude with <code class="highlighter-rouge">Γ ⊢ L ↓ v′ → v</code> by rule <code class="highlighter-rouge">sub</code>, because
<code class="highlighter-rouge">v′ → v ⊑ v′ → v₁</code>.</li>
    </ul>
  </li>
</ul>

<p>The forward direction is proved by cases on the premise <code class="highlighter-rouge">(ℰ L ● ℰ M) γ v</code>.
In case <code class="highlighter-rouge">v ⊑ ⊥</code>, we obtain <code class="highlighter-rouge">Γ ⊢ L · M ↓ ⊥</code> by rule <code class="highlighter-rouge">⊥-intro</code>.
Otherwise, we conclude immediately by rule <code class="highlighter-rouge">↦-elim</code>.</p>

<pre class="Agda"><a id="●ℰ→ℰ·"></a><a id="9072" href="/PLFA-zh/Compositional/#9072" class="Function">●ℰ→ℰ·</a> <a id="9078" class="Symbol">:</a> <a id="9080" class="Symbol">∀{</a><a id="9082" href="plfa.Compositional.html#9082" class="Bound">Γ</a><a id="9083" class="Symbol">}{</a><a id="9085" href="plfa.Compositional.html#9085" class="Bound">γ</a> <a id="9087" class="Symbol">:</a> <a id="9089" href="/PLFA-zh/Denotational/#7100" class="Function">Env</a> <a id="9093" href="plfa.Compositional.html#9082" class="Bound">Γ</a><a id="9094" class="Symbol">}{</a><a id="9096" href="plfa.Compositional.html#9096" class="Bound">L</a> <a id="9098" href="plfa.Compositional.html#9098" class="Bound">M</a> <a id="9100" class="Symbol">:</a> <a id="9102" href="plfa.Compositional.html#9082" class="Bound">Γ</a> <a id="9104" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="9106" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="9107" class="Symbol">}{</a><a id="9109" href="plfa.Compositional.html#9109" class="Bound">v</a><a id="9110" class="Symbol">}</a>
      <a id="9118" class="Symbol">→</a> <a id="9120" class="Symbol">(</a><a id="9121" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="9123" href="/PLFA-zh/Compositional/#9096" class="Bound">L</a> <a id="9125" href="plfa.Compositional.html#5495" class="Function Operator">●</a> <a id="9127" href="plfa.Denotational.html#17427" class="Function">ℰ</a> <a id="9129" href="plfa.Compositional.html#9098" class="Bound">M</a><a id="9130" class="Symbol">)</a> <a id="9132" href="plfa.Compositional.html#9085" class="Bound">γ</a> <a id="9134" href="plfa.Compositional.html#9109" class="Bound">v</a>
        <a id="9144" class="Comment">----------------</a>
      <a id="9167" class="Symbol">→</a> <a id="9169" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="9171" class="Symbol">(</a><a id="9172" href="/PLFA-zh/Compositional/#9096" class="Bound">L</a> <a id="9174" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="9176" href="plfa.Compositional.html#9098" class="Bound">M</a><a id="9177" class="Symbol">)</a> <a id="9179" href="plfa.Compositional.html#9085" class="Bound">γ</a> <a id="9181" href="plfa.Compositional.html#9109" class="Bound">v</a>
<a id="9183" href="/PLFA-zh/Compositional/#9072" class="Function">●ℰ→ℰ·</a> <a id="9189" class="Symbol">{</a><a id="9190" href="plfa.Compositional.html#9190" class="Bound">γ</a><a id="9191" class="Symbol">}{</a><a id="9193" href="plfa.Compositional.html#9193" class="Bound">v</a><a id="9194" class="Symbol">}</a> <a id="9196" class="Symbol">(</a><a id="9197" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#662" class="InductiveConstructor">inj₁</a> <a id="9202" href="plfa.Compositional.html#9202" class="Bound">lt</a><a id="9204" class="Symbol">)</a> <a id="9206" class="Symbol">=</a> <a id="9208" href="/PLFA-zh/Denotational/#9875" class="InductiveConstructor">sub</a> <a id="9212" href="plfa.Denotational.html#9669" class="InductiveConstructor">⊥-intro</a> <a id="9220" href="plfa.Compositional.html#9202" class="Bound">lt</a>
<a id="9223" href="/PLFA-zh/Compositional/#9072" class="Function">●ℰ→ℰ·</a> <a id="9229" class="Symbol">{</a><a id="9230" href="plfa.Compositional.html#9230" class="Bound">γ</a><a id="9231" class="Symbol">}{</a><a id="9233" href="plfa.Compositional.html#9233" class="Bound">v</a><a id="9234" class="Symbol">}</a> <a id="9236" class="Symbol">(</a><a id="9237" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#687" class="InductiveConstructor">inj₂</a> <a id="9242" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="9244" href="plfa.Compositional.html#9244" class="Bound">v₁</a> <a id="9247" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="9249" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="9251" href="plfa.Compositional.html#9251" class="Bound">d1</a> <a id="9254" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="9256" href="plfa.Compositional.html#9256" class="Bound">d2</a> <a id="9259" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="9261" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a><a id="9262" class="Symbol">)</a> <a id="9264" class="Symbol">=</a> <a id="9266" href="/PLFA-zh/Denotational/#9407" class="InductiveConstructor">↦-elim</a> <a id="9273" href="plfa.Compositional.html#9251" class="Bound">d1</a> <a id="9276" href="plfa.Compositional.html#9256" class="Bound">d2</a>
</pre>
<p>So we have proved that the semantics is compositional with respect to
function application, as witnessed by the <code class="highlighter-rouge">●</code> function.</p>

<pre class="Agda"><a id="app-equiv"></a><a id="9415" href="/PLFA-zh/Compositional/#9415" class="Function">app-equiv</a> <a id="9425" class="Symbol">:</a> <a id="9427" class="Symbol">∀{</a><a id="9429" href="plfa.Compositional.html#9429" class="Bound">Γ</a><a id="9430" class="Symbol">}{</a><a id="9432" href="plfa.Compositional.html#9432" class="Bound">L</a> <a id="9434" href="plfa.Compositional.html#9434" class="Bound">M</a> <a id="9436" class="Symbol">:</a> <a id="9438" href="plfa.Compositional.html#9429" class="Bound">Γ</a> <a id="9440" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="9442" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="9443" class="Symbol">}</a>
          <a id="9455" class="Symbol">→</a> <a id="9457" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="9459" class="Symbol">(</a><a id="9460" href="/PLFA-zh/Compositional/#9432" class="Bound">L</a> <a id="9462" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="9464" href="plfa.Compositional.html#9434" class="Bound">M</a><a id="9465" class="Symbol">)</a> <a id="9467" href="plfa.Denotational.html#17609" class="Function Operator">≃</a> <a id="9469" class="Symbol">(</a><a id="9470" href="plfa.Denotational.html#17427" class="Function">ℰ</a> <a id="9472" href="plfa.Compositional.html#9432" class="Bound">L</a><a id="9473" class="Symbol">)</a> <a id="9475" href="plfa.Compositional.html#5495" class="Function Operator">●</a> <a id="9477" class="Symbol">(</a><a id="9478" href="plfa.Denotational.html#17427" class="Function">ℰ</a> <a id="9480" href="plfa.Compositional.html#9434" class="Bound">M</a><a id="9481" class="Symbol">)</a>
<a id="9483" href="/PLFA-zh/Compositional/#9415" class="Function">app-equiv</a> <a id="9493" href="plfa.Compositional.html#9493" class="Bound">γ</a> <a id="9495" href="plfa.Compositional.html#9495" class="Bound">v</a> <a id="9497" class="Symbol">=</a> <a id="9499" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="9501" href="plfa.Compositional.html#5843" class="Function">ℰ·→●ℰ</a> <a id="9507" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="9509" href="plfa.Compositional.html#9072" class="Function">●ℰ→ℰ·</a> <a id="9515" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>We also need an inversion lemma for variables.
If <code class="highlighter-rouge">Γ ⊢ x ↓ v</code>, then <code class="highlighter-rouge">v ⊑ γ x</code>. The proof is a straightforward
induction on the semantics.</p>

<pre class="Agda"><a id="var-inv"></a><a id="9665" href="/PLFA-zh/Compositional/#9665" class="Function">var-inv</a> <a id="9673" class="Symbol">:</a> <a id="9675" class="Symbol">∀</a> <a id="9677" class="Symbol">{</a><a id="9678" href="plfa.Compositional.html#9678" class="Bound">Γ</a> <a id="9680" href="plfa.Compositional.html#9680" class="Bound">v</a> <a id="9682" href="plfa.Compositional.html#9682" class="Bound">x</a><a id="9683" class="Symbol">}</a> <a id="9685" class="Symbol">{</a><a id="9686" href="plfa.Compositional.html#9686" class="Bound">γ</a> <a id="9688" class="Symbol">:</a> <a id="9690" href="/PLFA-zh/Denotational/#7100" class="Function">Env</a> <a id="9694" href="plfa.Compositional.html#9678" class="Bound">Γ</a><a id="9695" class="Symbol">}</a>
  <a id="9699" class="Symbol">→</a> <a id="9701" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="9703" class="Symbol">(</a><a id="9704" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="9706" href="/PLFA-zh/Compositional/#9682" class="Bound">x</a><a id="9707" class="Symbol">)</a> <a id="9709" href="plfa.Compositional.html#9686" class="Bound">γ</a> <a id="9711" href="plfa.Compositional.html#9680" class="Bound">v</a>
    <a id="9717" class="Comment">-------------------</a>
  <a id="9739" class="Symbol">→</a> <a id="9741" href="/PLFA-zh/Compositional/#9680" class="Bound">v</a> <a id="9743" href="/PLFA-zh/Denotational/#4317" class="Datatype Operator">⊑</a> <a id="9745" href="plfa.Compositional.html#9686" class="Bound">γ</a> <a id="9747" href="plfa.Compositional.html#9682" class="Bound">x</a>
<a id="9749" href="/PLFA-zh/Compositional/#9665" class="Function">var-inv</a> <a id="9757" class="Symbol">(</a><a id="9758" href="/PLFA-zh/Denotational/#9328" class="InductiveConstructor">var</a><a id="9761" class="Symbol">)</a> <a id="9763" class="Symbol">=</a> <a id="9765" href="plfa.Denotational.html#5471" class="Function">Refl⊑</a>
<a id="9771" href="/PLFA-zh/Compositional/#9665" class="Function">var-inv</a> <a id="9779" class="Symbol">(</a><a id="9780" href="/PLFA-zh/Denotational/#9744" class="InductiveConstructor">⊔-intro</a> <a id="9788" href="plfa.Compositional.html#9788" class="Bound">d₁</a> <a id="9791" href="plfa.Compositional.html#9791" class="Bound">d₂</a><a id="9793" class="Symbol">)</a> <a id="9795" class="Symbol">=</a> <a id="9797" href="plfa.Denotational.html#4376" class="InductiveConstructor">ConjL⊑</a> <a id="9804" class="Symbol">(</a><a id="9805" href="plfa.Compositional.html#9665" class="Function">var-inv</a> <a id="9813" href="plfa.Compositional.html#9788" class="Bound">d₁</a><a id="9815" class="Symbol">)</a> <a id="9817" class="Symbol">(</a><a id="9818" href="plfa.Compositional.html#9665" class="Function">var-inv</a> <a id="9826" href="plfa.Compositional.html#9791" class="Bound">d₂</a><a id="9828" class="Symbol">)</a>
<a id="9830" href="/PLFA-zh/Compositional/#9665" class="Function">var-inv</a> <a id="9838" class="Symbol">(</a><a id="9839" href="/PLFA-zh/Denotational/#9875" class="InductiveConstructor">sub</a> <a id="9843" href="plfa.Compositional.html#9843" class="Bound">d</a> <a id="9845" href="plfa.Compositional.html#9845" class="Bound">lt</a><a id="9847" class="Symbol">)</a> <a id="9849" class="Symbol">=</a> <a id="9851" href="plfa.Denotational.html#4614" class="InductiveConstructor">Trans⊑</a> <a id="9858" href="plfa.Compositional.html#9845" class="Bound">lt</a> <a id="9861" class="Symbol">(</a><a id="9862" href="plfa.Compositional.html#9665" class="Function">var-inv</a> <a id="9870" href="plfa.Compositional.html#9843" class="Bound">d</a><a id="9871" class="Symbol">)</a>
<a id="9873" href="/PLFA-zh/Compositional/#9665" class="Function">var-inv</a> <a id="9881" href="/PLFA-zh/Denotational/#9669" class="InductiveConstructor">⊥-intro</a> <a id="9889" class="Symbol">=</a> <a id="9891" href="plfa.Denotational.html#4352" class="InductiveConstructor">Bot⊑</a>
</pre>
<p>To round-out the semantic equations, we establish the following one
for variables.</p>

<pre class="Agda"><a id="var-equiv"></a><a id="9989" href="/PLFA-zh/Compositional/#9989" class="Function">var-equiv</a> <a id="9999" class="Symbol">:</a> <a id="10001" class="Symbol">∀{</a><a id="10003" href="plfa.Compositional.html#10003" class="Bound">Γ</a><a id="10004" class="Symbol">}{</a><a id="10006" href="plfa.Compositional.html#10006" class="Bound">x</a> <a id="10008" class="Symbol">:</a> <a id="10010" href="plfa.Compositional.html#10003" class="Bound">Γ</a> <a id="10012" href="/PLFA-zh/Untyped/#3483" class="Datatype Operator">∋</a> <a id="10014" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="10015" class="Symbol">}</a>
          <a id="10027" class="Symbol">→</a> <a id="10029" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="10031" class="Symbol">(</a><a id="10032" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="10034" href="/PLFA-zh/Compositional/#10006" class="Bound">x</a><a id="10035" class="Symbol">)</a> <a id="10037" href="plfa.Denotational.html#17609" class="Function Operator">≃</a> <a id="10039" class="Symbol">(λ</a> <a id="10042" href="plfa.Compositional.html#10042" class="Bound">γ</a> <a id="10044" href="plfa.Compositional.html#10044" class="Bound">v</a> <a id="10046" class="Symbol">→</a> <a id="10048" href="plfa.Compositional.html#10044" class="Bound">v</a> <a id="10050" href="plfa.Denotational.html#4317" class="Datatype Operator">⊑</a> <a id="10052" href="plfa.Compositional.html#10042" class="Bound">γ</a> <a id="10054" href="plfa.Compositional.html#10006" class="Bound">x</a><a id="10055" class="Symbol">)</a>
<a id="10057" href="/PLFA-zh/Compositional/#9989" class="Function">var-equiv</a> <a id="10067" href="plfa.Compositional.html#10067" class="Bound">γ</a> <a id="10069" href="plfa.Compositional.html#10069" class="Bound">v</a> <a id="10071" class="Symbol">=</a> <a id="10073" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="10075" href="plfa.Compositional.html#9665" class="Function">var-inv</a> <a id="10083" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="10085" class="Symbol">(λ</a> <a id="10088" href="plfa.Compositional.html#10088" class="Bound">lt</a> <a id="10091" class="Symbol">→</a> <a id="10093" href="/PLFA-zh/Denotational/#9875" class="InductiveConstructor">sub</a> <a id="10097" href="plfa.Denotational.html#9328" class="InductiveConstructor">var</a> <a id="10101" href="plfa.Compositional.html#10088" class="Bound">lt</a><a id="10103" class="Symbol">)</a> <a id="10105" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>

<h2 id="congruence">Congruence</h2>

<p>The main work of this chapter is complete: we have established
semantic equations that show how the denotational semantics is
compositional. In this section and the next we make use of these
equations to prove some corollaries: that denotational equality is a
<em>congruence</em> and to prove the <em>compositionality property</em>, which states
that surrounding two denotationally-equal terms in the same context
produces two programs that are denotationally equal.</p>

<p>We begin by showing that denotational equality is a congruence with
respect to lambda abstraction: that <code class="highlighter-rouge">ℰ N ≃ ℰ N′</code> implies <code class="highlighter-rouge">ℰ (ƛ N) ≃ ℰ
(ƛ N′)</code>. We shall use the <code class="highlighter-rouge">lam-equiv</code> equation to reduce this question to
whether <code class="highlighter-rouge">ℱ</code> is a congruence.</p>

<pre class="Agda"><a id="ℱ-cong"></a><a id="10829" href="/PLFA-zh/Compositional/#10829" class="Function">ℱ-cong</a> <a id="10836" class="Symbol">:</a> <a id="10838" class="Symbol">∀{</a><a id="10840" href="plfa.Compositional.html#10840" class="Bound">Γ</a><a id="10841" class="Symbol">}{</a><a id="10843" href="plfa.Compositional.html#10843" class="Bound">D</a> <a id="10845" href="plfa.Compositional.html#10845" class="Bound">D′</a> <a id="10848" class="Symbol">:</a> <a id="10850" href="/PLFA-zh/Denotational/#17214" class="Function">Denotation</a> <a id="10861" class="Symbol">(</a><a id="10862" href="plfa.Compositional.html#10840" class="Bound">Γ</a> <a id="10864" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="10866" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="10867" class="Symbol">)}</a>
       <a id="10877" class="Symbol">→</a> <a id="10879" href="/PLFA-zh/Compositional/#10843" class="Bound">D</a> <a id="10881" href="/PLFA-zh/Denotational/#17609" class="Function Operator">≃</a> <a id="10883" href="plfa.Compositional.html#10845" class="Bound">D′</a>
         <a id="10895" class="Comment">-----------</a>
       <a id="10914" class="Symbol">→</a> <a id="10916" href="/PLFA-zh/Compositional/#1852" class="Function">ℱ</a> <a id="10918" href="plfa.Compositional.html#10843" class="Bound">D</a> <a id="10920" href="/PLFA-zh/Denotational/#17609" class="Function Operator">≃</a> <a id="10922" href="plfa.Compositional.html#1852" class="Function">ℱ</a> <a id="10924" href="plfa.Compositional.html#10845" class="Bound">D′</a>
<a id="10927" href="/PLFA-zh/Compositional/#10829" class="Function">ℱ-cong</a><a id="10933" class="Symbol">{</a><a id="10934" href="plfa.Compositional.html#10934" class="Bound">Γ</a><a id="10935" class="Symbol">}</a> <a id="10937" href="plfa.Compositional.html#10937" class="Bound">D≃D′</a> <a id="10942" href="plfa.Compositional.html#10942" class="Bound">γ</a> <a id="10944" href="plfa.Compositional.html#10944" class="Bound">v</a> <a id="10946" class="Symbol">=</a>
   <a id="10951" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="10953" class="Symbol">(λ</a> <a id="10956" href="/PLFA-zh/Compositional/#10956" class="Bound">x</a> <a id="10958" class="Symbol">→</a> <a id="10960" href="plfa.Compositional.html#11025" class="Function">ℱ≃</a><a id="10962" class="Symbol">{</a><a id="10963" href="plfa.Compositional.html#10942" class="Bound">γ</a><a id="10964" class="Symbol">}{</a><a id="10966" href="plfa.Compositional.html#10944" class="Bound">v</a><a id="10967" class="Symbol">}</a> <a id="10969" href="plfa.Compositional.html#10956" class="Bound">x</a> <a id="10971" href="plfa.Compositional.html#10937" class="Bound">D≃D′</a><a id="10975" class="Symbol">)</a> <a id="10977" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="10979" class="Symbol">(λ</a> <a id="10982" href="plfa.Compositional.html#10982" class="Bound">x</a> <a id="10984" class="Symbol">→</a> <a id="10986" href="plfa.Compositional.html#11025" class="Function">ℱ≃</a><a id="10988" class="Symbol">{</a><a id="10989" href="plfa.Compositional.html#10942" class="Bound">γ</a><a id="10990" class="Symbol">}{</a><a id="10992" href="plfa.Compositional.html#10944" class="Bound">v</a><a id="10993" class="Symbol">}</a> <a id="10995" href="plfa.Compositional.html#10982" class="Bound">x</a> <a id="10997" class="Symbol">(</a><a id="10998" href="/PLFA-zh/Denotational/#17881" class="Function">≃-sym</a> <a id="11004" href="plfa.Compositional.html#10937" class="Bound">D≃D′</a><a id="11008" class="Symbol">))</a> <a id="11011" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
   <a id="11016" class="Keyword">where</a>
   <a id="11025" href="/PLFA-zh/Compositional/#11025" class="Function">ℱ≃</a> <a id="11028" class="Symbol">:</a> <a id="11030" class="Symbol">∀{</a><a id="11032" href="plfa.Compositional.html#11032" class="Bound">γ</a> <a id="11034" class="Symbol">:</a> <a id="11036" href="/PLFA-zh/Denotational/#7100" class="Function">Env</a> <a id="11040" href="plfa.Compositional.html#10934" class="Bound">Γ</a><a id="11041" class="Symbol">}{</a><a id="11043" href="plfa.Compositional.html#11043" class="Bound">v</a><a id="11044" class="Symbol">}{</a><a id="11046" href="plfa.Compositional.html#11046" class="Bound">D</a> <a id="11048" href="plfa.Compositional.html#11048" class="Bound">D′</a> <a id="11051" class="Symbol">:</a> <a id="11053" href="plfa.Denotational.html#17214" class="Function">Denotation</a> <a id="11064" class="Symbol">(</a><a id="11065" href="plfa.Compositional.html#10934" class="Bound">Γ</a> <a id="11067" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="11069" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="11070" class="Symbol">)}</a>
      <a id="11079" class="Symbol">→</a> <a id="11081" href="/PLFA-zh/Compositional/#1852" class="Function">ℱ</a> <a id="11083" href="plfa.Compositional.html#11046" class="Bound">D</a> <a id="11085" href="plfa.Compositional.html#11032" class="Bound">γ</a> <a id="11087" href="plfa.Compositional.html#11043" class="Bound">v</a>  <a id="11090" class="Symbol">→</a>  <a id="11093" href="plfa.Compositional.html#11046" class="Bound">D</a> <a id="11095" href="/PLFA-zh/Denotational/#17609" class="Function Operator">≃</a> <a id="11097" href="plfa.Compositional.html#11048" class="Bound">D′</a> <a id="11100" class="Symbol">→</a> <a id="11102" href="plfa.Compositional.html#1852" class="Function">ℱ</a> <a id="11104" href="plfa.Compositional.html#11048" class="Bound">D′</a> <a id="11107" href="plfa.Compositional.html#11032" class="Bound">γ</a> <a id="11109" href="plfa.Compositional.html#11043" class="Bound">v</a>
   <a id="11114" href="/PLFA-zh/Compositional/#11025" class="Function">ℱ≃</a> <a id="11117" class="Symbol">{</a><a id="11118" class="Argument">v</a> <a id="11120" class="Symbol">=</a> <a id="11122" href="/PLFA-zh/Denotational/#3982" class="InductiveConstructor">⊥</a><a id="11123" class="Symbol">}</a> <a id="11125" href="plfa.Compositional.html#11125" class="Bound">fd</a> <a id="11128" href="plfa.Compositional.html#11128" class="Bound">dd′</a> <a id="11132" class="Symbol">=</a> <a id="11134" href="Agda.Builtin.Unit.html#174" class="InductiveConstructor">tt</a>
   <a id="11140" href="/PLFA-zh/Compositional/#11025" class="Function">ℱ≃</a> <a id="11143" class="Symbol">{</a><a id="11144" href="plfa.Compositional.html#11144" class="Bound">γ</a><a id="11145" class="Symbol">}{</a><a id="11147" href="plfa.Compositional.html#11147" class="Bound">v</a> <a id="11149" href="/PLFA-zh/Denotational/#3994" class="InductiveConstructor Operator">↦</a> <a id="11151" href="plfa.Compositional.html#11151" class="Bound">w</a><a id="11152" class="Symbol">}</a> <a id="11154" href="plfa.Compositional.html#11154" class="Bound">fd</a> <a id="11157" href="plfa.Compositional.html#11157" class="Bound">dd′</a> <a id="11161" class="Symbol">=</a> <a id="11163" href="Agda.Builtin.Sigma.html#225" class="Field">proj₁</a> <a id="11169" class="Symbol">(</a><a id="11170" href="plfa.Compositional.html#11157" class="Bound">dd′</a> <a id="11174" class="Symbol">(</a><a id="11175" href="plfa.Compositional.html#11144" class="Bound">γ</a> <a id="11177" href="plfa.Denotational.html#7257" class="Function Operator">`,</a> <a id="11180" href="plfa.Compositional.html#11147" class="Bound">v</a><a id="11181" class="Symbol">)</a> <a id="11183" href="plfa.Compositional.html#11151" class="Bound">w</a><a id="11184" class="Symbol">)</a> <a id="11186" href="plfa.Compositional.html#11154" class="Bound">fd</a>
   <a id="11192" href="/PLFA-zh/Compositional/#11025" class="Function">ℱ≃</a> <a id="11195" class="Symbol">{</a><a id="11196" href="plfa.Compositional.html#11196" class="Bound">γ</a><a id="11197" class="Symbol">}{</a><a id="11199" href="plfa.Compositional.html#11199" class="Bound">u</a> <a id="11201" href="/PLFA-zh/Denotational/#4024" class="InductiveConstructor Operator">⊔</a> <a id="11203" href="plfa.Compositional.html#11203" class="Bound">w</a><a id="11204" class="Symbol">}</a> <a id="11206" href="plfa.Compositional.html#11206" class="Bound">fd</a> <a id="11209" href="plfa.Compositional.html#11209" class="Bound">dd′</a> <a id="11213" class="Symbol">=</a> <a id="11215" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="11217" href="plfa.Compositional.html#11025" class="Function">ℱ≃</a><a id="11219" class="Symbol">{</a><a id="11220" href="plfa.Compositional.html#11196" class="Bound">γ</a><a id="11221" class="Symbol">}{</a><a id="11223" href="plfa.Compositional.html#11199" class="Bound">u</a><a id="11224" class="Symbol">}</a> <a id="11226" class="Symbol">(</a><a id="11227" href="Agda.Builtin.Sigma.html#225" class="Field">proj₁</a> <a id="11233" href="plfa.Compositional.html#11206" class="Bound">fd</a><a id="11235" class="Symbol">)</a> <a id="11237" href="plfa.Compositional.html#11209" class="Bound">dd′</a> <a id="11241" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="11243" href="plfa.Compositional.html#11025" class="Function">ℱ≃</a><a id="11245" class="Symbol">{</a><a id="11246" href="plfa.Compositional.html#11196" class="Bound">γ</a><a id="11247" class="Symbol">}{</a><a id="11249" href="plfa.Compositional.html#11203" class="Bound">w</a><a id="11250" class="Symbol">}</a> <a id="11252" class="Symbol">(</a><a id="11253" href="Agda.Builtin.Sigma.html#237" class="Field">proj₂</a> <a id="11259" href="plfa.Compositional.html#11206" class="Bound">fd</a><a id="11261" class="Symbol">)</a> <a id="11263" href="plfa.Compositional.html#11209" class="Bound">dd′</a> <a id="11267" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>The proof of <code class="highlighter-rouge">ℱ-cong</code> uses the lemma <code class="highlighter-rouge">ℱ≃</code> to handle both directions of
the if-and-only-if. That lemma is proved by a straightforward
induction on the value <code class="highlighter-rouge">v</code>.</p>

<p>We now prove that lambda abstraction is a congruence by direct
equational reasoning.</p>

<pre class="Agda"><a id="lam-cong"></a><a id="11526" href="/PLFA-zh/Compositional/#11526" class="Function">lam-cong</a> <a id="11535" class="Symbol">:</a> <a id="11537" class="Symbol">∀{</a><a id="11539" href="plfa.Compositional.html#11539" class="Bound">Γ</a><a id="11540" class="Symbol">}{</a><a id="11542" href="plfa.Compositional.html#11542" class="Bound">N</a> <a id="11544" href="plfa.Compositional.html#11544" class="Bound">N′</a> <a id="11547" class="Symbol">:</a> <a id="11549" href="plfa.Compositional.html#11539" class="Bound">Γ</a> <a id="11551" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="11553" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="11555" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="11557" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="11558" class="Symbol">}</a>
         <a id="11569" class="Symbol">→</a> <a id="11571" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="11573" href="/PLFA-zh/Compositional/#11542" class="Bound">N</a> <a id="11575" href="plfa.Denotational.html#17609" class="Function Operator">≃</a> <a id="11577" href="plfa.Denotational.html#17427" class="Function">ℰ</a> <a id="11579" href="plfa.Compositional.html#11544" class="Bound">N′</a>
           <a id="11593" class="Comment">-----------------</a>
         <a id="11620" class="Symbol">→</a> <a id="11622" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="11624" class="Symbol">(</a><a id="11625" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11627" href="/PLFA-zh/Compositional/#11542" class="Bound">N</a><a id="11628" class="Symbol">)</a> <a id="11630" href="plfa.Denotational.html#17609" class="Function Operator">≃</a> <a id="11632" href="plfa.Denotational.html#17427" class="Function">ℰ</a> <a id="11634" class="Symbol">(</a><a id="11635" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11637" href="plfa.Compositional.html#11544" class="Bound">N′</a><a id="11639" class="Symbol">)</a>
<a id="11641" href="/PLFA-zh/Compositional/#11526" class="Function">lam-cong</a> <a id="11650" class="Symbol">{</a><a id="11651" href="plfa.Compositional.html#11651" class="Bound">Γ</a><a id="11652" class="Symbol">}{</a><a id="11654" href="plfa.Compositional.html#11654" class="Bound">N</a><a id="11655" class="Symbol">}{</a><a id="11657" href="plfa.Compositional.html#11657" class="Bound">N′</a><a id="11659" class="Symbol">}</a> <a id="11661" href="plfa.Compositional.html#11661" class="Bound">N≃N′</a> <a id="11666" class="Symbol">=</a>
  <a id="11670" href="/PLFA-zh/Denotational/#18545" class="Function Operator">start</a>
  <a id="11678" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="11680" class="Symbol">(</a><a id="11681" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11683" href="/PLFA-zh/Compositional/#11654" class="Bound">N</a><a id="11684" class="Symbol">)</a>
  <a id="11688" href="/PLFA-zh/Denotational/#18743" class="Function Operator">≃⟨</a> <a id="11691" href="/PLFA-zh/Compositional/#4295" class="Function">lam-equiv</a> <a id="11701" href="plfa.Denotational.html#18743" class="Function Operator">⟩</a>
  <a id="11705" href="/PLFA-zh/Compositional/#1852" class="Function">ℱ</a> <a id="11707" class="Symbol">(</a><a id="11708" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="11710" href="plfa.Compositional.html#11654" class="Bound">N</a><a id="11711" class="Symbol">)</a>
  <a id="11715" href="/PLFA-zh/Denotational/#18743" class="Function Operator">≃⟨</a> <a id="11718" href="/PLFA-zh/Compositional/#10829" class="Function">ℱ-cong</a> <a id="11725" href="plfa.Compositional.html#11661" class="Bound">N≃N′</a> <a id="11730" href="plfa.Denotational.html#18743" class="Function Operator">⟩</a>
  <a id="11734" href="/PLFA-zh/Compositional/#1852" class="Function">ℱ</a> <a id="11736" class="Symbol">(</a><a id="11737" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="11739" href="plfa.Compositional.html#11657" class="Bound">N′</a><a id="11741" class="Symbol">)</a>
  <a id="11745" href="/PLFA-zh/Denotational/#18743" class="Function Operator">≃⟨</a> <a id="11748" href="plfa.Denotational.html#17881" class="Function">≃-sym</a> <a id="11754" href="/PLFA-zh/Compositional/#4295" class="Function">lam-equiv</a> <a id="11764" href="plfa.Denotational.html#18743" class="Function Operator">⟩</a>
  <a id="11768" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="11770" class="Symbol">(</a><a id="11771" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11773" href="/PLFA-zh/Compositional/#11657" class="Bound">N′</a><a id="11775" class="Symbol">)</a>
  <a id="11779" href="/PLFA-zh/Denotational/#18883" class="Function Operator">☐</a>
</pre>
<p>Next we prove that denotational equality is a congruence for
application: that <code class="highlighter-rouge">ℰ L ≃ ℰ L′</code> and <code class="highlighter-rouge">ℰ M ≃ ℰ M′</code> imply
<code class="highlighter-rouge">ℰ (L · M) ≃ ℰ (L′ · M′)</code>. The <code class="highlighter-rouge">app-equiv</code> equation
reduces this to the question of whether the <code class="highlighter-rouge">●</code> operator
is a congruence.</p>

<pre class="Agda"><a id="●-cong"></a><a id="12032" href="/PLFA-zh/Compositional/#12032" class="Function">●-cong</a> <a id="12039" class="Symbol">:</a> <a id="12041" class="Symbol">∀{</a><a id="12043" href="plfa.Compositional.html#12043" class="Bound">Γ</a><a id="12044" class="Symbol">}{</a><a id="12046" href="plfa.Compositional.html#12046" class="Bound">D₁</a> <a id="12049" href="plfa.Compositional.html#12049" class="Bound">D₁′</a> <a id="12053" href="plfa.Compositional.html#12053" class="Bound">D₂</a> <a id="12056" href="plfa.Compositional.html#12056" class="Bound">D₂′</a> <a id="12060" class="Symbol">:</a> <a id="12062" href="/PLFA-zh/Denotational/#17214" class="Function">Denotation</a> <a id="12073" href="plfa.Compositional.html#12043" class="Bound">Γ</a><a id="12074" class="Symbol">}</a>
   <a id="12079" class="Symbol">→</a> <a id="12081" href="/PLFA-zh/Compositional/#12046" class="Bound">D₁</a> <a id="12084" href="/PLFA-zh/Denotational/#17609" class="Function Operator">≃</a> <a id="12086" href="plfa.Compositional.html#12049" class="Bound">D₁′</a> <a id="12090" class="Symbol">→</a> <a id="12092" href="plfa.Compositional.html#12053" class="Bound">D₂</a> <a id="12095" href="plfa.Denotational.html#17609" class="Function Operator">≃</a> <a id="12097" href="plfa.Compositional.html#12056" class="Bound">D₂′</a>
   <a id="12104" class="Symbol">→</a> <a id="12106" class="Symbol">(</a><a id="12107" href="/PLFA-zh/Compositional/#12046" class="Bound">D₁</a> <a id="12110" href="plfa.Compositional.html#5495" class="Function Operator">●</a> <a id="12112" href="plfa.Compositional.html#12053" class="Bound">D₂</a><a id="12114" class="Symbol">)</a> <a id="12116" href="/PLFA-zh/Denotational/#17609" class="Function Operator">≃</a> <a id="12118" class="Symbol">(</a><a id="12119" href="plfa.Compositional.html#12049" class="Bound">D₁′</a> <a id="12123" href="plfa.Compositional.html#5495" class="Function Operator">●</a> <a id="12125" href="plfa.Compositional.html#12056" class="Bound">D₂′</a><a id="12128" class="Symbol">)</a>
<a id="12130" href="/PLFA-zh/Compositional/#12032" class="Function">●-cong</a> <a id="12137" class="Symbol">{</a><a id="12138" href="plfa.Compositional.html#12138" class="Bound">Γ</a><a id="12139" class="Symbol">}</a> <a id="12141" href="plfa.Compositional.html#12141" class="Bound">d1</a> <a id="12144" href="plfa.Compositional.html#12144" class="Bound">d2</a> <a id="12147" href="plfa.Compositional.html#12147" class="Bound">γ</a> <a id="12149" href="plfa.Compositional.html#12149" class="Bound">v</a> <a id="12151" class="Symbol">=</a> <a id="12153" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="12155" class="Symbol">(λ</a> <a id="12158" href="plfa.Compositional.html#12158" class="Bound">x</a> <a id="12160" class="Symbol">→</a> <a id="12162" href="plfa.Compositional.html#12250" class="Function">●≃</a> <a id="12165" href="plfa.Compositional.html#12158" class="Bound">x</a> <a id="12167" href="plfa.Compositional.html#12141" class="Bound">d1</a> <a id="12170" href="plfa.Compositional.html#12144" class="Bound">d2</a><a id="12172" class="Symbol">)</a> <a id="12174" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a>
                         <a id="12201" class="Symbol">(λ</a> <a id="12204" href="/PLFA-zh/Compositional/#12204" class="Bound">x</a> <a id="12206" class="Symbol">→</a> <a id="12208" href="plfa.Compositional.html#12250" class="Function">●≃</a> <a id="12211" href="plfa.Compositional.html#12204" class="Bound">x</a> <a id="12213" class="Symbol">(</a><a id="12214" href="/PLFA-zh/Denotational/#17881" class="Function">≃-sym</a> <a id="12220" href="plfa.Compositional.html#12141" class="Bound">d1</a><a id="12222" class="Symbol">)</a> <a id="12224" class="Symbol">(</a><a id="12225" href="plfa.Denotational.html#17881" class="Function">≃-sym</a> <a id="12231" href="plfa.Compositional.html#12144" class="Bound">d2</a><a id="12233" class="Symbol">))</a> <a id="12236" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
   <a id="12241" class="Keyword">where</a>
   <a id="12250" href="/PLFA-zh/Compositional/#12250" class="Function">●≃</a> <a id="12253" class="Symbol">:</a> <a id="12255" class="Symbol">∀{</a><a id="12257" href="plfa.Compositional.html#12257" class="Bound">γ</a> <a id="12259" class="Symbol">:</a> <a id="12261" href="/PLFA-zh/Denotational/#7100" class="Function">Env</a> <a id="12265" href="plfa.Compositional.html#12138" class="Bound">Γ</a><a id="12266" class="Symbol">}{</a><a id="12268" href="plfa.Compositional.html#12268" class="Bound">v</a><a id="12269" class="Symbol">}{</a><a id="12271" href="plfa.Compositional.html#12271" class="Bound">D₁</a> <a id="12274" href="plfa.Compositional.html#12274" class="Bound">D₁′</a> <a id="12278" href="plfa.Compositional.html#12278" class="Bound">D₂</a> <a id="12281" href="plfa.Compositional.html#12281" class="Bound">D₂′</a> <a id="12285" class="Symbol">:</a> <a id="12287" href="plfa.Denotational.html#17214" class="Function">Denotation</a> <a id="12298" href="plfa.Compositional.html#12138" class="Bound">Γ</a><a id="12299" class="Symbol">}</a>
      <a id="12307" class="Symbol">→</a> <a id="12309" class="Symbol">(</a><a id="12310" href="/PLFA-zh/Compositional/#12271" class="Bound">D₁</a> <a id="12313" href="plfa.Compositional.html#5495" class="Function Operator">●</a> <a id="12315" href="plfa.Compositional.html#12278" class="Bound">D₂</a><a id="12317" class="Symbol">)</a> <a id="12319" href="plfa.Compositional.html#12257" class="Bound">γ</a> <a id="12321" href="plfa.Compositional.html#12268" class="Bound">v</a>  <a id="12324" class="Symbol">→</a>  <a id="12327" href="plfa.Compositional.html#12271" class="Bound">D₁</a> <a id="12330" href="/PLFA-zh/Denotational/#17609" class="Function Operator">≃</a> <a id="12332" href="plfa.Compositional.html#12274" class="Bound">D₁′</a>  <a id="12337" class="Symbol">→</a>  <a id="12340" href="plfa.Compositional.html#12278" class="Bound">D₂</a> <a id="12343" href="plfa.Denotational.html#17609" class="Function Operator">≃</a> <a id="12345" href="plfa.Compositional.html#12281" class="Bound">D₂′</a>
      <a id="12355" class="Symbol">→</a> <a id="12357" class="Symbol">(</a><a id="12358" href="/PLFA-zh/Compositional/#12274" class="Bound">D₁′</a> <a id="12362" href="plfa.Compositional.html#5495" class="Function Operator">●</a> <a id="12364" href="plfa.Compositional.html#12281" class="Bound">D₂′</a><a id="12367" class="Symbol">)</a> <a id="12369" href="plfa.Compositional.html#12257" class="Bound">γ</a> <a id="12371" href="plfa.Compositional.html#12268" class="Bound">v</a>
   <a id="12376" href="/PLFA-zh/Compositional/#12250" class="Function">●≃</a> <a id="12379" class="Symbol">(</a><a id="12380" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#662" class="InductiveConstructor">inj₁</a> <a id="12385" href="plfa.Compositional.html#12385" class="Bound">v⊑⊥</a><a id="12388" class="Symbol">)</a> <a id="12390" href="plfa.Compositional.html#12390" class="Bound">eq₁</a> <a id="12394" href="plfa.Compositional.html#12394" class="Bound">eq₂</a> <a id="12398" class="Symbol">=</a> <a id="12400" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#662" class="InductiveConstructor">inj₁</a> <a id="12405" href="plfa.Compositional.html#12385" class="Bound">v⊑⊥</a>
   <a id="12412" href="/PLFA-zh/Compositional/#12250" class="Function">●≃</a> <a id="12415" class="Symbol">{</a><a id="12416" href="plfa.Compositional.html#12416" class="Bound">γ</a><a id="12417" class="Symbol">}</a> <a id="12419" class="Symbol">{</a><a id="12420" href="plfa.Compositional.html#12420" class="Bound">w</a><a id="12421" class="Symbol">}</a> <a id="12423" class="Symbol">(</a><a id="12424" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#687" class="InductiveConstructor">inj₂</a> <a id="12429" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="12431" href="plfa.Compositional.html#12431" class="Bound">v</a> <a id="12433" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="12435" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="12437" href="plfa.Compositional.html#12437" class="Bound">Dv↦w</a> <a id="12442" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="12444" href="plfa.Compositional.html#12444" class="Bound">Dv</a> <a id="12447" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="12449" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a><a id="12450" class="Symbol">)</a> <a id="12452" href="plfa.Compositional.html#12452" class="Bound">eq₁</a> <a id="12456" href="plfa.Compositional.html#12456" class="Bound">eq₂</a> <a id="12460" class="Symbol">=</a>
      <a id="12468" href="https://agda.github.io/agda-stdlib/v1.1/Data.Sum.Base.html#687" class="InductiveConstructor">inj₂</a> <a id="12473" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="12475" href="/PLFA-zh/Compositional/#12431" class="Bound">v</a> <a id="12477" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="12479" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="12481" href="Agda.Builtin.Sigma.html#225" class="Field">proj₁</a> <a id="12487" class="Symbol">(</a><a id="12488" href="plfa.Compositional.html#12452" class="Bound">eq₁</a> <a id="12492" href="plfa.Compositional.html#12416" class="Bound">γ</a> <a id="12494" class="Symbol">(</a><a id="12495" href="plfa.Compositional.html#12431" class="Bound">v</a> <a id="12497" href="/PLFA-zh/Denotational/#3994" class="InductiveConstructor Operator">↦</a> <a id="12499" href="plfa.Compositional.html#12420" class="Bound">w</a><a id="12500" class="Symbol">))</a> <a id="12503" href="plfa.Compositional.html#12437" class="Bound">Dv↦w</a> <a id="12508" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="12510" href="Agda.Builtin.Sigma.html#225" class="Field">proj₁</a> <a id="12516" class="Symbol">(</a><a id="12517" href="plfa.Compositional.html#12456" class="Bound">eq₂</a> <a id="12521" href="plfa.Compositional.html#12416" class="Bound">γ</a> <a id="12523" href="plfa.Compositional.html#12431" class="Bound">v</a><a id="12524" class="Symbol">)</a> <a id="12526" href="plfa.Compositional.html#12444" class="Bound">Dv</a> <a id="12529" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="12531" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>Again, both directions of the if-and-only-if are proved via a lemma.
This time the lemma is proved by cases on <code class="highlighter-rouge">(D₁ ● D₂) γ v</code>.</p>

<p>With the congruence of <code class="highlighter-rouge">●</code>, we can prove that application is a
congruence by direct equational reasoning.</p>

<pre class="Agda"><a id="app-cong"></a><a id="12778" href="/PLFA-zh/Compositional/#12778" class="Function">app-cong</a> <a id="12787" class="Symbol">:</a> <a id="12789" class="Symbol">∀{</a><a id="12791" href="plfa.Compositional.html#12791" class="Bound">Γ</a><a id="12792" class="Symbol">}{</a><a id="12794" href="plfa.Compositional.html#12794" class="Bound">L</a> <a id="12796" href="plfa.Compositional.html#12796" class="Bound">L′</a> <a id="12799" href="plfa.Compositional.html#12799" class="Bound">M</a> <a id="12801" href="plfa.Compositional.html#12801" class="Bound">M′</a> <a id="12804" class="Symbol">:</a> <a id="12806" href="plfa.Compositional.html#12791" class="Bound">Γ</a> <a id="12808" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="12810" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="12811" class="Symbol">}</a>
         <a id="12822" class="Symbol">→</a> <a id="12824" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="12826" href="/PLFA-zh/Compositional/#12794" class="Bound">L</a> <a id="12828" href="plfa.Denotational.html#17609" class="Function Operator">≃</a> <a id="12830" href="plfa.Denotational.html#17427" class="Function">ℰ</a> <a id="12832" href="plfa.Compositional.html#12796" class="Bound">L′</a>
         <a id="12844" class="Symbol">→</a> <a id="12846" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="12848" href="/PLFA-zh/Compositional/#12799" class="Bound">M</a> <a id="12850" href="plfa.Denotational.html#17609" class="Function Operator">≃</a> <a id="12852" href="plfa.Denotational.html#17427" class="Function">ℰ</a> <a id="12854" href="plfa.Compositional.html#12801" class="Bound">M′</a>
           <a id="12868" class="Comment">-------------------------</a>
         <a id="12903" class="Symbol">→</a> <a id="12905" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="12907" class="Symbol">(</a><a id="12908" href="/PLFA-zh/Compositional/#12794" class="Bound">L</a> <a id="12910" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="12912" href="plfa.Compositional.html#12799" class="Bound">M</a><a id="12913" class="Symbol">)</a> <a id="12915" href="plfa.Denotational.html#17609" class="Function Operator">≃</a> <a id="12917" href="plfa.Denotational.html#17427" class="Function">ℰ</a> <a id="12919" class="Symbol">(</a><a id="12920" href="plfa.Compositional.html#12796" class="Bound">L′</a> <a id="12923" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="12925" href="plfa.Compositional.html#12801" class="Bound">M′</a><a id="12927" class="Symbol">)</a>
<a id="12929" href="/PLFA-zh/Compositional/#12778" class="Function">app-cong</a> <a id="12938" class="Symbol">{</a><a id="12939" href="plfa.Compositional.html#12939" class="Bound">Γ</a><a id="12940" class="Symbol">}{</a><a id="12942" href="plfa.Compositional.html#12942" class="Bound">L</a><a id="12943" class="Symbol">}{</a><a id="12945" href="plfa.Compositional.html#12945" class="Bound">L′</a><a id="12947" class="Symbol">}{</a><a id="12949" href="plfa.Compositional.html#12949" class="Bound">M</a><a id="12950" class="Symbol">}{</a><a id="12952" href="plfa.Compositional.html#12952" class="Bound">M′</a><a id="12954" class="Symbol">}</a> <a id="12956" href="plfa.Compositional.html#12956" class="Bound">L≅L′</a> <a id="12961" href="plfa.Compositional.html#12961" class="Bound">M≅M′</a> <a id="12966" class="Symbol">=</a>
  <a id="12970" href="/PLFA-zh/Denotational/#18545" class="Function Operator">start</a>
  <a id="12978" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="12980" class="Symbol">(</a><a id="12981" href="/PLFA-zh/Compositional/#12942" class="Bound">L</a> <a id="12983" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="12985" href="plfa.Compositional.html#12949" class="Bound">M</a><a id="12986" class="Symbol">)</a>
  <a id="12990" href="/PLFA-zh/Denotational/#18743" class="Function Operator">≃⟨</a> <a id="12993" href="/PLFA-zh/Compositional/#9415" class="Function">app-equiv</a> <a id="13003" href="plfa.Denotational.html#18743" class="Function Operator">⟩</a>
  <a id="13007" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="13009" href="/PLFA-zh/Compositional/#12942" class="Bound">L</a> <a id="13011" href="plfa.Compositional.html#5495" class="Function Operator">●</a> <a id="13013" href="plfa.Denotational.html#17427" class="Function">ℰ</a> <a id="13015" href="plfa.Compositional.html#12949" class="Bound">M</a>
  <a id="13019" href="/PLFA-zh/Denotational/#18743" class="Function Operator">≃⟨</a> <a id="13022" href="/PLFA-zh/Compositional/#12032" class="Function">●-cong</a> <a id="13029" href="plfa.Compositional.html#12956" class="Bound">L≅L′</a> <a id="13034" href="plfa.Compositional.html#12961" class="Bound">M≅M′</a> <a id="13039" href="plfa.Denotational.html#18743" class="Function Operator">⟩</a>
  <a id="13043" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="13045" href="/PLFA-zh/Compositional/#12945" class="Bound">L′</a> <a id="13048" href="plfa.Compositional.html#5495" class="Function Operator">●</a> <a id="13050" href="plfa.Denotational.html#17427" class="Function">ℰ</a> <a id="13052" href="plfa.Compositional.html#12952" class="Bound">M′</a>
  <a id="13057" href="/PLFA-zh/Denotational/#18743" class="Function Operator">≃⟨</a> <a id="13060" href="plfa.Denotational.html#17881" class="Function">≃-sym</a> <a id="13066" href="/PLFA-zh/Compositional/#9415" class="Function">app-equiv</a> <a id="13076" href="plfa.Denotational.html#18743" class="Function Operator">⟩</a>
  <a id="13080" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="13082" class="Symbol">(</a><a id="13083" href="/PLFA-zh/Compositional/#12945" class="Bound">L′</a> <a id="13086" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="13088" href="plfa.Compositional.html#12952" class="Bound">M′</a><a id="13090" class="Symbol">)</a>
  <a id="13094" href="/PLFA-zh/Denotational/#18883" class="Function Operator">☐</a>
</pre>

<h2 id="compositionality">Compositionality</h2>

<p>The <em>compositionality property</em> states that surrounding two terms that
are denotationally equal in the same context produces two programs
that are denotationally equal. To make this precise, we define what we
mean by “context” and “surround”.</p>

<p>A <em>context</em> is a program with one hole in it. The following data
definition <code class="highlighter-rouge">Ctx</code> makes this idea explicit. We index the <code class="highlighter-rouge">Ctx</code> data
type with two contexts for variables: one for the the hole and one for
terms that result from filling the hole.</p>

<pre class="Agda"><a id="13616" class="Keyword">data</a> <a id="Ctx"></a><a id="13621" href="/PLFA-zh/Compositional/#13621" class="Datatype">Ctx</a> <a id="13625" class="Symbol">:</a> <a id="13627" href="/PLFA-zh/Untyped/#3130" class="Datatype">Context</a> <a id="13635" class="Symbol">→</a> <a id="13637" href="plfa.Untyped.html#3130" class="Datatype">Context</a> <a id="13645" class="Symbol">→</a> <a id="13647" class="PrimitiveType">Set</a> <a id="13651" class="Keyword">where</a>
  <a id="Ctx.CHole"></a><a id="13659" href="/PLFA-zh/Compositional/#13659" class="InductiveConstructor">CHole</a> <a id="13665" class="Symbol">:</a> <a id="13667" class="Symbol">∀{</a><a id="13669" href="plfa.Compositional.html#13669" class="Bound">Γ</a><a id="13670" class="Symbol">}</a> <a id="13672" class="Symbol">→</a> <a id="13674" href="plfa.Compositional.html#13621" class="Datatype">Ctx</a> <a id="13678" href="plfa.Compositional.html#13669" class="Bound">Γ</a> <a id="13680" href="plfa.Compositional.html#13669" class="Bound">Γ</a>
  <a id="Ctx.CLam"></a><a id="13684" href="/PLFA-zh/Compositional/#13684" class="InductiveConstructor">CLam</a> <a id="13689" class="Symbol">:</a>  <a id="13692" class="Symbol">∀{</a><a id="13694" href="plfa.Compositional.html#13694" class="Bound">Γ</a> <a id="13696" href="plfa.Compositional.html#13696" class="Bound">Δ</a><a id="13697" class="Symbol">}</a> <a id="13699" class="Symbol">→</a> <a id="13701" href="plfa.Compositional.html#13621" class="Datatype">Ctx</a> <a id="13705" class="Symbol">(</a><a id="13706" href="plfa.Compositional.html#13694" class="Bound">Γ</a> <a id="13708" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="13710" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="13711" class="Symbol">)</a> <a id="13713" class="Symbol">(</a><a id="13714" href="plfa.Compositional.html#13696" class="Bound">Δ</a> <a id="13716" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="13718" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="13719" class="Symbol">)</a> <a id="13721" class="Symbol">→</a> <a id="13723" href="plfa.Compositional.html#13621" class="Datatype">Ctx</a> <a id="13727" class="Symbol">(</a><a id="13728" href="plfa.Compositional.html#13694" class="Bound">Γ</a> <a id="13730" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="13732" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="13733" class="Symbol">)</a> <a id="13735" href="plfa.Compositional.html#13696" class="Bound">Δ</a>
  <a id="Ctx.CAppL"></a><a id="13739" href="/PLFA-zh/Compositional/#13739" class="InductiveConstructor">CAppL</a> <a id="13745" class="Symbol">:</a> <a id="13747" class="Symbol">∀{</a><a id="13749" href="plfa.Compositional.html#13749" class="Bound">Γ</a> <a id="13751" href="plfa.Compositional.html#13751" class="Bound">Δ</a><a id="13752" class="Symbol">}</a> <a id="13754" class="Symbol">→</a> <a id="13756" href="plfa.Compositional.html#13621" class="Datatype">Ctx</a> <a id="13760" href="plfa.Compositional.html#13749" class="Bound">Γ</a> <a id="13762" href="plfa.Compositional.html#13751" class="Bound">Δ</a> <a id="13764" class="Symbol">→</a> <a id="13766" href="plfa.Compositional.html#13751" class="Bound">Δ</a> <a id="13768" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="13770" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="13772" class="Symbol">→</a> <a id="13774" href="plfa.Compositional.html#13621" class="Datatype">Ctx</a> <a id="13778" href="plfa.Compositional.html#13749" class="Bound">Γ</a> <a id="13780" href="plfa.Compositional.html#13751" class="Bound">Δ</a>
  <a id="Ctx.CAppR"></a><a id="13784" href="/PLFA-zh/Compositional/#13784" class="InductiveConstructor">CAppR</a> <a id="13790" class="Symbol">:</a> <a id="13792" class="Symbol">∀{</a><a id="13794" href="plfa.Compositional.html#13794" class="Bound">Γ</a> <a id="13796" href="plfa.Compositional.html#13796" class="Bound">Δ</a><a id="13797" class="Symbol">}</a> <a id="13799" class="Symbol">→</a> <a id="13801" href="plfa.Compositional.html#13796" class="Bound">Δ</a> <a id="13803" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="13805" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="13807" class="Symbol">→</a> <a id="13809" href="plfa.Compositional.html#13621" class="Datatype">Ctx</a> <a id="13813" href="plfa.Compositional.html#13794" class="Bound">Γ</a> <a id="13815" href="plfa.Compositional.html#13796" class="Bound">Δ</a> <a id="13817" class="Symbol">→</a> <a id="13819" href="plfa.Compositional.html#13621" class="Datatype">Ctx</a> <a id="13823" href="plfa.Compositional.html#13794" class="Bound">Γ</a> <a id="13825" href="plfa.Compositional.html#13796" class="Bound">Δ</a>
</pre>
<ul>
  <li>
    <p>The constructor <code class="highlighter-rouge">CHole</code> represents the hole, and in this case the
variable context for the hole is the same as the variable context
for the term that results from filling the hole.</p>
  </li>
  <li>
    <p>The constructor <code class="highlighter-rouge">CLam</code> takes a <code class="highlighter-rouge">Ctx</code> and produces a larger one that
adds a lambda abstraction at the top. The variable context of the
hole stays the same, whereas we remove one variable from the context
of the resulting term because it is bound by this lambda
abstraction.</p>
  </li>
  <li>
    <p>There are two constructions for application, <code class="highlighter-rouge">CAppL</code> and
<code class="highlighter-rouge">CAppR</code>. The <code class="highlighter-rouge">CAppL</code> is for when the hole is inside the left-hand
term (the operator) and the later is when the hole is inside the
right-hand term (the operand).</p>
  </li>
</ul>

<p>The action of surrounding a term with a context is defined by the
following <code class="highlighter-rouge">plug</code> function. It is defined by recursion on the context.</p>

<pre class="Agda"><a id="plug"></a><a id="14673" href="/PLFA-zh/Compositional/#14673" class="Function">plug</a> <a id="14678" class="Symbol">:</a> <a id="14680" class="Symbol">∀{</a><a id="14682" href="plfa.Compositional.html#14682" class="Bound">Γ</a><a id="14683" class="Symbol">}{</a><a id="14685" href="plfa.Compositional.html#14685" class="Bound">Δ</a><a id="14686" class="Symbol">}</a> <a id="14688" class="Symbol">→</a> <a id="14690" href="plfa.Compositional.html#13621" class="Datatype">Ctx</a> <a id="14694" href="plfa.Compositional.html#14682" class="Bound">Γ</a> <a id="14696" href="plfa.Compositional.html#14685" class="Bound">Δ</a> <a id="14698" class="Symbol">→</a> <a id="14700" href="plfa.Compositional.html#14682" class="Bound">Γ</a> <a id="14702" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="14704" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="14706" class="Symbol">→</a> <a id="14708" href="plfa.Compositional.html#14685" class="Bound">Δ</a> <a id="14710" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="14712" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a>
<a id="14714" href="/PLFA-zh/Compositional/#14673" class="Function">plug</a> <a id="14719" href="plfa.Compositional.html#13659" class="InductiveConstructor">CHole</a> <a id="14725" href="plfa.Compositional.html#14725" class="Bound">M</a> <a id="14727" class="Symbol">=</a> <a id="14729" href="plfa.Compositional.html#14725" class="Bound">M</a>
<a id="14731" href="/PLFA-zh/Compositional/#14673" class="Function">plug</a> <a id="14736" class="Symbol">(</a><a id="14737" href="plfa.Compositional.html#13684" class="InductiveConstructor">CLam</a> <a id="14742" href="plfa.Compositional.html#14742" class="Bound">C</a><a id="14743" class="Symbol">)</a> <a id="14745" href="plfa.Compositional.html#14745" class="Bound">N</a> <a id="14747" class="Symbol">=</a> <a id="14749" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="14751" href="plfa.Compositional.html#14673" class="Function">plug</a> <a id="14756" href="plfa.Compositional.html#14742" class="Bound">C</a> <a id="14758" href="plfa.Compositional.html#14745" class="Bound">N</a>
<a id="14760" href="/PLFA-zh/Compositional/#14673" class="Function">plug</a> <a id="14765" class="Symbol">(</a><a id="14766" href="plfa.Compositional.html#13739" class="InductiveConstructor">CAppL</a> <a id="14772" href="plfa.Compositional.html#14772" class="Bound">C</a> <a id="14774" href="plfa.Compositional.html#14774" class="Bound">N</a><a id="14775" class="Symbol">)</a> <a id="14777" href="plfa.Compositional.html#14777" class="Bound">L</a> <a id="14779" class="Symbol">=</a> <a id="14781" class="Symbol">(</a><a id="14782" href="plfa.Compositional.html#14673" class="Function">plug</a> <a id="14787" href="plfa.Compositional.html#14772" class="Bound">C</a> <a id="14789" href="plfa.Compositional.html#14777" class="Bound">L</a><a id="14790" class="Symbol">)</a> <a id="14792" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="14794" href="plfa.Compositional.html#14774" class="Bound">N</a>
<a id="14796" href="/PLFA-zh/Compositional/#14673" class="Function">plug</a> <a id="14801" class="Symbol">(</a><a id="14802" href="plfa.Compositional.html#13784" class="InductiveConstructor">CAppR</a> <a id="14808" href="plfa.Compositional.html#14808" class="Bound">L</a> <a id="14810" href="plfa.Compositional.html#14810" class="Bound">C</a><a id="14811" class="Symbol">)</a> <a id="14813" href="plfa.Compositional.html#14813" class="Bound">M</a> <a id="14815" class="Symbol">=</a> <a id="14817" href="plfa.Compositional.html#14808" class="Bound">L</a> <a id="14819" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="14821" class="Symbol">(</a><a id="14822" href="plfa.Compositional.html#14673" class="Function">plug</a> <a id="14827" href="plfa.Compositional.html#14810" class="Bound">C</a> <a id="14829" href="plfa.Compositional.html#14813" class="Bound">M</a><a id="14830" class="Symbol">)</a>
</pre>
<p>We are ready to state and prove the compositionality principle.  Given
two terms <code class="highlighter-rouge">M</code> and <code class="highlighter-rouge">N</code> that are denotationally equal, plugging them both
into an arbitrary context <code class="highlighter-rouge">C</code> produces two programs that are
denotationally equal.</p>

<pre class="Agda"><a id="compositionality"></a><a id="15068" href="/PLFA-zh/Compositional/#15068" class="Function">compositionality</a> <a id="15085" class="Symbol">:</a> <a id="15087" class="Symbol">∀{</a><a id="15089" href="plfa.Compositional.html#15089" class="Bound">Γ</a> <a id="15091" href="plfa.Compositional.html#15091" class="Bound">Δ</a><a id="15092" class="Symbol">}{</a><a id="15094" href="plfa.Compositional.html#15094" class="Bound">C</a> <a id="15096" class="Symbol">:</a> <a id="15098" href="plfa.Compositional.html#13621" class="Datatype">Ctx</a> <a id="15102" href="plfa.Compositional.html#15089" class="Bound">Γ</a> <a id="15104" href="plfa.Compositional.html#15091" class="Bound">Δ</a><a id="15105" class="Symbol">}</a> <a id="15107" class="Symbol">{</a><a id="15108" href="plfa.Compositional.html#15108" class="Bound">M</a> <a id="15110" href="plfa.Compositional.html#15110" class="Bound">N</a> <a id="15112" class="Symbol">:</a> <a id="15114" href="plfa.Compositional.html#15089" class="Bound">Γ</a> <a id="15116" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="15118" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="15119" class="Symbol">}</a>
              <a id="15135" class="Symbol">→</a> <a id="15137" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="15139" href="/PLFA-zh/Compositional/#15108" class="Bound">M</a> <a id="15141" href="plfa.Denotational.html#17609" class="Function Operator">≃</a> <a id="15143" href="plfa.Denotational.html#17427" class="Function">ℰ</a> <a id="15145" href="plfa.Compositional.html#15110" class="Bound">N</a>
                <a id="15163" class="Comment">---------------------------</a>
              <a id="15205" class="Symbol">→</a> <a id="15207" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="15209" class="Symbol">(</a><a id="15210" href="/PLFA-zh/Compositional/#14673" class="Function">plug</a> <a id="15215" href="plfa.Compositional.html#15094" class="Bound">C</a> <a id="15217" href="plfa.Compositional.html#15108" class="Bound">M</a><a id="15218" class="Symbol">)</a> <a id="15220" href="plfa.Denotational.html#17609" class="Function Operator">≃</a> <a id="15222" href="plfa.Denotational.html#17427" class="Function">ℰ</a> <a id="15224" class="Symbol">(</a><a id="15225" href="plfa.Compositional.html#14673" class="Function">plug</a> <a id="15230" href="plfa.Compositional.html#15094" class="Bound">C</a> <a id="15232" href="plfa.Compositional.html#15110" class="Bound">N</a><a id="15233" class="Symbol">)</a>
<a id="15235" href="/PLFA-zh/Compositional/#15068" class="Function">compositionality</a> <a id="15252" class="Symbol">{</a><a id="15253" class="Argument">C</a> <a id="15255" class="Symbol">=</a> <a id="15257" href="plfa.Compositional.html#13659" class="InductiveConstructor">CHole</a><a id="15262" class="Symbol">}</a> <a id="15264" href="plfa.Compositional.html#15264" class="Bound">M≃N</a> <a id="15268" class="Symbol">=</a>
  <a id="15272" href="/PLFA-zh/Compositional/#15264" class="Bound">M≃N</a>
<a id="15276" href="/PLFA-zh/Compositional/#15068" class="Function">compositionality</a> <a id="15293" class="Symbol">{</a><a id="15294" class="Argument">C</a> <a id="15296" class="Symbol">=</a> <a id="15298" href="plfa.Compositional.html#13684" class="InductiveConstructor">CLam</a> <a id="15303" href="plfa.Compositional.html#15303" class="Bound">C′</a><a id="15305" class="Symbol">}</a> <a id="15307" href="plfa.Compositional.html#15307" class="Bound">M≃N</a> <a id="15311" class="Symbol">=</a>
  <a id="15315" href="/PLFA-zh/Compositional/#11526" class="Function">lam-cong</a> <a id="15324" class="Symbol">(</a><a id="15325" href="plfa.Compositional.html#15068" class="Function">compositionality</a> <a id="15342" class="Symbol">{</a><a id="15343" class="Argument">C</a> <a id="15345" class="Symbol">=</a> <a id="15347" href="plfa.Compositional.html#15303" class="Bound">C′</a><a id="15349" class="Symbol">}</a> <a id="15351" href="plfa.Compositional.html#15307" class="Bound">M≃N</a><a id="15354" class="Symbol">)</a>
<a id="15356" href="/PLFA-zh/Compositional/#15068" class="Function">compositionality</a> <a id="15373" class="Symbol">{</a><a id="15374" class="Argument">C</a> <a id="15376" class="Symbol">=</a> <a id="15378" href="plfa.Compositional.html#13739" class="InductiveConstructor">CAppL</a> <a id="15384" href="plfa.Compositional.html#15384" class="Bound">C′</a> <a id="15387" href="plfa.Compositional.html#15387" class="Bound">L</a><a id="15388" class="Symbol">}</a> <a id="15390" href="plfa.Compositional.html#15390" class="Bound">M≃N</a> <a id="15394" class="Symbol">=</a>
  <a id="15398" href="/PLFA-zh/Compositional/#12778" class="Function">app-cong</a> <a id="15407" class="Symbol">(</a><a id="15408" href="plfa.Compositional.html#15068" class="Function">compositionality</a> <a id="15425" class="Symbol">{</a><a id="15426" class="Argument">C</a> <a id="15428" class="Symbol">=</a> <a id="15430" href="plfa.Compositional.html#15384" class="Bound">C′</a><a id="15432" class="Symbol">}</a> <a id="15434" href="plfa.Compositional.html#15390" class="Bound">M≃N</a><a id="15437" class="Symbol">)</a> <a id="15439" class="Symbol">λ</a> <a id="15441" href="plfa.Compositional.html#15441" class="Bound">γ</a> <a id="15443" href="plfa.Compositional.html#15443" class="Bound">v</a> <a id="15445" class="Symbol">→</a> <a id="15447" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="15449" class="Symbol">(λ</a> <a id="15452" href="plfa.Compositional.html#15452" class="Bound">x</a> <a id="15454" class="Symbol">→</a> <a id="15456" href="plfa.Compositional.html#15452" class="Bound">x</a><a id="15457" class="Symbol">)</a> <a id="15459" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="15461" class="Symbol">(λ</a> <a id="15464" href="plfa.Compositional.html#15464" class="Bound">x</a> <a id="15466" class="Symbol">→</a> <a id="15468" href="plfa.Compositional.html#15464" class="Bound">x</a><a id="15469" class="Symbol">)</a> <a id="15471" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="15473" href="/PLFA-zh/Compositional/#15068" class="Function">compositionality</a> <a id="15490" class="Symbol">{</a><a id="15491" class="Argument">C</a> <a id="15493" class="Symbol">=</a> <a id="15495" href="plfa.Compositional.html#13784" class="InductiveConstructor">CAppR</a> <a id="15501" href="plfa.Compositional.html#15501" class="Bound">L</a> <a id="15503" href="plfa.Compositional.html#15503" class="Bound">C′</a><a id="15505" class="Symbol">}</a> <a id="15507" href="plfa.Compositional.html#15507" class="Bound">M≃N</a> <a id="15511" class="Symbol">=</a>
  <a id="15515" href="/PLFA-zh/Compositional/#12778" class="Function">app-cong</a> <a id="15524" class="Symbol">(λ</a> <a id="15527" href="plfa.Compositional.html#15527" class="Bound">γ</a> <a id="15529" href="plfa.Compositional.html#15529" class="Bound">v</a> <a id="15531" class="Symbol">→</a> <a id="15533" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="15535" class="Symbol">(λ</a> <a id="15538" href="plfa.Compositional.html#15538" class="Bound">x</a> <a id="15540" class="Symbol">→</a> <a id="15542" href="plfa.Compositional.html#15538" class="Bound">x</a><a id="15543" class="Symbol">)</a> <a id="15545" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="15547" class="Symbol">(λ</a> <a id="15550" href="plfa.Compositional.html#15550" class="Bound">x</a> <a id="15552" class="Symbol">→</a> <a id="15554" href="plfa.Compositional.html#15550" class="Bound">x</a><a id="15555" class="Symbol">)</a> <a id="15557" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a><a id="15558" class="Symbol">)</a> <a id="15560" class="Symbol">(</a><a id="15561" href="plfa.Compositional.html#15068" class="Function">compositionality</a> <a id="15578" class="Symbol">{</a><a id="15579" class="Argument">C</a> <a id="15581" class="Symbol">=</a> <a id="15583" href="plfa.Compositional.html#15503" class="Bound">C′</a><a id="15585" class="Symbol">}</a> <a id="15587" href="plfa.Compositional.html#15507" class="Bound">M≃N</a><a id="15590" class="Symbol">)</a>
</pre>
<p>The proof is a straightforward induction on the context <code class="highlighter-rouge">C</code>, using the
congruence properties <code class="highlighter-rouge">lam-cong</code> and <code class="highlighter-rouge">app-cong</code> that we established
above.</p>

<h2 id="the-denotational-semantics-defined-as-a-function">The denotational semantics defined as a function</h2>

<p>Having established the three equations <code class="highlighter-rouge">var-equiv</code>, <code class="highlighter-rouge">lam-equiv</code>, and
<code class="highlighter-rouge">app-equiv</code>, one should be able to define the denotational semantics
as a recursive function over the input term <code class="highlighter-rouge">M</code>. Indeed, we define the
following function <code class="highlighter-rouge">⟦ M ⟧</code> that maps terms to denotations, using the
auxiliary curry <code class="highlighter-rouge">ℱ</code> and apply <code class="highlighter-rouge">●</code> functions in the cases for lambda
and application, respectively.</p>

<pre class="Agda"><a id="⟦_⟧"></a><a id="16179" href="/PLFA-zh/Compositional/#16179" class="Function Operator">⟦_⟧</a> <a id="16183" class="Symbol">:</a> <a id="16185" class="Symbol">∀{</a><a id="16187" href="plfa.Compositional.html#16187" class="Bound">Γ</a><a id="16188" class="Symbol">}</a> <a id="16190" class="Symbol">→</a> <a id="16192" class="Symbol">(</a><a id="16193" href="plfa.Compositional.html#16193" class="Bound">M</a> <a id="16195" class="Symbol">:</a> <a id="16197" href="plfa.Compositional.html#16187" class="Bound">Γ</a> <a id="16199" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="16201" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="16202" class="Symbol">)</a> <a id="16204" class="Symbol">→</a> <a id="16206" href="/PLFA-zh/Denotational/#17214" class="Function">Denotation</a> <a id="16217" href="plfa.Compositional.html#16187" class="Bound">Γ</a>
<a id="16219" href="/PLFA-zh/Compositional/#16179" class="Function Operator">⟦</a> <a id="16221" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="16223" href="plfa.Compositional.html#16223" class="Bound">x</a> <a id="16225" href="plfa.Compositional.html#16179" class="Function Operator">⟧</a> <a id="16227" href="plfa.Compositional.html#16227" class="Bound">γ</a> <a id="16229" href="plfa.Compositional.html#16229" class="Bound">v</a> <a id="16231" class="Symbol">=</a> <a id="16233" href="plfa.Compositional.html#16229" class="Bound">v</a> <a id="16235" href="/PLFA-zh/Denotational/#4317" class="Datatype Operator">⊑</a> <a id="16237" href="plfa.Compositional.html#16227" class="Bound">γ</a> <a id="16239" href="plfa.Compositional.html#16223" class="Bound">x</a>
<a id="16241" href="/PLFA-zh/Compositional/#16179" class="Function Operator">⟦</a> <a id="16243" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16245" href="plfa.Compositional.html#16245" class="Bound">N</a> <a id="16247" href="plfa.Compositional.html#16179" class="Function Operator">⟧</a> <a id="16249" class="Symbol">=</a> <a id="16251" href="plfa.Compositional.html#1852" class="Function">ℱ</a> <a id="16253" href="plfa.Compositional.html#16179" class="Function Operator">⟦</a> <a id="16255" href="plfa.Compositional.html#16245" class="Bound">N</a> <a id="16257" href="plfa.Compositional.html#16179" class="Function Operator">⟧</a>
<a id="16259" href="/PLFA-zh/Compositional/#16179" class="Function Operator">⟦</a> <a id="16261" href="plfa.Compositional.html#16261" class="Bound">L</a> <a id="16263" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="16265" href="plfa.Compositional.html#16265" class="Bound">M</a> <a id="16267" href="plfa.Compositional.html#16179" class="Function Operator">⟧</a> <a id="16269" class="Symbol">=</a> <a id="16271" href="plfa.Compositional.html#16179" class="Function Operator">⟦</a> <a id="16273" href="plfa.Compositional.html#16261" class="Bound">L</a> <a id="16275" href="plfa.Compositional.html#16179" class="Function Operator">⟧</a> <a id="16277" href="plfa.Compositional.html#5495" class="Function Operator">●</a> <a id="16279" href="plfa.Compositional.html#16179" class="Function Operator">⟦</a> <a id="16281" href="plfa.Compositional.html#16265" class="Bound">M</a> <a id="16283" href="plfa.Compositional.html#16179" class="Function Operator">⟧</a>
</pre>
<p>The proof that <code class="highlighter-rouge">ℰ M</code> is denotationally equal to <code class="highlighter-rouge">⟦ M ⟧</code> is a
straightforward induction, using the three equations
<code class="highlighter-rouge">var-equiv</code>, <code class="highlighter-rouge">lam-equiv</code>, and <code class="highlighter-rouge">app-equiv</code> together
with the congruence lemmas for <code class="highlighter-rouge">ℱ</code> and <code class="highlighter-rouge">●</code>.</p>

<pre class="Agda"><a id="ℰ≃⟦⟧"></a><a id="16504" href="/PLFA-zh/Compositional/#16504" class="Function">ℰ≃⟦⟧</a> <a id="16509" class="Symbol">:</a> <a id="16511" class="Symbol">∀</a> <a id="16513" class="Symbol">{</a><a id="16514" href="plfa.Compositional.html#16514" class="Bound">Γ</a><a id="16515" class="Symbol">}</a> <a id="16517" class="Symbol">{</a><a id="16518" href="plfa.Compositional.html#16518" class="Bound">M</a> <a id="16520" class="Symbol">:</a> <a id="16522" href="plfa.Compositional.html#16514" class="Bound">Γ</a> <a id="16524" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="16526" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="16527" class="Symbol">}</a>
    <a id="16533" class="Symbol">→</a> <a id="16535" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="16537" href="/PLFA-zh/Compositional/#16518" class="Bound">M</a> <a id="16539" href="plfa.Denotational.html#17609" class="Function Operator">≃</a> <a id="16541" href="plfa.Compositional.html#16179" class="Function Operator">⟦</a> <a id="16543" href="plfa.Compositional.html#16518" class="Bound">M</a> <a id="16545" href="plfa.Compositional.html#16179" class="Function Operator">⟧</a>
<a id="16547" href="/PLFA-zh/Compositional/#16504" class="Function">ℰ≃⟦⟧</a> <a id="16552" class="Symbol">{</a><a id="16553" href="plfa.Compositional.html#16553" class="Bound">Γ</a><a id="16554" class="Symbol">}</a> <a id="16556" class="Symbol">{</a><a id="16557" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="16559" href="plfa.Compositional.html#16559" class="Bound">x</a><a id="16560" class="Symbol">}</a> <a id="16562" class="Symbol">=</a> <a id="16564" href="plfa.Compositional.html#9989" class="Function">var-equiv</a>
<a id="16574" href="/PLFA-zh/Compositional/#16504" class="Function">ℰ≃⟦⟧</a> <a id="16579" class="Symbol">{</a><a id="16580" href="plfa.Compositional.html#16580" class="Bound">Γ</a><a id="16581" class="Symbol">}</a> <a id="16583" class="Symbol">{</a><a id="16584" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16586" href="plfa.Compositional.html#16586" class="Bound">N</a><a id="16587" class="Symbol">}</a> <a id="16589" class="Symbol">=</a>
    <a id="16595" class="Keyword">let</a> <a id="16599" href="/PLFA-zh/Compositional/#16599" class="Bound">ih</a> <a id="16602" class="Symbol">=</a> <a id="16604" href="plfa.Compositional.html#16504" class="Function">ℰ≃⟦⟧</a> <a id="16609" class="Symbol">{</a><a id="16610" class="Argument">M</a> <a id="16612" class="Symbol">=</a> <a id="16614" href="plfa.Compositional.html#16586" class="Bound">N</a><a id="16615" class="Symbol">}</a> <a id="16617" class="Keyword">in</a>
      <a id="16626" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="16628" class="Symbol">(</a><a id="16629" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16631" href="/PLFA-zh/Compositional/#16586" class="Bound">N</a><a id="16632" class="Symbol">)</a>
    <a id="16638" href="/PLFA-zh/Denotational/#18743" class="Function Operator">≃⟨</a> <a id="16641" href="/PLFA-zh/Compositional/#4295" class="Function">lam-equiv</a> <a id="16651" href="plfa.Denotational.html#18743" class="Function Operator">⟩</a>
      <a id="16659" href="/PLFA-zh/Compositional/#1852" class="Function">ℱ</a> <a id="16661" class="Symbol">(</a><a id="16662" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="16664" href="plfa.Compositional.html#16586" class="Bound">N</a><a id="16665" class="Symbol">)</a>
    <a id="16671" href="/PLFA-zh/Denotational/#18743" class="Function Operator">≃⟨</a> <a id="16674" href="/PLFA-zh/Compositional/#10829" class="Function">ℱ-cong</a> <a id="16681" class="Symbol">(</a><a id="16682" href="plfa.Compositional.html#16504" class="Function">ℰ≃⟦⟧</a> <a id="16687" class="Symbol">{</a><a id="16688" class="Argument">M</a> <a id="16690" class="Symbol">=</a> <a id="16692" href="plfa.Compositional.html#16586" class="Bound">N</a><a id="16693" class="Symbol">})</a> <a id="16696" href="plfa.Denotational.html#18743" class="Function Operator">⟩</a>
      <a id="16704" href="/PLFA-zh/Compositional/#1852" class="Function">ℱ</a> <a id="16706" href="plfa.Compositional.html#16179" class="Function Operator">⟦</a> <a id="16708" href="plfa.Compositional.html#16586" class="Bound">N</a> <a id="16710" href="plfa.Compositional.html#16179" class="Function Operator">⟧</a>
    <a id="16716" href="/PLFA-zh/Denotational/#18636" class="Function Operator">≃⟨⟩</a>
      <a id="16726" href="/PLFA-zh/Compositional/#16179" class="Function Operator">⟦</a> <a id="16728" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16730" href="plfa.Compositional.html#16586" class="Bound">N</a> <a id="16732" href="plfa.Compositional.html#16179" class="Function Operator">⟧</a>
    <a id="16738" href="/PLFA-zh/Denotational/#18883" class="Function Operator">☐</a>
<a id="16740" href="/PLFA-zh/Compositional/#16504" class="Function">ℰ≃⟦⟧</a> <a id="16745" class="Symbol">{</a><a id="16746" href="plfa.Compositional.html#16746" class="Bound">Γ</a><a id="16747" class="Symbol">}</a> <a id="16749" class="Symbol">{</a><a id="16750" href="plfa.Compositional.html#16750" class="Bound">L</a> <a id="16752" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="16754" href="plfa.Compositional.html#16754" class="Bound">M</a><a id="16755" class="Symbol">}</a> <a id="16757" class="Symbol">=</a>
     <a id="16764" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="16766" class="Symbol">(</a><a id="16767" href="/PLFA-zh/Compositional/#16750" class="Bound">L</a> <a id="16769" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="16771" href="plfa.Compositional.html#16754" class="Bound">M</a><a id="16772" class="Symbol">)</a>
    <a id="16778" href="/PLFA-zh/Denotational/#18743" class="Function Operator">≃⟨</a> <a id="16781" href="/PLFA-zh/Compositional/#9415" class="Function">app-equiv</a> <a id="16791" href="plfa.Denotational.html#18743" class="Function Operator">⟩</a>
     <a id="16798" href="/PLFA-zh/Denotational/#17427" class="Function">ℰ</a> <a id="16800" href="/PLFA-zh/Compositional/#16750" class="Bound">L</a> <a id="16802" href="plfa.Compositional.html#5495" class="Function Operator">●</a> <a id="16804" href="plfa.Denotational.html#17427" class="Function">ℰ</a> <a id="16806" href="plfa.Compositional.html#16754" class="Bound">M</a>
    <a id="16812" href="/PLFA-zh/Denotational/#18743" class="Function Operator">≃⟨</a> <a id="16815" href="/PLFA-zh/Compositional/#12032" class="Function">●-cong</a> <a id="16822" class="Symbol">(</a><a id="16823" href="plfa.Compositional.html#16504" class="Function">ℰ≃⟦⟧</a> <a id="16828" class="Symbol">{</a><a id="16829" class="Argument">M</a> <a id="16831" class="Symbol">=</a> <a id="16833" href="plfa.Compositional.html#16750" class="Bound">L</a><a id="16834" class="Symbol">})</a> <a id="16837" class="Symbol">(</a><a id="16838" href="plfa.Compositional.html#16504" class="Function">ℰ≃⟦⟧</a> <a id="16843" class="Symbol">{</a><a id="16844" class="Argument">M</a> <a id="16846" class="Symbol">=</a> <a id="16848" href="plfa.Compositional.html#16754" class="Bound">M</a><a id="16849" class="Symbol">})</a> <a id="16852" href="plfa.Denotational.html#18743" class="Function Operator">⟩</a>
     <a id="16859" href="/PLFA-zh/Compositional/#16179" class="Function Operator">⟦</a> <a id="16861" href="plfa.Compositional.html#16750" class="Bound">L</a> <a id="16863" href="plfa.Compositional.html#16179" class="Function Operator">⟧</a> <a id="16865" href="plfa.Compositional.html#5495" class="Function Operator">●</a> <a id="16867" href="plfa.Compositional.html#16179" class="Function Operator">⟦</a> <a id="16869" href="plfa.Compositional.html#16754" class="Bound">M</a> <a id="16871" href="plfa.Compositional.html#16179" class="Function Operator">⟧</a>
    <a id="16877" href="/PLFA-zh/Denotational/#18636" class="Function Operator">≃⟨⟩</a>
      <a id="16887" href="/PLFA-zh/Compositional/#16179" class="Function Operator">⟦</a> <a id="16889" href="plfa.Compositional.html#16750" class="Bound">L</a> <a id="16891" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="16893" href="plfa.Compositional.html#16754" class="Bound">M</a> <a id="16895" href="plfa.Compositional.html#16179" class="Function Operator">⟧</a>
    <a id="16901" href="/PLFA-zh/Denotational/#18883" class="Function Operator">☐</a>
</pre>

<h2 id="unicode">Unicode</h2>

<p>This chapter uses the following unicode:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ℱ  U+2131  SCRIPT CAPITAL F (\McF)
●  U+2131  BLACK CIRCLE (\cib)
</code></pre></div></div>

  </div>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/PLFA-zh/Denotational/">上一章</a>
    
    
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/Agda-zh/PLFA-zh/blob/dev/src/plfa/Compositional.lagda.md">源代码</a>
    
    
    &bullet;
    
    
    <a alt="Next chapter" href="/PLFA-zh/Soundness/">下一章</a>
    
</p>


</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/PLFA-zh/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">编程语言基础：Agda 语言描述
</h2>

    <h3 class="footer-heading">原作者：</h3><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Philip Wadler</li>
          <li><a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wadler"><svg class="svg-icon"><use xlink:href="/PLFA-zh/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wadler</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wen Kokke</li>
          <li><a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wenkokke"><svg class="svg-icon"><use xlink:href="/PLFA-zh/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wenkokke</span></a></li><li><a href="https://www.twitter.com/wenkokke"><svg class="svg-icon"><use xlink:href="/PLFA-zh/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">wenkokke</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><h3 class="footer-heading">本章暂无翻译</h3>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">创作共用-署名 4.0 国际（CC BY 4.0）许可协议</a>授权。<br />
  </div>
</footer>
<!-- Import jQuery -->
<script type="text/javascript" src="/PLFA-zh/assets/jquery.js"></script>

<!-- Script which draws background for progress tags -->
<script type="text/javascript">
$('span.progress').each(function(){
    const progress = parseInt($(this).text());
    $(this).css({
        'border-style': 'solid',
        'border-radius': '5px',
        'border-width': 'thin',
        'border-color': progress === 100 ? 'limegreen' : 'dimgray',
        'font-size': '70%',
        'padding': '0% 0.5% 0% 0.5%',
        'margin': '0em 0em 0em 0.5em',
        'box-sizing': 'border-box',
        'vertical-align': '10%'
    });
    $(this).text(progress.toString() + " %");
})
</script>

<!-- Script which allows for foldable code blocks -->
<script type="text/javascript">

 // Makes sandwhich menu works
 $('.menu-icon').click(function(){
   $('.trigger').toggle();
 });

 // Script which allows for foldable code blocks
 $('div.foldable pre').each(function(){
     var autoHeight = $(this).height();
     var lineHeight = parseFloat($(this).css('line-height'));

     var plus    = $("<div></div>");
     var horLine = $("<div></div>");
     var verLine = $("<div></div>");
     $(this).prepend(plus);
     plus.css({
         'position'         : 'relative',
         'float'            : 'right',
         'right'            : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'width'            : lineHeight,
         'height'           : lineHeight});
     verLine.css({
         'position'         : 'relative',
         'height'           : lineHeight,
         'width'            : '3px',
         'background-color' : '#C1E0FF'});
     horLine.css({
         'position'         : 'relative',
         'top'              : '-' + (0.5 * lineHeight + 1.5) + 'px',
         'left'             : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'height'           : '3px',
         'width'            : lineHeight,
         'background-color' : '#C1E0FF'});
     plus.append(verLine);
     plus.append(horLine);

     $(this).height(2.0 * lineHeight);
     $(this).css('overflow','hidden');

     $(this).click(function(){
         if ($(this).height() == autoHeight) {
             $(this).height(2.0 * lineHeight);
             plus.show();
         }
         else {
             $(this).height('auto');
             plus.hide();
         }
     });
 });
</script>

<!-- Import KaTeX -->
<script type="text/javascript" src="/PLFA-zh/assets/katex.js"></script>

<!-- Script which renders TeX using KaTeX -->
<script type="text/javascript">
 $("script[type='math/tex']").replaceWith(
     function(){
         var tex = $(this).text();
         return "<span class=\"inline-equation\">" +
                katex.renderToString(tex) +
                "</span>";
     });
 $("script[type='math/tex; mode=display']").replaceWith(
     function(){
         var tex = $(this).text().replace(/%.*?(\n|$)/g,"");
         return "<div class=\"equation\">" +
                katex.renderToString("\\displaystyle "+tex) +
                "</div>";
     });
</script>
</body>

</html>
