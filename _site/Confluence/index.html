<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Confluence of the untyped lambda calculus | 编程语言基础：Agda 语言描述
</title><!-- Begin Jekyll SEO tag v2.5.0 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Confluence of the untyped lambda calculus" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="编程语言基础：Agda 语言描述" />
<meta property="og:description" content="编程语言基础：Agda 语言描述" />
<link rel="canonical" href="https://agda-zh.github.io/PLFA-zh/Confluence/" />
<meta property="og:url" content="https://agda-zh.github.io/PLFA-zh/Confluence/" />
<meta property="og:site_name" content="编程语言基础：Agda 语言描述" />
<script type="application/ld+json">
{"description":"编程语言基础：Agda 语言描述","@type":"WebPage","url":"https://agda-zh.github.io/PLFA-zh/Confluence/","headline":"Confluence of the untyped lambda calculus","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/PLFA-zh/assets/main.css"></head>
<body><header class="site-header" role="banner">

    <div class="wrapper">

        <a class="site-title" href="/PLFA-zh/">编程语言基础：Agda 语言描述
</a>

        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="/PLFA-zh/">主页</a>
                <a class="page-link" href="/PLFA-zh/Announcements/">公告</a>
                <a class="page-link" href="/PLFA-zh/GettingStarted/">使用说明</a>
                <a class="page-link" href="/PLFA-zh/Citing/">引用</a>
                <a class="page-link" href="https://plfa.github.io/">English</a>
            </div>
        </nav>

    </div>

</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
      <h1 class="post-title">Confluence of the untyped lambda calculus</h1>
  </header>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/PLFA-zh/Untyped/">上一章</a>
    
    
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/Agda-zh/PLFA-zh/blob/dev/src/plfa/Confluence.lagda.md">源代码</a>
    
    
    &bullet;
    
    
    <a alt="Next chapter" href="/PLFA-zh/CallByName/">下一章</a>
    
</p>


  <div class="post-content">
    <pre class="Agda"><a id="159" class="Keyword">module</a> <a id="166" href="/PLFA-zh/Confluence/" class="Module">plfa.Confluence</a> <a id="182" class="Keyword">where</a>
</pre>
<h2 id="introduction">Introduction</h2>

<p>In this chapter we prove that beta reduction is <em>confluent</em>, a
property also known as <em>Church-Rosser</em>. That is, if there is a
reduction sequence from any term <code class="highlighter-rouge">L</code> to two different terms <code class="highlighter-rouge">M₁</code> and
<code class="highlighter-rouge">M₂</code>, then there exist reduction sequences from those two terms to
some common term <code class="highlighter-rouge">N</code>. In pictures:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    L
   / \
  /   \
 /     \
M₁      M₂
 \     /
  \   /
   \ /
    N
</code></pre></div></div>

<p>where downward lines are instances of <code class="highlighter-rouge">—↠</code>.</p>

<p>Confluence is studied in many other kinds of rewrite systems besides
the lambda calculus, and it is well known how to prove confluence in
rewrite systems that enjoy the <em>diamond property</em>, a single-step
version of confluence. Let <code class="highlighter-rouge">⇛</code> be a relation.  Then <code class="highlighter-rouge">⇛</code> has the
diamond property if whenever <code class="highlighter-rouge">L ⇛ M₁</code> and <code class="highlighter-rouge">L ⇛ M₂</code>, then there exists
an <code class="highlighter-rouge">N</code> such that <code class="highlighter-rouge">M₁ ⇛ N</code> and <code class="highlighter-rouge">M₂ ⇛ N</code>. This is just an instance of
the same picture above, where downward lines are now instance of <code class="highlighter-rouge">⇛</code>.
If we write <code class="highlighter-rouge">⇛*</code> for the reflexive and transitive closure of <code class="highlighter-rouge">⇛</code>, then
confluence of <code class="highlighter-rouge">⇛*</code> follows immediately from the diamond property.</p>

<p>Unfortunately, reduction in the lambda calculus does not satisfy the
diamond property. Here is a counter example.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(λ x. x x)((λ x. x) a) —→ (λ x. x x) a
(λ x. x x)((λ x. x) a) —→ ((λ x. x) a) ((λ x. x) a)
</code></pre></div></div>

<p>Both terms can reduce to <code class="highlighter-rouge">a a</code>, but the second term requires two steps
to get there, not one.</p>

<p>To side-step this problem, we’ll define an auxilliary reduction
relation, called <em>parallel reduction</em>, that can perform many
reductions simultaneously and thereby satisfy the diamond property.
Furthermore, we show that a parallel reduction sequence exists between
any two terms if and only if a beta reduction sequence exists between them.
Thus, we can reduce the proof of confluence for beta reduction to
confluence for parallel reduction.</p>

<h2 id="imports">Imports</h2>

<pre class="Agda"><a id="2043" class="Keyword">open</a> <a id="2048" class="Keyword">import</a> <a id="2055" href="/PLFA-zh/Substitution/" class="Module">plfa.Substitution</a> <a id="2073" class="Keyword">using</a> <a id="2079" class="Symbol">(</a><a id="2080" href="plfa.Substitution.html#2233" class="Function">Rename</a><a id="2086" class="Symbol">;</a> <a id="2088" href="plfa.Substitution.html#2446" class="Function">Subst</a><a id="2093" class="Symbol">)</a>
<a id="2095" class="Keyword">open</a> <a id="2100" class="Keyword">import</a> <a id="2107" href="/PLFA-zh/Untyped/" class="Module">plfa.Untyped</a>
    <a id="2124" class="Keyword">using</a> <a id="2130" class="Symbol">(</a><a id="2131" href="/PLFA-zh/Untyped/#10105" class="Datatype Operator">_—→_</a><a id="2135" class="Symbol">;</a> <a id="2137" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a><a id="2138" class="Symbol">;</a> <a id="2140" href="plfa.Untyped.html#10155" class="InductiveConstructor">ξ₁</a><a id="2142" class="Symbol">;</a> <a id="2144" href="plfa.Untyped.html#10245" class="InductiveConstructor">ξ₂</a><a id="2146" class="Symbol">;</a> <a id="2148" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a><a id="2149" class="Symbol">;</a> <a id="2151" href="plfa.Untyped.html#11203" class="Datatype Operator">_—↠_</a><a id="2155" class="Symbol">;</a> <a id="2157" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">_—→⟨_⟩_</a><a id="2164" class="Symbol">;</a> <a id="2166" href="plfa.Untyped.html#11253" class="InductiveConstructor Operator">_∎</a><a id="2168" class="Symbol">;</a>
           <a id="2181" href="/PLFA-zh/Untyped/#23725" class="Function">abs-cong</a><a id="2189" class="Symbol">;</a> <a id="2191" href="plfa.Untyped.html#22728" class="Function">appL-cong</a><a id="2200" class="Symbol">;</a> <a id="2202" href="plfa.Untyped.html#23497" class="Function">appR-cong</a><a id="2211" class="Symbol">;</a> <a id="2213" href="plfa.Untyped.html#21544" class="Function">—↠-trans</a><a id="2221" class="Symbol">;</a>
           <a id="2234" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">_⊢_</a><a id="2237" class="Symbol">;</a> <a id="2239" href="plfa.Untyped.html#3483" class="Datatype Operator">_∋_</a><a id="2242" class="Symbol">;</a> <a id="2244" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`_</a><a id="2246" class="Symbol">;</a> <a id="2248" href="plfa.Untyped.html#5069" class="Function Operator">#_</a><a id="2250" class="Symbol">;</a> <a id="2252" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">_,_</a><a id="2255" class="Symbol">;</a> <a id="2257" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="2258" class="Symbol">;</a> <a id="2260" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ_</a><a id="2262" class="Symbol">;</a> <a id="2264" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">_·_</a><a id="2267" class="Symbol">;</a> <a id="2269" href="plfa.Untyped.html#7449" class="Function Operator">_[_]</a><a id="2273" class="Symbol">;</a>
           <a id="2286" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a><a id="2292" class="Symbol">;</a> <a id="2294" href="plfa.Untyped.html#5883" class="Function">ext</a><a id="2297" class="Symbol">;</a> <a id="2299" href="plfa.Untyped.html#6629" class="Function">exts</a><a id="2303" class="Symbol">;</a> <a id="2305" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="2306" class="Symbol">;</a> <a id="2308" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a><a id="2310" class="Symbol">;</a> <a id="2312" href="plfa.Untyped.html#6921" class="Function">subst</a><a id="2317" class="Symbol">;</a> <a id="2319" href="plfa.Untyped.html#7333" class="Function">subst-zero</a><a id="2329" class="Symbol">)</a>
<a id="2331" class="Keyword">import</a> <a id="2338" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="2376" class="Symbol">as</a> <a id="2379" class="Module">Eq</a>
<a id="2382" class="Keyword">open</a> <a id="2387" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html" class="Module">Eq</a> <a id="2390" class="Keyword">using</a> <a id="2396" class="Symbol">(</a><a id="2397" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">_≡_</a><a id="2400" class="Symbol">;</a> <a id="2402" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="2406" class="Symbol">)</a>
<a id="2408" class="Keyword">open</a> <a id="2413" class="Keyword">import</a> <a id="2420" href="https://agda.github.io/agda-stdlib/v1.1/Function.html" class="Module">Function</a> <a id="2429" class="Keyword">using</a> <a id="2435" class="Symbol">(</a><a id="2436" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">_∘_</a><a id="2439" class="Symbol">)</a>
<a id="2441" class="Keyword">open</a> <a id="2446" class="Keyword">import</a> <a id="2453" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html" class="Module">Data.Product</a> <a id="2466" class="Keyword">using</a> <a id="2472" class="Symbol">(</a><a id="2473" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">_×_</a><a id="2476" class="Symbol">;</a> <a id="2478" href="Agda.Builtin.Sigma.html#139" class="Record">Σ</a><a id="2479" class="Symbol">;</a> <a id="2481" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ-syntax</a><a id="2489" class="Symbol">;</a> <a id="2491" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1364" class="Function">∃</a><a id="2492" class="Symbol">;</a> <a id="2494" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1783" class="Function">∃-syntax</a><a id="2502" class="Symbol">;</a> <a id="2504" href="Agda.Builtin.Sigma.html#225" class="Field">proj₁</a><a id="2509" class="Symbol">;</a> <a id="2511" href="Agda.Builtin.Sigma.html#237" class="Field">proj₂</a><a id="2516" class="Symbol">)</a>
     <a id="2523" class="Keyword">renaming</a> <a id="2532" class="Symbol">(</a><a id="2533" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">_,_</a> <a id="2537" class="Symbol">to</a> <a id="2540" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="2545" class="Symbol">)</a>
</pre>
<h2 id="parallel-reduction">Parallel Reduction</h2>

<p>The parallel reduction relation is defined as follows.</p>

<pre class="Agda"><a id="2635" class="Keyword">infix</a> <a id="2641" class="Number">2</a> <a id="2643" href="/PLFA-zh/Confluence/#2653" class="Datatype Operator">_⇛_</a>

<a id="2648" class="Keyword">data</a> <a id="_⇛_"></a><a id="2653" href="/PLFA-zh/Confluence/#2653" class="Datatype Operator">_⇛_</a> <a id="2657" class="Symbol">:</a> <a id="2659" class="Symbol">∀</a> <a id="2661" class="Symbol">{</a><a id="2662" href="plfa.Confluence.html#2662" class="Bound">Γ</a> <a id="2664" href="plfa.Confluence.html#2664" class="Bound">A</a><a id="2665" class="Symbol">}</a> <a id="2667" class="Symbol">→</a> <a id="2669" class="Symbol">(</a><a id="2670" href="plfa.Confluence.html#2662" class="Bound">Γ</a> <a id="2672" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="2674" href="plfa.Confluence.html#2664" class="Bound">A</a><a id="2675" class="Symbol">)</a> <a id="2677" class="Symbol">→</a> <a id="2679" class="Symbol">(</a><a id="2680" href="plfa.Confluence.html#2662" class="Bound">Γ</a> <a id="2682" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="2684" href="plfa.Confluence.html#2664" class="Bound">A</a><a id="2685" class="Symbol">)</a> <a id="2687" class="Symbol">→</a> <a id="2689" class="PrimitiveType">Set</a> <a id="2693" class="Keyword">where</a>

  <a id="_⇛_.pvar"></a><a id="2702" href="/PLFA-zh/Confluence/#2702" class="InductiveConstructor">pvar</a> <a id="2707" class="Symbol">:</a> <a id="2709" class="Symbol">∀{</a><a id="2711" href="plfa.Confluence.html#2711" class="Bound">Γ</a> <a id="2713" href="plfa.Confluence.html#2713" class="Bound">A</a><a id="2714" class="Symbol">}{</a><a id="2716" href="plfa.Confluence.html#2716" class="Bound">x</a> <a id="2718" class="Symbol">:</a> <a id="2720" href="plfa.Confluence.html#2711" class="Bound">Γ</a> <a id="2722" href="/PLFA-zh/Untyped/#3483" class="Datatype Operator">∋</a> <a id="2724" href="plfa.Confluence.html#2713" class="Bound">A</a><a id="2725" class="Symbol">}</a>
         <a id="2736" class="Comment">---------</a>
       <a id="2753" class="Symbol">→</a> <a id="2755" class="Symbol">(</a><a id="2756" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="2758" href="/PLFA-zh/Confluence/#2716" class="Bound">x</a><a id="2759" class="Symbol">)</a> <a id="2761" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="2763" class="Symbol">(</a><a id="2764" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="2766" href="plfa.Confluence.html#2716" class="Bound">x</a><a id="2767" class="Symbol">)</a>

  <a id="_⇛_.pabs"></a><a id="2772" href="/PLFA-zh/Confluence/#2772" class="InductiveConstructor">pabs</a> <a id="2777" class="Symbol">:</a> <a id="2779" class="Symbol">∀{</a><a id="2781" href="plfa.Confluence.html#2781" class="Bound">Γ</a><a id="2782" class="Symbol">}{</a><a id="2784" href="plfa.Confluence.html#2784" class="Bound">N</a> <a id="2786" href="plfa.Confluence.html#2786" class="Bound">N′</a> <a id="2789" class="Symbol">:</a> <a id="2791" href="plfa.Confluence.html#2781" class="Bound">Γ</a> <a id="2793" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="2795" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="2797" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="2799" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="2800" class="Symbol">}</a>
       <a id="2809" class="Symbol">→</a> <a id="2811" href="/PLFA-zh/Confluence/#2784" class="Bound">N</a> <a id="2813" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="2815" href="plfa.Confluence.html#2786" class="Bound">N′</a>
         <a id="2827" class="Comment">----------</a>
       <a id="2845" class="Symbol">→</a> <a id="2847" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="2849" href="/PLFA-zh/Confluence/#2784" class="Bound">N</a> <a id="2851" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="2853" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="2855" href="plfa.Confluence.html#2786" class="Bound">N′</a>

  <a id="_⇛_.papp"></a><a id="2861" href="/PLFA-zh/Confluence/#2861" class="InductiveConstructor">papp</a> <a id="2866" class="Symbol">:</a> <a id="2868" class="Symbol">∀{</a><a id="2870" href="plfa.Confluence.html#2870" class="Bound">Γ</a><a id="2871" class="Symbol">}{</a><a id="2873" href="plfa.Confluence.html#2873" class="Bound">L</a> <a id="2875" href="plfa.Confluence.html#2875" class="Bound">L′</a> <a id="2878" href="plfa.Confluence.html#2878" class="Bound">M</a> <a id="2880" href="plfa.Confluence.html#2880" class="Bound">M′</a> <a id="2883" class="Symbol">:</a> <a id="2885" href="plfa.Confluence.html#2870" class="Bound">Γ</a> <a id="2887" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="2889" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="2890" class="Symbol">}</a>
       <a id="2899" class="Symbol">→</a> <a id="2901" href="/PLFA-zh/Confluence/#2873" class="Bound">L</a> <a id="2903" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="2905" href="plfa.Confluence.html#2875" class="Bound">L′</a>
       <a id="2915" class="Symbol">→</a> <a id="2917" href="/PLFA-zh/Confluence/#2878" class="Bound">M</a> <a id="2919" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="2921" href="plfa.Confluence.html#2880" class="Bound">M′</a>
         <a id="2933" class="Comment">-----------------</a>
       <a id="2958" class="Symbol">→</a> <a id="2960" href="/PLFA-zh/Confluence/#2873" class="Bound">L</a> <a id="2962" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="2964" href="plfa.Confluence.html#2878" class="Bound">M</a> <a id="2966" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="2968" href="plfa.Confluence.html#2875" class="Bound">L′</a> <a id="2971" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="2973" href="plfa.Confluence.html#2880" class="Bound">M′</a>

  <a id="_⇛_.pbeta"></a><a id="2979" href="/PLFA-zh/Confluence/#2979" class="InductiveConstructor">pbeta</a> <a id="2985" class="Symbol">:</a> <a id="2987" class="Symbol">∀{</a><a id="2989" href="plfa.Confluence.html#2989" class="Bound">Γ</a><a id="2990" class="Symbol">}{</a><a id="2992" href="plfa.Confluence.html#2992" class="Bound">N</a> <a id="2994" href="plfa.Confluence.html#2994" class="Bound">N′</a>  <a id="2998" class="Symbol">:</a> <a id="3000" href="plfa.Confluence.html#2989" class="Bound">Γ</a> <a id="3002" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="3004" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="3006" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="3008" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="3009" class="Symbol">}{</a><a id="3011" href="plfa.Confluence.html#3011" class="Bound">M</a> <a id="3013" href="plfa.Confluence.html#3013" class="Bound">M′</a> <a id="3016" class="Symbol">:</a> <a id="3018" href="plfa.Confluence.html#2989" class="Bound">Γ</a> <a id="3020" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="3022" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="3023" class="Symbol">}</a>
       <a id="3032" class="Symbol">→</a> <a id="3034" href="/PLFA-zh/Confluence/#2992" class="Bound">N</a> <a id="3036" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="3038" href="plfa.Confluence.html#2994" class="Bound">N′</a>
       <a id="3048" class="Symbol">→</a> <a id="3050" href="/PLFA-zh/Confluence/#3011" class="Bound">M</a> <a id="3052" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="3054" href="plfa.Confluence.html#3013" class="Bound">M′</a>
         <a id="3066" class="Comment">-----------------------</a>
       <a id="3097" class="Symbol">→</a> <a id="3099" class="Symbol">(</a><a id="3100" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="3102" href="/PLFA-zh/Confluence/#2992" class="Bound">N</a><a id="3103" class="Symbol">)</a> <a id="3105" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="3107" href="plfa.Confluence.html#3011" class="Bound">M</a>  <a id="3110" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a>  <a id="3113" href="plfa.Confluence.html#2994" class="Bound">N′</a> <a id="3116" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="3118" href="plfa.Confluence.html#3013" class="Bound">M′</a> <a id="3121" href="plfa.Untyped.html#7449" class="Function Operator">]</a>
</pre>
<p>The first three rules are congruences that reduce each of their
parts simultaneously. The last rule reduces a lambda term and
term in parallel followed by a beta step.</p>

<p>We remark that the <code class="highlighter-rouge">pabs</code>, <code class="highlighter-rouge">papp</code>, and <code class="highlighter-rouge">pbeta</code> rules perform reduction
on all their subexpressions simultaneously. Also, the <code class="highlighter-rouge">pabs</code> rule is
akin to the <code class="highlighter-rouge">ζ</code> rule and <code class="highlighter-rouge">pbeta</code> is akin to <code class="highlighter-rouge">β</code>.</p>

<p>Parallel reduction is reflexive.</p>

<pre class="Agda"><a id="par-refl"></a><a id="3524" href="/PLFA-zh/Confluence/#3524" class="Function">par-refl</a> <a id="3533" class="Symbol">:</a> <a id="3535" class="Symbol">∀{</a><a id="3537" href="plfa.Confluence.html#3537" class="Bound">Γ</a> <a id="3539" href="plfa.Confluence.html#3539" class="Bound">A</a><a id="3540" class="Symbol">}{</a><a id="3542" href="plfa.Confluence.html#3542" class="Bound">M</a> <a id="3544" class="Symbol">:</a> <a id="3546" href="plfa.Confluence.html#3537" class="Bound">Γ</a> <a id="3548" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="3550" href="plfa.Confluence.html#3539" class="Bound">A</a><a id="3551" class="Symbol">}</a> <a id="3553" class="Symbol">→</a> <a id="3555" href="plfa.Confluence.html#3542" class="Bound">M</a> <a id="3557" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="3559" href="plfa.Confluence.html#3542" class="Bound">M</a>
<a id="3561" href="/PLFA-zh/Confluence/#3524" class="Function">par-refl</a> <a id="3570" class="Symbol">{</a><a id="3571" href="plfa.Confluence.html#3571" class="Bound">Γ</a><a id="3572" class="Symbol">}</a> <a id="3574" class="Symbol">{</a><a id="3575" href="plfa.Confluence.html#3575" class="Bound">A</a><a id="3576" class="Symbol">}</a> <a id="3578" class="Symbol">{</a><a id="3579" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="3581" href="plfa.Confluence.html#3581" class="Bound">x</a><a id="3582" class="Symbol">}</a> <a id="3584" class="Symbol">=</a> <a id="3586" href="plfa.Confluence.html#2702" class="InductiveConstructor">pvar</a>
<a id="3591" href="/PLFA-zh/Confluence/#3524" class="Function">par-refl</a> <a id="3600" class="Symbol">{</a><a id="3601" href="plfa.Confluence.html#3601" class="Bound">Γ</a><a id="3602" class="Symbol">}</a> <a id="3604" class="Symbol">{</a><a id="3605" href="/PLFA-zh/Untyped/#2876" class="InductiveConstructor">★</a><a id="3606" class="Symbol">}</a> <a id="3608" class="Symbol">{</a><a id="3609" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="3611" href="plfa.Confluence.html#3611" class="Bound">N</a><a id="3612" class="Symbol">}</a> <a id="3614" class="Symbol">=</a> <a id="3616" href="plfa.Confluence.html#2772" class="InductiveConstructor">pabs</a> <a id="3621" href="plfa.Confluence.html#3524" class="Function">par-refl</a>
<a id="3630" href="/PLFA-zh/Confluence/#3524" class="Function">par-refl</a> <a id="3639" class="Symbol">{</a><a id="3640" href="plfa.Confluence.html#3640" class="Bound">Γ</a><a id="3641" class="Symbol">}</a> <a id="3643" class="Symbol">{</a><a id="3644" href="/PLFA-zh/Untyped/#2876" class="InductiveConstructor">★</a><a id="3645" class="Symbol">}</a> <a id="3647" class="Symbol">{</a><a id="3648" href="plfa.Confluence.html#3648" class="Bound">L</a> <a id="3650" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="3652" href="plfa.Confluence.html#3652" class="Bound">M</a><a id="3653" class="Symbol">}</a> <a id="3655" class="Symbol">=</a> <a id="3657" href="plfa.Confluence.html#2861" class="InductiveConstructor">papp</a> <a id="3662" href="plfa.Confluence.html#3524" class="Function">par-refl</a> <a id="3671" href="plfa.Confluence.html#3524" class="Function">par-refl</a>
</pre>
<p>We define the sequences of parallel reduction as follows.</p>

<pre class="Agda"><a id="3747" class="Keyword">infix</a>  <a id="3754" class="Number">2</a> <a id="3756" href="/PLFA-zh/Confluence/#3795" class="Datatype Operator">_⇛*_</a>
<a id="3761" class="Keyword">infixr</a> <a id="3768" class="Number">2</a> <a id="3770" href="/PLFA-zh/Confluence/#3901" class="InductiveConstructor Operator">_⇛⟨_⟩_</a>
<a id="3777" class="Keyword">infix</a>  <a id="3784" class="Number">3</a> <a id="3786" href="/PLFA-zh/Confluence/#3845" class="InductiveConstructor Operator">_∎</a>

<a id="3790" class="Keyword">data</a> <a id="_⇛*_"></a><a id="3795" href="/PLFA-zh/Confluence/#3795" class="Datatype Operator">_⇛*_</a> <a id="3800" class="Symbol">:</a> <a id="3802" class="Symbol">∀</a> <a id="3804" class="Symbol">{</a><a id="3805" href="plfa.Confluence.html#3805" class="Bound">Γ</a> <a id="3807" href="plfa.Confluence.html#3807" class="Bound">A</a><a id="3808" class="Symbol">}</a> <a id="3810" class="Symbol">→</a> <a id="3812" class="Symbol">(</a><a id="3813" href="plfa.Confluence.html#3805" class="Bound">Γ</a> <a id="3815" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="3817" href="plfa.Confluence.html#3807" class="Bound">A</a><a id="3818" class="Symbol">)</a> <a id="3820" class="Symbol">→</a> <a id="3822" class="Symbol">(</a><a id="3823" href="plfa.Confluence.html#3805" class="Bound">Γ</a> <a id="3825" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="3827" href="plfa.Confluence.html#3807" class="Bound">A</a><a id="3828" class="Symbol">)</a> <a id="3830" class="Symbol">→</a> <a id="3832" class="PrimitiveType">Set</a> <a id="3836" class="Keyword">where</a>

  <a id="_⇛*_._∎"></a><a id="3845" href="/PLFA-zh/Confluence/#3845" class="InductiveConstructor Operator">_∎</a> <a id="3848" class="Symbol">:</a> <a id="3850" class="Symbol">∀</a> <a id="3852" class="Symbol">{</a><a id="3853" href="plfa.Confluence.html#3853" class="Bound">Γ</a> <a id="3855" href="plfa.Confluence.html#3855" class="Bound">A</a><a id="3856" class="Symbol">}</a> <a id="3858" class="Symbol">(</a><a id="3859" href="plfa.Confluence.html#3859" class="Bound">M</a> <a id="3861" class="Symbol">:</a> <a id="3863" href="plfa.Confluence.html#3853" class="Bound">Γ</a> <a id="3865" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="3867" href="plfa.Confluence.html#3855" class="Bound">A</a><a id="3868" class="Symbol">)</a>
      <a id="3876" class="Comment">--------</a>
    <a id="3889" class="Symbol">→</a> <a id="3891" href="/PLFA-zh/Confluence/#3859" class="Bound">M</a> <a id="3893" href="plfa.Confluence.html#3795" class="Datatype Operator">⇛*</a> <a id="3896" href="plfa.Confluence.html#3859" class="Bound">M</a>

  <a id="_⇛*_._⇛⟨_⟩_"></a><a id="3901" href="/PLFA-zh/Confluence/#3901" class="InductiveConstructor Operator">_⇛⟨_⟩_</a> <a id="3908" class="Symbol">:</a> <a id="3910" class="Symbol">∀</a> <a id="3912" class="Symbol">{</a><a id="3913" href="plfa.Confluence.html#3913" class="Bound">Γ</a> <a id="3915" href="plfa.Confluence.html#3915" class="Bound">A</a><a id="3916" class="Symbol">}</a> <a id="3918" class="Symbol">(</a><a id="3919" href="plfa.Confluence.html#3919" class="Bound">L</a> <a id="3921" class="Symbol">:</a> <a id="3923" href="plfa.Confluence.html#3913" class="Bound">Γ</a> <a id="3925" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="3927" href="plfa.Confluence.html#3915" class="Bound">A</a><a id="3928" class="Symbol">)</a> <a id="3930" class="Symbol">{</a><a id="3931" href="plfa.Confluence.html#3931" class="Bound">M</a> <a id="3933" href="plfa.Confluence.html#3933" class="Bound">N</a> <a id="3935" class="Symbol">:</a> <a id="3937" href="plfa.Confluence.html#3913" class="Bound">Γ</a> <a id="3939" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="3941" href="plfa.Confluence.html#3915" class="Bound">A</a><a id="3942" class="Symbol">}</a>
    <a id="3948" class="Symbol">→</a> <a id="3950" href="/PLFA-zh/Confluence/#3919" class="Bound">L</a> <a id="3952" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="3954" href="plfa.Confluence.html#3931" class="Bound">M</a>
    <a id="3960" class="Symbol">→</a> <a id="3962" href="/PLFA-zh/Confluence/#3931" class="Bound">M</a> <a id="3964" href="plfa.Confluence.html#3795" class="Datatype Operator">⇛*</a> <a id="3967" href="plfa.Confluence.html#3933" class="Bound">N</a>
      <a id="3975" class="Comment">---------</a>
    <a id="3989" class="Symbol">→</a> <a id="3991" href="/PLFA-zh/Confluence/#3919" class="Bound">L</a> <a id="3993" href="plfa.Confluence.html#3795" class="Datatype Operator">⇛*</a> <a id="3996" href="plfa.Confluence.html#3933" class="Bound">N</a>
</pre>

<h4 id="exercise-par-diamond-eg">Exercise <code class="highlighter-rouge">par-diamond-eg</code></h4>

<p>Revisit the counter example to the diamond property for reduction by
showing that the diamond property holds for parallel reduction in that
case.</p>

<pre class="Agda"><a id="4187" class="Comment">-- Your code goes here</a>
</pre>

<h2 id="equivalence-between-parallel-reduction-and-reduction">Equivalence between parallel reduction and reduction</h2>

<p>Here we prove that for any <code class="highlighter-rouge">M</code> and <code class="highlighter-rouge">N</code>, <code class="highlighter-rouge">M ⇛* N</code> if and only if <code class="highlighter-rouge">M —↠ N</code>.
The only-if direction is particularly easy. We start by showing
that if <code class="highlighter-rouge">M —→ N</code>, then <code class="highlighter-rouge">M ⇛ N</code>. The proof is by induction on
the reduction <code class="highlighter-rouge">M —→ N</code>.</p>

<pre class="Agda"><a id="beta-par"></a><a id="4501" href="/PLFA-zh/Confluence/#4501" class="Function">beta-par</a> <a id="4510" class="Symbol">:</a> <a id="4512" class="Symbol">∀{</a><a id="4514" href="plfa.Confluence.html#4514" class="Bound">Γ</a> <a id="4516" href="plfa.Confluence.html#4516" class="Bound">A</a><a id="4517" class="Symbol">}{</a><a id="4519" href="plfa.Confluence.html#4519" class="Bound">M</a> <a id="4521" href="plfa.Confluence.html#4521" class="Bound">N</a> <a id="4523" class="Symbol">:</a> <a id="4525" href="plfa.Confluence.html#4514" class="Bound">Γ</a> <a id="4527" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="4529" href="plfa.Confluence.html#4516" class="Bound">A</a><a id="4530" class="Symbol">}</a>
         <a id="4541" class="Symbol">→</a> <a id="4543" href="/PLFA-zh/Confluence/#4519" class="Bound">M</a> <a id="4545" href="/PLFA-zh/Untyped/#10105" class="Datatype Operator">—→</a> <a id="4548" href="plfa.Confluence.html#4521" class="Bound">N</a>
           <a id="4561" class="Comment">------</a>
         <a id="4577" class="Symbol">→</a> <a id="4579" href="/PLFA-zh/Confluence/#4519" class="Bound">M</a> <a id="4581" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="4583" href="plfa.Confluence.html#4521" class="Bound">N</a>
<a id="4585" href="/PLFA-zh/Confluence/#4501" class="Function">beta-par</a> <a id="4594" class="Symbol">{</a><a id="4595" href="plfa.Confluence.html#4595" class="Bound">Γ</a><a id="4596" class="Symbol">}</a> <a id="4598" class="Symbol">{</a><a id="4599" href="/PLFA-zh/Untyped/#2876" class="InductiveConstructor">★</a><a id="4600" class="Symbol">}</a> <a id="4602" class="Symbol">{</a><a id="4603" href="plfa.Confluence.html#4603" class="Bound">L</a> <a id="4605" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="4607" href="plfa.Confluence.html#4607" class="Bound">M</a><a id="4608" class="Symbol">}</a> <a id="4610" class="Symbol">(</a><a id="4611" href="plfa.Untyped.html#10155" class="InductiveConstructor">ξ₁</a> <a id="4614" href="plfa.Confluence.html#4614" class="Bound">r</a><a id="4615" class="Symbol">)</a> <a id="4617" class="Symbol">=</a> <a id="4619" href="plfa.Confluence.html#2861" class="InductiveConstructor">papp</a> <a id="4624" class="Symbol">(</a><a id="4625" href="plfa.Confluence.html#4501" class="Function">beta-par</a> <a id="4634" class="Symbol">{</a><a id="4635" class="Argument">M</a> <a id="4637" class="Symbol">=</a> <a id="4639" href="plfa.Confluence.html#4603" class="Bound">L</a><a id="4640" class="Symbol">}</a> <a id="4642" href="plfa.Confluence.html#4614" class="Bound">r</a><a id="4643" class="Symbol">)</a> <a id="4645" href="plfa.Confluence.html#3524" class="Function">par-refl</a>
<a id="4654" href="/PLFA-zh/Confluence/#4501" class="Function">beta-par</a> <a id="4663" class="Symbol">{</a><a id="4664" href="plfa.Confluence.html#4664" class="Bound">Γ</a><a id="4665" class="Symbol">}</a> <a id="4667" class="Symbol">{</a><a id="4668" href="/PLFA-zh/Untyped/#2876" class="InductiveConstructor">★</a><a id="4669" class="Symbol">}</a> <a id="4671" class="Symbol">{</a><a id="4672" href="plfa.Confluence.html#4672" class="Bound">L</a> <a id="4674" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="4676" href="plfa.Confluence.html#4676" class="Bound">M</a><a id="4677" class="Symbol">}</a> <a id="4679" class="Symbol">(</a><a id="4680" href="plfa.Untyped.html#10245" class="InductiveConstructor">ξ₂</a> <a id="4683" href="plfa.Confluence.html#4683" class="Bound">r</a><a id="4684" class="Symbol">)</a> <a id="4686" class="Symbol">=</a> <a id="4688" href="plfa.Confluence.html#2861" class="InductiveConstructor">papp</a> <a id="4693" href="plfa.Confluence.html#3524" class="Function">par-refl</a> <a id="4702" class="Symbol">(</a><a id="4703" href="plfa.Confluence.html#4501" class="Function">beta-par</a> <a id="4712" class="Symbol">{</a><a id="4713" class="Argument">M</a> <a id="4715" class="Symbol">=</a> <a id="4717" href="plfa.Confluence.html#4676" class="Bound">M</a><a id="4718" class="Symbol">}</a> <a id="4720" href="plfa.Confluence.html#4683" class="Bound">r</a><a id="4721" class="Symbol">)</a>
<a id="4723" href="/PLFA-zh/Confluence/#4501" class="Function">beta-par</a> <a id="4732" class="Symbol">{</a><a id="4733" href="plfa.Confluence.html#4733" class="Bound">Γ</a><a id="4734" class="Symbol">}</a> <a id="4736" class="Symbol">{</a><a id="4737" href="/PLFA-zh/Untyped/#2876" class="InductiveConstructor">★</a><a id="4738" class="Symbol">}</a> <a id="4740" class="Symbol">{(</a><a id="4742" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="4744" href="plfa.Confluence.html#4744" class="Bound">N</a><a id="4745" class="Symbol">)</a> <a id="4747" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="4749" href="plfa.Confluence.html#4749" class="Bound">M</a><a id="4750" class="Symbol">}</a> <a id="4752" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a> <a id="4754" class="Symbol">=</a> <a id="4756" href="plfa.Confluence.html#2979" class="InductiveConstructor">pbeta</a> <a id="4762" href="plfa.Confluence.html#3524" class="Function">par-refl</a> <a id="4771" href="plfa.Confluence.html#3524" class="Function">par-refl</a>
<a id="4780" href="/PLFA-zh/Confluence/#4501" class="Function">beta-par</a> <a id="4789" class="Symbol">{</a><a id="4790" href="plfa.Confluence.html#4790" class="Bound">Γ</a><a id="4791" class="Symbol">}</a> <a id="4793" class="Symbol">{</a><a id="4794" href="/PLFA-zh/Untyped/#2876" class="InductiveConstructor">★</a><a id="4795" class="Symbol">}</a> <a id="4797" class="Symbol">{</a><a id="4798" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="4800" href="plfa.Confluence.html#4800" class="Bound">N</a><a id="4801" class="Symbol">}</a> <a id="4803" class="Symbol">(</a><a id="4804" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a> <a id="4806" href="plfa.Confluence.html#4806" class="Bound">r</a><a id="4807" class="Symbol">)</a> <a id="4809" class="Symbol">=</a> <a id="4811" href="plfa.Confluence.html#2772" class="InductiveConstructor">pabs</a> <a id="4816" class="Symbol">(</a><a id="4817" href="plfa.Confluence.html#4501" class="Function">beta-par</a> <a id="4826" href="plfa.Confluence.html#4806" class="Bound">r</a><a id="4827" class="Symbol">)</a>
</pre>
<p>With this lemma in hand we complete the only-if direction,
that <code class="highlighter-rouge">M —↠ N</code> implies <code class="highlighter-rouge">M ⇛* N</code>. The proof is a straightforward
induction on the reduction sequence <code class="highlighter-rouge">M —↠ N</code>.</p>

<pre class="Agda"><a id="betas-pars"></a><a id="5007" href="/PLFA-zh/Confluence/#5007" class="Function">betas-pars</a> <a id="5018" class="Symbol">:</a> <a id="5020" class="Symbol">∀{</a><a id="5022" href="plfa.Confluence.html#5022" class="Bound">Γ</a> <a id="5024" href="plfa.Confluence.html#5024" class="Bound">A</a><a id="5025" class="Symbol">}</a> <a id="5027" class="Symbol">{</a><a id="5028" href="plfa.Confluence.html#5028" class="Bound">M</a> <a id="5030" href="plfa.Confluence.html#5030" class="Bound">N</a> <a id="5032" class="Symbol">:</a> <a id="5034" href="plfa.Confluence.html#5022" class="Bound">Γ</a> <a id="5036" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="5038" href="plfa.Confluence.html#5024" class="Bound">A</a><a id="5039" class="Symbol">}</a>
           <a id="5052" class="Symbol">→</a> <a id="5054" href="/PLFA-zh/Confluence/#5028" class="Bound">M</a> <a id="5056" href="/PLFA-zh/Untyped/#11203" class="Datatype Operator">—↠</a> <a id="5059" href="plfa.Confluence.html#5030" class="Bound">N</a>
             <a id="5074" class="Comment">------</a>
           <a id="5092" class="Symbol">→</a> <a id="5094" href="/PLFA-zh/Confluence/#5028" class="Bound">M</a> <a id="5096" href="plfa.Confluence.html#3795" class="Datatype Operator">⇛*</a> <a id="5099" href="plfa.Confluence.html#5030" class="Bound">N</a>
<a id="5101" href="/PLFA-zh/Confluence/#5007" class="Function">betas-pars</a> <a id="5112" class="Symbol">{</a><a id="5113" href="plfa.Confluence.html#5113" class="Bound">Γ</a><a id="5114" class="Symbol">}</a> <a id="5116" class="Symbol">{</a><a id="5117" href="plfa.Confluence.html#5117" class="Bound">A</a><a id="5118" class="Symbol">}</a> <a id="5120" class="Symbol">{</a><a id="5121" href="plfa.Confluence.html#5121" class="Bound">M₁</a><a id="5123" class="Symbol">}</a> <a id="5125" class="Symbol">{</a><a id="5126" class="DottedPattern Symbol">.</a><a id="5127" href="plfa.Confluence.html#5121" class="DottedPattern Bound">M₁</a><a id="5129" class="Symbol">}</a> <a id="5131" class="Symbol">(</a><a id="5132" href="plfa.Confluence.html#5121" class="Bound">M₁</a> <a id="5135" href="/PLFA-zh/Untyped/#11253" class="InductiveConstructor Operator">∎</a><a id="5136" class="Symbol">)</a> <a id="5138" class="Symbol">=</a> <a id="5140" href="plfa.Confluence.html#5121" class="Bound">M₁</a> <a id="5143" href="plfa.Confluence.html#3845" class="InductiveConstructor Operator">∎</a>
<a id="5145" href="/PLFA-zh/Confluence/#5007" class="Function">betas-pars</a> <a id="5156" class="Symbol">{</a><a id="5157" href="plfa.Confluence.html#5157" class="Bound">Γ</a><a id="5158" class="Symbol">}</a> <a id="5160" class="Symbol">{</a><a id="5161" href="plfa.Confluence.html#5161" class="Bound">A</a><a id="5162" class="Symbol">}</a> <a id="5164" class="Symbol">{</a><a id="5165" class="DottedPattern Symbol">.</a><a id="5166" href="plfa.Confluence.html#5174" class="DottedPattern Bound">L</a><a id="5167" class="Symbol">}</a> <a id="5169" class="Symbol">{</a><a id="5170" href="plfa.Confluence.html#5170" class="Bound">N</a><a id="5171" class="Symbol">}</a> <a id="5173" class="Symbol">(</a><a id="5174" href="plfa.Confluence.html#5174" class="Bound">L</a> <a id="5176" href="/PLFA-zh/Untyped/#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="5180" href="plfa.Confluence.html#5180" class="Bound">b</a> <a id="5182" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a> <a id="5184" href="plfa.Confluence.html#5184" class="Bound">bs</a><a id="5186" class="Symbol">)</a> <a id="5188" class="Symbol">=</a>
   <a id="5193" href="/PLFA-zh/Confluence/#5174" class="Bound">L</a> <a id="5195" href="plfa.Confluence.html#3901" class="InductiveConstructor Operator">⇛⟨</a> <a id="5198" href="plfa.Confluence.html#4501" class="Function">beta-par</a> <a id="5207" href="plfa.Confluence.html#5180" class="Bound">b</a> <a id="5209" href="plfa.Confluence.html#3901" class="InductiveConstructor Operator">⟩</a> <a id="5211" href="plfa.Confluence.html#5007" class="Function">betas-pars</a> <a id="5222" href="plfa.Confluence.html#5184" class="Bound">bs</a>
</pre>
<p>Now for the other direction, that <code class="highlighter-rouge">M ⇛* N</code> implies <code class="highlighter-rouge">M —↠ N</code>.  The
proof of this direction is a bit different because it’s not the case
that <code class="highlighter-rouge">M ⇛ N</code> implies <code class="highlighter-rouge">M —→ N</code>. After all, <code class="highlighter-rouge">M ⇛ N</code> performs many
reductions. So instead we shall prove that <code class="highlighter-rouge">M ⇛ N</code> implies <code class="highlighter-rouge">M —↠ N</code>.</p>

<pre class="Agda"><a id="par-betas"></a><a id="5503" href="/PLFA-zh/Confluence/#5503" class="Function">par-betas</a> <a id="5513" class="Symbol">:</a> <a id="5515" class="Symbol">∀{</a><a id="5517" href="plfa.Confluence.html#5517" class="Bound">Γ</a> <a id="5519" href="plfa.Confluence.html#5519" class="Bound">A</a><a id="5520" class="Symbol">}{</a><a id="5522" href="plfa.Confluence.html#5522" class="Bound">M</a> <a id="5524" href="plfa.Confluence.html#5524" class="Bound">N</a> <a id="5526" class="Symbol">:</a> <a id="5528" href="plfa.Confluence.html#5517" class="Bound">Γ</a> <a id="5530" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="5532" href="plfa.Confluence.html#5519" class="Bound">A</a><a id="5533" class="Symbol">}</a>
         <a id="5544" class="Symbol">→</a> <a id="5546" href="/PLFA-zh/Confluence/#5522" class="Bound">M</a> <a id="5548" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="5550" href="plfa.Confluence.html#5524" class="Bound">N</a>
           <a id="5563" class="Comment">------</a>
         <a id="5579" class="Symbol">→</a> <a id="5581" href="/PLFA-zh/Confluence/#5522" class="Bound">M</a> <a id="5583" href="/PLFA-zh/Untyped/#11203" class="Datatype Operator">—↠</a> <a id="5586" href="plfa.Confluence.html#5524" class="Bound">N</a>
<a id="5588" href="/PLFA-zh/Confluence/#5503" class="Function">par-betas</a> <a id="5598" class="Symbol">{</a><a id="5599" href="plfa.Confluence.html#5599" class="Bound">Γ</a><a id="5600" class="Symbol">}</a> <a id="5602" class="Symbol">{</a><a id="5603" href="plfa.Confluence.html#5603" class="Bound">A</a><a id="5604" class="Symbol">}</a> <a id="5606" class="Symbol">{</a><a id="5607" class="DottedPattern Symbol">.(</a><a id="5609" href="/PLFA-zh/Untyped/#4288" class="DottedPattern InductiveConstructor Operator">`</a> <a id="5611" class="DottedPattern Symbol">_)</a><a id="5613" class="Symbol">}</a> <a id="5615" class="Symbol">(</a><a id="5616" href="plfa.Confluence.html#2702" class="InductiveConstructor">pvar</a><a id="5620" class="Symbol">{</a><a id="5621" class="Argument">x</a> <a id="5623" class="Symbol">=</a> <a id="5625" href="plfa.Confluence.html#5625" class="Bound">x</a><a id="5626" class="Symbol">})</a> <a id="5629" class="Symbol">=</a> <a id="5631" class="Symbol">(</a><a id="5632" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="5634" href="plfa.Confluence.html#5625" class="Bound">x</a><a id="5635" class="Symbol">)</a> <a id="5637" href="plfa.Untyped.html#11253" class="InductiveConstructor Operator">∎</a>
<a id="5639" href="/PLFA-zh/Confluence/#5503" class="Function">par-betas</a> <a id="5649" class="Symbol">{</a><a id="5650" href="plfa.Confluence.html#5650" class="Bound">Γ</a><a id="5651" class="Symbol">}</a> <a id="5653" class="Symbol">{</a><a id="5654" href="/PLFA-zh/Untyped/#2876" class="InductiveConstructor">★</a><a id="5655" class="Symbol">}</a> <a id="5657" class="Symbol">{</a><a id="5658" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="5660" href="plfa.Confluence.html#5660" class="Bound">N</a><a id="5661" class="Symbol">}</a> <a id="5663" class="Symbol">(</a><a id="5664" href="plfa.Confluence.html#2772" class="InductiveConstructor">pabs</a> <a id="5669" href="plfa.Confluence.html#5669" class="Bound">p</a><a id="5670" class="Symbol">)</a> <a id="5672" class="Symbol">=</a> <a id="5674" href="plfa.Untyped.html#23725" class="Function">abs-cong</a> <a id="5683" class="Symbol">(</a><a id="5684" href="plfa.Confluence.html#5503" class="Function">par-betas</a> <a id="5694" href="plfa.Confluence.html#5669" class="Bound">p</a><a id="5695" class="Symbol">)</a>
<a id="5697" href="/PLFA-zh/Confluence/#5503" class="Function">par-betas</a> <a id="5707" class="Symbol">{</a><a id="5708" href="plfa.Confluence.html#5708" class="Bound">Γ</a><a id="5709" class="Symbol">}</a> <a id="5711" class="Symbol">{</a><a id="5712" href="/PLFA-zh/Untyped/#2876" class="InductiveConstructor">★</a><a id="5713" class="Symbol">}</a> <a id="5715" class="Symbol">{</a><a id="5716" href="plfa.Confluence.html#5716" class="Bound">L</a> <a id="5718" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="5720" href="plfa.Confluence.html#5720" class="Bound">M</a><a id="5721" class="Symbol">}</a> <a id="5723" class="Symbol">(</a><a id="5724" href="plfa.Confluence.html#2861" class="InductiveConstructor">papp</a> <a id="5729" href="plfa.Confluence.html#5729" class="Bound">p₁</a> <a id="5732" href="plfa.Confluence.html#5732" class="Bound">p₂</a><a id="5734" class="Symbol">)</a> <a id="5736" class="Symbol">=</a>
   <a id="5741" href="/PLFA-zh/Untyped/#21544" class="Function">—↠-trans</a> <a id="5750" class="Symbol">(</a><a id="5751" href="plfa.Untyped.html#22728" class="Function">appL-cong</a><a id="5760" class="Symbol">{</a><a id="5761" class="Argument">M</a> <a id="5763" class="Symbol">=</a> <a id="5765" href="/PLFA-zh/Confluence/#5720" class="Bound">M</a><a id="5766" class="Symbol">}</a> <a id="5768" class="Symbol">(</a><a id="5769" href="plfa.Confluence.html#5503" class="Function">par-betas</a> <a id="5779" href="plfa.Confluence.html#5729" class="Bound">p₁</a><a id="5781" class="Symbol">))</a> <a id="5784" class="Symbol">(</a><a id="5785" href="plfa.Untyped.html#23497" class="Function">appR-cong</a> <a id="5795" class="Symbol">(</a><a id="5796" href="plfa.Confluence.html#5503" class="Function">par-betas</a> <a id="5806" href="plfa.Confluence.html#5732" class="Bound">p₂</a><a id="5808" class="Symbol">))</a>
<a id="5811" href="/PLFA-zh/Confluence/#5503" class="Function">par-betas</a> <a id="5821" class="Symbol">{</a><a id="5822" href="plfa.Confluence.html#5822" class="Bound">Γ</a><a id="5823" class="Symbol">}</a> <a id="5825" class="Symbol">{</a><a id="5826" href="/PLFA-zh/Untyped/#2876" class="InductiveConstructor">★</a><a id="5827" class="Symbol">}</a> <a id="5829" class="Symbol">{(</a><a id="5831" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="5833" href="plfa.Confluence.html#5833" class="Bound">N</a><a id="5834" class="Symbol">)</a> <a id="5836" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="5838" href="plfa.Confluence.html#5838" class="Bound">M</a><a id="5839" class="Symbol">}</a> <a id="5841" class="Symbol">(</a><a id="5842" href="plfa.Confluence.html#2979" class="InductiveConstructor">pbeta</a><a id="5847" class="Symbol">{</a><a id="5848" class="Argument">N′</a> <a id="5851" class="Symbol">=</a> <a id="5853" href="plfa.Confluence.html#5853" class="Bound">N′</a><a id="5855" class="Symbol">}{</a><a id="5857" class="Argument">M′</a> <a id="5860" class="Symbol">=</a> <a id="5862" href="plfa.Confluence.html#5862" class="Bound">M′</a><a id="5864" class="Symbol">}</a> <a id="5866" href="plfa.Confluence.html#5866" class="Bound">p₁</a> <a id="5869" href="plfa.Confluence.html#5869" class="Bound">p₂</a><a id="5871" class="Symbol">)</a> <a id="5873" class="Symbol">=</a>
  <a id="5877" class="Keyword">let</a> <a id="5881" href="/PLFA-zh/Confluence/#5881" class="Bound">ih₁</a> <a id="5885" class="Symbol">=</a> <a id="5887" href="plfa.Confluence.html#5503" class="Function">par-betas</a> <a id="5897" href="plfa.Confluence.html#5866" class="Bound">p₁</a> <a id="5900" class="Keyword">in</a>
  <a id="5905" class="Keyword">let</a> <a id="5909" href="/PLFA-zh/Confluence/#5909" class="Bound">ih₂</a> <a id="5913" class="Symbol">=</a> <a id="5915" href="plfa.Confluence.html#5503" class="Function">par-betas</a> <a id="5925" href="plfa.Confluence.html#5869" class="Bound">p₂</a> <a id="5928" class="Keyword">in</a>
  <a id="5933" class="Keyword">let</a> <a id="5937" href="/PLFA-zh/Confluence/#5937" class="Bound">a</a> <a id="5939" class="Symbol">:</a> <a id="5941" class="Symbol">(</a><a id="5942" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="5944" href="plfa.Confluence.html#5833" class="Bound">N</a><a id="5945" class="Symbol">)</a> <a id="5947" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="5949" href="plfa.Confluence.html#5838" class="Bound">M</a> <a id="5951" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="5954" class="Symbol">(</a><a id="5955" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="5957" href="plfa.Confluence.html#5853" class="Bound">N′</a><a id="5959" class="Symbol">)</a> <a id="5961" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="5963" href="plfa.Confluence.html#5838" class="Bound">M</a>
      <a id="5971" href="/PLFA-zh/Confluence/#5937" class="Bound">a</a> <a id="5973" class="Symbol">=</a> <a id="5975" href="/PLFA-zh/Untyped/#22728" class="Function">appL-cong</a><a id="5984" class="Symbol">{</a><a id="5985" class="Argument">M</a> <a id="5987" class="Symbol">=</a> <a id="5989" href="plfa.Confluence.html#5838" class="Bound">M</a><a id="5990" class="Symbol">}</a> <a id="5992" class="Symbol">(</a><a id="5993" href="plfa.Untyped.html#23725" class="Function">abs-cong</a> <a id="6002" href="plfa.Confluence.html#5881" class="Bound">ih₁</a><a id="6005" class="Symbol">)</a> <a id="6007" class="Keyword">in</a>
  <a id="6012" class="Keyword">let</a> <a id="6016" href="/PLFA-zh/Confluence/#6016" class="Bound">b</a> <a id="6018" class="Symbol">:</a> <a id="6020" class="Symbol">(</a><a id="6021" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="6023" href="plfa.Confluence.html#5853" class="Bound">N′</a><a id="6025" class="Symbol">)</a> <a id="6027" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="6029" href="plfa.Confluence.html#5838" class="Bound">M</a> <a id="6031" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="6034" class="Symbol">(</a><a id="6035" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="6037" href="plfa.Confluence.html#5853" class="Bound">N′</a><a id="6039" class="Symbol">)</a> <a id="6041" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="6043" href="plfa.Confluence.html#5862" class="Bound">M′</a>
      <a id="6052" href="/PLFA-zh/Confluence/#6016" class="Bound">b</a> <a id="6054" class="Symbol">=</a> <a id="6056" href="/PLFA-zh/Untyped/#23497" class="Function">appR-cong</a><a id="6065" class="Symbol">{</a><a id="6066" class="Argument">L</a> <a id="6068" class="Symbol">=</a> <a id="6070" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="6072" href="plfa.Confluence.html#5853" class="Bound">N′</a><a id="6074" class="Symbol">}</a> <a id="6076" href="plfa.Confluence.html#5909" class="Bound">ih₂</a> <a id="6080" class="Keyword">in</a>
  <a id="6085" class="Keyword">let</a> <a id="6089" href="/PLFA-zh/Confluence/#6089" class="Bound">c</a> <a id="6091" class="Symbol">=</a> <a id="6093" class="Symbol">(</a><a id="6094" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="6096" href="plfa.Confluence.html#5853" class="Bound">N′</a><a id="6098" class="Symbol">)</a> <a id="6100" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="6102" href="plfa.Confluence.html#5862" class="Bound">M′</a> <a id="6105" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="6109" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a> <a id="6111" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a> <a id="6113" href="plfa.Confluence.html#5853" class="Bound">N′</a> <a id="6116" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="6118" href="plfa.Confluence.html#5862" class="Bound">M′</a> <a id="6121" href="plfa.Untyped.html#7449" class="Function Operator">]</a> <a id="6123" href="plfa.Untyped.html#11253" class="InductiveConstructor Operator">∎</a> <a id="6125" class="Keyword">in</a>
  <a id="6130" href="/PLFA-zh/Untyped/#21544" class="Function">—↠-trans</a> <a id="6139" class="Symbol">(</a><a id="6140" href="plfa.Untyped.html#21544" class="Function">—↠-trans</a> <a id="6149" href="/PLFA-zh/Confluence/#5937" class="Bound">a</a> <a id="6151" href="plfa.Confluence.html#6016" class="Bound">b</a><a id="6152" class="Symbol">)</a> <a id="6154" href="plfa.Confluence.html#6089" class="Bound">c</a>
</pre>
<p>The proof is by induction on <code class="highlighter-rouge">M ⇛ N</code>.</p>

<ul>
  <li>
    <p>Suppose <code class="highlighter-rouge">x ⇛ x</code>. We immediately have <code class="highlighter-rouge">x —↠ x</code>.</p>
  </li>
  <li>
    <p>Suppose <code class="highlighter-rouge">ƛ N ⇛ ƛ N′</code> because <code class="highlighter-rouge">N ⇛ N′</code>. By the induction hypothesis
we have <code class="highlighter-rouge">N —↠ N′</code>. We conclude that <code class="highlighter-rouge">ƛ N —↠ ƛ N′</code> because
<code class="highlighter-rouge">—↠</code> is a congruence.</p>
  </li>
  <li>
    <p>Suppose <code class="highlighter-rouge">L · M ⇛ L′ · M′</code> because <code class="highlighter-rouge">L ⇛ L′</code> and <code class="highlighter-rouge">M ⇛ M′</code>.
By the induction hypothesis, we have <code class="highlighter-rouge">L —↠ L′</code> and <code class="highlighter-rouge">M —↠ M′</code>.
So <code class="highlighter-rouge">L · M —↠ L′ · M</code> and then <code class="highlighter-rouge">L′ · M  —↠ L′ · M′</code>
because <code class="highlighter-rouge">—↠</code> is a congruence. We conclude using the transitity
of <code class="highlighter-rouge">—↠</code>.</p>
  </li>
  <li>
    <p>Suppose <code class="highlighter-rouge">(ƛ N) · M  ⇛  N′ [ M′ ]</code> because <code class="highlighter-rouge">N ⇛ N′</code> and <code class="highlighter-rouge">M ⇛ M′</code>.
By similar reasoning, we have
<code class="highlighter-rouge">(ƛ N) · M —↠ (ƛ N′) · M′</code>.
Of course, <code class="highlighter-rouge">(ƛ N′) · M′ —→ N′ [ M′ ]</code>, so we can conclude
using the transitivity of <code class="highlighter-rouge">—↠</code>.</p>
  </li>
</ul>

<p>With this lemma in hand, we complete the proof that <code class="highlighter-rouge">M ⇛* N</code> implies
<code class="highlighter-rouge">M —↠ N</code> with a simple induction on <code class="highlighter-rouge">M ⇛* N</code>.</p>

<pre class="Agda"><a id="pars-betas"></a><a id="7001" href="/PLFA-zh/Confluence/#7001" class="Function">pars-betas</a> <a id="7012" class="Symbol">:</a> <a id="7014" class="Symbol">∀{</a><a id="7016" href="plfa.Confluence.html#7016" class="Bound">Γ</a> <a id="7018" href="plfa.Confluence.html#7018" class="Bound">A</a><a id="7019" class="Symbol">}</a> <a id="7021" class="Symbol">{</a><a id="7022" href="plfa.Confluence.html#7022" class="Bound">M</a> <a id="7024" href="plfa.Confluence.html#7024" class="Bound">N</a> <a id="7026" class="Symbol">:</a> <a id="7028" href="plfa.Confluence.html#7016" class="Bound">Γ</a> <a id="7030" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="7032" href="plfa.Confluence.html#7018" class="Bound">A</a><a id="7033" class="Symbol">}</a>
           <a id="7046" class="Symbol">→</a> <a id="7048" href="/PLFA-zh/Confluence/#7022" class="Bound">M</a> <a id="7050" href="plfa.Confluence.html#3795" class="Datatype Operator">⇛*</a> <a id="7053" href="plfa.Confluence.html#7024" class="Bound">N</a>
             <a id="7068" class="Comment">------</a>
           <a id="7086" class="Symbol">→</a> <a id="7088" href="/PLFA-zh/Confluence/#7022" class="Bound">M</a> <a id="7090" href="/PLFA-zh/Untyped/#11203" class="Datatype Operator">—↠</a> <a id="7093" href="plfa.Confluence.html#7024" class="Bound">N</a>
<a id="7095" href="/PLFA-zh/Confluence/#7001" class="Function">pars-betas</a> <a id="7106" class="Symbol">(</a><a id="7107" href="plfa.Confluence.html#7107" class="Bound">M₁</a> <a id="7110" href="plfa.Confluence.html#3845" class="InductiveConstructor Operator">∎</a><a id="7111" class="Symbol">)</a> <a id="7113" class="Symbol">=</a> <a id="7115" href="plfa.Confluence.html#7107" class="Bound">M₁</a> <a id="7118" href="/PLFA-zh/Untyped/#11253" class="InductiveConstructor Operator">∎</a>
<a id="7120" href="/PLFA-zh/Confluence/#7001" class="Function">pars-betas</a> <a id="7131" class="Symbol">(</a><a id="7132" href="plfa.Confluence.html#7132" class="Bound">L</a> <a id="7134" href="plfa.Confluence.html#3901" class="InductiveConstructor Operator">⇛⟨</a> <a id="7137" href="plfa.Confluence.html#7137" class="Bound">p</a> <a id="7139" href="plfa.Confluence.html#3901" class="InductiveConstructor Operator">⟩</a> <a id="7141" href="plfa.Confluence.html#7141" class="Bound">ps</a><a id="7143" class="Symbol">)</a> <a id="7145" class="Symbol">=</a> <a id="7147" href="/PLFA-zh/Untyped/#21544" class="Function">—↠-trans</a> <a id="7156" class="Symbol">(</a><a id="7157" href="plfa.Confluence.html#5503" class="Function">par-betas</a> <a id="7167" href="plfa.Confluence.html#7137" class="Bound">p</a><a id="7168" class="Symbol">)</a> <a id="7170" class="Symbol">(</a><a id="7171" href="plfa.Confluence.html#7001" class="Function">pars-betas</a> <a id="7182" href="plfa.Confluence.html#7141" class="Bound">ps</a><a id="7184" class="Symbol">)</a>
</pre>

<h2 id="substitution-lemma-for-parallel-reduction">Substitution lemma for parallel reduction</h2>

<p>Our next goal is the prove the diamond property for parallel
reduction. But to do that, we need to prove that substitution
respects parallel reduction. That is, if
<code class="highlighter-rouge">N ⇛ N′</code> and <code class="highlighter-rouge">M ⇛ M′</code>, then <code class="highlighter-rouge">N [ M ] ⇛ N′ [ M′ ]</code>.
We cannot prove this directly by induction, so we
generalize it to: if <code class="highlighter-rouge">N ⇛ N′</code> and
the substitution <code class="highlighter-rouge">σ</code> pointwise parallel reduces to <code class="highlighter-rouge">τ</code>,
then <code class="highlighter-rouge">subst σ N ⇛ subst τ N′</code>. We define the notion
of pointwise parallel reduction as follows.</p>

<pre class="Agda"><a id="par-subst"></a><a id="7694" href="/PLFA-zh/Confluence/#7694" class="Function">par-subst</a> <a id="7704" class="Symbol">:</a> <a id="7706" class="Symbol">∀{</a><a id="7708" href="plfa.Confluence.html#7708" class="Bound">Γ</a> <a id="7710" href="plfa.Confluence.html#7710" class="Bound">Δ</a><a id="7711" class="Symbol">}</a> <a id="7713" class="Symbol">→</a> <a id="7715" href="/PLFA-zh/Substitution/#2446" class="Function">Subst</a> <a id="7721" href="plfa.Confluence.html#7708" class="Bound">Γ</a> <a id="7723" href="plfa.Confluence.html#7710" class="Bound">Δ</a> <a id="7725" class="Symbol">→</a> <a id="7727" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="7733" href="plfa.Confluence.html#7708" class="Bound">Γ</a> <a id="7735" href="plfa.Confluence.html#7710" class="Bound">Δ</a> <a id="7737" class="Symbol">→</a> <a id="7739" class="PrimitiveType">Set</a>
<a id="7743" href="/PLFA-zh/Confluence/#7694" class="Function">par-subst</a> <a id="7753" class="Symbol">{</a><a id="7754" href="plfa.Confluence.html#7754" class="Bound">Γ</a><a id="7755" class="Symbol">}{</a><a id="7757" href="plfa.Confluence.html#7757" class="Bound">Δ</a><a id="7758" class="Symbol">}</a> <a id="7760" href="plfa.Confluence.html#7760" class="Bound">σ</a> <a id="7762" href="plfa.Confluence.html#7762" class="Bound">σ′</a> <a id="7765" class="Symbol">=</a> <a id="7767" class="Symbol">∀{</a><a id="7769" href="plfa.Confluence.html#7769" class="Bound">A</a><a id="7770" class="Symbol">}{</a><a id="7772" href="plfa.Confluence.html#7772" class="Bound">x</a> <a id="7774" class="Symbol">:</a> <a id="7776" href="plfa.Confluence.html#7754" class="Bound">Γ</a> <a id="7778" href="/PLFA-zh/Untyped/#3483" class="Datatype Operator">∋</a> <a id="7780" href="plfa.Confluence.html#7769" class="Bound">A</a><a id="7781" class="Symbol">}</a> <a id="7783" class="Symbol">→</a> <a id="7785" href="plfa.Confluence.html#7760" class="Bound">σ</a> <a id="7787" href="plfa.Confluence.html#7772" class="Bound">x</a> <a id="7789" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="7791" href="plfa.Confluence.html#7762" class="Bound">σ′</a> <a id="7794" href="plfa.Confluence.html#7772" class="Bound">x</a>
</pre>
<p>Because substitution depends on the extension function <code class="highlighter-rouge">exts</code>, which
in turn relies on <code class="highlighter-rouge">rename</code>, we start with a version of the
substitution lemma, called <code class="highlighter-rouge">par-rename</code>, that is specialized to
renamings.  The proof of <code class="highlighter-rouge">par-rename</code> relies on the fact that renaming
and substitution commute with one another, which is a lemma that we
import from Chapter <a href="/PLFA-zh/Substitution/">Substitution</a>
and restate here.</p>

<pre class="Agda"><a id="rename-subst-commute"></a><a id="8224" href="/PLFA-zh/Confluence/#8224" class="Function">rename-subst-commute</a> <a id="8245" class="Symbol">:</a> <a id="8247" class="Symbol">∀{</a><a id="8249" href="plfa.Confluence.html#8249" class="Bound">Γ</a> <a id="8251" href="plfa.Confluence.html#8251" class="Bound">Δ</a><a id="8252" class="Symbol">}{</a><a id="8254" href="plfa.Confluence.html#8254" class="Bound">N</a> <a id="8256" class="Symbol">:</a> <a id="8258" href="plfa.Confluence.html#8249" class="Bound">Γ</a> <a id="8260" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="8262" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="8264" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="8266" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="8267" class="Symbol">}{</a><a id="8269" href="plfa.Confluence.html#8269" class="Bound">M</a> <a id="8271" class="Symbol">:</a> <a id="8273" href="plfa.Confluence.html#8249" class="Bound">Γ</a> <a id="8275" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="8277" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="8278" class="Symbol">}{</a><a id="8280" href="plfa.Confluence.html#8280" class="Bound">ρ</a> <a id="8282" class="Symbol">:</a> <a id="8284" href="/PLFA-zh/Substitution/#2233" class="Function">Rename</a> <a id="8291" href="plfa.Confluence.html#8249" class="Bound">Γ</a> <a id="8293" href="plfa.Confluence.html#8251" class="Bound">Δ</a> <a id="8295" class="Symbol">}</a>
    <a id="8301" class="Symbol">→</a> <a id="8303" class="Symbol">(</a><a id="8304" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="8311" class="Symbol">(</a><a id="8312" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="8316" href="/PLFA-zh/Confluence/#8280" class="Bound">ρ</a><a id="8317" class="Symbol">)</a> <a id="8319" href="plfa.Confluence.html#8254" class="Bound">N</a><a id="8320" class="Symbol">)</a> <a id="8322" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="8324" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="8331" href="plfa.Confluence.html#8280" class="Bound">ρ</a> <a id="8333" href="plfa.Confluence.html#8269" class="Bound">M</a> <a id="8335" href="plfa.Untyped.html#7449" class="Function Operator">]</a> <a id="8337" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="8339" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="8346" href="plfa.Confluence.html#8280" class="Bound">ρ</a> <a id="8348" class="Symbol">(</a><a id="8349" href="plfa.Confluence.html#8254" class="Bound">N</a> <a id="8351" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="8353" href="plfa.Confluence.html#8269" class="Bound">M</a> <a id="8355" href="plfa.Untyped.html#7449" class="Function Operator">]</a><a id="8356" class="Symbol">)</a>
<a id="8358" href="/PLFA-zh/Confluence/#8224" class="Function">rename-subst-commute</a> <a id="8379" class="Symbol">{</a><a id="8380" class="Argument">N</a> <a id="8382" class="Symbol">=</a> <a id="8384" href="plfa.Confluence.html#8384" class="Bound">N</a><a id="8385" class="Symbol">}</a> <a id="8387" class="Symbol">=</a> <a id="8389" href="/PLFA-zh/Substitution/#27994" class="Function">plfa.Substitution.rename-subst-commute</a> <a id="8428" class="Symbol">{</a><a id="8429" class="Argument">N</a> <a id="8431" class="Symbol">=</a> <a id="8433" href="plfa.Confluence.html#8384" class="Bound">N</a><a id="8434" class="Symbol">}</a>
</pre>
<p>Now for the <code class="highlighter-rouge">par-rename</code> lemma.</p>

<pre class="Agda"><a id="par-rename"></a><a id="8478" href="/PLFA-zh/Confluence/#8478" class="Function">par-rename</a> <a id="8489" class="Symbol">:</a> <a id="8491" class="Symbol">∀{</a><a id="8493" href="plfa.Confluence.html#8493" class="Bound">Γ</a> <a id="8495" href="plfa.Confluence.html#8495" class="Bound">Δ</a> <a id="8497" href="plfa.Confluence.html#8497" class="Bound">A</a><a id="8498" class="Symbol">}</a> <a id="8500" class="Symbol">{</a><a id="8501" href="plfa.Confluence.html#8501" class="Bound">ρ</a> <a id="8503" class="Symbol">:</a> <a id="8505" href="/PLFA-zh/Substitution/#2233" class="Function">Rename</a> <a id="8512" href="plfa.Confluence.html#8493" class="Bound">Γ</a> <a id="8514" href="plfa.Confluence.html#8495" class="Bound">Δ</a><a id="8515" class="Symbol">}</a> <a id="8517" class="Symbol">{</a><a id="8518" href="plfa.Confluence.html#8518" class="Bound">M</a> <a id="8520" href="plfa.Confluence.html#8520" class="Bound">M′</a> <a id="8523" class="Symbol">:</a> <a id="8525" href="plfa.Confluence.html#8493" class="Bound">Γ</a> <a id="8527" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="8529" href="plfa.Confluence.html#8497" class="Bound">A</a><a id="8530" class="Symbol">}</a>
  <a id="8534" class="Symbol">→</a> <a id="8536" href="/PLFA-zh/Confluence/#8518" class="Bound">M</a> <a id="8538" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="8540" href="plfa.Confluence.html#8520" class="Bound">M′</a>
    <a id="8547" class="Comment">------------------------</a>
  <a id="8574" class="Symbol">→</a> <a id="8576" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="8583" href="/PLFA-zh/Confluence/#8501" class="Bound">ρ</a> <a id="8585" href="plfa.Confluence.html#8518" class="Bound">M</a> <a id="8587" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="8589" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="8596" href="plfa.Confluence.html#8501" class="Bound">ρ</a> <a id="8598" href="plfa.Confluence.html#8520" class="Bound">M′</a>
<a id="8601" href="/PLFA-zh/Confluence/#8478" class="Function">par-rename</a> <a id="8612" href="plfa.Confluence.html#2702" class="InductiveConstructor">pvar</a> <a id="8617" class="Symbol">=</a> <a id="8619" href="plfa.Confluence.html#2702" class="InductiveConstructor">pvar</a>
<a id="8624" href="/PLFA-zh/Confluence/#8478" class="Function">par-rename</a> <a id="8635" class="Symbol">(</a><a id="8636" href="plfa.Confluence.html#2772" class="InductiveConstructor">pabs</a> <a id="8641" href="plfa.Confluence.html#8641" class="Bound">p</a><a id="8642" class="Symbol">)</a> <a id="8644" class="Symbol">=</a> <a id="8646" href="plfa.Confluence.html#2772" class="InductiveConstructor">pabs</a> <a id="8651" class="Symbol">(</a><a id="8652" href="plfa.Confluence.html#8478" class="Function">par-rename</a> <a id="8663" href="plfa.Confluence.html#8641" class="Bound">p</a><a id="8664" class="Symbol">)</a>
<a id="8666" href="/PLFA-zh/Confluence/#8478" class="Function">par-rename</a> <a id="8677" class="Symbol">(</a><a id="8678" href="plfa.Confluence.html#2861" class="InductiveConstructor">papp</a> <a id="8683" href="plfa.Confluence.html#8683" class="Bound">p₁</a> <a id="8686" href="plfa.Confluence.html#8686" class="Bound">p₂</a><a id="8688" class="Symbol">)</a> <a id="8690" class="Symbol">=</a> <a id="8692" href="plfa.Confluence.html#2861" class="InductiveConstructor">papp</a> <a id="8697" class="Symbol">(</a><a id="8698" href="plfa.Confluence.html#8478" class="Function">par-rename</a> <a id="8709" href="plfa.Confluence.html#8683" class="Bound">p₁</a><a id="8711" class="Symbol">)</a> <a id="8713" class="Symbol">(</a><a id="8714" href="plfa.Confluence.html#8478" class="Function">par-rename</a> <a id="8725" href="plfa.Confluence.html#8686" class="Bound">p₂</a><a id="8727" class="Symbol">)</a>
<a id="8729" href="/PLFA-zh/Confluence/#8478" class="Function">par-rename</a> <a id="8740" class="Symbol">{</a><a id="8741" href="plfa.Confluence.html#8741" class="Bound">Γ</a><a id="8742" class="Symbol">}{</a><a id="8744" href="plfa.Confluence.html#8744" class="Bound">Δ</a><a id="8745" class="Symbol">}{</a><a id="8747" href="plfa.Confluence.html#8747" class="Bound">A</a><a id="8748" class="Symbol">}{</a><a id="8750" href="plfa.Confluence.html#8750" class="Bound">ρ</a><a id="8751" class="Symbol">}</a> <a id="8753" class="Symbol">(</a><a id="8754" href="plfa.Confluence.html#2979" class="InductiveConstructor">pbeta</a><a id="8759" class="Symbol">{</a><a id="8760" href="plfa.Confluence.html#8741" class="Bound">Γ</a><a id="8761" class="Symbol">}{</a><a id="8763" href="plfa.Confluence.html#8763" class="Bound">N</a><a id="8764" class="Symbol">}{</a><a id="8766" href="plfa.Confluence.html#8766" class="Bound">N′</a><a id="8768" class="Symbol">}{</a><a id="8770" href="plfa.Confluence.html#8770" class="Bound">M</a><a id="8771" class="Symbol">}{</a><a id="8773" href="plfa.Confluence.html#8773" class="Bound">M′</a><a id="8775" class="Symbol">}</a> <a id="8777" href="plfa.Confluence.html#8777" class="Bound">p₁</a> <a id="8780" href="plfa.Confluence.html#8780" class="Bound">p₂</a><a id="8782" class="Symbol">)</a>
     <a id="8789" class="Keyword">with</a> <a id="8794" href="/PLFA-zh/Confluence/#2979" class="InductiveConstructor">pbeta</a> <a id="8800" class="Symbol">(</a><a id="8801" href="plfa.Confluence.html#8478" class="Function">par-rename</a><a id="8811" class="Symbol">{</a><a id="8812" class="Argument">ρ</a> <a id="8814" class="Symbol">=</a> <a id="8816" href="/PLFA-zh/Untyped/#5883" class="Function">ext</a> <a id="8820" href="plfa.Confluence.html#8750" class="Bound">ρ</a><a id="8821" class="Symbol">}</a> <a id="8823" href="plfa.Confluence.html#8777" class="Bound">p₁</a><a id="8825" class="Symbol">)</a> <a id="8827" class="Symbol">(</a><a id="8828" href="plfa.Confluence.html#8478" class="Function">par-rename</a><a id="8838" class="Symbol">{</a><a id="8839" class="Argument">ρ</a> <a id="8841" class="Symbol">=</a> <a id="8843" href="plfa.Confluence.html#8750" class="Bound">ρ</a><a id="8844" class="Symbol">}</a> <a id="8846" href="plfa.Confluence.html#8780" class="Bound">p₂</a><a id="8848" class="Symbol">)</a>
<a id="8850" class="Symbol">...</a> <a id="8854" class="Symbol">|</a> <a id="8856" href="/PLFA-zh/Confluence/#8856" class="Bound">G</a> <a id="8858" class="Keyword">rewrite</a> <a id="8866" href="plfa.Confluence.html#8224" class="Function">rename-subst-commute</a><a id="8886" class="Symbol">{</a><a id="8887" class="Bound">Γ</a><a id="8888" class="Symbol">}{</a><a id="8890" class="Bound">Δ</a><a id="8891" class="Symbol">}{</a><a id="8893" class="Bound">N′</a><a id="8895" class="Symbol">}{</a><a id="8897" class="Bound">M′</a><a id="8899" class="Symbol">}{</a><a id="8901" class="Bound">ρ</a><a id="8902" class="Symbol">}</a> <a id="8904" class="Symbol">=</a> <a id="8906" href="plfa.Confluence.html#8856" class="Bound">G</a>

</pre>
<p>The proof is by induction on <code class="highlighter-rouge">M ⇛ M′</code>. The first four cases
are straightforward so we just consider the last one for <code class="highlighter-rouge">pbeta</code>.</p>

<ul>
  <li>Suppose <code class="highlighter-rouge">(ƛ N) · M  ⇛  N′ [ M′ ]</code> because <code class="highlighter-rouge">N ⇛ N′</code> and <code class="highlighter-rouge">M ⇛ M′</code>.
By the induction hypothesis, we have
<code class="highlighter-rouge">rename (ext ρ) N ⇛ rename (ext ρ) N′</code> and
<code class="highlighter-rouge">rename ρ M ⇛ rename ρ M′</code>.
So by <code class="highlighter-rouge">pbeta</code> we have
<code class="highlighter-rouge">(ƛ rename (ext ρ) N) · (rename ρ M) ⇛ (rename (ext ρ) N) [ rename ρ M ]</code>.
However, to conclude we instead need parallel reduction to
<code class="highlighter-rouge">rename ρ (N [ M ])</code>. But thankfully, renaming and substitution
commute with one another.</li>
</ul>

<p>With the <code class="highlighter-rouge">par-rename</code> lemma in hand, it is straightforward to show
that extending substitutions preserves the pointwise parallel
reduction relation.</p>

<pre class="Agda"><a id="par-subst-exts"></a><a id="9634" href="/PLFA-zh/Confluence/#9634" class="Function">par-subst-exts</a> <a id="9649" class="Symbol">:</a> <a id="9651" class="Symbol">∀{</a><a id="9653" href="plfa.Confluence.html#9653" class="Bound">Γ</a> <a id="9655" href="plfa.Confluence.html#9655" class="Bound">Δ</a><a id="9656" class="Symbol">}</a> <a id="9658" class="Symbol">{</a><a id="9659" href="plfa.Confluence.html#9659" class="Bound">σ</a> <a id="9661" href="plfa.Confluence.html#9661" class="Bound">τ</a> <a id="9663" class="Symbol">:</a> <a id="9665" href="/PLFA-zh/Substitution/#2446" class="Function">Subst</a> <a id="9671" href="plfa.Confluence.html#9653" class="Bound">Γ</a> <a id="9673" href="plfa.Confluence.html#9655" class="Bound">Δ</a><a id="9674" class="Symbol">}</a>
   <a id="9679" class="Symbol">→</a> <a id="9681" href="/PLFA-zh/Confluence/#7694" class="Function">par-subst</a> <a id="9691" href="plfa.Confluence.html#9659" class="Bound">σ</a> <a id="9693" href="plfa.Confluence.html#9661" class="Bound">τ</a>
   <a id="9698" class="Symbol">→</a> <a id="9700" class="Symbol">∀{</a><a id="9702" href="/PLFA-zh/Confluence/#9702" class="Bound">B</a><a id="9703" class="Symbol">}</a> <a id="9705" class="Symbol">→</a> <a id="9707" href="plfa.Confluence.html#7694" class="Function">par-subst</a> <a id="9717" class="Symbol">(</a><a id="9718" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="9723" href="plfa.Confluence.html#9659" class="Bound">σ</a> <a id="9725" class="Symbol">{</a><a id="9726" class="Argument">B</a> <a id="9728" class="Symbol">=</a> <a id="9730" href="plfa.Confluence.html#9702" class="Bound">B</a><a id="9731" class="Symbol">})</a> <a id="9734" class="Symbol">(</a><a id="9735" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="9740" href="plfa.Confluence.html#9661" class="Bound">τ</a><a id="9741" class="Symbol">)</a>
<a id="9743" href="/PLFA-zh/Confluence/#9634" class="Function">par-subst-exts</a> <a id="9758" href="plfa.Confluence.html#9758" class="Bound">s</a> <a id="9760" class="Symbol">{</a><a id="9761" class="Argument">x</a> <a id="9763" class="Symbol">=</a> <a id="9765" href="/PLFA-zh/Untyped/#3519" class="InductiveConstructor">Z</a><a id="9766" class="Symbol">}</a> <a id="9768" class="Symbol">=</a> <a id="9770" href="plfa.Confluence.html#2702" class="InductiveConstructor">pvar</a>
<a id="9775" href="/PLFA-zh/Confluence/#9634" class="Function">par-subst-exts</a> <a id="9790" href="plfa.Confluence.html#9790" class="Bound">s</a> <a id="9792" class="Symbol">{</a><a id="9793" class="Argument">x</a> <a id="9795" class="Symbol">=</a> <a id="9797" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="9799" href="plfa.Confluence.html#9799" class="Bound">x</a><a id="9800" class="Symbol">}</a> <a id="9802" class="Symbol">=</a> <a id="9804" href="plfa.Confluence.html#8478" class="Function">par-rename</a> <a id="9815" href="plfa.Confluence.html#9790" class="Bound">s</a>
</pre>
<p>The next lemma that we need to prove that substitution respects
parallel reduction is the following one, which states that
simultaneoous substitution commutes with single substitution. We import this
lemma from Chapter <a href="/PLFA-zh/Substitution/">Substitution</a>
and restate it below.</p>

<pre class="Agda"><a id="subst-commute"></a><a id="10117" href="/PLFA-zh/Confluence/#10117" class="Function">subst-commute</a> <a id="10131" class="Symbol">:</a> <a id="10133" class="Symbol">∀{</a><a id="10135" href="plfa.Confluence.html#10135" class="Bound">Γ</a> <a id="10137" href="plfa.Confluence.html#10137" class="Bound">Δ</a><a id="10138" class="Symbol">}{</a><a id="10140" href="plfa.Confluence.html#10140" class="Bound">N</a> <a id="10142" class="Symbol">:</a> <a id="10144" href="plfa.Confluence.html#10135" class="Bound">Γ</a> <a id="10146" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="10148" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="10150" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="10152" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="10153" class="Symbol">}{</a><a id="10155" href="plfa.Confluence.html#10155" class="Bound">M</a> <a id="10157" class="Symbol">:</a> <a id="10159" href="plfa.Confluence.html#10135" class="Bound">Γ</a> <a id="10161" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="10163" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="10164" class="Symbol">}{</a><a id="10166" href="plfa.Confluence.html#10166" class="Bound">σ</a> <a id="10168" class="Symbol">:</a> <a id="10170" href="/PLFA-zh/Substitution/#2446" class="Function">Subst</a> <a id="10176" href="plfa.Confluence.html#10135" class="Bound">Γ</a> <a id="10178" href="plfa.Confluence.html#10137" class="Bound">Δ</a> <a id="10180" class="Symbol">}</a>
    <a id="10186" class="Symbol">→</a> <a id="10188" href="/PLFA-zh/Untyped/#6921" class="Function">subst</a> <a id="10194" class="Symbol">(</a><a id="10195" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="10200" href="/PLFA-zh/Confluence/#10166" class="Bound">σ</a><a id="10201" class="Symbol">)</a> <a id="10203" href="plfa.Confluence.html#10140" class="Bound">N</a> <a id="10205" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="10207" href="plfa.Untyped.html#6921" class="Function">subst</a> <a id="10213" href="plfa.Confluence.html#10166" class="Bound">σ</a> <a id="10215" href="plfa.Confluence.html#10155" class="Bound">M</a> <a id="10217" href="plfa.Untyped.html#7449" class="Function Operator">]</a> <a id="10219" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="10221" href="plfa.Untyped.html#6921" class="Function">subst</a> <a id="10227" href="plfa.Confluence.html#10166" class="Bound">σ</a> <a id="10229" class="Symbol">(</a><a id="10230" href="plfa.Confluence.html#10140" class="Bound">N</a> <a id="10232" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="10234" href="plfa.Confluence.html#10155" class="Bound">M</a> <a id="10236" href="plfa.Untyped.html#7449" class="Function Operator">]</a><a id="10237" class="Symbol">)</a>
<a id="10239" href="/PLFA-zh/Confluence/#10117" class="Function">subst-commute</a> <a id="10253" class="Symbol">{</a><a id="10254" class="Argument">N</a> <a id="10256" class="Symbol">=</a> <a id="10258" href="plfa.Confluence.html#10258" class="Bound">N</a><a id="10259" class="Symbol">}</a> <a id="10261" class="Symbol">=</a> <a id="10263" href="/PLFA-zh/Substitution/#26453" class="Function">plfa.Substitution.subst-commute</a> <a id="10295" class="Symbol">{</a><a id="10296" class="Argument">N</a> <a id="10298" class="Symbol">=</a> <a id="10300" href="plfa.Confluence.html#10258" class="Bound">N</a><a id="10301" class="Symbol">}</a>
</pre>
<p>We are ready to prove that substitution respects parallel reduction.</p>

<pre class="Agda"><a id="subst-par"></a><a id="10382" href="/PLFA-zh/Confluence/#10382" class="Function">subst-par</a> <a id="10392" class="Symbol">:</a> <a id="10394" class="Symbol">∀{</a><a id="10396" href="plfa.Confluence.html#10396" class="Bound">Γ</a> <a id="10398" href="plfa.Confluence.html#10398" class="Bound">Δ</a> <a id="10400" href="plfa.Confluence.html#10400" class="Bound">A</a><a id="10401" class="Symbol">}</a> <a id="10403" class="Symbol">{</a><a id="10404" href="plfa.Confluence.html#10404" class="Bound">σ</a> <a id="10406" href="plfa.Confluence.html#10406" class="Bound">τ</a> <a id="10408" class="Symbol">:</a> <a id="10410" href="/PLFA-zh/Substitution/#2446" class="Function">Subst</a> <a id="10416" href="plfa.Confluence.html#10396" class="Bound">Γ</a> <a id="10418" href="plfa.Confluence.html#10398" class="Bound">Δ</a><a id="10419" class="Symbol">}</a> <a id="10421" class="Symbol">{</a><a id="10422" href="plfa.Confluence.html#10422" class="Bound">M</a> <a id="10424" href="plfa.Confluence.html#10424" class="Bound">M′</a> <a id="10427" class="Symbol">:</a> <a id="10429" href="plfa.Confluence.html#10396" class="Bound">Γ</a> <a id="10431" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="10433" href="plfa.Confluence.html#10400" class="Bound">A</a><a id="10434" class="Symbol">}</a>
   <a id="10439" class="Symbol">→</a> <a id="10441" href="/PLFA-zh/Confluence/#7694" class="Function">par-subst</a> <a id="10451" href="plfa.Confluence.html#10404" class="Bound">σ</a> <a id="10453" href="plfa.Confluence.html#10406" class="Bound">τ</a>  <a id="10456" class="Symbol">→</a>  <a id="10459" href="plfa.Confluence.html#10422" class="Bound">M</a> <a id="10461" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="10463" href="plfa.Confluence.html#10424" class="Bound">M′</a>
     <a id="10471" class="Comment">--------------------------</a>
   <a id="10501" class="Symbol">→</a> <a id="10503" href="/PLFA-zh/Untyped/#6921" class="Function">subst</a> <a id="10509" href="/PLFA-zh/Confluence/#10404" class="Bound">σ</a> <a id="10511" href="plfa.Confluence.html#10422" class="Bound">M</a> <a id="10513" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="10515" href="plfa.Untyped.html#6921" class="Function">subst</a> <a id="10521" href="plfa.Confluence.html#10406" class="Bound">τ</a> <a id="10523" href="plfa.Confluence.html#10424" class="Bound">M′</a>
<a id="10526" href="/PLFA-zh/Confluence/#10382" class="Function">subst-par</a> <a id="10536" class="Symbol">{</a><a id="10537" href="plfa.Confluence.html#10537" class="Bound">Γ</a><a id="10538" class="Symbol">}</a> <a id="10540" class="Symbol">{</a><a id="10541" href="plfa.Confluence.html#10541" class="Bound">Δ</a><a id="10542" class="Symbol">}</a> <a id="10544" class="Symbol">{</a><a id="10545" href="plfa.Confluence.html#10545" class="Bound">A</a><a id="10546" class="Symbol">}</a> <a id="10548" class="Symbol">{</a><a id="10549" href="plfa.Confluence.html#10549" class="Bound">σ</a><a id="10550" class="Symbol">}</a> <a id="10552" class="Symbol">{</a><a id="10553" href="plfa.Confluence.html#10553" class="Bound">τ</a><a id="10554" class="Symbol">}</a> <a id="10556" class="Symbol">{</a><a id="10557" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="10559" href="plfa.Confluence.html#10559" class="Bound">x</a><a id="10560" class="Symbol">}</a> <a id="10562" href="plfa.Confluence.html#10562" class="Bound">s</a> <a id="10564" href="plfa.Confluence.html#2702" class="InductiveConstructor">pvar</a> <a id="10569" class="Symbol">=</a> <a id="10571" href="plfa.Confluence.html#10562" class="Bound">s</a>
<a id="10573" href="/PLFA-zh/Confluence/#10382" class="Function">subst-par</a> <a id="10583" class="Symbol">{</a><a id="10584" href="plfa.Confluence.html#10584" class="Bound">Γ</a><a id="10585" class="Symbol">}</a> <a id="10587" class="Symbol">{</a><a id="10588" href="plfa.Confluence.html#10588" class="Bound">Δ</a><a id="10589" class="Symbol">}</a> <a id="10591" class="Symbol">{</a><a id="10592" href="plfa.Confluence.html#10592" class="Bound">A</a><a id="10593" class="Symbol">}</a> <a id="10595" class="Symbol">{</a><a id="10596" href="plfa.Confluence.html#10596" class="Bound">σ</a><a id="10597" class="Symbol">}</a> <a id="10599" class="Symbol">{</a><a id="10600" href="plfa.Confluence.html#10600" class="Bound">τ</a><a id="10601" class="Symbol">}</a> <a id="10603" class="Symbol">{</a><a id="10604" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="10606" href="plfa.Confluence.html#10606" class="Bound">N</a><a id="10607" class="Symbol">}</a> <a id="10609" href="plfa.Confluence.html#10609" class="Bound">s</a> <a id="10611" class="Symbol">(</a><a id="10612" href="plfa.Confluence.html#2772" class="InductiveConstructor">pabs</a> <a id="10617" href="plfa.Confluence.html#10617" class="Bound">p</a><a id="10618" class="Symbol">)</a> <a id="10620" class="Symbol">=</a>
   <a id="10625" href="/PLFA-zh/Confluence/#2772" class="InductiveConstructor">pabs</a> <a id="10630" class="Symbol">(</a><a id="10631" href="plfa.Confluence.html#10382" class="Function">subst-par</a> <a id="10641" class="Symbol">{</a><a id="10642" class="Argument">σ</a> <a id="10644" class="Symbol">=</a> <a id="10646" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="10651" href="plfa.Confluence.html#10596" class="Bound">σ</a><a id="10652" class="Symbol">}</a> <a id="10654" class="Symbol">{</a><a id="10655" class="Argument">τ</a> <a id="10657" class="Symbol">=</a> <a id="10659" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="10664" href="plfa.Confluence.html#10600" class="Bound">τ</a><a id="10665" class="Symbol">}</a>
            <a id="10679" class="Symbol">(λ</a> <a id="10682" class="Symbol">{</a><a id="10683" href="/PLFA-zh/Confluence/#10683" class="Bound">A</a><a id="10684" class="Symbol">}{</a><a id="10686" href="plfa.Confluence.html#10686" class="Bound">x</a><a id="10687" class="Symbol">}</a> <a id="10689" class="Symbol">→</a> <a id="10691" href="plfa.Confluence.html#9634" class="Function">par-subst-exts</a> <a id="10706" href="plfa.Confluence.html#10609" class="Bound">s</a> <a id="10708" class="Symbol">{</a><a id="10709" class="Argument">x</a> <a id="10711" class="Symbol">=</a> <a id="10713" href="plfa.Confluence.html#10686" class="Bound">x</a><a id="10714" class="Symbol">})</a> <a id="10717" href="plfa.Confluence.html#10617" class="Bound">p</a><a id="10718" class="Symbol">)</a>
<a id="10720" href="/PLFA-zh/Confluence/#10382" class="Function">subst-par</a> <a id="10730" class="Symbol">{</a><a id="10731" href="plfa.Confluence.html#10731" class="Bound">Γ</a><a id="10732" class="Symbol">}</a> <a id="10734" class="Symbol">{</a><a id="10735" href="plfa.Confluence.html#10735" class="Bound">Δ</a><a id="10736" class="Symbol">}</a> <a id="10738" class="Symbol">{</a><a id="10739" href="/PLFA-zh/Untyped/#2876" class="InductiveConstructor">★</a><a id="10740" class="Symbol">}</a> <a id="10742" class="Symbol">{</a><a id="10743" href="plfa.Confluence.html#10743" class="Bound">σ</a><a id="10744" class="Symbol">}</a> <a id="10746" class="Symbol">{</a><a id="10747" href="plfa.Confluence.html#10747" class="Bound">τ</a><a id="10748" class="Symbol">}</a> <a id="10750" class="Symbol">{</a><a id="10751" href="plfa.Confluence.html#10751" class="Bound">L</a> <a id="10753" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="10755" href="plfa.Confluence.html#10755" class="Bound">M</a><a id="10756" class="Symbol">}</a> <a id="10758" href="plfa.Confluence.html#10758" class="Bound">s</a> <a id="10760" class="Symbol">(</a><a id="10761" href="plfa.Confluence.html#2861" class="InductiveConstructor">papp</a> <a id="10766" href="plfa.Confluence.html#10766" class="Bound">p₁</a> <a id="10769" href="plfa.Confluence.html#10769" class="Bound">p₂</a><a id="10771" class="Symbol">)</a> <a id="10773" class="Symbol">=</a>
   <a id="10778" href="/PLFA-zh/Confluence/#2861" class="InductiveConstructor">papp</a> <a id="10783" class="Symbol">(</a><a id="10784" href="plfa.Confluence.html#10382" class="Function">subst-par</a> <a id="10794" href="plfa.Confluence.html#10758" class="Bound">s</a> <a id="10796" href="plfa.Confluence.html#10766" class="Bound">p₁</a><a id="10798" class="Symbol">)</a> <a id="10800" class="Symbol">(</a><a id="10801" href="plfa.Confluence.html#10382" class="Function">subst-par</a> <a id="10811" href="plfa.Confluence.html#10758" class="Bound">s</a> <a id="10813" href="plfa.Confluence.html#10769" class="Bound">p₂</a><a id="10815" class="Symbol">)</a>
<a id="10817" href="/PLFA-zh/Confluence/#10382" class="Function">subst-par</a> <a id="10827" class="Symbol">{</a><a id="10828" href="plfa.Confluence.html#10828" class="Bound">Γ</a><a id="10829" class="Symbol">}</a> <a id="10831" class="Symbol">{</a><a id="10832" href="plfa.Confluence.html#10832" class="Bound">Δ</a><a id="10833" class="Symbol">}</a> <a id="10835" class="Symbol">{</a><a id="10836" href="/PLFA-zh/Untyped/#2876" class="InductiveConstructor">★</a><a id="10837" class="Symbol">}</a> <a id="10839" class="Symbol">{</a><a id="10840" href="plfa.Confluence.html#10840" class="Bound">σ</a><a id="10841" class="Symbol">}</a> <a id="10843" class="Symbol">{</a><a id="10844" href="plfa.Confluence.html#10844" class="Bound">τ</a><a id="10845" class="Symbol">}</a> <a id="10847" class="Symbol">{(</a><a id="10849" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="10851" href="plfa.Confluence.html#10851" class="Bound">N</a><a id="10852" class="Symbol">)</a> <a id="10854" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="10856" href="plfa.Confluence.html#10856" class="Bound">M</a><a id="10857" class="Symbol">}</a> <a id="10859" href="plfa.Confluence.html#10859" class="Bound">s</a> <a id="10861" class="Symbol">(</a><a id="10862" href="plfa.Confluence.html#2979" class="InductiveConstructor">pbeta</a><a id="10867" class="Symbol">{</a><a id="10868" class="Argument">N′</a> <a id="10871" class="Symbol">=</a> <a id="10873" href="plfa.Confluence.html#10873" class="Bound">N′</a><a id="10875" class="Symbol">}{</a><a id="10877" class="Argument">M′</a> <a id="10880" class="Symbol">=</a> <a id="10882" href="plfa.Confluence.html#10882" class="Bound">M′</a><a id="10884" class="Symbol">}</a> <a id="10886" href="plfa.Confluence.html#10886" class="Bound">p₁</a> <a id="10889" href="plfa.Confluence.html#10889" class="Bound">p₂</a><a id="10891" class="Symbol">)</a>
    <a id="10897" class="Keyword">with</a> <a id="10902" href="/PLFA-zh/Confluence/#2979" class="InductiveConstructor">pbeta</a> <a id="10908" class="Symbol">(</a><a id="10909" href="plfa.Confluence.html#10382" class="Function">subst-par</a><a id="10918" class="Symbol">{</a><a id="10919" class="Argument">σ</a> <a id="10921" class="Symbol">=</a> <a id="10923" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="10928" href="plfa.Confluence.html#10840" class="Bound">σ</a><a id="10929" class="Symbol">}{</a><a id="10931" class="Argument">τ</a> <a id="10933" class="Symbol">=</a> <a id="10935" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="10940" href="plfa.Confluence.html#10844" class="Bound">τ</a><a id="10941" class="Symbol">}{</a><a id="10943" class="Argument">M</a> <a id="10945" class="Symbol">=</a> <a id="10947" href="plfa.Confluence.html#10851" class="Bound">N</a><a id="10948" class="Symbol">}</a>
                        <a id="10974" class="Symbol">(λ{</a><a id="10977" href="/PLFA-zh/Confluence/#10977" class="Bound">A</a><a id="10978" class="Symbol">}{</a><a id="10980" href="plfa.Confluence.html#10980" class="Bound">x</a><a id="10981" class="Symbol">}</a> <a id="10983" class="Symbol">→</a> <a id="10985" href="plfa.Confluence.html#9634" class="Function">par-subst-exts</a> <a id="11000" href="plfa.Confluence.html#10859" class="Bound">s</a> <a id="11002" class="Symbol">{</a><a id="11003" class="Argument">x</a> <a id="11005" class="Symbol">=</a> <a id="11007" href="plfa.Confluence.html#10980" class="Bound">x</a><a id="11008" class="Symbol">})</a> <a id="11011" href="plfa.Confluence.html#10886" class="Bound">p₁</a><a id="11013" class="Symbol">)</a>
               <a id="11030" class="Symbol">(</a><a id="11031" href="/PLFA-zh/Confluence/#10382" class="Function">subst-par</a> <a id="11041" class="Symbol">{</a><a id="11042" class="Argument">σ</a> <a id="11044" class="Symbol">=</a> <a id="11046" href="plfa.Confluence.html#10840" class="Bound">σ</a><a id="11047" class="Symbol">}</a> <a id="11049" href="plfa.Confluence.html#10859" class="Bound">s</a> <a id="11051" href="plfa.Confluence.html#10889" class="Bound">p₂</a><a id="11053" class="Symbol">)</a>
<a id="11055" class="Symbol">...</a> <a id="11059" class="Symbol">|</a> <a id="11061" href="/PLFA-zh/Confluence/#11061" class="Bound">G</a> <a id="11063" class="Keyword">rewrite</a> <a id="11071" href="plfa.Confluence.html#10117" class="Function">subst-commute</a><a id="11084" class="Symbol">{</a><a id="11085" class="Argument">N</a> <a id="11087" class="Symbol">=</a> <a id="11089" class="Bound">N′</a><a id="11091" class="Symbol">}{</a><a id="11093" class="Argument">M</a> <a id="11095" class="Symbol">=</a> <a id="11097" class="Bound">M′</a><a id="11099" class="Symbol">}{</a><a id="11101" class="Argument">σ</a> <a id="11103" class="Symbol">=</a> <a id="11105" class="Bound">τ</a><a id="11106" class="Symbol">}</a> <a id="11108" class="Symbol">=</a>
    <a id="11114" href="/PLFA-zh/Confluence/#11061" class="Bound">G</a>
</pre>
<p>We proceed by induction on <code class="highlighter-rouge">M ⇛ M′</code>.</p>

<ul>
  <li>
    <p>Suppose <code class="highlighter-rouge">x ⇛ x</code>. We conclude that <code class="highlighter-rouge">σ x ⇛ τ x</code> using
the premise <code class="highlighter-rouge">par-subst σ τ</code>.</p>
  </li>
  <li>
    <p>Suppose <code class="highlighter-rouge">ƛ N ⇛ ƛ N′</code> because <code class="highlighter-rouge">N ⇛ N′</code>.
To use the induction hypothesis, we need <code class="highlighter-rouge">par-subst (exts σ) (exts τ)</code>,
which we obtain by <code class="highlighter-rouge">par-subst-exts</code>.
So we have <code class="highlighter-rouge">subst (exts σ) N ⇛ subst (exts τ) N′</code>
and conclude by rule <code class="highlighter-rouge">pabs</code>.</p>
  </li>
  <li>
    <p>Suppose <code class="highlighter-rouge">L · M ⇛ L′ · M′</code> because <code class="highlighter-rouge">L ⇛ L′</code> and <code class="highlighter-rouge">M ⇛ M′</code>.
By the induction hypothesis we have
<code class="highlighter-rouge">subst σ L ⇛ subst τ L′</code> and <code class="highlighter-rouge">subst σ M ⇛ subst τ M′</code>, so
we conclude by rule <code class="highlighter-rouge">papp</code>.</p>
  </li>
  <li>
    <p>Suppose <code class="highlighter-rouge">(ƛ N) · M  ⇛  N′ [ M′ ]</code> because <code class="highlighter-rouge">N ⇛ N′</code> and <code class="highlighter-rouge">M ⇛ M′</code>.
Again we obtain <code class="highlighter-rouge">par-subst (exts σ) (exts τ)</code> by <code class="highlighter-rouge">par-subst-exts</code>.
So by the induction hypothesis, we have
<code class="highlighter-rouge">subst (exts σ) N ⇛ subst (exts τ) N′</code> and
<code class="highlighter-rouge">subst σ M ⇛ subst τ M′</code>. Then by rule <code class="highlighter-rouge">pbeta</code>, we have parallel reduction
to <code class="highlighter-rouge">subst (exts τ) N′ [ subst τ M′ ]</code>.
Substitution commutes with itself in the following sense.
For any σ, N, and M, we have</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  (subst (exts σ) N) [ subst σ M ] ≡ subst σ (N [ M ])
</code></pre></div>    </div>

    <p>So we have parallel reduction to <code class="highlighter-rouge">subst τ (N′ [ M′ ])</code>.</p>
  </li>
</ul>

<p>Of course, if <code class="highlighter-rouge">M ⇛ M′</code>, then <code class="highlighter-rouge">subst-zero M</code> pointwise parallel reduces
to <code class="highlighter-rouge">subst-zero M′</code>.</p>

<pre class="Agda"><a id="par-subst-zero"></a><a id="12322" href="/PLFA-zh/Confluence/#12322" class="Function">par-subst-zero</a> <a id="12337" class="Symbol">:</a> <a id="12339" class="Symbol">∀{</a><a id="12341" href="plfa.Confluence.html#12341" class="Bound">Γ</a><a id="12342" class="Symbol">}{</a><a id="12344" href="plfa.Confluence.html#12344" class="Bound">A</a><a id="12345" class="Symbol">}{</a><a id="12347" href="plfa.Confluence.html#12347" class="Bound">M</a> <a id="12349" href="plfa.Confluence.html#12349" class="Bound">M′</a> <a id="12352" class="Symbol">:</a> <a id="12354" href="plfa.Confluence.html#12341" class="Bound">Γ</a> <a id="12356" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="12358" href="plfa.Confluence.html#12344" class="Bound">A</a><a id="12359" class="Symbol">}</a>
       <a id="12368" class="Symbol">→</a> <a id="12370" href="/PLFA-zh/Confluence/#12347" class="Bound">M</a> <a id="12372" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="12374" href="plfa.Confluence.html#12349" class="Bound">M′</a>
       <a id="12384" class="Symbol">→</a> <a id="12386" href="/PLFA-zh/Confluence/#7694" class="Function">par-subst</a> <a id="12396" class="Symbol">(</a><a id="12397" href="/PLFA-zh/Untyped/#7333" class="Function">subst-zero</a> <a id="12408" href="plfa.Confluence.html#12347" class="Bound">M</a><a id="12409" class="Symbol">)</a> <a id="12411" class="Symbol">(</a><a id="12412" href="plfa.Untyped.html#7333" class="Function">subst-zero</a> <a id="12423" href="plfa.Confluence.html#12349" class="Bound">M′</a><a id="12425" class="Symbol">)</a>
<a id="12427" href="/PLFA-zh/Confluence/#12322" class="Function">par-subst-zero</a> <a id="12442" class="Symbol">{</a><a id="12443" href="plfa.Confluence.html#12443" class="Bound">M</a><a id="12444" class="Symbol">}</a> <a id="12446" class="Symbol">{</a><a id="12447" href="plfa.Confluence.html#12447" class="Bound">M′</a><a id="12449" class="Symbol">}</a> <a id="12451" href="plfa.Confluence.html#12451" class="Bound">p</a> <a id="12453" class="Symbol">{</a><a id="12454" href="plfa.Confluence.html#12454" class="Bound">A</a><a id="12455" class="Symbol">}</a> <a id="12457" class="Symbol">{</a><a id="12458" href="/PLFA-zh/Untyped/#3519" class="InductiveConstructor">Z</a><a id="12459" class="Symbol">}</a> <a id="12461" class="Symbol">=</a> <a id="12463" href="plfa.Confluence.html#12451" class="Bound">p</a>
<a id="12465" href="/PLFA-zh/Confluence/#12322" class="Function">par-subst-zero</a> <a id="12480" class="Symbol">{</a><a id="12481" href="plfa.Confluence.html#12481" class="Bound">M</a><a id="12482" class="Symbol">}</a> <a id="12484" class="Symbol">{</a><a id="12485" href="plfa.Confluence.html#12485" class="Bound">M′</a><a id="12487" class="Symbol">}</a> <a id="12489" href="plfa.Confluence.html#12489" class="Bound">p</a> <a id="12491" class="Symbol">{</a><a id="12492" href="plfa.Confluence.html#12492" class="Bound">A</a><a id="12493" class="Symbol">}</a> <a id="12495" class="Symbol">{</a><a id="12496" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="12498" href="plfa.Confluence.html#12498" class="Bound">x</a><a id="12499" class="Symbol">}</a> <a id="12501" class="Symbol">=</a> <a id="12503" href="plfa.Confluence.html#2702" class="InductiveConstructor">pvar</a>
</pre>
<p>We conclude this section with the desired corollary, that substitution
respects parallel reduction.</p>

<pre class="Agda"><a id="sub-par"></a><a id="12618" href="/PLFA-zh/Confluence/#12618" class="Function">sub-par</a> <a id="12626" class="Symbol">:</a> <a id="12628" class="Symbol">∀{</a><a id="12630" href="plfa.Confluence.html#12630" class="Bound">Γ</a> <a id="12632" href="plfa.Confluence.html#12632" class="Bound">A</a> <a id="12634" href="plfa.Confluence.html#12634" class="Bound">B</a><a id="12635" class="Symbol">}</a> <a id="12637" class="Symbol">{</a><a id="12638" href="plfa.Confluence.html#12638" class="Bound">N</a> <a id="12640" href="plfa.Confluence.html#12640" class="Bound">N′</a> <a id="12643" class="Symbol">:</a> <a id="12645" href="plfa.Confluence.html#12630" class="Bound">Γ</a> <a id="12647" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="12649" href="plfa.Confluence.html#12632" class="Bound">A</a> <a id="12651" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="12653" href="plfa.Confluence.html#12634" class="Bound">B</a><a id="12654" class="Symbol">}</a> <a id="12656" class="Symbol">{</a><a id="12657" href="plfa.Confluence.html#12657" class="Bound">M</a> <a id="12659" href="plfa.Confluence.html#12659" class="Bound">M′</a> <a id="12662" class="Symbol">:</a> <a id="12664" href="plfa.Confluence.html#12630" class="Bound">Γ</a> <a id="12666" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="12668" href="plfa.Confluence.html#12632" class="Bound">A</a><a id="12669" class="Symbol">}</a>
   <a id="12674" class="Symbol">→</a> <a id="12676" href="/PLFA-zh/Confluence/#12638" class="Bound">N</a> <a id="12678" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="12680" href="plfa.Confluence.html#12640" class="Bound">N′</a>
   <a id="12686" class="Symbol">→</a> <a id="12688" href="/PLFA-zh/Confluence/#12657" class="Bound">M</a> <a id="12690" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="12692" href="plfa.Confluence.html#12659" class="Bound">M′</a>
     <a id="12700" class="Comment">--------------------------</a>
   <a id="12730" class="Symbol">→</a> <a id="12732" href="/PLFA-zh/Confluence/#12638" class="Bound">N</a> <a id="12734" href="/PLFA-zh/Untyped/#7449" class="Function Operator">[</a> <a id="12736" href="plfa.Confluence.html#12657" class="Bound">M</a> <a id="12738" href="plfa.Untyped.html#7449" class="Function Operator">]</a> <a id="12740" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="12742" href="plfa.Confluence.html#12640" class="Bound">N′</a> <a id="12745" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="12747" href="plfa.Confluence.html#12659" class="Bound">M′</a> <a id="12750" href="plfa.Untyped.html#7449" class="Function Operator">]</a>
<a id="12752" href="/PLFA-zh/Confluence/#12618" class="Function">sub-par</a> <a id="12760" href="plfa.Confluence.html#12760" class="Bound">pn</a> <a id="12763" href="plfa.Confluence.html#12763" class="Bound">pm</a> <a id="12766" class="Symbol">=</a> <a id="12768" href="plfa.Confluence.html#10382" class="Function">subst-par</a> <a id="12778" class="Symbol">(</a><a id="12779" href="plfa.Confluence.html#12322" class="Function">par-subst-zero</a> <a id="12794" href="plfa.Confluence.html#12763" class="Bound">pm</a><a id="12796" class="Symbol">)</a> <a id="12798" href="plfa.Confluence.html#12760" class="Bound">pn</a>
</pre>

<h2 id="parallel-reduction-satisfies-the-diamond-property">Parallel reduction satisfies the diamond property</h2>

<p>The heart of the confluence proof is made of stone, or rather, of
diamond!  We show that parallel reduction satisfies the diamond
property: that if <code class="highlighter-rouge">M ⇛ N</code> and <code class="highlighter-rouge">M ⇛ N′</code>, then <code class="highlighter-rouge">N ⇛ L</code> and <code class="highlighter-rouge">N′ ⇛ L</code> for
some <code class="highlighter-rouge">L</code>.  The proof is relatively easy; it is parallel reduction’s
<em>raison d’etre</em>.</p>

<pre class="Agda"><a id="par-diamond"></a><a id="13151" href="/PLFA-zh/Confluence/#13151" class="Function">par-diamond</a> <a id="13163" class="Symbol">:</a> <a id="13165" class="Symbol">∀{</a><a id="13167" href="plfa.Confluence.html#13167" class="Bound">Γ</a> <a id="13169" href="plfa.Confluence.html#13169" class="Bound">A</a><a id="13170" class="Symbol">}</a> <a id="13172" class="Symbol">{</a><a id="13173" href="plfa.Confluence.html#13173" class="Bound">M</a> <a id="13175" href="plfa.Confluence.html#13175" class="Bound">N</a> <a id="13177" href="plfa.Confluence.html#13177" class="Bound">N′</a> <a id="13180" class="Symbol">:</a> <a id="13182" href="plfa.Confluence.html#13167" class="Bound">Γ</a> <a id="13184" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="13186" href="plfa.Confluence.html#13169" class="Bound">A</a><a id="13187" class="Symbol">}</a>
  <a id="13191" class="Symbol">→</a> <a id="13193" href="/PLFA-zh/Confluence/#13173" class="Bound">M</a> <a id="13195" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="13197" href="plfa.Confluence.html#13175" class="Bound">N</a>
  <a id="13201" class="Symbol">→</a> <a id="13203" href="/PLFA-zh/Confluence/#13173" class="Bound">M</a> <a id="13205" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="13207" href="plfa.Confluence.html#13177" class="Bound">N′</a>
    <a id="13214" class="Comment">---------------------------------</a>
  <a id="13250" class="Symbol">→</a> <a id="13252" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="13255" href="/PLFA-zh/Confluence/#13255" class="Bound">L</a> <a id="13257" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="13259" href="plfa.Confluence.html#13167" class="Bound">Γ</a> <a id="13261" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="13263" href="plfa.Confluence.html#13169" class="Bound">A</a> <a id="13265" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="13267" class="Symbol">(</a><a id="13268" href="plfa.Confluence.html#13175" class="Bound">N</a> <a id="13270" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="13272" href="plfa.Confluence.html#13255" class="Bound">L</a><a id="13273" class="Symbol">)</a> <a id="13275" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a> <a id="13277" class="Symbol">(</a><a id="13278" href="plfa.Confluence.html#13177" class="Bound">N′</a> <a id="13281" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="13283" href="plfa.Confluence.html#13255" class="Bound">L</a><a id="13284" class="Symbol">)</a>
<a id="13286" href="/PLFA-zh/Confluence/#13151" class="Function">par-diamond</a> <a id="13298" class="Symbol">(</a><a id="13299" href="plfa.Confluence.html#2702" class="InductiveConstructor">pvar</a><a id="13303" class="Symbol">{</a><a id="13304" class="Argument">x</a> <a id="13306" class="Symbol">=</a> <a id="13308" href="plfa.Confluence.html#13308" class="Bound">x</a><a id="13309" class="Symbol">})</a> <a id="13312" href="plfa.Confluence.html#2702" class="InductiveConstructor">pvar</a> <a id="13317" class="Symbol">=</a> <a id="13319" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13321" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="13323" href="plfa.Confluence.html#13308" class="Bound">x</a> <a id="13325" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13327" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13329" href="plfa.Confluence.html#2702" class="InductiveConstructor">pvar</a> <a id="13334" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13336" href="plfa.Confluence.html#2702" class="InductiveConstructor">pvar</a> <a id="13341" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="13343" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="13345" href="/PLFA-zh/Confluence/#13151" class="Function">par-diamond</a> <a id="13357" class="Symbol">(</a><a id="13358" href="plfa.Confluence.html#2772" class="InductiveConstructor">pabs</a> <a id="13363" href="plfa.Confluence.html#13363" class="Bound">p1</a><a id="13365" class="Symbol">)</a> <a id="13367" class="Symbol">(</a><a id="13368" href="plfa.Confluence.html#2772" class="InductiveConstructor">pabs</a> <a id="13373" href="plfa.Confluence.html#13373" class="Bound">p2</a><a id="13375" class="Symbol">)</a>
    <a id="13381" class="Keyword">with</a> <a id="13386" href="/PLFA-zh/Confluence/#13151" class="Function">par-diamond</a> <a id="13398" href="plfa.Confluence.html#13363" class="Bound">p1</a> <a id="13401" href="plfa.Confluence.html#13373" class="Bound">p2</a>
<a id="13404" class="Symbol">...</a> <a id="13408" class="Symbol">|</a> <a id="13410" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13412" href="/PLFA-zh/Confluence/#13412" class="Bound">L′</a> <a id="13415" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13417" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13419" href="plfa.Confluence.html#13419" class="Bound">p3</a> <a id="13422" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13424" href="plfa.Confluence.html#13424" class="Bound">p4</a> <a id="13427" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="13429" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="13431" class="Symbol">=</a>
      <a id="13439" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13441" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="13443" href="/PLFA-zh/Confluence/#13412" class="Bound">L′</a> <a id="13446" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13448" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13450" href="plfa.Confluence.html#2772" class="InductiveConstructor">pabs</a> <a id="13455" href="plfa.Confluence.html#13419" class="Bound">p3</a> <a id="13458" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13460" href="plfa.Confluence.html#2772" class="InductiveConstructor">pabs</a> <a id="13465" href="plfa.Confluence.html#13424" class="Bound">p4</a> <a id="13468" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="13470" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="13472" href="/PLFA-zh/Confluence/#13151" class="Function">par-diamond</a><a id="13483" class="Symbol">{</a><a id="13484" href="plfa.Confluence.html#13484" class="Bound">Γ</a><a id="13485" class="Symbol">}{</a><a id="13487" href="plfa.Confluence.html#13487" class="Bound">A</a><a id="13488" class="Symbol">}{</a><a id="13490" href="plfa.Confluence.html#13490" class="Bound">L</a> <a id="13492" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="13494" href="plfa.Confluence.html#13494" class="Bound">M</a><a id="13495" class="Symbol">}{</a><a id="13497" href="plfa.Confluence.html#13497" class="Bound">N</a><a id="13498" class="Symbol">}{</a><a id="13500" href="plfa.Confluence.html#13500" class="Bound">N′</a><a id="13502" class="Symbol">}</a> <a id="13504" class="Symbol">(</a><a id="13505" href="plfa.Confluence.html#2861" class="InductiveConstructor">papp</a><a id="13509" class="Symbol">{</a><a id="13510" href="plfa.Confluence.html#13484" class="Bound">Γ</a><a id="13511" class="Symbol">}{</a><a id="13513" href="plfa.Confluence.html#13490" class="Bound">L</a><a id="13514" class="Symbol">}{</a><a id="13516" href="plfa.Confluence.html#13516" class="Bound">L₁</a><a id="13518" class="Symbol">}{</a><a id="13520" href="plfa.Confluence.html#13494" class="Bound">M</a><a id="13521" class="Symbol">}{</a><a id="13523" href="plfa.Confluence.html#13523" class="Bound">M₁</a><a id="13525" class="Symbol">}</a> <a id="13527" href="plfa.Confluence.html#13527" class="Bound">p1</a> <a id="13530" href="plfa.Confluence.html#13530" class="Bound">p3</a><a id="13532" class="Symbol">)</a>
                                <a id="13566" class="Symbol">(</a><a id="13567" href="/PLFA-zh/Confluence/#2861" class="InductiveConstructor">papp</a><a id="13571" class="Symbol">{</a><a id="13572" href="plfa.Confluence.html#13484" class="Bound">Γ</a><a id="13573" class="Symbol">}{</a><a id="13575" href="plfa.Confluence.html#13490" class="Bound">L</a><a id="13576" class="Symbol">}{</a><a id="13578" href="plfa.Confluence.html#13578" class="Bound">L₂</a><a id="13580" class="Symbol">}{</a><a id="13582" href="plfa.Confluence.html#13494" class="Bound">M</a><a id="13583" class="Symbol">}{</a><a id="13585" href="plfa.Confluence.html#13585" class="Bound">M₂</a><a id="13587" class="Symbol">}</a> <a id="13589" href="plfa.Confluence.html#13589" class="Bound">p2</a> <a id="13592" href="plfa.Confluence.html#13592" class="Bound">p4</a><a id="13594" class="Symbol">)</a>
    <a id="13600" class="Keyword">with</a> <a id="13605" href="/PLFA-zh/Confluence/#13151" class="Function">par-diamond</a> <a id="13617" href="plfa.Confluence.html#13527" class="Bound">p1</a> <a id="13620" href="plfa.Confluence.html#13589" class="Bound">p2</a>
<a id="13623" class="Symbol">...</a> <a id="13627" class="Symbol">|</a> <a id="13629" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13631" href="/PLFA-zh/Confluence/#13631" class="Bound">L₃</a> <a id="13634" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13636" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13638" href="plfa.Confluence.html#13638" class="Bound">p5</a> <a id="13641" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13643" href="plfa.Confluence.html#13643" class="Bound">p6</a> <a id="13646" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="13648" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
    <a id="13654" class="Keyword">with</a> <a id="13659" href="/PLFA-zh/Confluence/#13151" class="Function">par-diamond</a> <a id="13671" class="Bound">p3</a> <a id="13674" class="Bound">p4</a>
<a id="13677" class="Symbol">...</a> <a id="13681" class="Symbol">|</a> <a id="13683" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13685" href="/PLFA-zh/Confluence/#13685" class="Bound">M₃</a> <a id="13688" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13690" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13692" href="plfa.Confluence.html#13692" class="Bound">p7</a> <a id="13695" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13697" href="plfa.Confluence.html#13697" class="Bound">p8</a> <a id="13700" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="13702" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="13704" class="Symbol">=</a>
      <a id="13712" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13714" class="Symbol">(</a><a id="13715" class="Bound">L₃</a> <a id="13718" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="13720" href="/PLFA-zh/Confluence/#13685" class="Bound">M₃</a><a id="13722" class="Symbol">)</a> <a id="13724" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13726" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13728" class="Symbol">(</a><a id="13729" href="plfa.Confluence.html#2861" class="InductiveConstructor">papp</a> <a id="13734" class="Bound">p5</a> <a id="13737" href="plfa.Confluence.html#13692" class="Bound">p7</a><a id="13739" class="Symbol">)</a> <a id="13741" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13743" class="Symbol">(</a><a id="13744" href="plfa.Confluence.html#2861" class="InductiveConstructor">papp</a> <a id="13749" class="Bound">p6</a> <a id="13752" href="plfa.Confluence.html#13697" class="Bound">p8</a><a id="13754" class="Symbol">)</a> <a id="13756" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="13758" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="13760" href="/PLFA-zh/Confluence/#13151" class="Function">par-diamond</a> <a id="13772" class="Symbol">(</a><a id="13773" href="plfa.Confluence.html#2861" class="InductiveConstructor">papp</a> <a id="13778" class="Symbol">(</a><a id="13779" href="plfa.Confluence.html#2772" class="InductiveConstructor">pabs</a> <a id="13784" href="plfa.Confluence.html#13784" class="Bound">p1</a><a id="13786" class="Symbol">)</a> <a id="13788" href="plfa.Confluence.html#13788" class="Bound">p3</a><a id="13790" class="Symbol">)</a> <a id="13792" class="Symbol">(</a><a id="13793" href="plfa.Confluence.html#2979" class="InductiveConstructor">pbeta</a> <a id="13799" href="plfa.Confluence.html#13799" class="Bound">p2</a> <a id="13802" href="plfa.Confluence.html#13802" class="Bound">p4</a><a id="13804" class="Symbol">)</a>
    <a id="13810" class="Keyword">with</a> <a id="13815" href="/PLFA-zh/Confluence/#13151" class="Function">par-diamond</a> <a id="13827" href="plfa.Confluence.html#13784" class="Bound">p1</a> <a id="13830" href="plfa.Confluence.html#13799" class="Bound">p2</a>
<a id="13833" class="Symbol">...</a> <a id="13837" class="Symbol">|</a> <a id="13839" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13841" href="/PLFA-zh/Confluence/#13841" class="Bound">N₃</a> <a id="13844" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13846" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13848" href="plfa.Confluence.html#13848" class="Bound">p5</a> <a id="13851" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13853" href="plfa.Confluence.html#13853" class="Bound">p6</a> <a id="13856" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="13858" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
    <a id="13864" class="Keyword">with</a> <a id="13869" href="/PLFA-zh/Confluence/#13151" class="Function">par-diamond</a> <a id="13881" class="Bound">p3</a> <a id="13884" class="Bound">p4</a>
<a id="13887" class="Symbol">...</a> <a id="13891" class="Symbol">|</a> <a id="13893" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13895" href="/PLFA-zh/Confluence/#13895" class="Bound">M₃</a> <a id="13898" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13900" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13902" href="plfa.Confluence.html#13902" class="Bound">p7</a> <a id="13905" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13907" href="plfa.Confluence.html#13907" class="Bound">p8</a> <a id="13910" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="13912" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="13914" class="Symbol">=</a>
    <a id="13920" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13922" class="Bound">N₃</a> <a id="13925" href="/PLFA-zh/Untyped/#7449" class="Function Operator">[</a> <a id="13927" href="/PLFA-zh/Confluence/#13895" class="Bound">M₃</a> <a id="13930" href="plfa.Untyped.html#7449" class="Function Operator">]</a> <a id="13932" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13934" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="13936" href="plfa.Confluence.html#2979" class="InductiveConstructor">pbeta</a> <a id="13942" class="Bound">p5</a> <a id="13945" href="plfa.Confluence.html#13902" class="Bound">p7</a> <a id="13948" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="13950" href="plfa.Confluence.html#12618" class="Function">sub-par</a> <a id="13958" class="Bound">p6</a> <a id="13961" href="plfa.Confluence.html#13907" class="Bound">p8</a> <a id="13964" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="13966" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="13968" href="/PLFA-zh/Confluence/#13151" class="Function">par-diamond</a> <a id="13980" class="Symbol">(</a><a id="13981" href="plfa.Confluence.html#2979" class="InductiveConstructor">pbeta</a> <a id="13987" href="plfa.Confluence.html#13987" class="Bound">p1</a> <a id="13990" href="plfa.Confluence.html#13990" class="Bound">p3</a><a id="13992" class="Symbol">)</a> <a id="13994" class="Symbol">(</a><a id="13995" href="plfa.Confluence.html#2861" class="InductiveConstructor">papp</a> <a id="14000" class="Symbol">(</a><a id="14001" href="plfa.Confluence.html#2772" class="InductiveConstructor">pabs</a> <a id="14006" href="plfa.Confluence.html#14006" class="Bound">p2</a><a id="14008" class="Symbol">)</a> <a id="14010" href="plfa.Confluence.html#14010" class="Bound">p4</a><a id="14012" class="Symbol">)</a>
    <a id="14018" class="Keyword">with</a> <a id="14023" href="/PLFA-zh/Confluence/#13151" class="Function">par-diamond</a> <a id="14035" href="plfa.Confluence.html#13987" class="Bound">p1</a> <a id="14038" href="plfa.Confluence.html#14006" class="Bound">p2</a>
<a id="14041" class="Symbol">...</a> <a id="14045" class="Symbol">|</a> <a id="14047" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14049" href="/PLFA-zh/Confluence/#14049" class="Bound">N₃</a> <a id="14052" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14054" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14056" href="plfa.Confluence.html#14056" class="Bound">p5</a> <a id="14059" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14061" href="plfa.Confluence.html#14061" class="Bound">p6</a> <a id="14064" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="14066" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
    <a id="14072" class="Keyword">with</a> <a id="14077" href="/PLFA-zh/Confluence/#13151" class="Function">par-diamond</a> <a id="14089" class="Bound">p3</a> <a id="14092" class="Bound">p4</a>
<a id="14095" class="Symbol">...</a> <a id="14099" class="Symbol">|</a> <a id="14101" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14103" href="/PLFA-zh/Confluence/#14103" class="Bound">M₃</a> <a id="14106" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14108" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14110" href="plfa.Confluence.html#14110" class="Bound">p7</a> <a id="14113" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14115" href="plfa.Confluence.html#14115" class="Bound">p8</a> <a id="14118" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="14120" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="14122" class="Symbol">=</a>
    <a id="14128" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14130" class="Symbol">(</a><a id="14131" class="Bound">N₃</a> <a id="14134" href="/PLFA-zh/Untyped/#7449" class="Function Operator">[</a> <a id="14136" href="/PLFA-zh/Confluence/#14103" class="Bound">M₃</a> <a id="14139" href="plfa.Untyped.html#7449" class="Function Operator">]</a><a id="14140" class="Symbol">)</a> <a id="14142" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14144" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14146" href="plfa.Confluence.html#12618" class="Function">sub-par</a> <a id="14154" class="Bound">p5</a>  <a id="14158" href="plfa.Confluence.html#14110" class="Bound">p7</a> <a id="14161" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14163" href="plfa.Confluence.html#2979" class="InductiveConstructor">pbeta</a> <a id="14169" class="Bound">p6</a> <a id="14172" href="plfa.Confluence.html#14115" class="Bound">p8</a> <a id="14175" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="14177" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="14179" href="/PLFA-zh/Confluence/#13151" class="Function">par-diamond</a> <a id="14191" class="Symbol">{</a><a id="14192" href="plfa.Confluence.html#14192" class="Bound">Γ</a><a id="14193" class="Symbol">}{</a><a id="14195" href="plfa.Confluence.html#14195" class="Bound">A</a><a id="14196" class="Symbol">}</a> <a id="14198" class="Symbol">(</a><a id="14199" href="plfa.Confluence.html#2979" class="InductiveConstructor">pbeta</a> <a id="14205" href="plfa.Confluence.html#14205" class="Bound">p1</a> <a id="14208" href="plfa.Confluence.html#14208" class="Bound">p3</a><a id="14210" class="Symbol">)</a> <a id="14212" class="Symbol">(</a><a id="14213" href="plfa.Confluence.html#2979" class="InductiveConstructor">pbeta</a> <a id="14219" href="plfa.Confluence.html#14219" class="Bound">p2</a> <a id="14222" href="plfa.Confluence.html#14222" class="Bound">p4</a><a id="14224" class="Symbol">)</a>
    <a id="14230" class="Keyword">with</a> <a id="14235" href="/PLFA-zh/Confluence/#13151" class="Function">par-diamond</a> <a id="14247" href="plfa.Confluence.html#14205" class="Bound">p1</a> <a id="14250" href="plfa.Confluence.html#14219" class="Bound">p2</a>
<a id="14253" class="Symbol">...</a> <a id="14257" class="Symbol">|</a> <a id="14259" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14261" href="/PLFA-zh/Confluence/#14261" class="Bound">N₃</a> <a id="14264" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14266" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14268" href="plfa.Confluence.html#14268" class="Bound">p5</a> <a id="14271" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14273" href="plfa.Confluence.html#14273" class="Bound">p6</a> <a id="14276" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="14278" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
    <a id="14284" class="Keyword">with</a> <a id="14289" href="/PLFA-zh/Confluence/#13151" class="Function">par-diamond</a> <a id="14301" class="Bound">p3</a> <a id="14304" class="Bound">p4</a>
<a id="14307" class="Symbol">...</a> <a id="14311" class="Symbol">|</a> <a id="14313" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14315" href="/PLFA-zh/Confluence/#14315" class="Bound">M₃</a> <a id="14318" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14320" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14322" href="plfa.Confluence.html#14322" class="Bound">p7</a> <a id="14325" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14327" href="plfa.Confluence.html#14327" class="Bound">p8</a> <a id="14330" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="14332" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="14334" class="Symbol">=</a>
      <a id="14342" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14344" class="Bound">N₃</a> <a id="14347" href="/PLFA-zh/Untyped/#7449" class="Function Operator">[</a> <a id="14349" href="/PLFA-zh/Confluence/#14315" class="Bound">M₃</a> <a id="14352" href="plfa.Untyped.html#7449" class="Function Operator">]</a> <a id="14354" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14356" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14358" href="plfa.Confluence.html#12618" class="Function">sub-par</a> <a id="14366" class="Bound">p5</a> <a id="14369" href="plfa.Confluence.html#14322" class="Bound">p7</a> <a id="14372" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14374" href="plfa.Confluence.html#12618" class="Function">sub-par</a> <a id="14382" class="Bound">p6</a> <a id="14385" href="plfa.Confluence.html#14327" class="Bound">p8</a> <a id="14388" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="14390" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>The proof is by induction on both premises.</p>

<ul>
  <li>
    <p>Suppose <code class="highlighter-rouge">x ⇛ x</code> and <code class="highlighter-rouge">x ⇛ x</code>.
We choose <code class="highlighter-rouge">L = x</code> and immediately have <code class="highlighter-rouge">x ⇛ x</code> and <code class="highlighter-rouge">x ⇛ x</code>.</p>
  </li>
  <li>
    <p>Suppose <code class="highlighter-rouge">ƛ N ⇛ ƛ N₁</code> and <code class="highlighter-rouge">ƛ N ⇛ ƛ N₂</code>.
By the induction hypothesis, there exists <code class="highlighter-rouge">L′</code> such that
<code class="highlighter-rouge">N₁ ⇛ L′</code> and <code class="highlighter-rouge">N₂ ⇛ L′</code>. We choose <code class="highlighter-rouge">L = ƛ L′</code> and
by <code class="highlighter-rouge">pabs</code> conclude that <code class="highlighter-rouge">ƛ N₁ ⇛ ƛ L′</code> and `ƛ N₂ ⇛ ƛ L′.</p>
  </li>
  <li>
    <p>Suppose that <code class="highlighter-rouge">L · M ⇛ L₁ · M₁</code> and <code class="highlighter-rouge">L · M ⇛ L₂ · M₂</code>.
By the induction hypothesis we have
<code class="highlighter-rouge">L₁ ⇛ L₃</code> and <code class="highlighter-rouge">L₂ ⇛ L₃</code> for some <code class="highlighter-rouge">L₃</code>.
Likewise, we have
<code class="highlighter-rouge">M₁ ⇛ M₃</code> and <code class="highlighter-rouge">M₂ ⇛ M₃</code> for some <code class="highlighter-rouge">M₃</code>.
We choose <code class="highlighter-rouge">L = L₃ · M₃</code> and conclude with two uses of <code class="highlighter-rouge">papp</code>.</p>
  </li>
  <li>
    <p>Suppose that <code class="highlighter-rouge">(ƛ N) · M ⇛ (ƛ N₁) · M₁</code> and <code class="highlighter-rouge">(ƛ N) · M ⇛ N₂ [ M₂ ]</code>
By the induction hypothesis we have
<code class="highlighter-rouge">N₁ ⇛ N₃</code> and <code class="highlighter-rouge">N₂ ⇛ N₃</code> for some <code class="highlighter-rouge">N₃</code>.
Likewise, we have
<code class="highlighter-rouge">M₁ ⇛ M₃</code> and <code class="highlighter-rouge">M₂ ⇛ M₃</code> for some <code class="highlighter-rouge">M₃</code>.
We choose <code class="highlighter-rouge">L = N₃ [ M₃ ]</code>.
We have <code class="highlighter-rouge">(ƛ N₁) · M₁ ⇛ N₃ [ M₃ ]</code> by rule <code class="highlighter-rouge">pbeta</code>
and conclude that <code class="highlighter-rouge">N₂ [ M₂ ] ⇛ N₃ [ M₃ ]</code> because
substitution respects parallel reduction.</p>
  </li>
  <li>
    <p>Suppose that <code class="highlighter-rouge">(ƛ N) · M ⇛ N₁ [ M₁ ]</code> and <code class="highlighter-rouge">(ƛ N) · M ⇛ (ƛ N₂) · M₂</code>.
The proof of this case is the mirror image of the last one.</p>
  </li>
  <li>
    <p>Suppose that <code class="highlighter-rouge">(ƛ N) · M ⇛ N₁ [ M₁ ]</code> and <code class="highlighter-rouge">(ƛ N) · M ⇛ N₂ [ M₂ ]</code>.
By the induction hypothesis we have
<code class="highlighter-rouge">N₁ ⇛ N₃</code> and <code class="highlighter-rouge">N₂ ⇛ N₃</code> for some <code class="highlighter-rouge">N₃</code>.
Likewise, we have
<code class="highlighter-rouge">M₁ ⇛ M₃</code> and <code class="highlighter-rouge">M₂ ⇛ M₃</code> for some <code class="highlighter-rouge">M₃</code>.
We choose <code class="highlighter-rouge">L = N₃ [ M₃ ]</code>.
We have both <code class="highlighter-rouge">(ƛ N₁) · M₁ ⇛ N₃ [ M₃ ]</code>
and <code class="highlighter-rouge">(ƛ N₂) · M₂ ⇛ N₃ [ M₃ ]</code>
by rule <code class="highlighter-rouge">pbeta</code></p>
  </li>
</ul>

<h4 id="exercise">Exercise</h4>

<p>Draw pictures that represent the proofs of each of the six cases in
the above proof of <code class="highlighter-rouge">par-diamond</code>. The pictures should consist of nodes
and directed edges, where each node is labeled with a term and each
edge represents parallel reduction.</p>

<h2 id="proof-of-confluence-for-parallel-reduction">Proof of confluence for parallel reduction</h2>

<p>As promised at the beginning, the proof that parallel reduction is
confluent is easy now that we know it satisfies the diamond property.
We just need to prove the strip lemma, which states that
if <code class="highlighter-rouge">M ⇛ N</code> and <code class="highlighter-rouge">M ⇛* N′</code>, then
<code class="highlighter-rouge">N ⇛* L</code> and <code class="highlighter-rouge">N′ ⇛ L</code> for some <code class="highlighter-rouge">L</code>.
The following diagram illustrates the strip lemma</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    M
   / \
  1   *
 /     \
N       N′
 \     /
  *   1
   \ /
    L
</code></pre></div></div>

<p>where downward lines are instances of <code class="highlighter-rouge">⇛</code> or <code class="highlighter-rouge">⇛*</code>, depending on how
they are marked.</p>

<p>The proof of the strip lemma is a straightforward induction on <code class="highlighter-rouge">M ⇛* N′</code>,
using the diamond property in the induction step.</p>

<pre class="Agda"><a id="strip"></a><a id="16799" href="/PLFA-zh/Confluence/#16799" class="Function">strip</a> <a id="16805" class="Symbol">:</a> <a id="16807" class="Symbol">∀{</a><a id="16809" href="plfa.Confluence.html#16809" class="Bound">Γ</a> <a id="16811" href="plfa.Confluence.html#16811" class="Bound">A</a><a id="16812" class="Symbol">}</a> <a id="16814" class="Symbol">{</a><a id="16815" href="plfa.Confluence.html#16815" class="Bound">M</a> <a id="16817" href="plfa.Confluence.html#16817" class="Bound">N</a> <a id="16819" href="plfa.Confluence.html#16819" class="Bound">N′</a> <a id="16822" class="Symbol">:</a> <a id="16824" href="plfa.Confluence.html#16809" class="Bound">Γ</a> <a id="16826" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="16828" href="plfa.Confluence.html#16811" class="Bound">A</a><a id="16829" class="Symbol">}</a>
  <a id="16833" class="Symbol">→</a> <a id="16835" href="/PLFA-zh/Confluence/#16815" class="Bound">M</a> <a id="16837" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="16839" href="plfa.Confluence.html#16817" class="Bound">N</a>
  <a id="16843" class="Symbol">→</a> <a id="16845" href="/PLFA-zh/Confluence/#16815" class="Bound">M</a> <a id="16847" href="plfa.Confluence.html#3795" class="Datatype Operator">⇛*</a> <a id="16850" href="plfa.Confluence.html#16819" class="Bound">N′</a>
    <a id="16857" class="Comment">------------------------------------</a>
  <a id="16896" class="Symbol">→</a> <a id="16898" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="16901" href="/PLFA-zh/Confluence/#16901" class="Bound">L</a> <a id="16903" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="16905" href="plfa.Confluence.html#16809" class="Bound">Γ</a> <a id="16907" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="16909" href="plfa.Confluence.html#16811" class="Bound">A</a> <a id="16911" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="16913" class="Symbol">(</a><a id="16914" href="plfa.Confluence.html#16817" class="Bound">N</a> <a id="16916" href="plfa.Confluence.html#3795" class="Datatype Operator">⇛*</a> <a id="16919" href="plfa.Confluence.html#16901" class="Bound">L</a><a id="16920" class="Symbol">)</a>  <a id="16923" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a>  <a id="16926" class="Symbol">(</a><a id="16927" href="plfa.Confluence.html#16819" class="Bound">N′</a> <a id="16930" href="plfa.Confluence.html#2653" class="Datatype Operator">⇛</a> <a id="16932" href="plfa.Confluence.html#16901" class="Bound">L</a><a id="16933" class="Symbol">)</a>
<a id="16935" href="/PLFA-zh/Confluence/#16799" class="Function">strip</a><a id="16940" class="Symbol">{</a><a id="16941" href="plfa.Confluence.html#16941" class="Bound">Γ</a><a id="16942" class="Symbol">}{</a><a id="16944" href="plfa.Confluence.html#16944" class="Bound">A</a><a id="16945" class="Symbol">}{</a><a id="16947" href="plfa.Confluence.html#16947" class="Bound">M</a><a id="16948" class="Symbol">}{</a><a id="16950" href="plfa.Confluence.html#16950" class="Bound">N</a><a id="16951" class="Symbol">}{</a><a id="16953" href="plfa.Confluence.html#16953" class="Bound">N′</a><a id="16955" class="Symbol">}</a> <a id="16957" href="plfa.Confluence.html#16957" class="Bound">mn</a> <a id="16960" class="Symbol">(</a><a id="16961" href="plfa.Confluence.html#16947" class="Bound">M</a> <a id="16963" href="plfa.Confluence.html#3845" class="InductiveConstructor Operator">∎</a><a id="16964" class="Symbol">)</a> <a id="16966" class="Symbol">=</a> <a id="16968" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16970" href="plfa.Confluence.html#16950" class="Bound">N</a> <a id="16972" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16974" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16976" href="plfa.Confluence.html#16950" class="Bound">N</a> <a id="16978" href="plfa.Confluence.html#3845" class="InductiveConstructor Operator">∎</a> <a id="16980" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16982" href="plfa.Confluence.html#16957" class="Bound">mn</a> <a id="16985" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16987" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="16989" href="/PLFA-zh/Confluence/#16799" class="Function">strip</a><a id="16994" class="Symbol">{</a><a id="16995" href="plfa.Confluence.html#16995" class="Bound">Γ</a><a id="16996" class="Symbol">}{</a><a id="16998" href="plfa.Confluence.html#16998" class="Bound">A</a><a id="16999" class="Symbol">}{</a><a id="17001" href="plfa.Confluence.html#17001" class="Bound">M</a><a id="17002" class="Symbol">}{</a><a id="17004" href="plfa.Confluence.html#17004" class="Bound">N</a><a id="17005" class="Symbol">}{</a><a id="17007" href="plfa.Confluence.html#17007" class="Bound">N′</a><a id="17009" class="Symbol">}</a> <a id="17011" href="plfa.Confluence.html#17011" class="Bound">mn</a> <a id="17014" class="Symbol">(</a><a id="17015" href="plfa.Confluence.html#17001" class="Bound">M</a> <a id="17017" href="plfa.Confluence.html#3901" class="InductiveConstructor Operator">⇛⟨</a> <a id="17020" href="plfa.Confluence.html#17020" class="Bound">mm&#39;</a> <a id="17024" href="plfa.Confluence.html#3901" class="InductiveConstructor Operator">⟩</a> <a id="17026" href="plfa.Confluence.html#17026" class="Bound">m&#39;n&#39;</a><a id="17030" class="Symbol">)</a>
    <a id="17036" class="Keyword">with</a> <a id="17041" href="/PLFA-zh/Confluence/#13151" class="Function">par-diamond</a> <a id="17053" href="plfa.Confluence.html#17011" class="Bound">mn</a> <a id="17056" href="plfa.Confluence.html#17020" class="Bound">mm&#39;</a>
<a id="17060" class="Symbol">...</a> <a id="17064" class="Symbol">|</a> <a id="17066" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17068" href="/PLFA-zh/Confluence/#17068" class="Bound">L</a> <a id="17070" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17072" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17074" href="plfa.Confluence.html#17074" class="Bound">nl</a> <a id="17077" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17079" href="plfa.Confluence.html#17079" class="Bound">m&#39;l</a> <a id="17083" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17085" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
    <a id="17091" class="Keyword">with</a> <a id="17096" href="/PLFA-zh/Confluence/#16799" class="Function">strip</a> <a id="17102" href="plfa.Confluence.html#17079" class="Bound">m&#39;l</a> <a id="17106" class="Bound">m&#39;n&#39;</a>
<a id="17111" class="Symbol">...</a> <a id="17115" class="Symbol">|</a> <a id="17117" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17119" href="/PLFA-zh/Confluence/#17119" class="Bound">L′</a> <a id="17122" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17124" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17126" href="plfa.Confluence.html#17126" class="Bound">ll&#39;</a> <a id="17130" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17132" href="plfa.Confluence.html#17132" class="Bound">n&#39;l&#39;</a> <a id="17137" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17139" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17141" class="Symbol">=</a>
    <a id="17147" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17149" href="/PLFA-zh/Confluence/#17119" class="Bound">L′</a> <a id="17152" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17154" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17156" class="Symbol">(</a><a id="17157" class="Bound">N</a> <a id="17159" href="plfa.Confluence.html#3901" class="InductiveConstructor Operator">⇛⟨</a> <a id="17162" class="Bound">nl</a> <a id="17165" href="plfa.Confluence.html#3901" class="InductiveConstructor Operator">⟩</a> <a id="17167" href="plfa.Confluence.html#17126" class="Bound">ll&#39;</a><a id="17170" class="Symbol">)</a> <a id="17172" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17174" href="plfa.Confluence.html#17132" class="Bound">n&#39;l&#39;</a> <a id="17179" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17181" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>The proof of confluence for parallel reduction is now proved by
induction on the sequence <code class="highlighter-rouge">M ⇛* N</code>, using the above lemma in the
induction step.</p>

<pre class="Agda"><a id="par-confluence"></a><a id="17338" href="/PLFA-zh/Confluence/#17338" class="Function">par-confluence</a> <a id="17353" class="Symbol">:</a> <a id="17355" class="Symbol">∀{</a><a id="17357" href="plfa.Confluence.html#17357" class="Bound">Γ</a> <a id="17359" href="plfa.Confluence.html#17359" class="Bound">A</a><a id="17360" class="Symbol">}</a> <a id="17362" class="Symbol">{</a><a id="17363" href="plfa.Confluence.html#17363" class="Bound">L</a> <a id="17365" href="plfa.Confluence.html#17365" class="Bound">M₁</a> <a id="17368" href="plfa.Confluence.html#17368" class="Bound">M₂</a> <a id="17371" class="Symbol">:</a> <a id="17373" href="plfa.Confluence.html#17357" class="Bound">Γ</a> <a id="17375" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="17377" href="plfa.Confluence.html#17359" class="Bound">A</a><a id="17378" class="Symbol">}</a>
  <a id="17382" class="Symbol">→</a> <a id="17384" href="/PLFA-zh/Confluence/#17363" class="Bound">L</a> <a id="17386" href="plfa.Confluence.html#3795" class="Datatype Operator">⇛*</a> <a id="17389" href="plfa.Confluence.html#17365" class="Bound">M₁</a>
  <a id="17394" class="Symbol">→</a> <a id="17396" href="/PLFA-zh/Confluence/#17363" class="Bound">L</a> <a id="17398" href="plfa.Confluence.html#3795" class="Datatype Operator">⇛*</a> <a id="17401" href="plfa.Confluence.html#17368" class="Bound">M₂</a>
    <a id="17408" class="Comment">------------------------------------</a>
  <a id="17447" class="Symbol">→</a> <a id="17449" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="17452" href="/PLFA-zh/Confluence/#17452" class="Bound">N</a> <a id="17454" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="17456" href="plfa.Confluence.html#17357" class="Bound">Γ</a> <a id="17458" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="17460" href="plfa.Confluence.html#17359" class="Bound">A</a> <a id="17462" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="17464" class="Symbol">(</a><a id="17465" href="plfa.Confluence.html#17365" class="Bound">M₁</a> <a id="17468" href="plfa.Confluence.html#3795" class="Datatype Operator">⇛*</a> <a id="17471" href="plfa.Confluence.html#17452" class="Bound">N</a><a id="17472" class="Symbol">)</a> <a id="17474" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a> <a id="17476" class="Symbol">(</a><a id="17477" href="plfa.Confluence.html#17368" class="Bound">M₂</a> <a id="17480" href="plfa.Confluence.html#3795" class="Datatype Operator">⇛*</a> <a id="17483" href="plfa.Confluence.html#17452" class="Bound">N</a><a id="17484" class="Symbol">)</a>
<a id="17486" href="/PLFA-zh/Confluence/#17338" class="Function">par-confluence</a> <a id="17501" class="Symbol">{</a><a id="17502" href="plfa.Confluence.html#17502" class="Bound">Γ</a><a id="17503" class="Symbol">}{</a><a id="17505" href="plfa.Confluence.html#17505" class="Bound">A</a><a id="17506" class="Symbol">}{</a><a id="17508" href="plfa.Confluence.html#17508" class="Bound">L</a><a id="17509" class="Symbol">}{</a><a id="17511" class="DottedPattern Symbol">.</a><a id="17512" href="plfa.Confluence.html#17508" class="DottedPattern Bound">L</a><a id="17513" class="Symbol">}{</a><a id="17515" href="plfa.Confluence.html#17515" class="Bound">N</a><a id="17516" class="Symbol">}</a> <a id="17518" class="Symbol">(</a><a id="17519" href="plfa.Confluence.html#17508" class="Bound">L</a> <a id="17521" href="plfa.Confluence.html#3845" class="InductiveConstructor Operator">∎</a><a id="17522" class="Symbol">)</a> <a id="17524" href="plfa.Confluence.html#17524" class="Bound">L⇛*N</a> <a id="17529" class="Symbol">=</a> <a id="17531" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17533" href="plfa.Confluence.html#17515" class="Bound">N</a> <a id="17535" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17537" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17539" href="plfa.Confluence.html#17524" class="Bound">L⇛*N</a> <a id="17544" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17546" href="plfa.Confluence.html#17515" class="Bound">N</a> <a id="17548" href="plfa.Confluence.html#3845" class="InductiveConstructor Operator">∎</a> <a id="17550" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17552" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="17554" href="/PLFA-zh/Confluence/#17338" class="Function">par-confluence</a> <a id="17569" class="Symbol">{</a><a id="17570" href="plfa.Confluence.html#17570" class="Bound">Γ</a><a id="17571" class="Symbol">}{</a><a id="17573" href="plfa.Confluence.html#17573" class="Bound">A</a><a id="17574" class="Symbol">}{</a><a id="17576" href="plfa.Confluence.html#17576" class="Bound">L</a><a id="17577" class="Symbol">}{</a><a id="17579" href="plfa.Confluence.html#17579" class="Bound">M₁′</a><a id="17582" class="Symbol">}{</a><a id="17584" href="plfa.Confluence.html#17584" class="Bound">M₂</a><a id="17586" class="Symbol">}</a> <a id="17588" class="Symbol">(</a><a id="17589" href="plfa.Confluence.html#17576" class="Bound">L</a> <a id="17591" href="plfa.Confluence.html#3901" class="InductiveConstructor Operator">⇛⟨</a> <a id="17594" href="plfa.Confluence.html#17594" class="Bound">L⇛M₁</a> <a id="17599" href="plfa.Confluence.html#3901" class="InductiveConstructor Operator">⟩</a> <a id="17601" href="plfa.Confluence.html#17601" class="Bound">M₁⇛*M₁′</a><a id="17608" class="Symbol">)</a> <a id="17610" href="plfa.Confluence.html#17610" class="Bound">L⇛*M₂</a>
    <a id="17620" class="Keyword">with</a> <a id="17625" href="/PLFA-zh/Confluence/#16799" class="Function">strip</a> <a id="17631" href="plfa.Confluence.html#17594" class="Bound">L⇛M₁</a> <a id="17636" href="plfa.Confluence.html#17610" class="Bound">L⇛*M₂</a>
<a id="17642" class="Symbol">...</a>    <a id="17649" class="Symbol">|</a> <a id="17651" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17653" href="/PLFA-zh/Confluence/#17653" class="Bound">N</a> <a id="17655" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17657" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17659" href="plfa.Confluence.html#17659" class="Bound">M₁⇛*N</a> <a id="17665" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17667" href="plfa.Confluence.html#17667" class="Bound">M₂⇛N</a> <a id="17672" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17674" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
         <a id="17685" class="Keyword">with</a> <a id="17690" href="/PLFA-zh/Confluence/#17338" class="Function">par-confluence</a> <a id="17705" class="Bound">M₁⇛*M₁′</a> <a id="17713" href="plfa.Confluence.html#17659" class="Bound">M₁⇛*N</a>
<a id="17719" class="Symbol">...</a>         <a id="17731" class="Symbol">|</a> <a id="17733" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17735" href="/PLFA-zh/Confluence/#17735" class="Bound">N′</a> <a id="17738" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17740" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17742" href="plfa.Confluence.html#17742" class="Bound">M₁′⇛*N′</a> <a id="17750" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17752" href="plfa.Confluence.html#17752" class="Bound">N⇛*N′</a> <a id="17758" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17760" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17762" class="Symbol">=</a>
              <a id="17778" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17780" href="/PLFA-zh/Confluence/#17735" class="Bound">N′</a> <a id="17783" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17785" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17787" href="plfa.Confluence.html#17742" class="Bound">M₁′⇛*N′</a> <a id="17795" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17797" class="Symbol">(</a><a id="17798" class="Bound">M₂</a> <a id="17801" href="plfa.Confluence.html#3901" class="InductiveConstructor Operator">⇛⟨</a> <a id="17804" class="Bound">M₂⇛N</a> <a id="17809" href="plfa.Confluence.html#3901" class="InductiveConstructor Operator">⟩</a> <a id="17811" href="plfa.Confluence.html#17752" class="Bound">N⇛*N′</a><a id="17816" class="Symbol">)</a> <a id="17818" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17820" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>The step case may be illustrated as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        L
       / \
      1   *
     /     \
    M₁ (a)  M₂
   / \     /
  *   *   1
 /     \ /
M₁′(b)  N
 \     /
  *   *
   \ /
    N′
</code></pre></div></div>

<p>where downward lines are instances of <code class="highlighter-rouge">⇛</code> or <code class="highlighter-rouge">⇛*</code>, depending on how
they are marked. Here <code class="highlighter-rouge">(a)</code> holds by <code class="highlighter-rouge">strip</code> and <code class="highlighter-rouge">(b)</code> holds by
induction.</p>

<h2 id="proof-of-confluence-for-reduction">Proof of confluence for reduction</h2>

<p>Confluence of reduction is a corollary of confluence for parallel
reduction. From
<code class="highlighter-rouge">L —↠ M₁</code> and <code class="highlighter-rouge">L —↠ M₂</code> we have
<code class="highlighter-rouge">L ⇛* M₁</code> and <code class="highlighter-rouge">L ⇛* M₂</code> by <code class="highlighter-rouge">betas-pars</code>.
Then by confluence we obtain some <code class="highlighter-rouge">L</code> such that
<code class="highlighter-rouge">M₁ ⇛* N</code> and <code class="highlighter-rouge">M₂ ⇛* N</code>, from which we conclude that
<code class="highlighter-rouge">M₁ —↠ N</code> and <code class="highlighter-rouge">M₂ —↠ N</code> by <code class="highlighter-rouge">pars-betas</code>.</p>

<pre class="Agda"><a id="confluence"></a><a id="18549" href="/PLFA-zh/Confluence/#18549" class="Function">confluence</a> <a id="18560" class="Symbol">:</a> <a id="18562" class="Symbol">∀{</a><a id="18564" href="plfa.Confluence.html#18564" class="Bound">Γ</a> <a id="18566" href="plfa.Confluence.html#18566" class="Bound">A</a><a id="18567" class="Symbol">}</a> <a id="18569" class="Symbol">{</a><a id="18570" href="plfa.Confluence.html#18570" class="Bound">L</a> <a id="18572" href="plfa.Confluence.html#18572" class="Bound">M₁</a> <a id="18575" href="plfa.Confluence.html#18575" class="Bound">M₂</a> <a id="18578" class="Symbol">:</a> <a id="18580" href="plfa.Confluence.html#18564" class="Bound">Γ</a> <a id="18582" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="18584" href="plfa.Confluence.html#18566" class="Bound">A</a><a id="18585" class="Symbol">}</a>
  <a id="18589" class="Symbol">→</a> <a id="18591" href="/PLFA-zh/Confluence/#18570" class="Bound">L</a> <a id="18593" href="/PLFA-zh/Untyped/#11203" class="Datatype Operator">—↠</a> <a id="18596" href="plfa.Confluence.html#18572" class="Bound">M₁</a>
  <a id="18601" class="Symbol">→</a> <a id="18603" href="/PLFA-zh/Confluence/#18570" class="Bound">L</a> <a id="18605" href="/PLFA-zh/Untyped/#11203" class="Datatype Operator">—↠</a> <a id="18608" href="plfa.Confluence.html#18575" class="Bound">M₂</a>
    <a id="18615" class="Comment">-----------------------------------</a>
  <a id="18653" class="Symbol">→</a> <a id="18655" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="18658" href="/PLFA-zh/Confluence/#18658" class="Bound">N</a> <a id="18660" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="18662" href="plfa.Confluence.html#18564" class="Bound">Γ</a> <a id="18664" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="18666" href="plfa.Confluence.html#18566" class="Bound">A</a> <a id="18668" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="18670" class="Symbol">(</a><a id="18671" href="plfa.Confluence.html#18572" class="Bound">M₁</a> <a id="18674" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="18677" href="plfa.Confluence.html#18658" class="Bound">N</a><a id="18678" class="Symbol">)</a> <a id="18680" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a> <a id="18682" class="Symbol">(</a><a id="18683" href="plfa.Confluence.html#18575" class="Bound">M₂</a> <a id="18686" href="plfa.Untyped.html#11203" class="Datatype Operator">—↠</a> <a id="18689" href="plfa.Confluence.html#18658" class="Bound">N</a><a id="18690" class="Symbol">)</a>
<a id="18692" href="/PLFA-zh/Confluence/#18549" class="Function">confluence</a> <a id="18703" href="plfa.Confluence.html#18703" class="Bound">L↠M₁</a> <a id="18708" href="plfa.Confluence.html#18708" class="Bound">L↠M₂</a>
    <a id="18717" class="Keyword">with</a> <a id="18722" href="/PLFA-zh/Confluence/#17338" class="Function">par-confluence</a> <a id="18737" class="Symbol">(</a><a id="18738" href="plfa.Confluence.html#5007" class="Function">betas-pars</a> <a id="18749" href="plfa.Confluence.html#18703" class="Bound">L↠M₁</a><a id="18753" class="Symbol">)</a> <a id="18755" class="Symbol">(</a><a id="18756" href="plfa.Confluence.html#5007" class="Function">betas-pars</a> <a id="18767" href="plfa.Confluence.html#18708" class="Bound">L↠M₂</a><a id="18771" class="Symbol">)</a>
<a id="18773" class="Symbol">...</a>    <a id="18780" class="Symbol">|</a> <a id="18782" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="18784" href="/PLFA-zh/Confluence/#18784" class="Bound">N</a> <a id="18786" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="18788" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="18790" href="plfa.Confluence.html#18790" class="Bound">M₁⇛N</a> <a id="18795" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="18797" href="plfa.Confluence.html#18797" class="Bound">M₂⇛N</a> <a id="18802" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="18804" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="18806" class="Symbol">=</a>
         <a id="18817" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="18819" href="/PLFA-zh/Confluence/#18784" class="Bound">N</a> <a id="18821" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="18823" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="18825" href="plfa.Confluence.html#7001" class="Function">pars-betas</a> <a id="18836" href="plfa.Confluence.html#18790" class="Bound">M₁⇛N</a> <a id="18841" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="18843" href="plfa.Confluence.html#7001" class="Function">pars-betas</a> <a id="18854" href="plfa.Confluence.html#18797" class="Bound">M₂⇛N</a> <a id="18859" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="18861" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>

<h2 id="notes">Notes</h2>

<p>Broadly speaking, this proof of confluence, based on parallel
reduction, is due to W. Tait and P. Martin-Lof (see Barendredgt 1984,
Section 3.2).  Details of the mechanization come from several sources.
The <code class="highlighter-rouge">subst-par</code> lemma is the “strong substitutivity” lemma of Shafer,
Tebbi, and Smolka (ITP 2015). The proofs of <code class="highlighter-rouge">par-diamond</code>, <code class="highlighter-rouge">strip</code>,
and <code class="highlighter-rouge">par-confluence</code> are based on Pfenning’s 1992 technical report
about the Church-Rosser theorem. In addition, we consulted Nipkow and
Berghofer’s mechanization in Isabelle, which is based on an earlier
article by Nipkow (JAR 1996).  We opted not to use the “complete
developments” approach of Takahashi (1995) because we felt that the
proof was simple enough based solely on parallel reduction.  There are
many more mechanizations of the Church-Rosser theorem that we have not
yet had the time to read, including Shankar’s (J. ACM 1988) and
Homeier’s (TPHOLs 2001).</p>

<h2 id="unicode">Unicode</h2>

<p>This chapter uses the following unicode:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>⇛  U+3015  RIGHTWARDS TRIPLE ARROW (\r== or \Rrightarrow)
</code></pre></div></div>

  </div>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/PLFA-zh/Untyped/">上一章</a>
    
    
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/Agda-zh/PLFA-zh/blob/dev/src/plfa/Confluence.lagda.md">源代码</a>
    
    
    &bullet;
    
    
    <a alt="Next chapter" href="/PLFA-zh/CallByName/">下一章</a>
    
</p>


</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/PLFA-zh/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">编程语言基础：Agda 语言描述
</h2>

    <h3 class="footer-heading">原作者：</h3><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Philip Wadler</li>
          <li><a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wadler"><svg class="svg-icon"><use xlink:href="/PLFA-zh/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wadler</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wen Kokke</li>
          <li><a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wenkokke"><svg class="svg-icon"><use xlink:href="/PLFA-zh/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wenkokke</span></a></li><li><a href="https://www.twitter.com/wenkokke"><svg class="svg-icon"><use xlink:href="/PLFA-zh/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">wenkokke</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><h3 class="footer-heading">本章暂无翻译</h3>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">创作共用-署名 4.0 国际（CC BY 4.0）许可协议</a>授权。<br />
  </div>
</footer>
<!-- Import jQuery -->
<script type="text/javascript" src="/PLFA-zh/assets/jquery.js"></script>

<!-- Script which draws background for progress tags -->
<script type="text/javascript">
$('span.progress').each(function(){
    const progress = parseInt($(this).text());
    $(this).css({
        'border-style': 'solid',
        'border-radius': '5px',
        'border-width': 'thin',
        'border-color': progress === 100 ? 'limegreen' : 'dimgray',
        'font-size': '70%',
        'padding': '0% 0.5% 0% 0.5%',
        'margin': '0em 0em 0em 0.5em',
        'box-sizing': 'border-box',
        'vertical-align': '10%'
    });
    $(this).text(progress.toString() + " %");
})
</script>

<!-- Script which allows for foldable code blocks -->
<script type="text/javascript">

 // Makes sandwhich menu works
 $('.menu-icon').click(function(){
   $('.trigger').toggle();
 });

 // Script which allows for foldable code blocks
 $('div.foldable pre').each(function(){
     var autoHeight = $(this).height();
     var lineHeight = parseFloat($(this).css('line-height'));

     var plus    = $("<div></div>");
     var horLine = $("<div></div>");
     var verLine = $("<div></div>");
     $(this).prepend(plus);
     plus.css({
         'position'         : 'relative',
         'float'            : 'right',
         'right'            : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'width'            : lineHeight,
         'height'           : lineHeight});
     verLine.css({
         'position'         : 'relative',
         'height'           : lineHeight,
         'width'            : '3px',
         'background-color' : '#C1E0FF'});
     horLine.css({
         'position'         : 'relative',
         'top'              : '-' + (0.5 * lineHeight + 1.5) + 'px',
         'left'             : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'height'           : '3px',
         'width'            : lineHeight,
         'background-color' : '#C1E0FF'});
     plus.append(verLine);
     plus.append(horLine);

     $(this).height(2.0 * lineHeight);
     $(this).css('overflow','hidden');

     $(this).click(function(){
         if ($(this).height() == autoHeight) {
             $(this).height(2.0 * lineHeight);
             plus.show();
         }
         else {
             $(this).height('auto');
             plus.hide();
         }
     });
 });
</script>

<!-- Import KaTeX -->
<script type="text/javascript" src="/PLFA-zh/assets/katex.js"></script>

<!-- Script which renders TeX using KaTeX -->
<script type="text/javascript">
 $("script[type='math/tex']").replaceWith(
     function(){
         var tex = $(this).text();
         return "<span class=\"inline-equation\">" +
                katex.renderToString(tex) +
                "</span>";
     });
 $("script[type='math/tex; mode=display']").replaceWith(
     function(){
         var tex = $(this).text().replace(/%.*?(\n|$)/g,"");
         return "<div class=\"equation\">" +
                katex.renderToString("\\displaystyle "+tex) +
                "</div>";
     });
</script>
</body>

</html>
