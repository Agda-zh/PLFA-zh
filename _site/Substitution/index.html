<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Substitution in the untyped lambda calculus | 编程语言基础：Agda 语言描述
</title><!-- Begin Jekyll SEO tag v2.5.0 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Substitution in the untyped lambda calculus" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="编程语言基础：Agda 语言描述" />
<meta property="og:description" content="编程语言基础：Agda 语言描述" />
<link rel="canonical" href="https://agda-zh.github.io/PLFA-zh/Substitution/" />
<meta property="og:url" content="https://agda-zh.github.io/PLFA-zh/Substitution/" />
<meta property="og:site_name" content="编程语言基础：Agda 语言描述" />
<script type="application/ld+json">
{"description":"编程语言基础：Agda 语言描述","@type":"WebPage","url":"https://agda-zh.github.io/PLFA-zh/Substitution/","headline":"Substitution in the untyped lambda calculus","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/PLFA-zh/assets/main.css"></head>
<body><header class="site-header" role="banner">

    <div class="wrapper">

        <a class="site-title" href="/PLFA-zh/">编程语言基础：Agda 语言描述
</a>

        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="/PLFA-zh/">主页</a>
                <a class="page-link" href="/PLFA-zh/Announcements/">公告</a>
                <a class="page-link" href="/PLFA-zh/GettingStarted/">使用说明</a>
                <a class="page-link" href="/PLFA-zh/Citing/">引用</a>
                <a class="page-link" href="https://plfa.github.io/">English</a>
            </div>
        </nav>

    </div>

</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
      <h1 class="post-title">Substitution in the untyped lambda calculus</h1>
  </header>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/PLFA-zh/ContextualEquivalence/">上一章</a>
    
    
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/Agda-zh/PLFA-zh/blob/dev/src/plfa/Substitution.lagda.md">源代码</a>
    
    
    &bullet;
    
    
    <a alt="Next chapter" href="/PLFA-zh/Acknowledgements/">下一章</a>
    
</p>


  <div class="post-content">
    <pre class="Agda"><a id="184" class="Keyword">module</a> <a id="191" href="/PLFA-zh/Substitution/" class="Module">plfa.Substitution</a> <a id="209" class="Keyword">where</a>
</pre>
<h2 id="introduction">Introduction</h2>

<p>The primary purpose of this chapter is to prove that substitution
commutes with itself. Barendgredt (1984) refers to this
as the substitution lemma:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>M [x:=N] [y:=L] = M [y:=L] [x:= N[y:=L] ]
</code></pre></div></div>

<p>In our setting, with de Bruijn indices for variables, the statement of
the lemma becomes:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>M [ N ] [ L ] ≡  M〔 L 〕[ N [ L ] ]                     (substitution)
</code></pre></div></div>

<p>where the notation <code class="highlighter-rouge">M 〔 L 〕</code> is for substituting L for index 1 inside
M.  In addition, because we define substitution in terms of parallel
substitution, we have the following generalization, replacing the
substitution of L with an arbitrary parallel substitution σ.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>subst σ (M [ N ]) ≡ (subst (exts σ) M) [ subst σ N ]    (subst-commute)
</code></pre></div></div>

<p>The special case for renamings is also useful.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rename ρ (M [ N ]) ≡ (rename (ext ρ) M) [ rename ρ N ]
                                                 (rename-subst-commute)
</code></pre></div></div>

<p>The secondary purpose of this chapter is to define the σ algebra of
parallel substitution due to Abadi, Cardelli, Curien, and Levy
(1991). The equations of this algebra not only help us prove the
substitution lemma, but they are generally useful. Furthermore, when
the equations are applied from left to right, they form a rewrite
system that <em>decides</em> whether any two substitutions are equal.</p>

<h2 id="imports">Imports</h2>

<pre class="Agda"><a id="1539" class="Keyword">open</a> <a id="1544" class="Keyword">import</a> <a id="1551" href="/PLFA-zh/Untyped/" class="Module">plfa.Untyped</a>
  <a id="1566" class="Keyword">using</a> <a id="1572" class="Symbol">(</a><a id="1573" href="/PLFA-zh/Untyped/#2857" class="Datatype">Type</a><a id="1577" class="Symbol">;</a> <a id="1579" href="plfa.Untyped.html#3130" class="Datatype">Context</a><a id="1586" class="Symbol">;</a> <a id="1588" href="plfa.Untyped.html#4252" class="Datatype Operator">_⊢_</a><a id="1591" class="Symbol">;</a> <a id="1593" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="1594" class="Symbol">;</a> <a id="1596" href="plfa.Untyped.html#3483" class="Datatype Operator">_∋_</a><a id="1599" class="Symbol">;</a> <a id="1601" href="plfa.Untyped.html#3152" class="InductiveConstructor">∅</a><a id="1602" class="Symbol">;</a> <a id="1604" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">_,_</a><a id="1607" class="Symbol">;</a> <a id="1609" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="1610" class="Symbol">;</a> <a id="1612" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a><a id="1614" class="Symbol">;</a> <a id="1616" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`_</a><a id="1618" class="Symbol">;</a> <a id="1620" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ_</a><a id="1622" class="Symbol">;</a> <a id="1624" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">_·_</a><a id="1627" class="Symbol">;</a>
         <a id="1638" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a><a id="1644" class="Symbol">;</a> <a id="1646" href="plfa.Untyped.html#6921" class="Function">subst</a><a id="1651" class="Symbol">;</a> <a id="1653" href="plfa.Untyped.html#5883" class="Function">ext</a><a id="1656" class="Symbol">;</a> <a id="1658" href="plfa.Untyped.html#6629" class="Function">exts</a><a id="1662" class="Symbol">;</a> <a id="1664" href="plfa.Untyped.html#7449" class="Function Operator">_[_]</a><a id="1668" class="Symbol">;</a> <a id="1670" href="plfa.Untyped.html#7333" class="Function">subst-zero</a><a id="1680" class="Symbol">)</a>
<a id="1682" class="Keyword">import</a> <a id="1689" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="1727" class="Symbol">as</a> <a id="1730" class="Module">Eq</a>
<a id="1733" class="Keyword">open</a> <a id="1738" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html" class="Module">Eq</a> <a id="1741" class="Keyword">using</a> <a id="1747" class="Symbol">(</a><a id="1748" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">_≡_</a><a id="1751" class="Symbol">;</a> <a id="1753" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="1757" class="Symbol">;</a> <a id="1759" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a><a id="1762" class="Symbol">;</a> <a id="1764" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a><a id="1768" class="Symbol">;</a> <a id="1770" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1436" class="Function">cong₂</a><a id="1775" class="Symbol">;</a> <a id="1777" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1308" class="Function">cong-app</a><a id="1785" class="Symbol">)</a>
<a id="1787" class="Keyword">open</a> <a id="1792" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2499" class="Module">Eq.≡-Reasoning</a> <a id="1807" class="Keyword">using</a> <a id="1813" class="Symbol">(</a><a id="1814" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin_</a><a id="1820" class="Symbol">;</a> <a id="1822" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">_≡⟨⟩_</a><a id="1827" class="Symbol">;</a> <a id="1829" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">_≡⟨_⟩_</a><a id="1835" class="Symbol">;</a> <a id="1837" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">_∎</a><a id="1839" class="Symbol">)</a>
<a id="1841" class="Keyword">open</a> <a id="1846" class="Keyword">import</a> <a id="1853" href="https://agda.github.io/agda-stdlib/v1.1/Function.html" class="Module">Function</a> <a id="1862" class="Keyword">using</a> <a id="1868" class="Symbol">(</a><a id="1869" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">_∘_</a><a id="1872" class="Symbol">)</a>
<a id="1874" class="Comment">-- open import plfa.Isomorphism using (extensionality)  -- causes a bug!</a>
</pre>
<pre class="Agda"><a id="1956" class="Keyword">postulate</a>
  <a id="extensionality"></a><a id="1968" href="/PLFA-zh/Substitution/#1968" class="Postulate">extensionality</a> <a id="1983" class="Symbol">:</a> <a id="1985" class="Symbol">∀</a> <a id="1987" class="Symbol">{</a><a id="1988" href="plfa.Substitution.html#1988" class="Bound">A</a> <a id="1990" href="plfa.Substitution.html#1990" class="Bound">B</a> <a id="1992" class="Symbol">:</a> <a id="1994" class="PrimitiveType">Set</a><a id="1997" class="Symbol">}</a> <a id="1999" class="Symbol">{</a><a id="2000" href="plfa.Substitution.html#2000" class="Bound">f</a> <a id="2002" href="plfa.Substitution.html#2002" class="Bound">g</a> <a id="2004" class="Symbol">:</a> <a id="2006" href="plfa.Substitution.html#1988" class="Bound">A</a> <a id="2008" class="Symbol">→</a> <a id="2010" href="plfa.Substitution.html#1990" class="Bound">B</a><a id="2011" class="Symbol">}</a>
    <a id="2017" class="Symbol">→</a> <a id="2019" class="Symbol">(∀</a> <a id="2022" class="Symbol">(</a><a id="2023" href="/PLFA-zh/Substitution/#2023" class="Bound">x</a> <a id="2025" class="Symbol">:</a> <a id="2027" href="plfa.Substitution.html#1988" class="Bound">A</a><a id="2028" class="Symbol">)</a> <a id="2030" class="Symbol">→</a> <a id="2032" href="plfa.Substitution.html#2000" class="Bound">f</a> <a id="2034" href="plfa.Substitution.html#2023" class="Bound">x</a> <a id="2036" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="2038" href="plfa.Substitution.html#2002" class="Bound">g</a> <a id="2040" href="plfa.Substitution.html#2023" class="Bound">x</a><a id="2041" class="Symbol">)</a>
      <a id="2049" class="Comment">-----------------------</a>
    <a id="2077" class="Symbol">→</a> <a id="2079" href="/PLFA-zh/Substitution/#2000" class="Bound">f</a> <a id="2081" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="2083" href="plfa.Substitution.html#2002" class="Bound">g</a>
</pre>
<h2 id="notation">Notation</h2>

<p>We introduce the following shorthand for the type of a <em>renaming</em> from
variables in context <code class="highlighter-rouge">Γ</code> to variables in context <code class="highlighter-rouge">Δ</code>.</p>

<pre class="Agda"><a id="Rename"></a><a id="2233" href="/PLFA-zh/Substitution/#2233" class="Function">Rename</a> <a id="2240" class="Symbol">:</a> <a id="2242" href="/PLFA-zh/Untyped/#3130" class="Datatype">Context</a> <a id="2250" class="Symbol">→</a> <a id="2252" href="plfa.Untyped.html#3130" class="Datatype">Context</a> <a id="2260" class="Symbol">→</a> <a id="2262" class="PrimitiveType">Set</a>
<a id="2266" href="/PLFA-zh/Substitution/#2233" class="Function">Rename</a> <a id="2273" href="plfa.Substitution.html#2273" class="Bound">Γ</a> <a id="2275" href="plfa.Substitution.html#2275" class="Bound">Δ</a> <a id="2277" class="Symbol">=</a> <a id="2279" class="Symbol">∀{</a><a id="2281" href="plfa.Substitution.html#2281" class="Bound">A</a><a id="2282" class="Symbol">}</a> <a id="2284" class="Symbol">→</a> <a id="2286" href="plfa.Substitution.html#2273" class="Bound">Γ</a> <a id="2288" href="/PLFA-zh/Untyped/#3483" class="Datatype Operator">∋</a> <a id="2290" href="plfa.Substitution.html#2281" class="Bound">A</a> <a id="2292" class="Symbol">→</a> <a id="2294" href="plfa.Substitution.html#2275" class="Bound">Δ</a> <a id="2296" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="2298" href="plfa.Substitution.html#2281" class="Bound">A</a>
</pre>
<p>Similarly, we introduce the following shorthand for the type of a
<em>substitution</em> from variables in context <code class="highlighter-rouge">Γ</code> to terms in context <code class="highlighter-rouge">Δ</code>.</p>

<pre class="Agda"><a id="Subst"></a><a id="2446" href="/PLFA-zh/Substitution/#2446" class="Function">Subst</a> <a id="2452" class="Symbol">:</a> <a id="2454" href="/PLFA-zh/Untyped/#3130" class="Datatype">Context</a> <a id="2462" class="Symbol">→</a> <a id="2464" href="plfa.Untyped.html#3130" class="Datatype">Context</a> <a id="2472" class="Symbol">→</a> <a id="2474" class="PrimitiveType">Set</a>
<a id="2478" href="/PLFA-zh/Substitution/#2446" class="Function">Subst</a> <a id="2484" href="plfa.Substitution.html#2484" class="Bound">Γ</a> <a id="2486" href="plfa.Substitution.html#2486" class="Bound">Δ</a> <a id="2488" class="Symbol">=</a> <a id="2490" class="Symbol">∀{</a><a id="2492" href="plfa.Substitution.html#2492" class="Bound">A</a><a id="2493" class="Symbol">}</a> <a id="2495" class="Symbol">→</a> <a id="2497" href="plfa.Substitution.html#2484" class="Bound">Γ</a> <a id="2499" href="/PLFA-zh/Untyped/#3483" class="Datatype Operator">∋</a> <a id="2501" href="plfa.Substitution.html#2492" class="Bound">A</a> <a id="2503" class="Symbol">→</a> <a id="2505" href="plfa.Substitution.html#2486" class="Bound">Δ</a> <a id="2507" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="2509" href="plfa.Substitution.html#2492" class="Bound">A</a>
</pre>
<p>We use the following more succinct notation the <code class="highlighter-rouge">subst</code> function.</p>

<pre class="Agda"><a id="⟪_⟫"></a><a id="2587" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪_⟫</a> <a id="2591" class="Symbol">:</a> <a id="2593" class="Symbol">∀{</a><a id="2595" href="plfa.Substitution.html#2595" class="Bound">Γ</a> <a id="2597" href="plfa.Substitution.html#2597" class="Bound">Δ</a> <a id="2599" href="plfa.Substitution.html#2599" class="Bound">A</a><a id="2600" class="Symbol">}</a> <a id="2602" class="Symbol">→</a> <a id="2604" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="2610" href="plfa.Substitution.html#2595" class="Bound">Γ</a> <a id="2612" href="plfa.Substitution.html#2597" class="Bound">Δ</a> <a id="2614" class="Symbol">→</a> <a id="2616" href="plfa.Substitution.html#2595" class="Bound">Γ</a> <a id="2618" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="2620" href="plfa.Substitution.html#2599" class="Bound">A</a> <a id="2622" class="Symbol">→</a> <a id="2624" href="plfa.Substitution.html#2597" class="Bound">Δ</a> <a id="2626" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="2628" href="plfa.Substitution.html#2599" class="Bound">A</a>
<a id="2630" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="2632" href="plfa.Substitution.html#2632" class="Bound">σ</a> <a id="2634" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="2636" class="Symbol">=</a> <a id="2638" class="Symbol">λ</a> <a id="2640" href="plfa.Substitution.html#2640" class="Bound">M</a> <a id="2642" class="Symbol">→</a> <a id="2644" href="/PLFA-zh/Untyped/#6921" class="Function">subst</a> <a id="2650" href="plfa.Substitution.html#2632" class="Bound">σ</a> <a id="2652" href="plfa.Substitution.html#2640" class="Bound">M</a>
</pre>

<h2 id="the-σ-algebra-of-substitution">The σ algebra of substitution</h2>

<p>Substitutions map de Bruijn indices (natural numbers) to terms, so we
can view a substitution simply as a sequence of terms, or more
precisely, as an infinite sequence of terms. The σ algebra consists of
four operations for building such sequences: identity <code class="highlighter-rouge">ids</code>, shift
<code class="highlighter-rouge">↑</code>, cons <code class="highlighter-rouge">M • σ</code>, and sequencing <code class="highlighter-rouge">σ ⨟ τ</code>.  The sequence <code class="highlighter-rouge">0, 1, 2, ...</code>
is constructed by the identity substitution.</p>

<pre class="Agda"><a id="ids"></a><a id="3087" href="/PLFA-zh/Substitution/#3087" class="Function">ids</a> <a id="3091" class="Symbol">:</a> <a id="3093" class="Symbol">∀{</a><a id="3095" href="plfa.Substitution.html#3095" class="Bound">Γ</a><a id="3096" class="Symbol">}</a> <a id="3098" class="Symbol">→</a> <a id="3100" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="3106" href="plfa.Substitution.html#3095" class="Bound">Γ</a> <a id="3108" href="plfa.Substitution.html#3095" class="Bound">Γ</a>
<a id="3110" href="/PLFA-zh/Substitution/#3087" class="Function">ids</a> <a id="3114" href="plfa.Substitution.html#3114" class="Bound">x</a> <a id="3116" class="Symbol">=</a> <a id="3118" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="3120" href="plfa.Substitution.html#3114" class="Bound">x</a>
</pre>
<p>The shift operation <code class="highlighter-rouge">↑</code> constructs the sequence</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1, 2, 3, ...
</code></pre></div></div>

<p>and is defined as follows.</p>

<pre class="Agda"><a id="↑"></a><a id="3226" href="/PLFA-zh/Substitution/#3226" class="Function">↑</a> <a id="3228" class="Symbol">:</a> <a id="3230" class="Symbol">∀{</a><a id="3232" href="plfa.Substitution.html#3232" class="Bound">Γ</a> <a id="3234" href="plfa.Substitution.html#3234" class="Bound">A</a><a id="3235" class="Symbol">}</a> <a id="3237" class="Symbol">→</a> <a id="3239" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="3245" href="plfa.Substitution.html#3232" class="Bound">Γ</a> <a id="3247" class="Symbol">(</a><a id="3248" href="plfa.Substitution.html#3232" class="Bound">Γ</a> <a id="3250" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="3252" href="plfa.Substitution.html#3234" class="Bound">A</a><a id="3253" class="Symbol">)</a>
<a id="3255" href="/PLFA-zh/Substitution/#3226" class="Function">↑</a> <a id="3257" href="plfa.Substitution.html#3257" class="Bound">x</a> <a id="3259" class="Symbol">=</a> <a id="3261" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="3263" class="Symbol">(</a><a id="3264" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="3266" href="plfa.Substitution.html#3257" class="Bound">x</a><a id="3267" class="Symbol">)</a>
</pre>
<p>Given a term <code class="highlighter-rouge">M</code> and substitution <code class="highlighter-rouge">σ</code>, the operation
<code class="highlighter-rouge">M • σ</code> constructs the sequence</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>M , σ 0, σ 1, σ 2, ...
</code></pre></div></div>

<p>This operation is analogous to the <code class="highlighter-rouge">cons</code> operation of Lisp.</p>

<pre class="Agda"><a id="3454" class="Keyword">infixr</a> <a id="3461" class="Number">6</a> <a id="3463" href="/PLFA-zh/Substitution/#3468" class="Function Operator">_•_</a>

<a id="_•_"></a><a id="3468" href="/PLFA-zh/Substitution/#3468" class="Function Operator">_•_</a> <a id="3472" class="Symbol">:</a> <a id="3474" class="Symbol">∀{</a><a id="3476" href="plfa.Substitution.html#3476" class="Bound">Γ</a> <a id="3478" href="plfa.Substitution.html#3478" class="Bound">Δ</a> <a id="3480" href="plfa.Substitution.html#3480" class="Bound">A</a><a id="3481" class="Symbol">}</a> <a id="3483" class="Symbol">→</a> <a id="3485" class="Symbol">(</a><a id="3486" href="plfa.Substitution.html#3478" class="Bound">Δ</a> <a id="3488" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="3490" href="plfa.Substitution.html#3480" class="Bound">A</a><a id="3491" class="Symbol">)</a> <a id="3493" class="Symbol">→</a> <a id="3495" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="3501" href="plfa.Substitution.html#3476" class="Bound">Γ</a> <a id="3503" href="plfa.Substitution.html#3478" class="Bound">Δ</a> <a id="3505" class="Symbol">→</a> <a id="3507" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="3513" class="Symbol">(</a><a id="3514" href="plfa.Substitution.html#3476" class="Bound">Γ</a> <a id="3516" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="3518" href="plfa.Substitution.html#3480" class="Bound">A</a><a id="3519" class="Symbol">)</a> <a id="3521" href="plfa.Substitution.html#3478" class="Bound">Δ</a>
<a id="3523" class="Symbol">(</a><a id="3524" href="/PLFA-zh/Substitution/#3524" class="Bound">M</a> <a id="3526" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="3528" href="plfa.Substitution.html#3528" class="Bound">σ</a><a id="3529" class="Symbol">)</a> <a id="3531" href="/PLFA-zh/Untyped/#3519" class="InductiveConstructor">Z</a> <a id="3533" class="Symbol">=</a> <a id="3535" href="plfa.Substitution.html#3524" class="Bound">M</a>
<a id="3537" class="Symbol">(</a><a id="3538" href="/PLFA-zh/Substitution/#3538" class="Bound">M</a> <a id="3540" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="3542" href="plfa.Substitution.html#3542" class="Bound">σ</a><a id="3543" class="Symbol">)</a> <a id="3545" class="Symbol">(</a><a id="3546" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="3548" href="plfa.Substitution.html#3548" class="Bound">x</a><a id="3549" class="Symbol">)</a> <a id="3551" class="Symbol">=</a> <a id="3553" href="plfa.Substitution.html#3542" class="Bound">σ</a> <a id="3555" href="plfa.Substitution.html#3548" class="Bound">x</a>
</pre>
<p>Given two substitutions <code class="highlighter-rouge">σ</code> and <code class="highlighter-rouge">τ</code>, the sequencing operation <code class="highlighter-rouge">σ ⨟ τ</code>
produces the sequence</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>⟪τ⟫(σ 0), ⟪τ⟫(σ 1), ⟪τ⟫(σ 2), ...
</code></pre></div></div>

<p>That is, it composes the two substitutions by first applying
<code class="highlighter-rouge">σ</code> and then applying <code class="highlighter-rouge">τ</code>.</p>

<pre class="Agda"><a id="3787" class="Keyword">infixr</a> <a id="3794" class="Number">5</a> <a id="3796" href="/PLFA-zh/Substitution/#3801" class="Function Operator">_⨟_</a>

<a id="_⨟_"></a><a id="3801" href="/PLFA-zh/Substitution/#3801" class="Function Operator">_⨟_</a> <a id="3805" class="Symbol">:</a> <a id="3807" class="Symbol">∀{</a><a id="3809" href="plfa.Substitution.html#3809" class="Bound">Γ</a> <a id="3811" href="plfa.Substitution.html#3811" class="Bound">Δ</a> <a id="3813" href="plfa.Substitution.html#3813" class="Bound">Σ</a><a id="3814" class="Symbol">}</a> <a id="3816" class="Symbol">→</a> <a id="3818" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="3824" href="plfa.Substitution.html#3809" class="Bound">Γ</a> <a id="3826" href="plfa.Substitution.html#3811" class="Bound">Δ</a> <a id="3828" class="Symbol">→</a> <a id="3830" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="3836" href="plfa.Substitution.html#3811" class="Bound">Δ</a> <a id="3838" href="plfa.Substitution.html#3813" class="Bound">Σ</a> <a id="3840" class="Symbol">→</a> <a id="3842" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="3848" href="plfa.Substitution.html#3809" class="Bound">Γ</a> <a id="3850" href="plfa.Substitution.html#3813" class="Bound">Σ</a>
<a id="3852" href="/PLFA-zh/Substitution/#3852" class="Bound">σ</a> <a id="3854" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="3856" href="plfa.Substitution.html#3856" class="Bound">τ</a> <a id="3858" class="Symbol">=</a> <a id="3860" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="3862" href="plfa.Substitution.html#3856" class="Bound">τ</a> <a id="3864" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="3866" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="3868" href="plfa.Substitution.html#3852" class="Bound">σ</a>
</pre>
<p>For the sequencing operation, Abadi et al. use the notation of
function composition, writing <code class="highlighter-rouge">σ ∘ τ</code>, but still with <code class="highlighter-rouge">σ</code> applied
before <code class="highlighter-rouge">τ</code>, which is the opposite of standard mathematical
practice. We instead write <code class="highlighter-rouge">σ ⨟ τ</code>, because semicolon is
the standard notation for forward function composition.</p>

<h2 id="the-σ-algebra-equations">The σ algebra equations</h2>

<p>The σ algebra includes the following equations.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(sub-head)  ⟪ M • σ ⟫ (` Z) ≡ M
(sub-tail)  ↑ ⨟ (M • σ)    ≡ σ
(sub-η)     (⟪ σ ⟫ (` Z)) • (↑ ⨟ σ) ≡ σ
(Z-shift)   (` Z) • ↑      ≡ ids

(sub-id)    ⟪ ids ⟫ M      ≡ M
(sub-app)   ⟪ σ ⟫ (L · M)  ≡ (⟪ σ ⟫ L) · (⟪ σ ⟫ M)
(sub-abs)   ⟪ σ ⟫ (ƛ N)    ≡ ƛ ⟪ σ ⟫ N
(sub-sub)   ⟪ τ ⟫ ⟪ σ ⟫ M  ≡ ⟪ σ ⨟ τ ⟫ M

(sub-idL)   ids ⨟ σ        ≡ σ
(sub-idR)   σ ⨟ ids        ≡ σ
(sub-assoc) (σ ⨟ τ) ⨟ θ    ≡ σ ⨟ (τ ⨟ θ)
(sub-dist)  (M • σ) ⨟ τ    ≡ (⟪ τ ⟫ M) • (σ ⨟ τ)
</code></pre></div></div>

<p>The first group of equations describe how the <code class="highlighter-rouge">•</code> operator acts like cons.
The equation <code class="highlighter-rouge">sub-head</code> says that the variable zero <code class="highlighter-rouge">Z</code> returns the
head of the sequence (it acts like the <code class="highlighter-rouge">car</code> of Lisp).  Similarly,
<code class="highlighter-rouge">sub-tail</code> says that sequencing with shift <code class="highlighter-rouge">↑</code> returns the tail of the
sequence (it acts like <code class="highlighter-rouge">cdr</code> of Lisp).  The <code class="highlighter-rouge">sub-η</code> equation is the
η-expansion rule for sequences, saying that taking the head and tail
of a sequence, and then cons’ing them together yields the original
sequence. The <code class="highlighter-rouge">Z-shift</code> equation says that cons’ing zero onto the
shifted sequence produces the identity sequence.</p>

<p>The next four equations involve applying substitutions to terms.  The
equation <code class="highlighter-rouge">sub-id</code> says that the identity substitution returns the term
unchanged. The equations <code class="highlighter-rouge">sub-app</code> and <code class="highlighter-rouge">sub-abs</code> says that
substitution is a congruence for the lambda calculus. The <code class="highlighter-rouge">sub-sub</code>
equation says that the sequence operator <code class="highlighter-rouge">⨟</code> behaves as intended.</p>

<p>The last four equations concern the sequencing of substitutions.
The first two equations, <code class="highlighter-rouge">sub-idL</code> and <code class="highlighter-rouge">sub-idR</code>, say that
<code class="highlighter-rouge">ids</code> is the left and right unit of the sequencing operator.
The <code class="highlighter-rouge">sub-assoc</code> equation says that sequencing is associative.
Finally, <code class="highlighter-rouge">sub-dist</code> says that post-sequencing distributes through cons.</p>

<h2 id="relating-the-σ-algebra-and-substitution-functions">Relating the σ algebra and substitution functions</h2>

<p>The definitions of substitution <code class="highlighter-rouge">N [ M ]</code> and parallel substitution
<code class="highlighter-rouge">subst σ N</code> depend on several auxiliary functions: <code class="highlighter-rouge">rename</code>, <code class="highlighter-rouge">exts</code>,
<code class="highlighter-rouge">ext</code>, and <code class="highlighter-rouge">subst-zero</code>. We shall relate those functions to terms in
the σ algebra.</p>

<p>To begin with, renaming can be expressed in terms of substitution.
We have</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rename ρ M ≡ ⟪ ren ρ ⟫ M               (rename-subst-ren)
</code></pre></div></div>

<p>where <code class="highlighter-rouge">ren</code> turns a renaming <code class="highlighter-rouge">ρ</code> into a substitution by post-composing
<code class="highlighter-rouge">ρ</code> with the identity substitution.</p>

<pre class="Agda"><a id="ren"></a><a id="6539" href="/PLFA-zh/Substitution/#6539" class="Function">ren</a> <a id="6543" class="Symbol">:</a> <a id="6545" class="Symbol">∀{</a><a id="6547" href="plfa.Substitution.html#6547" class="Bound">Γ</a> <a id="6549" href="plfa.Substitution.html#6549" class="Bound">Δ</a><a id="6550" class="Symbol">}</a> <a id="6552" class="Symbol">→</a> <a id="6554" href="plfa.Substitution.html#2233" class="Function">Rename</a> <a id="6561" href="plfa.Substitution.html#6547" class="Bound">Γ</a> <a id="6563" href="plfa.Substitution.html#6549" class="Bound">Δ</a> <a id="6565" class="Symbol">→</a> <a id="6567" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="6573" href="plfa.Substitution.html#6547" class="Bound">Γ</a> <a id="6575" href="plfa.Substitution.html#6549" class="Bound">Δ</a>
<a id="6577" href="/PLFA-zh/Substitution/#6539" class="Function">ren</a> <a id="6581" href="plfa.Substitution.html#6581" class="Bound">ρ</a> <a id="6583" class="Symbol">=</a> <a id="6585" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="6589" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="6591" href="plfa.Substitution.html#6581" class="Bound">ρ</a>
</pre>
<p>When the renaming is the increment function, then it is equivalent to
shift.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ren S_ ≡ ↑                             (ren-shift)

rename S_ M ≡ ⟪ ↑ ⟫ M                  (rename-shift)
</code></pre></div></div>

<p>Renaming with the identity renaming leaves the term unchanged.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rename (λ {A} x → x) M ≡ M             (rename-id)
</code></pre></div></div>

<p>Next we relate the <code class="highlighter-rouge">exts</code> function to the σ algebra.  Recall that the
<code class="highlighter-rouge">exts</code> function extends a substitution as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exts σ = ` Z, rename S_ (σ 0), rename S_ (σ 1), rename S_ (σ 2), ...
</code></pre></div></div>

<p>So <code class="highlighter-rouge">exts</code> is equivalent to cons’ing Z onto the sequence formed
by applying <code class="highlighter-rouge">σ</code> and then shifting.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exts σ ≡ ` Z • (σ ⨟ ↑)                (exts-cons-shift)
</code></pre></div></div>

<p>The <code class="highlighter-rouge">ext</code> function does the same job as <code class="highlighter-rouge">exts</code> but for renamings
instead of substitutions. So composing <code class="highlighter-rouge">ext</code> with <code class="highlighter-rouge">ren</code> is the same as
composing <code class="highlighter-rouge">ren</code> with <code class="highlighter-rouge">exts</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ren (ext ρ) ≡ exts (ren ρ)            (ren-ext)
</code></pre></div></div>

<p>Thus, we can recast the <code class="highlighter-rouge">exts-cons-shift</code> equation in terms of
renamings.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ren (ext ρ) ≡ ` Z • (ren ρ ⨟ ↑)       (ext-cons-Z-shift)
</code></pre></div></div>

<p>It is also useful to specialize the <code class="highlighter-rouge">sub-sub</code> equation of the σ
algebra to the situation where the first substitution is a renaming.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>⟪ σ ⟫ (rename ρ M) ≡ ⟪ σ ∘ ρ ⟫ M       (rename-subst)
</code></pre></div></div>

<p>The <code class="highlighter-rouge">subst-zero M</code> substitution is equivalent to cons’ing
<code class="highlighter-rouge">M</code> onto the identity substitution.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>subst-zero M ≡ M • ids                (subst-Z-cons-ids)
</code></pre></div></div>

<p>Finally, sequencing <code class="highlighter-rouge">exts σ</code> with <code class="highlighter-rouge">subst-zero M</code> is equivalent to
cons’ing <code class="highlighter-rouge">M</code> onto <code class="highlighter-rouge">σ</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exts σ ⨟ subst-zero M ≡ (M • σ)       (subst-zero-exts-cons)
</code></pre></div></div>

<h2 id="proofs-of-sub-head-sub-tail-sub-η-z-shift-sub-idl-sub-dist-and-sub-app">Proofs of sub-head, sub-tail, sub-η, Z-shift, sub-idL, sub-dist, and sub-app</h2>

<p>We start with the proofs that are immediate from the definitions of
the operators.</p>

<pre class="Agda"><a id="sub-head"></a><a id="8300" href="/PLFA-zh/Substitution/#8300" class="Function">sub-head</a> <a id="8309" class="Symbol">:</a> <a id="8311" class="Symbol">∀</a> <a id="8313" class="Symbol">{</a><a id="8314" href="plfa.Substitution.html#8314" class="Bound">Γ</a> <a id="8316" href="plfa.Substitution.html#8316" class="Bound">Δ</a><a id="8317" class="Symbol">}</a> <a id="8319" class="Symbol">{</a><a id="8320" href="plfa.Substitution.html#8320" class="Bound">A</a><a id="8321" class="Symbol">}</a> <a id="8323" class="Symbol">{</a><a id="8324" href="plfa.Substitution.html#8324" class="Bound">M</a> <a id="8326" class="Symbol">:</a> <a id="8328" href="plfa.Substitution.html#8316" class="Bound">Δ</a> <a id="8330" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="8332" href="plfa.Substitution.html#8320" class="Bound">A</a><a id="8333" class="Symbol">}{</a><a id="8335" href="plfa.Substitution.html#8335" class="Bound">σ</a> <a id="8337" class="Symbol">:</a> <a id="8339" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="8345" href="plfa.Substitution.html#8314" class="Bound">Γ</a> <a id="8347" href="plfa.Substitution.html#8316" class="Bound">Δ</a><a id="8348" class="Symbol">}</a>
         <a id="8359" class="Symbol">→</a> <a id="8361" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="8363" href="plfa.Substitution.html#8324" class="Bound">M</a> <a id="8365" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="8367" href="plfa.Substitution.html#8335" class="Bound">σ</a> <a id="8369" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="8371" class="Symbol">(</a><a id="8372" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="8374" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="8375" class="Symbol">)</a> <a id="8377" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="8379" href="plfa.Substitution.html#8324" class="Bound">M</a>
<a id="8381" href="/PLFA-zh/Substitution/#8300" class="Function">sub-head</a> <a id="8390" class="Symbol">=</a> <a id="8392" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<pre class="Agda"><a id="sub-tail"></a><a id="8406" href="/PLFA-zh/Substitution/#8406" class="Function">sub-tail</a> <a id="8415" class="Symbol">:</a> <a id="8417" class="Symbol">∀{</a><a id="8419" href="plfa.Substitution.html#8419" class="Bound">Γ</a> <a id="8421" href="plfa.Substitution.html#8421" class="Bound">Δ</a><a id="8422" class="Symbol">}</a> <a id="8424" class="Symbol">{</a><a id="8425" href="plfa.Substitution.html#8425" class="Bound">A</a> <a id="8427" href="plfa.Substitution.html#8427" class="Bound">B</a><a id="8428" class="Symbol">}</a> <a id="8430" class="Symbol">{</a><a id="8431" href="plfa.Substitution.html#8431" class="Bound">M</a> <a id="8433" class="Symbol">:</a> <a id="8435" href="plfa.Substitution.html#8421" class="Bound">Δ</a> <a id="8437" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="8439" href="plfa.Substitution.html#8425" class="Bound">A</a><a id="8440" class="Symbol">}</a> <a id="8442" class="Symbol">{</a><a id="8443" href="plfa.Substitution.html#8443" class="Bound">σ</a> <a id="8445" class="Symbol">:</a> <a id="8447" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="8453" href="plfa.Substitution.html#8419" class="Bound">Γ</a> <a id="8455" href="plfa.Substitution.html#8421" class="Bound">Δ</a><a id="8456" class="Symbol">}</a>
         <a id="8467" class="Symbol">→</a> <a id="8469" class="Symbol">(</a><a id="8470" href="/PLFA-zh/Substitution/#3226" class="Function">↑</a> <a id="8472" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="8474" href="plfa.Substitution.html#8431" class="Bound">M</a> <a id="8476" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="8478" href="plfa.Substitution.html#8443" class="Bound">σ</a><a id="8479" class="Symbol">)</a> <a id="8481" class="Symbol">{</a><a id="8482" class="Argument">A</a> <a id="8484" class="Symbol">=</a> <a id="8486" href="plfa.Substitution.html#8427" class="Bound">B</a><a id="8487" class="Symbol">}</a> <a id="8489" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="8491" href="plfa.Substitution.html#8443" class="Bound">σ</a>
<a id="8493" href="/PLFA-zh/Substitution/#8406" class="Function">sub-tail</a> <a id="8502" class="Symbol">=</a> <a id="8504" href="plfa.Substitution.html#1968" class="Postulate">extensionality</a> <a id="8519" class="Symbol">λ</a> <a id="8521" href="plfa.Substitution.html#8521" class="Bound">x</a> <a id="8523" class="Symbol">→</a> <a id="8525" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<pre class="Agda"><a id="sub-η"></a><a id="8539" href="/PLFA-zh/Substitution/#8539" class="Function">sub-η</a> <a id="8545" class="Symbol">:</a> <a id="8547" class="Symbol">∀{</a><a id="8549" href="plfa.Substitution.html#8549" class="Bound">Γ</a> <a id="8551" href="plfa.Substitution.html#8551" class="Bound">Δ</a><a id="8552" class="Symbol">}</a> <a id="8554" class="Symbol">{</a><a id="8555" href="plfa.Substitution.html#8555" class="Bound">A</a> <a id="8557" href="plfa.Substitution.html#8557" class="Bound">B</a><a id="8558" class="Symbol">}</a> <a id="8560" class="Symbol">{</a><a id="8561" href="plfa.Substitution.html#8561" class="Bound">σ</a> <a id="8563" class="Symbol">:</a> <a id="8565" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="8571" class="Symbol">(</a><a id="8572" href="plfa.Substitution.html#8549" class="Bound">Γ</a> <a id="8574" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="8576" href="plfa.Substitution.html#8555" class="Bound">A</a><a id="8577" class="Symbol">)</a> <a id="8579" href="plfa.Substitution.html#8551" class="Bound">Δ</a><a id="8580" class="Symbol">}</a>
      <a id="8588" class="Symbol">→</a> <a id="8590" class="Symbol">(</a><a id="8591" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="8593" href="plfa.Substitution.html#8561" class="Bound">σ</a> <a id="8595" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="8597" class="Symbol">(</a><a id="8598" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="8600" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="8601" class="Symbol">)</a> <a id="8603" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="8605" class="Symbol">(</a><a id="8606" href="plfa.Substitution.html#3226" class="Function">↑</a> <a id="8608" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="8610" href="plfa.Substitution.html#8561" class="Bound">σ</a><a id="8611" class="Symbol">))</a> <a id="8614" class="Symbol">{</a><a id="8615" class="Argument">A</a> <a id="8617" class="Symbol">=</a> <a id="8619" href="plfa.Substitution.html#8557" class="Bound">B</a><a id="8620" class="Symbol">}</a> <a id="8622" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="8624" href="plfa.Substitution.html#8561" class="Bound">σ</a>
<a id="8626" href="/PLFA-zh/Substitution/#8539" class="Function">sub-η</a> <a id="8632" class="Symbol">{</a><a id="8633" href="plfa.Substitution.html#8633" class="Bound">Γ</a><a id="8634" class="Symbol">}{</a><a id="8636" href="plfa.Substitution.html#8636" class="Bound">Δ</a><a id="8637" class="Symbol">}{</a><a id="8639" href="plfa.Substitution.html#8639" class="Bound">A</a><a id="8640" class="Symbol">}{</a><a id="8642" href="plfa.Substitution.html#8642" class="Bound">B</a><a id="8643" class="Symbol">}{</a><a id="8645" href="plfa.Substitution.html#8645" class="Bound">σ</a><a id="8646" class="Symbol">}</a> <a id="8648" class="Symbol">=</a> <a id="8650" href="plfa.Substitution.html#1968" class="Postulate">extensionality</a> <a id="8665" class="Symbol">λ</a> <a id="8667" href="plfa.Substitution.html#8667" class="Bound">x</a> <a id="8669" class="Symbol">→</a> <a id="8671" href="plfa.Substitution.html#8689" class="Function">lemma</a>
   <a id="8680" class="Keyword">where</a>
   <a id="8689" href="/PLFA-zh/Substitution/#8689" class="Function">lemma</a> <a id="8695" class="Symbol">:</a> <a id="8697" class="Symbol">∀</a> <a id="8699" class="Symbol">{</a><a id="8700" href="plfa.Substitution.html#8700" class="Bound">x</a><a id="8701" class="Symbol">}</a> <a id="8703" class="Symbol">→</a> <a id="8705" class="Symbol">((</a><a id="8707" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="8709" href="plfa.Substitution.html#8645" class="Bound">σ</a> <a id="8711" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="8713" class="Symbol">(</a><a id="8714" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="8716" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="8717" class="Symbol">))</a> <a id="8720" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="8722" class="Symbol">(</a><a id="8723" href="plfa.Substitution.html#3226" class="Function">↑</a> <a id="8725" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="8727" href="plfa.Substitution.html#8645" class="Bound">σ</a><a id="8728" class="Symbol">))</a> <a id="8731" href="plfa.Substitution.html#8700" class="Bound">x</a> <a id="8733" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="8735" href="plfa.Substitution.html#8645" class="Bound">σ</a> <a id="8737" href="plfa.Substitution.html#8700" class="Bound">x</a>
   <a id="8742" href="/PLFA-zh/Substitution/#8689" class="Function">lemma</a> <a id="8748" class="Symbol">{</a><a id="8749" class="Argument">x</a> <a id="8751" class="Symbol">=</a> <a id="8753" href="/PLFA-zh/Untyped/#3519" class="InductiveConstructor">Z</a><a id="8754" class="Symbol">}</a> <a id="8756" class="Symbol">=</a> <a id="8758" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
   <a id="8766" href="/PLFA-zh/Substitution/#8689" class="Function">lemma</a> <a id="8772" class="Symbol">{</a><a id="8773" class="Argument">x</a> <a id="8775" class="Symbol">=</a> <a id="8777" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="8779" href="plfa.Substitution.html#8779" class="Bound">x</a><a id="8780" class="Symbol">}</a> <a id="8782" class="Symbol">=</a> <a id="8784" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<pre class="Agda"><a id="Z-shift"></a><a id="8798" href="/PLFA-zh/Substitution/#8798" class="Function">Z-shift</a> <a id="8806" class="Symbol">:</a> <a id="8808" class="Symbol">∀{</a><a id="8810" href="plfa.Substitution.html#8810" class="Bound">Γ</a><a id="8811" class="Symbol">}{</a><a id="8813" href="plfa.Substitution.html#8813" class="Bound">A</a> <a id="8815" href="plfa.Substitution.html#8815" class="Bound">B</a><a id="8816" class="Symbol">}</a>
        <a id="8826" class="Symbol">→</a> <a id="8828" class="Symbol">((</a><a id="8830" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="8832" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="8833" class="Symbol">)</a> <a id="8835" href="/PLFA-zh/Substitution/#3468" class="Function Operator">•</a> <a id="8837" href="plfa.Substitution.html#3226" class="Function">↑</a><a id="8838" class="Symbol">)</a> <a id="8840" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="8842" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="8846" class="Symbol">{</a><a id="8847" href="plfa.Substitution.html#8810" class="Bound">Γ</a> <a id="8849" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="8851" href="plfa.Substitution.html#8813" class="Bound">A</a><a id="8852" class="Symbol">}</a> <a id="8854" class="Symbol">{</a><a id="8855" href="plfa.Substitution.html#8815" class="Bound">B</a><a id="8856" class="Symbol">}</a>
<a id="8858" href="/PLFA-zh/Substitution/#8798" class="Function">Z-shift</a> <a id="8866" class="Symbol">{</a><a id="8867" href="plfa.Substitution.html#8867" class="Bound">Γ</a><a id="8868" class="Symbol">}{</a><a id="8870" href="plfa.Substitution.html#8870" class="Bound">A</a><a id="8871" class="Symbol">}{</a><a id="8873" href="plfa.Substitution.html#8873" class="Bound">B</a><a id="8874" class="Symbol">}</a> <a id="8876" class="Symbol">=</a> <a id="8878" href="plfa.Substitution.html#1968" class="Postulate">extensionality</a> <a id="8893" href="plfa.Substitution.html#8911" class="Function">lemma</a>
   <a id="8902" class="Keyword">where</a>
   <a id="8911" href="/PLFA-zh/Substitution/#8911" class="Function">lemma</a> <a id="8917" class="Symbol">:</a> <a id="8919" class="Symbol">(</a><a id="8920" href="plfa.Substitution.html#8920" class="Bound">x</a> <a id="8922" class="Symbol">:</a> <a id="8924" href="plfa.Substitution.html#8867" class="Bound">Γ</a> <a id="8926" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="8928" href="plfa.Substitution.html#8870" class="Bound">A</a> <a id="8930" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="8932" href="plfa.Substitution.html#8873" class="Bound">B</a><a id="8933" class="Symbol">)</a> <a id="8935" class="Symbol">→</a> <a id="8937" class="Symbol">((</a><a id="8939" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="8941" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="8942" class="Symbol">)</a> <a id="8944" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="8946" href="plfa.Substitution.html#3226" class="Function">↑</a><a id="8947" class="Symbol">)</a> <a id="8949" href="plfa.Substitution.html#8920" class="Bound">x</a> <a id="8951" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="8953" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="8957" href="plfa.Substitution.html#8920" class="Bound">x</a>
   <a id="8962" href="/PLFA-zh/Substitution/#8911" class="Function">lemma</a> <a id="8968" href="/PLFA-zh/Untyped/#3519" class="InductiveConstructor">Z</a> <a id="8970" class="Symbol">=</a> <a id="8972" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
   <a id="8980" href="/PLFA-zh/Substitution/#8911" class="Function">lemma</a> <a id="8986" class="Symbol">(</a><a id="8987" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="8989" href="plfa.Substitution.html#8989" class="Bound">y</a><a id="8990" class="Symbol">)</a> <a id="8992" class="Symbol">=</a> <a id="8994" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<pre class="Agda"><a id="sub-idL"></a><a id="9008" href="/PLFA-zh/Substitution/#9008" class="Function">sub-idL</a> <a id="9016" class="Symbol">:</a> <a id="9018" class="Symbol">∀{</a><a id="9020" href="plfa.Substitution.html#9020" class="Bound">Γ</a> <a id="9022" href="plfa.Substitution.html#9022" class="Bound">Δ</a><a id="9023" class="Symbol">}</a> <a id="9025" class="Symbol">{</a><a id="9026" href="plfa.Substitution.html#9026" class="Bound">σ</a> <a id="9028" class="Symbol">:</a> <a id="9030" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="9036" href="plfa.Substitution.html#9020" class="Bound">Γ</a> <a id="9038" href="plfa.Substitution.html#9022" class="Bound">Δ</a><a id="9039" class="Symbol">}</a> <a id="9041" class="Symbol">{</a><a id="9042" href="plfa.Substitution.html#9042" class="Bound">A</a><a id="9043" class="Symbol">}</a>
       <a id="9052" class="Symbol">→</a> <a id="9054" href="/PLFA-zh/Substitution/#3087" class="Function">ids</a> <a id="9058" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="9060" href="plfa.Substitution.html#9026" class="Bound">σ</a> <a id="9062" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="9064" href="plfa.Substitution.html#9026" class="Bound">σ</a> <a id="9066" class="Symbol">{</a><a id="9067" href="plfa.Substitution.html#9042" class="Bound">A</a><a id="9068" class="Symbol">}</a>
<a id="9070" href="/PLFA-zh/Substitution/#9008" class="Function">sub-idL</a> <a id="9078" class="Symbol">=</a> <a id="9080" href="plfa.Substitution.html#1968" class="Postulate">extensionality</a> <a id="9095" class="Symbol">λ</a> <a id="9097" href="plfa.Substitution.html#9097" class="Bound">x</a> <a id="9099" class="Symbol">→</a> <a id="9101" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<pre class="Agda"><a id="sub-dist"></a><a id="9115" href="/PLFA-zh/Substitution/#9115" class="Function">sub-dist</a> <a id="9124" class="Symbol">:</a>  <a id="9127" class="Symbol">∀{</a><a id="9129" href="plfa.Substitution.html#9129" class="Bound">Γ</a> <a id="9131" href="plfa.Substitution.html#9131" class="Bound">Δ</a> <a id="9133" href="plfa.Substitution.html#9133" class="Bound">Σ</a> <a id="9135" class="Symbol">:</a> <a id="9137" href="/PLFA-zh/Untyped/#3130" class="Datatype">Context</a><a id="9144" class="Symbol">}</a> <a id="9146" class="Symbol">{</a><a id="9147" href="plfa.Substitution.html#9147" class="Bound">A</a> <a id="9149" href="plfa.Substitution.html#9149" class="Bound">B</a><a id="9150" class="Symbol">}</a> <a id="9152" class="Symbol">{</a><a id="9153" href="plfa.Substitution.html#9153" class="Bound">σ</a> <a id="9155" class="Symbol">:</a> <a id="9157" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="9163" href="plfa.Substitution.html#9129" class="Bound">Γ</a> <a id="9165" href="plfa.Substitution.html#9131" class="Bound">Δ</a><a id="9166" class="Symbol">}</a> <a id="9168" class="Symbol">{</a><a id="9169" href="plfa.Substitution.html#9169" class="Bound">τ</a> <a id="9171" class="Symbol">:</a> <a id="9173" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="9179" href="plfa.Substitution.html#9131" class="Bound">Δ</a> <a id="9181" href="plfa.Substitution.html#9133" class="Bound">Σ</a><a id="9182" class="Symbol">}</a>
              <a id="9198" class="Symbol">{</a><a id="9199" href="/PLFA-zh/Substitution/#9199" class="Bound">M</a> <a id="9201" class="Symbol">:</a> <a id="9203" href="plfa.Substitution.html#9131" class="Bound">Δ</a> <a id="9205" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="9207" href="plfa.Substitution.html#9147" class="Bound">A</a><a id="9208" class="Symbol">}</a>
         <a id="9219" class="Symbol">→</a> <a id="9221" class="Symbol">((</a><a id="9223" href="/PLFA-zh/Substitution/#9199" class="Bound">M</a> <a id="9225" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="9227" href="plfa.Substitution.html#9153" class="Bound">σ</a><a id="9228" class="Symbol">)</a> <a id="9230" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="9232" href="plfa.Substitution.html#9169" class="Bound">τ</a><a id="9233" class="Symbol">)</a> <a id="9235" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="9237" class="Symbol">((</a><a id="9239" href="/PLFA-zh/Untyped/#6921" class="Function">subst</a> <a id="9245" href="plfa.Substitution.html#9169" class="Bound">τ</a> <a id="9247" href="plfa.Substitution.html#9199" class="Bound">M</a><a id="9248" class="Symbol">)</a> <a id="9250" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="9252" class="Symbol">(</a><a id="9253" href="plfa.Substitution.html#9153" class="Bound">σ</a> <a id="9255" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="9257" href="plfa.Substitution.html#9169" class="Bound">τ</a><a id="9258" class="Symbol">))</a> <a id="9261" class="Symbol">{</a><a id="9262" href="plfa.Substitution.html#9149" class="Bound">B</a><a id="9263" class="Symbol">}</a>
<a id="9265" href="/PLFA-zh/Substitution/#9115" class="Function">sub-dist</a> <a id="9274" class="Symbol">{</a><a id="9275" href="plfa.Substitution.html#9275" class="Bound">Γ</a><a id="9276" class="Symbol">}{</a><a id="9278" href="plfa.Substitution.html#9278" class="Bound">Δ</a><a id="9279" class="Symbol">}{</a><a id="9281" href="plfa.Substitution.html#9281" class="Bound">Σ</a><a id="9282" class="Symbol">}{</a><a id="9284" href="plfa.Substitution.html#9284" class="Bound">A</a><a id="9285" class="Symbol">}{</a><a id="9287" href="plfa.Substitution.html#9287" class="Bound">B</a><a id="9288" class="Symbol">}{</a><a id="9290" href="plfa.Substitution.html#9290" class="Bound">σ</a><a id="9291" class="Symbol">}{</a><a id="9293" href="plfa.Substitution.html#9293" class="Bound">τ</a><a id="9294" class="Symbol">}{</a><a id="9296" href="plfa.Substitution.html#9296" class="Bound">M</a><a id="9297" class="Symbol">}</a> <a id="9299" class="Symbol">=</a> <a id="9301" href="plfa.Substitution.html#1968" class="Postulate">extensionality</a> <a id="9316" class="Symbol">λ</a> <a id="9318" href="plfa.Substitution.html#9318" class="Bound">x</a> <a id="9320" class="Symbol">→</a> <a id="9322" href="plfa.Substitution.html#9346" class="Function">lemma</a> <a id="9328" class="Symbol">{</a><a id="9329" class="Argument">x</a> <a id="9331" class="Symbol">=</a> <a id="9333" href="plfa.Substitution.html#9318" class="Bound">x</a><a id="9334" class="Symbol">}</a>
  <a id="9338" class="Keyword">where</a>
  <a id="9346" href="/PLFA-zh/Substitution/#9346" class="Function">lemma</a> <a id="9352" class="Symbol">:</a> <a id="9354" class="Symbol">∀</a> <a id="9356" class="Symbol">{</a><a id="9357" href="plfa.Substitution.html#9357" class="Bound">x</a> <a id="9359" class="Symbol">:</a> <a id="9361" href="plfa.Substitution.html#9275" class="Bound">Γ</a> <a id="9363" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="9365" href="plfa.Substitution.html#9284" class="Bound">A</a> <a id="9367" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="9369" href="plfa.Substitution.html#9287" class="Bound">B</a><a id="9370" class="Symbol">}</a> <a id="9372" class="Symbol">→</a> <a id="9374" class="Symbol">((</a><a id="9376" href="plfa.Substitution.html#9296" class="Bound">M</a> <a id="9378" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="9380" href="plfa.Substitution.html#9290" class="Bound">σ</a><a id="9381" class="Symbol">)</a> <a id="9383" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="9385" href="plfa.Substitution.html#9293" class="Bound">τ</a><a id="9386" class="Symbol">)</a> <a id="9388" href="plfa.Substitution.html#9357" class="Bound">x</a> <a id="9390" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="9392" class="Symbol">((</a><a id="9394" href="plfa.Untyped.html#6921" class="Function">subst</a> <a id="9400" href="plfa.Substitution.html#9293" class="Bound">τ</a> <a id="9402" href="plfa.Substitution.html#9296" class="Bound">M</a><a id="9403" class="Symbol">)</a> <a id="9405" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="9407" class="Symbol">(</a><a id="9408" href="plfa.Substitution.html#9290" class="Bound">σ</a> <a id="9410" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="9412" href="plfa.Substitution.html#9293" class="Bound">τ</a><a id="9413" class="Symbol">))</a> <a id="9416" href="plfa.Substitution.html#9357" class="Bound">x</a>
  <a id="9420" href="/PLFA-zh/Substitution/#9346" class="Function">lemma</a> <a id="9426" class="Symbol">{</a><a id="9427" class="Argument">x</a> <a id="9429" class="Symbol">=</a> <a id="9431" href="/PLFA-zh/Untyped/#3519" class="InductiveConstructor">Z</a><a id="9432" class="Symbol">}</a> <a id="9434" class="Symbol">=</a> <a id="9436" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
  <a id="9443" href="/PLFA-zh/Substitution/#9346" class="Function">lemma</a> <a id="9449" class="Symbol">{</a><a id="9450" class="Argument">x</a> <a id="9452" class="Symbol">=</a> <a id="9454" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="9456" href="plfa.Substitution.html#9456" class="Bound">x</a><a id="9457" class="Symbol">}</a> <a id="9459" class="Symbol">=</a> <a id="9461" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<pre class="Agda"><a id="sub-app"></a><a id="9475" href="/PLFA-zh/Substitution/#9475" class="Function">sub-app</a> <a id="9483" class="Symbol">:</a> <a id="9485" class="Symbol">∀{</a><a id="9487" href="plfa.Substitution.html#9487" class="Bound">Γ</a> <a id="9489" href="plfa.Substitution.html#9489" class="Bound">Δ</a><a id="9490" class="Symbol">}</a> <a id="9492" class="Symbol">{</a><a id="9493" href="plfa.Substitution.html#9493" class="Bound">σ</a> <a id="9495" class="Symbol">:</a> <a id="9497" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="9503" href="plfa.Substitution.html#9487" class="Bound">Γ</a> <a id="9505" href="plfa.Substitution.html#9489" class="Bound">Δ</a><a id="9506" class="Symbol">}</a> <a id="9508" class="Symbol">{</a><a id="9509" href="plfa.Substitution.html#9509" class="Bound">L</a> <a id="9511" class="Symbol">:</a> <a id="9513" href="plfa.Substitution.html#9487" class="Bound">Γ</a> <a id="9515" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="9517" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="9518" class="Symbol">}{</a><a id="9520" href="plfa.Substitution.html#9520" class="Bound">M</a> <a id="9522" class="Symbol">:</a> <a id="9524" href="plfa.Substitution.html#9487" class="Bound">Γ</a> <a id="9526" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="9528" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="9529" class="Symbol">}</a>
        <a id="9539" class="Symbol">→</a> <a id="9541" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="9543" href="plfa.Substitution.html#9493" class="Bound">σ</a> <a id="9545" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="9547" class="Symbol">(</a><a id="9548" href="plfa.Substitution.html#9509" class="Bound">L</a> <a id="9550" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="9552" href="plfa.Substitution.html#9520" class="Bound">M</a><a id="9553" class="Symbol">)</a>  <a id="9556" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="9558" class="Symbol">(</a><a id="9559" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="9561" href="plfa.Substitution.html#9493" class="Bound">σ</a> <a id="9563" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="9565" href="plfa.Substitution.html#9509" class="Bound">L</a><a id="9566" class="Symbol">)</a> <a id="9568" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="9570" class="Symbol">(</a><a id="9571" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="9573" href="plfa.Substitution.html#9493" class="Bound">σ</a> <a id="9575" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="9577" href="plfa.Substitution.html#9520" class="Bound">M</a><a id="9578" class="Symbol">)</a>
<a id="9580" href="/PLFA-zh/Substitution/#9475" class="Function">sub-app</a> <a id="9588" class="Symbol">=</a> <a id="9590" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>

<h2 id="interlude-congruences">Interlude: congruences</h2>

<p>In this section we establish congruence rules for the σ algebra
operators <code class="highlighter-rouge">•</code> and <code class="highlighter-rouge">⨟</code> and for <code class="highlighter-rouge">subst</code> and its helper functions <code class="highlighter-rouge">ext</code>,
<code class="highlighter-rouge">rename</code>, <code class="highlighter-rouge">exts</code>, and <code class="highlighter-rouge">subst-zero</code>. These congruence rules help with
the equational reasoning in the later sections of this chapter.</p>

<p>[JGS: I would have liked to prove all of these via cong and cong₂,
 but I have not yet found a way to make that work. It seems that
 various implicit parameters get in the way.]</p>

<pre class="Agda"><a id="cong-ext"></a><a id="10079" href="/PLFA-zh/Substitution/#10079" class="Function">cong-ext</a> <a id="10088" class="Symbol">:</a> <a id="10090" class="Symbol">∀{</a><a id="10092" href="plfa.Substitution.html#10092" class="Bound">Γ</a> <a id="10094" href="plfa.Substitution.html#10094" class="Bound">Δ</a><a id="10095" class="Symbol">}{</a><a id="10097" href="plfa.Substitution.html#10097" class="Bound">ρ</a> <a id="10099" href="plfa.Substitution.html#10099" class="Bound">ρ′</a> <a id="10102" class="Symbol">:</a> <a id="10104" href="plfa.Substitution.html#2233" class="Function">Rename</a> <a id="10111" href="plfa.Substitution.html#10092" class="Bound">Γ</a> <a id="10113" href="plfa.Substitution.html#10094" class="Bound">Δ</a><a id="10114" class="Symbol">}{</a><a id="10116" href="plfa.Substitution.html#10116" class="Bound">B</a><a id="10117" class="Symbol">}</a>
   <a id="10122" class="Symbol">→</a> <a id="10124" class="Symbol">(∀{</a><a id="10127" href="/PLFA-zh/Substitution/#10127" class="Bound">A</a><a id="10128" class="Symbol">}</a> <a id="10130" class="Symbol">→</a> <a id="10132" href="plfa.Substitution.html#10097" class="Bound">ρ</a> <a id="10134" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="10136" href="plfa.Substitution.html#10099" class="Bound">ρ′</a> <a id="10139" class="Symbol">{</a><a id="10140" href="plfa.Substitution.html#10127" class="Bound">A</a><a id="10141" class="Symbol">})</a>
     <a id="10149" class="Comment">---------------------------------</a>
   <a id="10186" class="Symbol">→</a> <a id="10188" class="Symbol">∀{</a><a id="10190" href="/PLFA-zh/Substitution/#10190" class="Bound">A</a><a id="10191" class="Symbol">}</a> <a id="10193" class="Symbol">→</a> <a id="10195" href="/PLFA-zh/Untyped/#5883" class="Function">ext</a> <a id="10199" href="plfa.Substitution.html#10097" class="Bound">ρ</a> <a id="10201" class="Symbol">{</a><a id="10202" class="Argument">B</a> <a id="10204" class="Symbol">=</a> <a id="10206" href="plfa.Substitution.html#10116" class="Bound">B</a><a id="10207" class="Symbol">}</a> <a id="10209" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="10211" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="10215" href="plfa.Substitution.html#10099" class="Bound">ρ′</a> <a id="10218" class="Symbol">{</a><a id="10219" href="plfa.Substitution.html#10190" class="Bound">A</a><a id="10220" class="Symbol">}</a>
<a id="10222" href="/PLFA-zh/Substitution/#10079" class="Function">cong-ext</a><a id="10230" class="Symbol">{</a><a id="10231" href="plfa.Substitution.html#10231" class="Bound">Γ</a><a id="10232" class="Symbol">}{</a><a id="10234" href="plfa.Substitution.html#10234" class="Bound">Δ</a><a id="10235" class="Symbol">}{</a><a id="10237" href="plfa.Substitution.html#10237" class="Bound">ρ</a><a id="10238" class="Symbol">}{</a><a id="10240" href="plfa.Substitution.html#10240" class="Bound">ρ′</a><a id="10242" class="Symbol">}{</a><a id="10244" href="plfa.Substitution.html#10244" class="Bound">B</a><a id="10245" class="Symbol">}</a> <a id="10247" href="plfa.Substitution.html#10247" class="Bound">rr</a> <a id="10250" class="Symbol">{</a><a id="10251" href="plfa.Substitution.html#10251" class="Bound">A</a><a id="10252" class="Symbol">}</a> <a id="10254" class="Symbol">=</a> <a id="10256" href="plfa.Substitution.html#1968" class="Postulate">extensionality</a> <a id="10271" class="Symbol">λ</a> <a id="10273" href="plfa.Substitution.html#10273" class="Bound">x</a> <a id="10275" class="Symbol">→</a> <a id="10277" href="plfa.Substitution.html#10297" class="Function">lemma</a> <a id="10283" class="Symbol">{</a><a id="10284" href="plfa.Substitution.html#10273" class="Bound">x</a><a id="10285" class="Symbol">}</a>
  <a id="10289" class="Keyword">where</a>
  <a id="10297" href="/PLFA-zh/Substitution/#10297" class="Function">lemma</a> <a id="10303" class="Symbol">:</a> <a id="10305" class="Symbol">∀{</a><a id="10307" href="plfa.Substitution.html#10307" class="Bound">x</a> <a id="10309" class="Symbol">:</a> <a id="10311" href="plfa.Substitution.html#10231" class="Bound">Γ</a> <a id="10313" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="10315" href="plfa.Substitution.html#10244" class="Bound">B</a> <a id="10317" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="10319" href="plfa.Substitution.html#10251" class="Bound">A</a><a id="10320" class="Symbol">}</a> <a id="10322" class="Symbol">→</a> <a id="10324" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="10328" href="plfa.Substitution.html#10237" class="Bound">ρ</a> <a id="10330" href="plfa.Substitution.html#10307" class="Bound">x</a> <a id="10332" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="10334" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="10338" href="plfa.Substitution.html#10240" class="Bound">ρ′</a> <a id="10341" href="plfa.Substitution.html#10307" class="Bound">x</a>
  <a id="10345" href="/PLFA-zh/Substitution/#10297" class="Function">lemma</a> <a id="10351" class="Symbol">{</a><a id="10352" href="/PLFA-zh/Untyped/#3519" class="InductiveConstructor">Z</a><a id="10353" class="Symbol">}</a> <a id="10355" class="Symbol">=</a> <a id="10357" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
  <a id="10364" href="/PLFA-zh/Substitution/#10297" class="Function">lemma</a> <a id="10370" class="Symbol">{</a><a id="10371" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="10373" href="plfa.Substitution.html#10373" class="Bound">y</a><a id="10374" class="Symbol">}</a> <a id="10376" class="Symbol">=</a> <a id="10378" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="10383" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a> <a id="10386" class="Symbol">(</a><a id="10387" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1308" class="Function">cong-app</a> <a id="10396" href="plfa.Substitution.html#10247" class="Bound">rr</a> <a id="10399" href="plfa.Substitution.html#10373" class="Bound">y</a><a id="10400" class="Symbol">)</a>
</pre>
<pre class="Agda"><a id="cong-rename"></a><a id="10411" href="/PLFA-zh/Substitution/#10411" class="Function">cong-rename</a> <a id="10423" class="Symbol">:</a> <a id="10425" class="Symbol">∀{</a><a id="10427" href="plfa.Substitution.html#10427" class="Bound">Γ</a> <a id="10429" href="plfa.Substitution.html#10429" class="Bound">Δ</a><a id="10430" class="Symbol">}{</a><a id="10432" href="plfa.Substitution.html#10432" class="Bound">ρ</a> <a id="10434" href="plfa.Substitution.html#10434" class="Bound">ρ′</a> <a id="10437" class="Symbol">:</a> <a id="10439" href="plfa.Substitution.html#2233" class="Function">Rename</a> <a id="10446" href="plfa.Substitution.html#10427" class="Bound">Γ</a> <a id="10448" href="plfa.Substitution.html#10429" class="Bound">Δ</a><a id="10449" class="Symbol">}{</a><a id="10451" href="plfa.Substitution.html#10451" class="Bound">B</a><a id="10452" class="Symbol">}{</a><a id="10454" href="plfa.Substitution.html#10454" class="Bound">M</a> <a id="10456" href="plfa.Substitution.html#10456" class="Bound">M′</a> <a id="10459" class="Symbol">:</a> <a id="10461" href="plfa.Substitution.html#10427" class="Bound">Γ</a> <a id="10463" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="10465" href="plfa.Substitution.html#10451" class="Bound">B</a><a id="10466" class="Symbol">}</a>
        <a id="10476" class="Symbol">→</a> <a id="10478" class="Symbol">(∀{</a><a id="10481" href="/PLFA-zh/Substitution/#10481" class="Bound">A</a><a id="10482" class="Symbol">}</a> <a id="10484" class="Symbol">→</a> <a id="10486" href="plfa.Substitution.html#10432" class="Bound">ρ</a> <a id="10488" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="10490" href="plfa.Substitution.html#10434" class="Bound">ρ′</a> <a id="10493" class="Symbol">{</a><a id="10494" href="plfa.Substitution.html#10481" class="Bound">A</a><a id="10495" class="Symbol">})</a>  <a id="10499" class="Symbol">→</a>  <a id="10502" href="plfa.Substitution.html#10454" class="Bound">M</a> <a id="10504" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="10506" href="plfa.Substitution.html#10456" class="Bound">M′</a>
          <a id="10519" class="Comment">------------------------------</a>
        <a id="10558" class="Symbol">→</a> <a id="10560" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="10567" href="/PLFA-zh/Substitution/#10432" class="Bound">ρ</a> <a id="10569" href="plfa.Substitution.html#10454" class="Bound">M</a> <a id="10571" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="10573" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="10580" href="plfa.Substitution.html#10434" class="Bound">ρ′</a> <a id="10583" href="plfa.Substitution.html#10454" class="Bound">M</a>
<a id="10585" href="/PLFA-zh/Substitution/#10411" class="Function">cong-rename</a> <a id="10597" class="Symbol">{</a><a id="10598" class="Argument">M</a> <a id="10600" class="Symbol">=</a> <a id="10602" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="10604" href="plfa.Substitution.html#10604" class="Bound">x</a><a id="10605" class="Symbol">}</a> <a id="10607" href="plfa.Substitution.html#10607" class="Bound">rr</a> <a id="10610" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="10615" class="Symbol">=</a> <a id="10617" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="10622" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`_</a> <a id="10625" class="Symbol">(</a><a id="10626" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1308" class="Function">cong-app</a> <a id="10635" href="plfa.Substitution.html#10607" class="Bound">rr</a> <a id="10638" href="plfa.Substitution.html#10604" class="Bound">x</a><a id="10639" class="Symbol">)</a>
<a id="10641" href="/PLFA-zh/Substitution/#10411" class="Function">cong-rename</a> <a id="10653" class="Symbol">{</a><a id="10654" class="Argument">ρ</a> <a id="10656" class="Symbol">=</a> <a id="10658" href="plfa.Substitution.html#10658" class="Bound">ρ</a><a id="10659" class="Symbol">}</a> <a id="10661" class="Symbol">{</a><a id="10662" class="Argument">ρ′</a> <a id="10665" class="Symbol">=</a> <a id="10667" href="plfa.Substitution.html#10667" class="Bound">ρ′</a><a id="10669" class="Symbol">}</a> <a id="10671" class="Symbol">{</a><a id="10672" class="Argument">M</a> <a id="10674" class="Symbol">=</a> <a id="10676" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="10678" href="plfa.Substitution.html#10678" class="Bound">N</a><a id="10679" class="Symbol">}</a> <a id="10681" href="plfa.Substitution.html#10681" class="Bound">rr</a> <a id="10684" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="10689" class="Symbol">=</a>
   <a id="10694" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="10699" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ_</a> <a id="10702" class="Symbol">(</a><a id="10703" href="/PLFA-zh/Substitution/#10411" class="Function">cong-rename</a> <a id="10715" class="Symbol">{</a><a id="10716" class="Argument">ρ</a> <a id="10718" class="Symbol">=</a> <a id="10720" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="10724" href="plfa.Substitution.html#10658" class="Bound">ρ</a><a id="10725" class="Symbol">}{</a><a id="10727" class="Argument">ρ′</a> <a id="10730" class="Symbol">=</a> <a id="10732" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="10736" href="plfa.Substitution.html#10667" class="Bound">ρ′</a><a id="10738" class="Symbol">}{</a><a id="10740" class="Argument">M</a> <a id="10742" class="Symbol">=</a> <a id="10744" href="plfa.Substitution.html#10678" class="Bound">N</a><a id="10745" class="Symbol">}</a> <a id="10747" class="Symbol">(</a><a id="10748" href="plfa.Substitution.html#10079" class="Function">cong-ext</a> <a id="10757" href="plfa.Substitution.html#10681" class="Bound">rr</a><a id="10759" class="Symbol">)</a> <a id="10761" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="10765" class="Symbol">)</a>
<a id="10767" href="/PLFA-zh/Substitution/#10411" class="Function">cong-rename</a> <a id="10779" class="Symbol">{</a><a id="10780" class="Argument">M</a> <a id="10782" class="Symbol">=</a> <a id="10784" href="plfa.Substitution.html#10784" class="Bound">L</a> <a id="10786" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="10788" href="plfa.Substitution.html#10788" class="Bound">M</a><a id="10789" class="Symbol">}</a> <a id="10791" href="plfa.Substitution.html#10791" class="Bound">rr</a> <a id="10794" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="10799" class="Symbol">=</a>
   <a id="10804" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1436" class="Function">cong₂</a> <a id="10810" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">_·_</a> <a id="10814" class="Symbol">(</a><a id="10815" href="/PLFA-zh/Substitution/#10411" class="Function">cong-rename</a> <a id="10827" href="plfa.Substitution.html#10791" class="Bound">rr</a> <a id="10830" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="10834" class="Symbol">)</a> <a id="10836" class="Symbol">(</a><a id="10837" href="plfa.Substitution.html#10411" class="Function">cong-rename</a> <a id="10849" href="plfa.Substitution.html#10791" class="Bound">rr</a> <a id="10852" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="10856" class="Symbol">)</a>
</pre>
<pre class="Agda"><a id="cong-exts"></a><a id="10867" href="/PLFA-zh/Substitution/#10867" class="Function">cong-exts</a> <a id="10877" class="Symbol">:</a> <a id="10879" class="Symbol">∀{</a><a id="10881" href="plfa.Substitution.html#10881" class="Bound">Γ</a> <a id="10883" href="plfa.Substitution.html#10883" class="Bound">Δ</a><a id="10884" class="Symbol">}{</a><a id="10886" href="plfa.Substitution.html#10886" class="Bound">σ</a> <a id="10888" href="plfa.Substitution.html#10888" class="Bound">σ′</a> <a id="10891" class="Symbol">:</a> <a id="10893" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="10899" href="plfa.Substitution.html#10881" class="Bound">Γ</a> <a id="10901" href="plfa.Substitution.html#10883" class="Bound">Δ</a><a id="10902" class="Symbol">}{</a><a id="10904" href="plfa.Substitution.html#10904" class="Bound">B</a><a id="10905" class="Symbol">}</a>
   <a id="10910" class="Symbol">→</a> <a id="10912" class="Symbol">(∀{</a><a id="10915" href="/PLFA-zh/Substitution/#10915" class="Bound">A</a><a id="10916" class="Symbol">}</a> <a id="10918" class="Symbol">→</a> <a id="10920" href="plfa.Substitution.html#10886" class="Bound">σ</a> <a id="10922" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="10924" href="plfa.Substitution.html#10888" class="Bound">σ′</a> <a id="10927" class="Symbol">{</a><a id="10928" href="plfa.Substitution.html#10915" class="Bound">A</a><a id="10929" class="Symbol">})</a>
     <a id="10937" class="Comment">-----------------------------------</a>
   <a id="10976" class="Symbol">→</a> <a id="10978" class="Symbol">∀{</a><a id="10980" href="/PLFA-zh/Substitution/#10980" class="Bound">A</a><a id="10981" class="Symbol">}</a> <a id="10983" class="Symbol">→</a> <a id="10985" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="10990" href="plfa.Substitution.html#10886" class="Bound">σ</a> <a id="10992" class="Symbol">{</a><a id="10993" class="Argument">B</a> <a id="10995" class="Symbol">=</a> <a id="10997" href="plfa.Substitution.html#10904" class="Bound">B</a><a id="10998" class="Symbol">}</a> <a id="11000" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="11002" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="11007" href="plfa.Substitution.html#10888" class="Bound">σ′</a> <a id="11010" class="Symbol">{</a><a id="11011" href="plfa.Substitution.html#10980" class="Bound">A</a><a id="11012" class="Symbol">}</a>
<a id="11014" href="/PLFA-zh/Substitution/#10867" class="Function">cong-exts</a><a id="11023" class="Symbol">{</a><a id="11024" href="plfa.Substitution.html#11024" class="Bound">Γ</a><a id="11025" class="Symbol">}{</a><a id="11027" href="plfa.Substitution.html#11027" class="Bound">Δ</a><a id="11028" class="Symbol">}{</a><a id="11030" href="plfa.Substitution.html#11030" class="Bound">σ</a><a id="11031" class="Symbol">}{</a><a id="11033" href="plfa.Substitution.html#11033" class="Bound">σ′</a><a id="11035" class="Symbol">}{</a><a id="11037" href="plfa.Substitution.html#11037" class="Bound">B</a><a id="11038" class="Symbol">}</a> <a id="11040" href="plfa.Substitution.html#11040" class="Bound">ss</a> <a id="11043" class="Symbol">{</a><a id="11044" href="plfa.Substitution.html#11044" class="Bound">A</a><a id="11045" class="Symbol">}</a> <a id="11047" class="Symbol">=</a> <a id="11049" href="plfa.Substitution.html#1968" class="Postulate">extensionality</a> <a id="11064" class="Symbol">λ</a> <a id="11066" href="plfa.Substitution.html#11066" class="Bound">x</a> <a id="11068" class="Symbol">→</a> <a id="11070" href="plfa.Substitution.html#11092" class="Function">lemma</a> <a id="11076" class="Symbol">{</a><a id="11077" href="plfa.Substitution.html#11066" class="Bound">x</a><a id="11078" class="Symbol">}</a>
   <a id="11083" class="Keyword">where</a>
   <a id="11092" href="/PLFA-zh/Substitution/#11092" class="Function">lemma</a> <a id="11098" class="Symbol">:</a> <a id="11100" class="Symbol">∀{</a><a id="11102" href="plfa.Substitution.html#11102" class="Bound">x</a><a id="11103" class="Symbol">}</a> <a id="11105" class="Symbol">→</a> <a id="11107" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="11112" href="plfa.Substitution.html#11030" class="Bound">σ</a> <a id="11114" href="plfa.Substitution.html#11102" class="Bound">x</a> <a id="11116" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="11118" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="11123" href="plfa.Substitution.html#11033" class="Bound">σ′</a> <a id="11126" href="plfa.Substitution.html#11102" class="Bound">x</a>
   <a id="11131" href="/PLFA-zh/Substitution/#11092" class="Function">lemma</a> <a id="11137" class="Symbol">{</a><a id="11138" href="/PLFA-zh/Untyped/#3519" class="InductiveConstructor">Z</a><a id="11139" class="Symbol">}</a> <a id="11141" class="Symbol">=</a> <a id="11143" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
   <a id="11151" href="/PLFA-zh/Substitution/#11092" class="Function">lemma</a> <a id="11157" class="Symbol">{</a><a id="11158" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="11160" href="plfa.Substitution.html#11160" class="Bound">x</a><a id="11161" class="Symbol">}</a> <a id="11163" class="Symbol">=</a> <a id="11165" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="11170" class="Symbol">(</a><a id="11171" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="11178" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a><a id="11180" class="Symbol">)</a> <a id="11182" class="Symbol">(</a><a id="11183" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1308" class="Function">cong-app</a> <a id="11192" class="Symbol">(</a><a id="11193" href="plfa.Substitution.html#11040" class="Bound">ss</a> <a id="11196" class="Symbol">{</a><a id="11197" href="plfa.Substitution.html#11044" class="Bound">A</a><a id="11198" class="Symbol">})</a> <a id="11201" href="plfa.Substitution.html#11160" class="Bound">x</a><a id="11202" class="Symbol">)</a>
</pre>
<pre class="Agda"><a id="cong-sub"></a><a id="11213" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a> <a id="11222" class="Symbol">:</a> <a id="11224" class="Symbol">∀{</a><a id="11226" href="plfa.Substitution.html#11226" class="Bound">Γ</a> <a id="11228" href="plfa.Substitution.html#11228" class="Bound">Δ</a><a id="11229" class="Symbol">}{</a><a id="11231" href="plfa.Substitution.html#11231" class="Bound">σ</a> <a id="11233" href="plfa.Substitution.html#11233" class="Bound">σ′</a> <a id="11236" class="Symbol">:</a> <a id="11238" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="11244" href="plfa.Substitution.html#11226" class="Bound">Γ</a> <a id="11246" href="plfa.Substitution.html#11228" class="Bound">Δ</a><a id="11247" class="Symbol">}{</a><a id="11249" href="plfa.Substitution.html#11249" class="Bound">A</a><a id="11250" class="Symbol">}{</a><a id="11252" href="plfa.Substitution.html#11252" class="Bound">M</a> <a id="11254" href="plfa.Substitution.html#11254" class="Bound">M′</a> <a id="11257" class="Symbol">:</a> <a id="11259" href="plfa.Substitution.html#11226" class="Bound">Γ</a> <a id="11261" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="11263" href="plfa.Substitution.html#11249" class="Bound">A</a><a id="11264" class="Symbol">}</a>
            <a id="11278" class="Symbol">→</a> <a id="11280" class="Symbol">(∀{</a><a id="11283" href="/PLFA-zh/Substitution/#11283" class="Bound">A</a><a id="11284" class="Symbol">}</a> <a id="11286" class="Symbol">→</a> <a id="11288" href="plfa.Substitution.html#11231" class="Bound">σ</a> <a id="11290" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="11292" href="plfa.Substitution.html#11233" class="Bound">σ′</a> <a id="11295" class="Symbol">{</a><a id="11296" href="plfa.Substitution.html#11283" class="Bound">A</a><a id="11297" class="Symbol">})</a>  <a id="11301" class="Symbol">→</a>  <a id="11304" href="plfa.Substitution.html#11252" class="Bound">M</a> <a id="11306" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="11308" href="plfa.Substitution.html#11254" class="Bound">M′</a>
              <a id="11325" class="Comment">------------------------------</a>
            <a id="11368" class="Symbol">→</a> <a id="11370" href="/PLFA-zh/Untyped/#6921" class="Function">subst</a> <a id="11376" href="/PLFA-zh/Substitution/#11231" class="Bound">σ</a> <a id="11378" href="plfa.Substitution.html#11252" class="Bound">M</a> <a id="11380" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="11382" href="plfa.Untyped.html#6921" class="Function">subst</a> <a id="11388" href="plfa.Substitution.html#11233" class="Bound">σ′</a> <a id="11391" href="plfa.Substitution.html#11254" class="Bound">M′</a>
<a id="11394" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a> <a id="11403" class="Symbol">{</a><a id="11404" href="plfa.Substitution.html#11404" class="Bound">Γ</a><a id="11405" class="Symbol">}</a> <a id="11407" class="Symbol">{</a><a id="11408" href="plfa.Substitution.html#11408" class="Bound">Δ</a><a id="11409" class="Symbol">}</a> <a id="11411" class="Symbol">{</a><a id="11412" href="plfa.Substitution.html#11412" class="Bound">σ</a><a id="11413" class="Symbol">}</a> <a id="11415" class="Symbol">{</a><a id="11416" href="plfa.Substitution.html#11416" class="Bound">σ′</a><a id="11418" class="Symbol">}</a> <a id="11420" class="Symbol">{</a><a id="11421" href="plfa.Substitution.html#11421" class="Bound">A</a><a id="11422" class="Symbol">}</a> <a id="11424" class="Symbol">{</a><a id="11425" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="11427" href="plfa.Substitution.html#11427" class="Bound">x</a><a id="11428" class="Symbol">}</a> <a id="11430" href="plfa.Substitution.html#11430" class="Bound">ss</a> <a id="11433" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="11438" class="Symbol">=</a> <a id="11440" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1308" class="Function">cong-app</a> <a id="11449" href="plfa.Substitution.html#11430" class="Bound">ss</a> <a id="11452" href="plfa.Substitution.html#11427" class="Bound">x</a>
<a id="11454" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a> <a id="11463" class="Symbol">{</a><a id="11464" href="plfa.Substitution.html#11464" class="Bound">Γ</a><a id="11465" class="Symbol">}</a> <a id="11467" class="Symbol">{</a><a id="11468" href="plfa.Substitution.html#11468" class="Bound">Δ</a><a id="11469" class="Symbol">}</a> <a id="11471" class="Symbol">{</a><a id="11472" href="plfa.Substitution.html#11472" class="Bound">σ</a><a id="11473" class="Symbol">}</a> <a id="11475" class="Symbol">{</a><a id="11476" href="plfa.Substitution.html#11476" class="Bound">σ′</a><a id="11478" class="Symbol">}</a> <a id="11480" class="Symbol">{</a><a id="11481" href="plfa.Substitution.html#11481" class="Bound">A</a><a id="11482" class="Symbol">}</a> <a id="11484" class="Symbol">{</a><a id="11485" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="11487" href="plfa.Substitution.html#11487" class="Bound">M</a><a id="11488" class="Symbol">}</a> <a id="11490" href="plfa.Substitution.html#11490" class="Bound">ss</a> <a id="11493" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="11498" class="Symbol">=</a>
   <a id="11503" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="11508" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ_</a> <a id="11511" class="Symbol">(</a><a id="11512" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a> <a id="11521" class="Symbol">{</a><a id="11522" class="Argument">σ</a> <a id="11524" class="Symbol">=</a> <a id="11526" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="11531" href="plfa.Substitution.html#11472" class="Bound">σ</a><a id="11532" class="Symbol">}{</a><a id="11534" class="Argument">σ′</a> <a id="11537" class="Symbol">=</a> <a id="11539" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="11544" href="plfa.Substitution.html#11476" class="Bound">σ′</a><a id="11546" class="Symbol">}</a> <a id="11548" class="Symbol">{</a><a id="11549" class="Argument">M</a> <a id="11551" class="Symbol">=</a> <a id="11553" href="plfa.Substitution.html#11487" class="Bound">M</a><a id="11554" class="Symbol">}</a> <a id="11556" class="Symbol">(</a><a id="11557" href="plfa.Substitution.html#10867" class="Function">cong-exts</a> <a id="11567" href="plfa.Substitution.html#11490" class="Bound">ss</a><a id="11569" class="Symbol">)</a> <a id="11571" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="11575" class="Symbol">)</a>
<a id="11577" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a> <a id="11586" class="Symbol">{</a><a id="11587" href="plfa.Substitution.html#11587" class="Bound">Γ</a><a id="11588" class="Symbol">}</a> <a id="11590" class="Symbol">{</a><a id="11591" href="plfa.Substitution.html#11591" class="Bound">Δ</a><a id="11592" class="Symbol">}</a> <a id="11594" class="Symbol">{</a><a id="11595" href="plfa.Substitution.html#11595" class="Bound">σ</a><a id="11596" class="Symbol">}</a> <a id="11598" class="Symbol">{</a><a id="11599" href="plfa.Substitution.html#11599" class="Bound">σ′</a><a id="11601" class="Symbol">}</a> <a id="11603" class="Symbol">{</a><a id="11604" href="plfa.Substitution.html#11604" class="Bound">A</a><a id="11605" class="Symbol">}</a> <a id="11607" class="Symbol">{</a><a id="11608" href="plfa.Substitution.html#11608" class="Bound">L</a> <a id="11610" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="11612" href="plfa.Substitution.html#11612" class="Bound">M</a><a id="11613" class="Symbol">}</a> <a id="11615" href="plfa.Substitution.html#11615" class="Bound">ss</a> <a id="11618" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="11623" class="Symbol">=</a>
   <a id="11628" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1436" class="Function">cong₂</a> <a id="11634" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">_·_</a> <a id="11638" class="Symbol">(</a><a id="11639" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a> <a id="11648" class="Symbol">{</a><a id="11649" class="Argument">M</a> <a id="11651" class="Symbol">=</a> <a id="11653" href="plfa.Substitution.html#11608" class="Bound">L</a><a id="11654" class="Symbol">}</a> <a id="11656" href="plfa.Substitution.html#11615" class="Bound">ss</a> <a id="11659" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="11663" class="Symbol">)</a> <a id="11665" class="Symbol">(</a><a id="11666" href="plfa.Substitution.html#11213" class="Function">cong-sub</a> <a id="11675" class="Symbol">{</a><a id="11676" class="Argument">M</a> <a id="11678" class="Symbol">=</a> <a id="11680" href="plfa.Substitution.html#11612" class="Bound">M</a><a id="11681" class="Symbol">}</a> <a id="11683" href="plfa.Substitution.html#11615" class="Bound">ss</a> <a id="11686" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="11690" class="Symbol">)</a>
</pre>
<pre class="Agda"><a id="cong-sub-zero"></a><a id="11701" href="/PLFA-zh/Substitution/#11701" class="Function">cong-sub-zero</a> <a id="11715" class="Symbol">:</a> <a id="11717" class="Symbol">∀{</a><a id="11719" href="plfa.Substitution.html#11719" class="Bound">Γ</a><a id="11720" class="Symbol">}{</a><a id="11722" href="plfa.Substitution.html#11722" class="Bound">B</a> <a id="11724" class="Symbol">:</a> <a id="11726" href="/PLFA-zh/Untyped/#2857" class="Datatype">Type</a><a id="11730" class="Symbol">}{</a><a id="11732" href="plfa.Substitution.html#11732" class="Bound">M</a> <a id="11734" href="plfa.Substitution.html#11734" class="Bound">M′</a> <a id="11737" class="Symbol">:</a> <a id="11739" href="plfa.Substitution.html#11719" class="Bound">Γ</a> <a id="11741" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="11743" href="plfa.Substitution.html#11722" class="Bound">B</a><a id="11744" class="Symbol">}</a>
  <a id="11748" class="Symbol">→</a> <a id="11750" href="/PLFA-zh/Substitution/#11732" class="Bound">M</a> <a id="11752" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="11754" href="plfa.Substitution.html#11734" class="Bound">M′</a>
    <a id="11761" class="Comment">-----------------------------------------</a>
  <a id="11805" class="Symbol">→</a> <a id="11807" class="Symbol">∀{</a><a id="11809" href="/PLFA-zh/Substitution/#11809" class="Bound">A</a><a id="11810" class="Symbol">}</a> <a id="11812" class="Symbol">→</a> <a id="11814" href="/PLFA-zh/Untyped/#7333" class="Function">subst-zero</a> <a id="11825" href="plfa.Substitution.html#11732" class="Bound">M</a> <a id="11827" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="11829" class="Symbol">(</a><a id="11830" href="plfa.Untyped.html#7333" class="Function">subst-zero</a> <a id="11841" href="plfa.Substitution.html#11734" class="Bound">M′</a><a id="11843" class="Symbol">)</a> <a id="11845" class="Symbol">{</a><a id="11846" href="plfa.Substitution.html#11809" class="Bound">A</a><a id="11847" class="Symbol">}</a>
<a id="11849" href="/PLFA-zh/Substitution/#11701" class="Function">cong-sub-zero</a> <a id="11863" class="Symbol">{</a><a id="11864" href="plfa.Substitution.html#11864" class="Bound">Γ</a><a id="11865" class="Symbol">}{</a><a id="11867" href="plfa.Substitution.html#11867" class="Bound">B</a><a id="11868" class="Symbol">}{</a><a id="11870" href="plfa.Substitution.html#11870" class="Bound">M</a><a id="11871" class="Symbol">}{</a><a id="11873" href="plfa.Substitution.html#11873" class="Bound">M′</a><a id="11875" class="Symbol">}</a> <a id="11877" href="plfa.Substitution.html#11877" class="Bound">mm&#39;</a> <a id="11881" class="Symbol">{</a><a id="11882" href="plfa.Substitution.html#11882" class="Bound">A</a><a id="11883" class="Symbol">}</a> <a id="11885" class="Symbol">=</a>
   <a id="11890" href="/PLFA-zh/Substitution/#1968" class="Postulate">extensionality</a> <a id="11905" class="Symbol">λ</a> <a id="11907" href="plfa.Substitution.html#11907" class="Bound">x</a> <a id="11909" class="Symbol">→</a> <a id="11911" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="11916" class="Symbol">(λ</a> <a id="11919" href="plfa.Substitution.html#11919" class="Bound">z</a> <a id="11921" class="Symbol">→</a> <a id="11923" href="/PLFA-zh/Untyped/#7333" class="Function">subst-zero</a> <a id="11934" href="plfa.Substitution.html#11919" class="Bound">z</a> <a id="11936" href="plfa.Substitution.html#11907" class="Bound">x</a><a id="11937" class="Symbol">)</a> <a id="11939" href="plfa.Substitution.html#11877" class="Bound">mm&#39;</a>
</pre>
<pre class="Agda"><a id="cong-cons"></a><a id="11952" href="/PLFA-zh/Substitution/#11952" class="Function">cong-cons</a> <a id="11962" class="Symbol">:</a> <a id="11964" class="Symbol">∀{</a><a id="11966" href="plfa.Substitution.html#11966" class="Bound">Γ</a> <a id="11968" href="plfa.Substitution.html#11968" class="Bound">Δ</a><a id="11969" class="Symbol">}{</a><a id="11971" href="plfa.Substitution.html#11971" class="Bound">A</a><a id="11972" class="Symbol">}{</a><a id="11974" href="plfa.Substitution.html#11974" class="Bound">M</a> <a id="11976" href="plfa.Substitution.html#11976" class="Bound">N</a> <a id="11978" class="Symbol">:</a> <a id="11980" href="plfa.Substitution.html#11968" class="Bound">Δ</a> <a id="11982" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="11984" href="plfa.Substitution.html#11971" class="Bound">A</a><a id="11985" class="Symbol">}{</a><a id="11987" href="plfa.Substitution.html#11987" class="Bound">σ</a> <a id="11989" href="plfa.Substitution.html#11989" class="Bound">τ</a> <a id="11991" class="Symbol">:</a> <a id="11993" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="11999" href="plfa.Substitution.html#11966" class="Bound">Γ</a> <a id="12001" href="plfa.Substitution.html#11968" class="Bound">Δ</a><a id="12002" class="Symbol">}</a>
  <a id="12006" class="Symbol">→</a> <a id="12008" href="/PLFA-zh/Substitution/#11974" class="Bound">M</a> <a id="12010" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12012" href="plfa.Substitution.html#11976" class="Bound">N</a>  <a id="12015" class="Symbol">→</a>  <a id="12018" class="Symbol">(∀{</a><a id="12021" href="plfa.Substitution.html#12021" class="Bound">A</a><a id="12022" class="Symbol">}</a> <a id="12024" class="Symbol">→</a> <a id="12026" href="plfa.Substitution.html#11987" class="Bound">σ</a> <a id="12028" class="Symbol">{</a><a id="12029" href="plfa.Substitution.html#12021" class="Bound">A</a><a id="12030" class="Symbol">}</a> <a id="12032" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12034" href="plfa.Substitution.html#11989" class="Bound">τ</a> <a id="12036" class="Symbol">{</a><a id="12037" href="plfa.Substitution.html#12021" class="Bound">A</a><a id="12038" class="Symbol">})</a>
    <a id="12045" class="Comment">--------------------------------</a>
  <a id="12080" class="Symbol">→</a> <a id="12082" class="Symbol">∀{</a><a id="12084" href="/PLFA-zh/Substitution/#12084" class="Bound">A</a><a id="12085" class="Symbol">}</a> <a id="12087" class="Symbol">→</a> <a id="12089" class="Symbol">(</a><a id="12090" href="plfa.Substitution.html#11974" class="Bound">M</a> <a id="12092" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="12094" href="plfa.Substitution.html#11987" class="Bound">σ</a><a id="12095" class="Symbol">)</a> <a id="12097" class="Symbol">{</a><a id="12098" href="plfa.Substitution.html#12084" class="Bound">A</a><a id="12099" class="Symbol">}</a> <a id="12101" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12103" class="Symbol">(</a><a id="12104" href="plfa.Substitution.html#11976" class="Bound">N</a> <a id="12106" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="12108" href="plfa.Substitution.html#11989" class="Bound">τ</a><a id="12109" class="Symbol">)</a> <a id="12111" class="Symbol">{</a><a id="12112" href="plfa.Substitution.html#12084" class="Bound">A</a><a id="12113" class="Symbol">}</a>
<a id="12115" href="/PLFA-zh/Substitution/#11952" class="Function">cong-cons</a><a id="12124" class="Symbol">{</a><a id="12125" href="plfa.Substitution.html#12125" class="Bound">Γ</a><a id="12126" class="Symbol">}{</a><a id="12128" href="plfa.Substitution.html#12128" class="Bound">Δ</a><a id="12129" class="Symbol">}{</a><a id="12131" href="plfa.Substitution.html#12131" class="Bound">A</a><a id="12132" class="Symbol">}{</a><a id="12134" href="plfa.Substitution.html#12134" class="Bound">M</a><a id="12135" class="Symbol">}{</a><a id="12137" href="plfa.Substitution.html#12137" class="Bound">N</a><a id="12138" class="Symbol">}{</a><a id="12140" href="plfa.Substitution.html#12140" class="Bound">σ</a><a id="12141" class="Symbol">}{</a><a id="12143" href="plfa.Substitution.html#12143" class="Bound">τ</a><a id="12144" class="Symbol">}</a> <a id="12146" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="12151" href="plfa.Substitution.html#12151" class="Bound">st</a> <a id="12154" class="Symbol">{</a><a id="12155" href="plfa.Substitution.html#12155" class="Bound">A′</a><a id="12157" class="Symbol">}</a> <a id="12159" class="Symbol">=</a> <a id="12161" href="plfa.Substitution.html#1968" class="Postulate">extensionality</a> <a id="12176" href="plfa.Substitution.html#12192" class="Function">lemma</a>
  <a id="12184" class="Keyword">where</a>
  <a id="12192" href="/PLFA-zh/Substitution/#12192" class="Function">lemma</a> <a id="12198" class="Symbol">:</a> <a id="12200" class="Symbol">(</a><a id="12201" href="plfa.Substitution.html#12201" class="Bound">x</a> <a id="12203" class="Symbol">:</a> <a id="12205" href="plfa.Substitution.html#12125" class="Bound">Γ</a> <a id="12207" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="12209" href="plfa.Substitution.html#12131" class="Bound">A</a> <a id="12211" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="12213" href="plfa.Substitution.html#12155" class="Bound">A′</a><a id="12215" class="Symbol">)</a> <a id="12217" class="Symbol">→</a> <a id="12219" class="Symbol">(</a><a id="12220" href="plfa.Substitution.html#12134" class="Bound">M</a> <a id="12222" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="12224" href="plfa.Substitution.html#12140" class="Bound">σ</a><a id="12225" class="Symbol">)</a> <a id="12227" href="plfa.Substitution.html#12201" class="Bound">x</a> <a id="12229" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12231" class="Symbol">(</a><a id="12232" href="plfa.Substitution.html#12134" class="Bound">M</a> <a id="12234" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="12236" href="plfa.Substitution.html#12143" class="Bound">τ</a><a id="12237" class="Symbol">)</a> <a id="12239" href="plfa.Substitution.html#12201" class="Bound">x</a>
  <a id="12243" href="/PLFA-zh/Substitution/#12192" class="Function">lemma</a> <a id="12249" href="/PLFA-zh/Untyped/#3519" class="InductiveConstructor">Z</a> <a id="12251" class="Symbol">=</a> <a id="12253" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
  <a id="12260" href="/PLFA-zh/Substitution/#12192" class="Function">lemma</a> <a id="12266" class="Symbol">(</a><a id="12267" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="12269" href="plfa.Substitution.html#12269" class="Bound">x</a><a id="12270" class="Symbol">)</a> <a id="12272" class="Symbol">=</a> <a id="12274" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1308" class="Function">cong-app</a> <a id="12283" href="plfa.Substitution.html#12151" class="Bound">st</a> <a id="12286" href="plfa.Substitution.html#12269" class="Bound">x</a>
</pre>
<pre class="Agda"><a id="cong-seq"></a><a id="12297" href="/PLFA-zh/Substitution/#12297" class="Function">cong-seq</a> <a id="12306" class="Symbol">:</a> <a id="12308" class="Symbol">∀{</a><a id="12310" href="plfa.Substitution.html#12310" class="Bound">Γ</a> <a id="12312" href="plfa.Substitution.html#12312" class="Bound">Δ</a> <a id="12314" href="plfa.Substitution.html#12314" class="Bound">Σ</a><a id="12315" class="Symbol">}{</a><a id="12317" href="plfa.Substitution.html#12317" class="Bound">σ</a> <a id="12319" href="plfa.Substitution.html#12319" class="Bound">σ′</a> <a id="12322" class="Symbol">:</a> <a id="12324" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="12330" href="plfa.Substitution.html#12310" class="Bound">Γ</a> <a id="12332" href="plfa.Substitution.html#12312" class="Bound">Δ</a><a id="12333" class="Symbol">}{</a><a id="12335" href="plfa.Substitution.html#12335" class="Bound">τ</a> <a id="12337" href="plfa.Substitution.html#12337" class="Bound">τ′</a> <a id="12340" class="Symbol">:</a> <a id="12342" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="12348" href="plfa.Substitution.html#12312" class="Bound">Δ</a> <a id="12350" href="plfa.Substitution.html#12314" class="Bound">Σ</a><a id="12351" class="Symbol">}</a>
  <a id="12355" class="Symbol">→</a> <a id="12357" class="Symbol">(∀{</a><a id="12360" href="/PLFA-zh/Substitution/#12360" class="Bound">A</a><a id="12361" class="Symbol">}</a> <a id="12363" class="Symbol">→</a> <a id="12365" href="plfa.Substitution.html#12317" class="Bound">σ</a> <a id="12367" class="Symbol">{</a><a id="12368" href="plfa.Substitution.html#12360" class="Bound">A</a><a id="12369" class="Symbol">}</a> <a id="12371" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12373" href="plfa.Substitution.html#12319" class="Bound">σ′</a> <a id="12376" class="Symbol">{</a><a id="12377" href="plfa.Substitution.html#12360" class="Bound">A</a><a id="12378" class="Symbol">})</a> <a id="12381" class="Symbol">→</a> <a id="12383" class="Symbol">(∀{</a><a id="12386" href="plfa.Substitution.html#12386" class="Bound">A</a><a id="12387" class="Symbol">}</a> <a id="12389" class="Symbol">→</a> <a id="12391" href="plfa.Substitution.html#12335" class="Bound">τ</a> <a id="12393" class="Symbol">{</a><a id="12394" href="plfa.Substitution.html#12386" class="Bound">A</a><a id="12395" class="Symbol">}</a> <a id="12397" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12399" href="plfa.Substitution.html#12337" class="Bound">τ′</a> <a id="12402" class="Symbol">{</a><a id="12403" href="plfa.Substitution.html#12386" class="Bound">A</a><a id="12404" class="Symbol">})</a>
  <a id="12409" class="Symbol">→</a> <a id="12411" class="Symbol">∀{</a><a id="12413" href="/PLFA-zh/Substitution/#12413" class="Bound">A</a><a id="12414" class="Symbol">}</a> <a id="12416" class="Symbol">→</a> <a id="12418" class="Symbol">(</a><a id="12419" href="plfa.Substitution.html#12317" class="Bound">σ</a> <a id="12421" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="12423" href="plfa.Substitution.html#12335" class="Bound">τ</a><a id="12424" class="Symbol">)</a> <a id="12426" class="Symbol">{</a><a id="12427" href="plfa.Substitution.html#12413" class="Bound">A</a><a id="12428" class="Symbol">}</a> <a id="12430" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12432" class="Symbol">(</a><a id="12433" href="plfa.Substitution.html#12319" class="Bound">σ′</a> <a id="12436" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="12438" href="plfa.Substitution.html#12337" class="Bound">τ′</a><a id="12440" class="Symbol">)</a> <a id="12442" class="Symbol">{</a><a id="12443" href="plfa.Substitution.html#12413" class="Bound">A</a><a id="12444" class="Symbol">}</a>
<a id="12446" href="/PLFA-zh/Substitution/#12297" class="Function">cong-seq</a> <a id="12455" class="Symbol">{</a><a id="12456" href="plfa.Substitution.html#12456" class="Bound">Γ</a><a id="12457" class="Symbol">}{</a><a id="12459" href="plfa.Substitution.html#12459" class="Bound">Δ</a><a id="12460" class="Symbol">}{</a><a id="12462" href="plfa.Substitution.html#12462" class="Bound">Σ</a><a id="12463" class="Symbol">}{</a><a id="12465" href="plfa.Substitution.html#12465" class="Bound">σ</a><a id="12466" class="Symbol">}{</a><a id="12468" href="plfa.Substitution.html#12468" class="Bound">σ′</a><a id="12470" class="Symbol">}{</a><a id="12472" href="plfa.Substitution.html#12472" class="Bound">τ</a><a id="12473" class="Symbol">}{</a><a id="12475" href="plfa.Substitution.html#12475" class="Bound">τ′</a><a id="12477" class="Symbol">}</a> <a id="12479" href="plfa.Substitution.html#12479" class="Bound">ss&#39;</a> <a id="12483" href="plfa.Substitution.html#12483" class="Bound">tt&#39;</a> <a id="12487" class="Symbol">{</a><a id="12488" href="plfa.Substitution.html#12488" class="Bound">A</a><a id="12489" class="Symbol">}</a> <a id="12491" class="Symbol">=</a> <a id="12493" href="plfa.Substitution.html#1968" class="Postulate">extensionality</a> <a id="12508" href="plfa.Substitution.html#12524" class="Function">lemma</a>
  <a id="12516" class="Keyword">where</a>
  <a id="12524" href="/PLFA-zh/Substitution/#12524" class="Function">lemma</a> <a id="12530" class="Symbol">:</a> <a id="12532" class="Symbol">(</a><a id="12533" href="plfa.Substitution.html#12533" class="Bound">x</a> <a id="12535" class="Symbol">:</a> <a id="12537" href="plfa.Substitution.html#12456" class="Bound">Γ</a> <a id="12539" href="/PLFA-zh/Untyped/#3483" class="Datatype Operator">∋</a> <a id="12541" href="plfa.Substitution.html#12488" class="Bound">A</a><a id="12542" class="Symbol">)</a> <a id="12544" class="Symbol">→</a> <a id="12546" class="Symbol">(</a><a id="12547" href="plfa.Substitution.html#12465" class="Bound">σ</a> <a id="12549" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="12551" href="plfa.Substitution.html#12472" class="Bound">τ</a><a id="12552" class="Symbol">)</a> <a id="12554" href="plfa.Substitution.html#12533" class="Bound">x</a> <a id="12556" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12558" class="Symbol">(</a><a id="12559" href="plfa.Substitution.html#12468" class="Bound">σ′</a> <a id="12562" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="12564" href="plfa.Substitution.html#12475" class="Bound">τ′</a><a id="12566" class="Symbol">)</a> <a id="12568" href="plfa.Substitution.html#12533" class="Bound">x</a>
  <a id="12572" href="/PLFA-zh/Substitution/#12524" class="Function">lemma</a> <a id="12578" href="plfa.Substitution.html#12578" class="Bound">x</a> <a id="12580" class="Symbol">=</a>
     <a id="12587" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin</a>
       <a id="12600" class="Symbol">(</a><a id="12601" href="/PLFA-zh/Substitution/#12465" class="Bound">σ</a> <a id="12603" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="12605" href="plfa.Substitution.html#12472" class="Bound">τ</a><a id="12606" class="Symbol">)</a> <a id="12608" href="plfa.Substitution.html#12578" class="Bound">x</a>
     <a id="12615" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
       <a id="12626" href="/PLFA-zh/Untyped/#6921" class="Function">subst</a> <a id="12632" href="/PLFA-zh/Substitution/#12472" class="Bound">τ</a> <a id="12634" class="Symbol">(</a><a id="12635" href="plfa.Substitution.html#12465" class="Bound">σ</a> <a id="12637" href="plfa.Substitution.html#12578" class="Bound">x</a><a id="12638" class="Symbol">)</a>
     <a id="12645" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="12648" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="12653" class="Symbol">(</a><a id="12654" href="/PLFA-zh/Untyped/#6921" class="Function">subst</a> <a id="12660" href="/PLFA-zh/Substitution/#12472" class="Bound">τ</a><a id="12661" class="Symbol">)</a> <a id="12663" class="Symbol">(</a><a id="12664" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1308" class="Function">cong-app</a> <a id="12673" href="plfa.Substitution.html#12479" class="Bound">ss&#39;</a> <a id="12677" href="plfa.Substitution.html#12578" class="Bound">x</a><a id="12678" class="Symbol">)</a> <a id="12680" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="12689" href="/PLFA-zh/Untyped/#6921" class="Function">subst</a> <a id="12695" href="/PLFA-zh/Substitution/#12472" class="Bound">τ</a> <a id="12697" class="Symbol">(</a><a id="12698" href="plfa.Substitution.html#12468" class="Bound">σ′</a> <a id="12701" href="plfa.Substitution.html#12578" class="Bound">x</a><a id="12702" class="Symbol">)</a>
     <a id="12709" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="12712" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a><a id="12720" class="Symbol">{</a><a id="12721" class="Argument">M</a> <a id="12723" class="Symbol">=</a> <a id="12725" href="plfa.Substitution.html#12468" class="Bound">σ′</a> <a id="12728" href="plfa.Substitution.html#12578" class="Bound">x</a><a id="12729" class="Symbol">}</a> <a id="12731" href="plfa.Substitution.html#12483" class="Bound">tt&#39;</a> <a id="12735" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="12740" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="12749" href="/PLFA-zh/Untyped/#6921" class="Function">subst</a> <a id="12755" href="/PLFA-zh/Substitution/#12475" class="Bound">τ′</a> <a id="12758" class="Symbol">(</a><a id="12759" href="plfa.Substitution.html#12468" class="Bound">σ′</a> <a id="12762" href="plfa.Substitution.html#12578" class="Bound">x</a><a id="12763" class="Symbol">)</a>
     <a id="12770" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
       <a id="12781" class="Symbol">(</a><a id="12782" href="/PLFA-zh/Substitution/#12468" class="Bound">σ′</a> <a id="12785" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="12787" href="plfa.Substitution.html#12475" class="Bound">τ′</a><a id="12789" class="Symbol">)</a> <a id="12791" href="plfa.Substitution.html#12578" class="Bound">x</a>
     <a id="12798" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">∎</a>
</pre>

<h2 id="relating-rename-exts-ext-and-subst-zero-to-the-σ-algebra">Relating <code class="highlighter-rouge">rename</code>, <code class="highlighter-rouge">exts</code>, <code class="highlighter-rouge">ext</code>, and <code class="highlighter-rouge">subst-zero</code> to the σ algebra</h2>

<p>In this section we establish equations that relate <code class="highlighter-rouge">subst</code> and its
helper functions (<code class="highlighter-rouge">rename</code>, <code class="highlighter-rouge">exts</code>, <code class="highlighter-rouge">ext</code>, and <code class="highlighter-rouge">subst-zero</code>) to terms
in the σ algebra.</p>

<p>The first equation we prove is</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rename ρ M ≡ ⟪ ren ρ ⟫ M              (rename-subst-ren)
</code></pre></div></div>

<p>Because <code class="highlighter-rouge">subst</code> uses the <code class="highlighter-rouge">exts</code> function, we need the following lemma
which says that <code class="highlighter-rouge">exts</code> and <code class="highlighter-rouge">ext</code> do the same thing except that <code class="highlighter-rouge">ext</code>
works on renamings and <code class="highlighter-rouge">exts</code> works on substitutions.</p>

<pre class="Agda"><a id="ren-ext"></a><a id="13326" href="/PLFA-zh/Substitution/#13326" class="Function">ren-ext</a> <a id="13334" class="Symbol">:</a> <a id="13336" class="Symbol">∀</a> <a id="13338" class="Symbol">{</a><a id="13339" href="plfa.Substitution.html#13339" class="Bound">Γ</a> <a id="13341" href="plfa.Substitution.html#13341" class="Bound">Δ</a><a id="13342" class="Symbol">}{</a><a id="13344" href="plfa.Substitution.html#13344" class="Bound">B</a> <a id="13346" href="plfa.Substitution.html#13346" class="Bound">C</a> <a id="13348" class="Symbol">:</a> <a id="13350" href="/PLFA-zh/Untyped/#2857" class="Datatype">Type</a><a id="13354" class="Symbol">}</a> <a id="13356" class="Symbol">{</a><a id="13357" href="plfa.Substitution.html#13357" class="Bound">ρ</a> <a id="13359" class="Symbol">:</a> <a id="13361" href="plfa.Substitution.html#2233" class="Function">Rename</a> <a id="13368" href="plfa.Substitution.html#13339" class="Bound">Γ</a> <a id="13370" href="plfa.Substitution.html#13341" class="Bound">Δ</a><a id="13371" class="Symbol">}</a>
        <a id="13381" class="Symbol">→</a> <a id="13383" href="/PLFA-zh/Substitution/#6539" class="Function">ren</a> <a id="13387" class="Symbol">(</a><a id="13388" href="/PLFA-zh/Untyped/#5883" class="Function">ext</a> <a id="13392" href="plfa.Substitution.html#13357" class="Bound">ρ</a> <a id="13394" class="Symbol">{</a><a id="13395" class="Argument">B</a> <a id="13397" class="Symbol">=</a> <a id="13399" href="plfa.Substitution.html#13344" class="Bound">B</a><a id="13400" class="Symbol">})</a> <a id="13403" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="13405" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="13410" class="Symbol">(</a><a id="13411" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="13415" href="plfa.Substitution.html#13357" class="Bound">ρ</a><a id="13416" class="Symbol">)</a> <a id="13418" class="Symbol">{</a><a id="13419" href="plfa.Substitution.html#13346" class="Bound">C</a><a id="13420" class="Symbol">}</a>
<a id="13422" href="/PLFA-zh/Substitution/#13326" class="Function">ren-ext</a> <a id="13430" class="Symbol">{</a><a id="13431" href="plfa.Substitution.html#13431" class="Bound">Γ</a><a id="13432" class="Symbol">}{</a><a id="13434" href="plfa.Substitution.html#13434" class="Bound">Δ</a><a id="13435" class="Symbol">}{</a><a id="13437" href="plfa.Substitution.html#13437" class="Bound">B</a><a id="13438" class="Symbol">}{</a><a id="13440" href="plfa.Substitution.html#13440" class="Bound">C</a><a id="13441" class="Symbol">}{</a><a id="13443" href="plfa.Substitution.html#13443" class="Bound">ρ</a><a id="13444" class="Symbol">}</a> <a id="13446" class="Symbol">=</a> <a id="13448" href="plfa.Substitution.html#1968" class="Postulate">extensionality</a> <a id="13463" class="Symbol">λ</a> <a id="13465" href="plfa.Substitution.html#13465" class="Bound">x</a> <a id="13467" class="Symbol">→</a> <a id="13469" href="plfa.Substitution.html#13493" class="Function">lemma</a> <a id="13475" class="Symbol">{</a><a id="13476" class="Argument">x</a> <a id="13478" class="Symbol">=</a> <a id="13480" href="plfa.Substitution.html#13465" class="Bound">x</a><a id="13481" class="Symbol">}</a>
  <a id="13485" class="Keyword">where</a>
  <a id="13493" href="/PLFA-zh/Substitution/#13493" class="Function">lemma</a> <a id="13499" class="Symbol">:</a> <a id="13501" class="Symbol">∀</a> <a id="13503" class="Symbol">{</a><a id="13504" href="plfa.Substitution.html#13504" class="Bound">x</a> <a id="13506" class="Symbol">:</a> <a id="13508" href="plfa.Substitution.html#13431" class="Bound">Γ</a> <a id="13510" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="13512" href="plfa.Substitution.html#13437" class="Bound">B</a> <a id="13514" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="13516" href="plfa.Substitution.html#13440" class="Bound">C</a><a id="13517" class="Symbol">}</a> <a id="13519" class="Symbol">→</a> <a id="13521" class="Symbol">(</a><a id="13522" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="13526" class="Symbol">(</a><a id="13527" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="13531" href="plfa.Substitution.html#13443" class="Bound">ρ</a><a id="13532" class="Symbol">))</a> <a id="13535" href="plfa.Substitution.html#13504" class="Bound">x</a> <a id="13537" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="13539" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="13544" class="Symbol">(</a><a id="13545" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="13549" href="plfa.Substitution.html#13443" class="Bound">ρ</a><a id="13550" class="Symbol">)</a> <a id="13552" href="plfa.Substitution.html#13504" class="Bound">x</a>
  <a id="13556" href="/PLFA-zh/Substitution/#13493" class="Function">lemma</a> <a id="13562" class="Symbol">{</a><a id="13563" class="Argument">x</a> <a id="13565" class="Symbol">=</a> <a id="13567" href="/PLFA-zh/Untyped/#3519" class="InductiveConstructor">Z</a><a id="13568" class="Symbol">}</a> <a id="13570" class="Symbol">=</a> <a id="13572" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
  <a id="13579" href="/PLFA-zh/Substitution/#13493" class="Function">lemma</a> <a id="13585" class="Symbol">{</a><a id="13586" class="Argument">x</a> <a id="13588" class="Symbol">=</a> <a id="13590" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="13592" href="plfa.Substitution.html#13592" class="Bound">x</a><a id="13593" class="Symbol">}</a> <a id="13595" class="Symbol">=</a> <a id="13597" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<p>With this lemma in hand, the proof is a straightforward induction on
the term <code class="highlighter-rouge">M</code>.</p>

<pre class="Agda"><a id="rename-subst-ren"></a><a id="13695" href="/PLFA-zh/Substitution/#13695" class="Function">rename-subst-ren</a> <a id="13712" class="Symbol">:</a> <a id="13714" class="Symbol">∀</a> <a id="13716" class="Symbol">{</a><a id="13717" href="plfa.Substitution.html#13717" class="Bound">Γ</a> <a id="13719" href="plfa.Substitution.html#13719" class="Bound">Δ</a><a id="13720" class="Symbol">}{</a><a id="13722" href="plfa.Substitution.html#13722" class="Bound">A</a><a id="13723" class="Symbol">}</a> <a id="13725" class="Symbol">{</a><a id="13726" href="plfa.Substitution.html#13726" class="Bound">ρ</a> <a id="13728" class="Symbol">:</a> <a id="13730" href="plfa.Substitution.html#2233" class="Function">Rename</a> <a id="13737" href="plfa.Substitution.html#13717" class="Bound">Γ</a> <a id="13739" href="plfa.Substitution.html#13719" class="Bound">Δ</a><a id="13740" class="Symbol">}{</a><a id="13742" href="plfa.Substitution.html#13742" class="Bound">M</a> <a id="13744" class="Symbol">:</a> <a id="13746" href="plfa.Substitution.html#13717" class="Bound">Γ</a> <a id="13748" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="13750" href="plfa.Substitution.html#13722" class="Bound">A</a><a id="13751" class="Symbol">}</a>
                 <a id="13770" class="Symbol">→</a> <a id="13772" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="13779" href="/PLFA-zh/Substitution/#13726" class="Bound">ρ</a> <a id="13781" href="plfa.Substitution.html#13742" class="Bound">M</a> <a id="13783" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="13785" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="13787" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="13791" href="plfa.Substitution.html#13726" class="Bound">ρ</a> <a id="13793" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="13795" href="plfa.Substitution.html#13742" class="Bound">M</a>
<a id="13797" href="/PLFA-zh/Substitution/#13695" class="Function">rename-subst-ren</a> <a id="13814" class="Symbol">{</a><a id="13815" class="Argument">M</a> <a id="13817" class="Symbol">=</a> <a id="13819" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="13821" href="plfa.Substitution.html#13821" class="Bound">x</a><a id="13822" class="Symbol">}</a> <a id="13824" class="Symbol">=</a> <a id="13826" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="13831" href="/PLFA-zh/Substitution/#13695" class="Function">rename-subst-ren</a> <a id="13848" class="Symbol">{</a><a id="13849" class="Argument">ρ</a> <a id="13851" class="Symbol">=</a> <a id="13853" href="plfa.Substitution.html#13853" class="Bound">ρ</a><a id="13854" class="Symbol">}{</a><a id="13856" class="Argument">M</a> <a id="13858" class="Symbol">=</a> <a id="13860" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="13862" href="plfa.Substitution.html#13862" class="Bound">N</a><a id="13863" class="Symbol">}</a> <a id="13865" class="Symbol">=</a>
  <a id="13869" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin</a>
      <a id="13881" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="13888" href="/PLFA-zh/Substitution/#13853" class="Bound">ρ</a> <a id="13890" class="Symbol">(</a><a id="13891" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="13893" href="plfa.Substitution.html#13862" class="Bound">N</a><a id="13894" class="Symbol">)</a>
    <a id="13900" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
      <a id="13910" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="13912" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="13919" class="Symbol">(</a><a id="13920" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="13924" href="/PLFA-zh/Substitution/#13853" class="Bound">ρ</a><a id="13925" class="Symbol">)</a> <a id="13927" href="plfa.Substitution.html#13862" class="Bound">N</a>
    <a id="13933" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="13936" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="13941" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ_</a> <a id="13944" class="Symbol">(</a><a id="13945" href="/PLFA-zh/Substitution/#13695" class="Function">rename-subst-ren</a> <a id="13962" class="Symbol">{</a><a id="13963" class="Argument">ρ</a> <a id="13965" class="Symbol">=</a> <a id="13967" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="13971" href="plfa.Substitution.html#13853" class="Bound">ρ</a><a id="13972" class="Symbol">}{</a><a id="13974" class="Argument">M</a> <a id="13976" class="Symbol">=</a> <a id="13978" href="plfa.Substitution.html#13862" class="Bound">N</a><a id="13979" class="Symbol">})</a> <a id="13982" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
      <a id="13990" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="13992" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="13994" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="13998" class="Symbol">(</a><a id="13999" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="14003" href="plfa.Substitution.html#13853" class="Bound">ρ</a><a id="14004" class="Symbol">)</a> <a id="14006" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="14008" href="plfa.Substitution.html#13862" class="Bound">N</a>
    <a id="14014" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="14017" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="14022" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ_</a> <a id="14025" class="Symbol">(</a><a id="14026" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a> <a id="14035" class="Symbol">{</a><a id="14036" class="Argument">M</a> <a id="14038" class="Symbol">=</a> <a id="14040" href="plfa.Substitution.html#13862" class="Bound">N</a><a id="14041" class="Symbol">}</a> <a id="14043" href="plfa.Substitution.html#13326" class="Function">ren-ext</a> <a id="14051" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="14055" class="Symbol">)</a> <a id="14057" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
      <a id="14065" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="14067" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="14069" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="14074" class="Symbol">(</a><a id="14075" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="14079" href="plfa.Substitution.html#13853" class="Bound">ρ</a><a id="14080" class="Symbol">)</a> <a id="14082" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a>  <a id="14085" href="plfa.Substitution.html#13862" class="Bound">N</a>
    <a id="14091" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
      <a id="14101" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="14103" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="14107" href="plfa.Substitution.html#13853" class="Bound">ρ</a> <a id="14109" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="14111" class="Symbol">(</a><a id="14112" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="14114" href="plfa.Substitution.html#13862" class="Bound">N</a><a id="14115" class="Symbol">)</a>
  <a id="14119" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">∎</a>
<a id="14121" href="/PLFA-zh/Substitution/#13695" class="Function">rename-subst-ren</a> <a id="14138" class="Symbol">{</a><a id="14139" class="Argument">M</a> <a id="14141" class="Symbol">=</a> <a id="14143" href="plfa.Substitution.html#14143" class="Bound">L</a> <a id="14145" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="14147" href="plfa.Substitution.html#14147" class="Bound">M</a><a id="14148" class="Symbol">}</a> <a id="14150" class="Symbol">=</a> <a id="14152" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1436" class="Function">cong₂</a> <a id="14158" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">_·_</a> <a id="14162" href="plfa.Substitution.html#13695" class="Function">rename-subst-ren</a> <a id="14179" href="plfa.Substitution.html#13695" class="Function">rename-subst-ren</a>
</pre>
<p>The substitution <code class="highlighter-rouge">ren S_</code> is equivalent to <code class="highlighter-rouge">↑</code>.</p>

<pre class="Agda"><a id="ren-shift"></a><a id="14254" href="/PLFA-zh/Substitution/#14254" class="Function">ren-shift</a> <a id="14264" class="Symbol">:</a> <a id="14266" class="Symbol">∀{</a><a id="14268" href="plfa.Substitution.html#14268" class="Bound">Γ</a><a id="14269" class="Symbol">}{</a><a id="14271" href="plfa.Substitution.html#14271" class="Bound">A</a><a id="14272" class="Symbol">}{</a><a id="14274" href="plfa.Substitution.html#14274" class="Bound">B</a><a id="14275" class="Symbol">}</a>
          <a id="14287" class="Symbol">→</a> <a id="14289" href="/PLFA-zh/Substitution/#6539" class="Function">ren</a> <a id="14293" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S_</a> <a id="14296" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="14298" href="plfa.Substitution.html#3226" class="Function">↑</a> <a id="14300" class="Symbol">{</a><a id="14301" class="Argument">A</a> <a id="14303" class="Symbol">=</a> <a id="14305" href="plfa.Substitution.html#14274" class="Bound">B</a><a id="14306" class="Symbol">}</a> <a id="14308" class="Symbol">{</a><a id="14309" href="plfa.Substitution.html#14271" class="Bound">A</a><a id="14310" class="Symbol">}</a>
<a id="14312" href="/PLFA-zh/Substitution/#14254" class="Function">ren-shift</a> <a id="14322" class="Symbol">{</a><a id="14323" href="plfa.Substitution.html#14323" class="Bound">Γ</a><a id="14324" class="Symbol">}{</a><a id="14326" href="plfa.Substitution.html#14326" class="Bound">A</a><a id="14327" class="Symbol">}{</a><a id="14329" href="plfa.Substitution.html#14329" class="Bound">B</a><a id="14330" class="Symbol">}</a> <a id="14332" class="Symbol">=</a> <a id="14334" href="plfa.Substitution.html#1968" class="Postulate">extensionality</a> <a id="14349" class="Symbol">λ</a> <a id="14351" href="plfa.Substitution.html#14351" class="Bound">x</a> <a id="14353" class="Symbol">→</a> <a id="14355" href="plfa.Substitution.html#14379" class="Function">lemma</a> <a id="14361" class="Symbol">{</a><a id="14362" class="Argument">x</a> <a id="14364" class="Symbol">=</a> <a id="14366" href="plfa.Substitution.html#14351" class="Bound">x</a><a id="14367" class="Symbol">}</a>
  <a id="14371" class="Keyword">where</a>
  <a id="14379" href="/PLFA-zh/Substitution/#14379" class="Function">lemma</a> <a id="14385" class="Symbol">:</a> <a id="14387" class="Symbol">∀</a> <a id="14389" class="Symbol">{</a><a id="14390" href="plfa.Substitution.html#14390" class="Bound">x</a> <a id="14392" class="Symbol">:</a> <a id="14394" href="plfa.Substitution.html#14323" class="Bound">Γ</a> <a id="14396" href="/PLFA-zh/Untyped/#3483" class="Datatype Operator">∋</a> <a id="14398" href="plfa.Substitution.html#14326" class="Bound">A</a><a id="14399" class="Symbol">}</a> <a id="14401" class="Symbol">→</a> <a id="14403" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="14407" class="Symbol">(</a><a id="14408" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a><a id="14410" class="Symbol">{</a><a id="14411" class="Argument">B</a> <a id="14413" class="Symbol">=</a> <a id="14415" href="plfa.Substitution.html#14329" class="Bound">B</a><a id="14416" class="Symbol">})</a> <a id="14419" href="plfa.Substitution.html#14390" class="Bound">x</a> <a id="14421" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="14423" href="plfa.Substitution.html#3226" class="Function">↑</a> <a id="14425" class="Symbol">{</a><a id="14426" class="Argument">A</a> <a id="14428" class="Symbol">=</a> <a id="14430" href="plfa.Substitution.html#14329" class="Bound">B</a><a id="14431" class="Symbol">}</a> <a id="14433" href="plfa.Substitution.html#14390" class="Bound">x</a>
  <a id="14437" href="/PLFA-zh/Substitution/#14379" class="Function">lemma</a> <a id="14443" class="Symbol">{</a><a id="14444" class="Argument">x</a> <a id="14446" class="Symbol">=</a> <a id="14448" href="/PLFA-zh/Untyped/#3519" class="InductiveConstructor">Z</a><a id="14449" class="Symbol">}</a> <a id="14451" class="Symbol">=</a> <a id="14453" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
  <a id="14460" href="/PLFA-zh/Substitution/#14379" class="Function">lemma</a> <a id="14466" class="Symbol">{</a><a id="14467" class="Argument">x</a> <a id="14469" class="Symbol">=</a> <a id="14471" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="14473" href="plfa.Substitution.html#14473" class="Bound">x</a><a id="14474" class="Symbol">}</a> <a id="14476" class="Symbol">=</a> <a id="14478" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<p>The substitution <code class="highlighter-rouge">rename S_ M</code> is equivalent to shifting: <code class="highlighter-rouge">⟪ ↑ ⟫ M</code>.</p>

<pre class="Agda"><a id="rename-shift"></a><a id="14562" href="/PLFA-zh/Substitution/#14562" class="Function">rename-shift</a> <a id="14575" class="Symbol">:</a> <a id="14577" class="Symbol">∀{</a><a id="14579" href="plfa.Substitution.html#14579" class="Bound">Γ</a><a id="14580" class="Symbol">}</a> <a id="14582" class="Symbol">{</a><a id="14583" href="plfa.Substitution.html#14583" class="Bound">A</a><a id="14584" class="Symbol">}</a> <a id="14586" class="Symbol">{</a><a id="14587" href="plfa.Substitution.html#14587" class="Bound">B</a><a id="14588" class="Symbol">}</a> <a id="14590" class="Symbol">{</a><a id="14591" href="plfa.Substitution.html#14591" class="Bound">M</a> <a id="14593" class="Symbol">:</a> <a id="14595" href="plfa.Substitution.html#14579" class="Bound">Γ</a> <a id="14597" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="14599" href="plfa.Substitution.html#14583" class="Bound">A</a><a id="14600" class="Symbol">}</a>
             <a id="14615" class="Symbol">→</a> <a id="14617" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="14624" class="Symbol">(</a><a id="14625" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a><a id="14627" class="Symbol">{</a><a id="14628" class="Argument">B</a> <a id="14630" class="Symbol">=</a> <a id="14632" href="/PLFA-zh/Substitution/#14587" class="Bound">B</a><a id="14633" class="Symbol">})</a> <a id="14636" href="plfa.Substitution.html#14591" class="Bound">M</a> <a id="14638" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="14640" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="14642" href="plfa.Substitution.html#3226" class="Function">↑</a> <a id="14644" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="14646" href="plfa.Substitution.html#14591" class="Bound">M</a>
<a id="14648" href="/PLFA-zh/Substitution/#14562" class="Function">rename-shift</a><a id="14660" class="Symbol">{</a><a id="14661" href="plfa.Substitution.html#14661" class="Bound">Γ</a><a id="14662" class="Symbol">}{</a><a id="14664" href="plfa.Substitution.html#14664" class="Bound">A</a><a id="14665" class="Symbol">}{</a><a id="14667" href="plfa.Substitution.html#14667" class="Bound">B</a><a id="14668" class="Symbol">}{</a><a id="14670" href="plfa.Substitution.html#14670" class="Bound">M</a><a id="14671" class="Symbol">}</a> <a id="14673" class="Symbol">=</a>
  <a id="14677" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin</a>
    <a id="14687" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="14694" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a> <a id="14697" href="/PLFA-zh/Substitution/#14670" class="Bound">M</a>
  <a id="14701" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="14704" href="/PLFA-zh/Substitution/#13695" class="Function">rename-subst-ren</a> <a id="14721" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
    <a id="14727" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="14729" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="14733" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S_</a> <a id="14736" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="14738" href="plfa.Substitution.html#14670" class="Bound">M</a>
  <a id="14742" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="14745" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a><a id="14753" class="Symbol">{</a><a id="14754" class="Argument">M</a> <a id="14756" class="Symbol">=</a> <a id="14758" href="plfa.Substitution.html#14670" class="Bound">M</a><a id="14759" class="Symbol">}</a> <a id="14761" href="plfa.Substitution.html#14254" class="Function">ren-shift</a> <a id="14771" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="14776" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
    <a id="14782" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="14784" href="plfa.Substitution.html#3226" class="Function">↑</a> <a id="14786" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="14788" href="plfa.Substitution.html#14670" class="Bound">M</a>
  <a id="14792" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">∎</a>
</pre>
<p>Next we prove the equation <code class="highlighter-rouge">exts-cons-shift</code>, which states that <code class="highlighter-rouge">exts</code>
is equivalent to cons’ing Z onto the sequence formed by applying <code class="highlighter-rouge">σ</code>
and then shifting. The proof is by case analysis on the variable <code class="highlighter-rouge">x</code>,
using <code class="highlighter-rouge">rename-subst-ren</code> for when <code class="highlighter-rouge">x = S y</code>.</p>

<pre class="Agda"><a id="exts-cons-shift"></a><a id="15059" href="/PLFA-zh/Substitution/#15059" class="Function">exts-cons-shift</a> <a id="15075" class="Symbol">:</a> <a id="15077" class="Symbol">∀{</a><a id="15079" href="plfa.Substitution.html#15079" class="Bound">Γ</a> <a id="15081" href="plfa.Substitution.html#15081" class="Bound">Δ</a><a id="15082" class="Symbol">}</a> <a id="15084" class="Symbol">{</a><a id="15085" href="plfa.Substitution.html#15085" class="Bound">A</a> <a id="15087" href="plfa.Substitution.html#15087" class="Bound">B</a><a id="15088" class="Symbol">}</a> <a id="15090" class="Symbol">{</a><a id="15091" href="plfa.Substitution.html#15091" class="Bound">σ</a> <a id="15093" class="Symbol">:</a> <a id="15095" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="15101" href="plfa.Substitution.html#15079" class="Bound">Γ</a> <a id="15103" href="plfa.Substitution.html#15081" class="Bound">Δ</a><a id="15104" class="Symbol">}</a>
                <a id="15122" class="Symbol">→</a> <a id="15124" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="15129" href="/PLFA-zh/Substitution/#15091" class="Bound">σ</a> <a id="15131" class="Symbol">{</a><a id="15132" href="plfa.Substitution.html#15085" class="Bound">A</a><a id="15133" class="Symbol">}</a> <a id="15135" class="Symbol">{</a><a id="15136" href="plfa.Substitution.html#15087" class="Bound">B</a><a id="15137" class="Symbol">}</a> <a id="15139" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="15141" class="Symbol">(</a><a id="15142" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="15144" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a> <a id="15146" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="15148" class="Symbol">(</a><a id="15149" href="plfa.Substitution.html#15091" class="Bound">σ</a> <a id="15151" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="15153" href="plfa.Substitution.html#3226" class="Function">↑</a><a id="15154" class="Symbol">))</a>
<a id="15157" href="/PLFA-zh/Substitution/#15059" class="Function">exts-cons-shift</a> <a id="15173" class="Symbol">=</a> <a id="15175" href="plfa.Substitution.html#1968" class="Postulate">extensionality</a> <a id="15190" class="Symbol">λ</a> <a id="15192" href="plfa.Substitution.html#15192" class="Bound">x</a> <a id="15194" class="Symbol">→</a> <a id="15196" href="plfa.Substitution.html#15219" class="Function">lemma</a><a id="15201" class="Symbol">{</a><a id="15202" class="Argument">x</a> <a id="15204" class="Symbol">=</a> <a id="15206" href="plfa.Substitution.html#15192" class="Bound">x</a><a id="15207" class="Symbol">}</a>
  <a id="15211" class="Keyword">where</a>
  <a id="15219" href="/PLFA-zh/Substitution/#15219" class="Function">lemma</a> <a id="15225" class="Symbol">:</a> <a id="15227" class="Symbol">∀{</a><a id="15229" href="plfa.Substitution.html#15229" class="Bound">Γ</a> <a id="15231" href="plfa.Substitution.html#15231" class="Bound">Δ</a><a id="15232" class="Symbol">}</a> <a id="15234" class="Symbol">{</a><a id="15235" href="plfa.Substitution.html#15235" class="Bound">A</a> <a id="15237" href="plfa.Substitution.html#15237" class="Bound">B</a><a id="15238" class="Symbol">}</a> <a id="15240" class="Symbol">{</a><a id="15241" href="plfa.Substitution.html#15241" class="Bound">σ</a> <a id="15243" class="Symbol">:</a> <a id="15245" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="15251" href="plfa.Substitution.html#15229" class="Bound">Γ</a> <a id="15253" href="plfa.Substitution.html#15231" class="Bound">Δ</a><a id="15254" class="Symbol">}</a> <a id="15256" class="Symbol">{</a><a id="15257" href="plfa.Substitution.html#15257" class="Bound">x</a> <a id="15259" class="Symbol">:</a> <a id="15261" href="plfa.Substitution.html#15229" class="Bound">Γ</a> <a id="15263" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="15265" href="plfa.Substitution.html#15237" class="Bound">B</a> <a id="15267" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="15269" href="plfa.Substitution.html#15235" class="Bound">A</a><a id="15270" class="Symbol">}</a>
                  <a id="15290" class="Symbol">→</a> <a id="15292" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="15297" href="/PLFA-zh/Substitution/#15241" class="Bound">σ</a> <a id="15299" href="plfa.Substitution.html#15257" class="Bound">x</a> <a id="15301" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="15303" class="Symbol">(</a><a id="15304" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="15306" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a> <a id="15308" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="15310" class="Symbol">(</a><a id="15311" href="plfa.Substitution.html#15241" class="Bound">σ</a> <a id="15313" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="15315" href="plfa.Substitution.html#3226" class="Function">↑</a><a id="15316" class="Symbol">))</a> <a id="15319" href="plfa.Substitution.html#15257" class="Bound">x</a>
  <a id="15323" href="/PLFA-zh/Substitution/#15219" class="Function">lemma</a> <a id="15329" class="Symbol">{</a><a id="15330" class="Argument">x</a> <a id="15332" class="Symbol">=</a> <a id="15334" href="/PLFA-zh/Untyped/#3519" class="InductiveConstructor">Z</a><a id="15335" class="Symbol">}</a> <a id="15337" class="Symbol">=</a> <a id="15339" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
  <a id="15346" href="/PLFA-zh/Substitution/#15219" class="Function">lemma</a> <a id="15352" class="Symbol">{</a><a id="15353" class="Argument">x</a> <a id="15355" class="Symbol">=</a> <a id="15357" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="15359" href="plfa.Substitution.html#15359" class="Bound">y</a><a id="15360" class="Symbol">}</a> <a id="15362" class="Symbol">=</a> <a id="15364" href="plfa.Substitution.html#13695" class="Function">rename-subst-ren</a>
</pre>
<p>As a corollary, we have a similar correspondence for <code class="highlighter-rouge">ren (ext ρ)</code>.</p>

<pre class="Agda"><a id="ext-cons-Z-shift"></a><a id="15459" href="/PLFA-zh/Substitution/#15459" class="Function">ext-cons-Z-shift</a> <a id="15476" class="Symbol">:</a> <a id="15478" class="Symbol">∀{</a><a id="15480" href="plfa.Substitution.html#15480" class="Bound">Γ</a> <a id="15482" href="plfa.Substitution.html#15482" class="Bound">Δ</a><a id="15483" class="Symbol">}</a> <a id="15485" class="Symbol">{</a><a id="15486" href="plfa.Substitution.html#15486" class="Bound">ρ</a> <a id="15488" class="Symbol">:</a> <a id="15490" href="plfa.Substitution.html#2233" class="Function">Rename</a> <a id="15497" href="plfa.Substitution.html#15480" class="Bound">Γ</a> <a id="15499" href="plfa.Substitution.html#15482" class="Bound">Δ</a><a id="15500" class="Symbol">}{</a><a id="15502" href="plfa.Substitution.html#15502" class="Bound">A</a><a id="15503" class="Symbol">}{</a><a id="15505" href="plfa.Substitution.html#15505" class="Bound">B</a><a id="15506" class="Symbol">}</a>
                 <a id="15525" class="Symbol">→</a> <a id="15527" href="/PLFA-zh/Substitution/#6539" class="Function">ren</a> <a id="15531" class="Symbol">(</a><a id="15532" href="/PLFA-zh/Untyped/#5883" class="Function">ext</a> <a id="15536" href="plfa.Substitution.html#15486" class="Bound">ρ</a> <a id="15538" class="Symbol">{</a><a id="15539" class="Argument">B</a> <a id="15541" class="Symbol">=</a> <a id="15543" href="plfa.Substitution.html#15505" class="Bound">B</a><a id="15544" class="Symbol">})</a> <a id="15547" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="15549" class="Symbol">(</a><a id="15550" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="15552" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a> <a id="15554" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="15556" class="Symbol">(</a><a id="15557" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="15561" href="plfa.Substitution.html#15486" class="Bound">ρ</a> <a id="15563" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="15565" href="plfa.Substitution.html#3226" class="Function">↑</a><a id="15566" class="Symbol">))</a> <a id="15569" class="Symbol">{</a><a id="15570" href="plfa.Substitution.html#15502" class="Bound">A</a><a id="15571" class="Symbol">}</a>
<a id="15573" href="/PLFA-zh/Substitution/#15459" class="Function">ext-cons-Z-shift</a> <a id="15590" class="Symbol">{</a><a id="15591" href="plfa.Substitution.html#15591" class="Bound">Γ</a><a id="15592" class="Symbol">}{</a><a id="15594" href="plfa.Substitution.html#15594" class="Bound">Δ</a><a id="15595" class="Symbol">}{</a><a id="15597" href="plfa.Substitution.html#15597" class="Bound">ρ</a><a id="15598" class="Symbol">}{</a><a id="15600" href="plfa.Substitution.html#15600" class="Bound">A</a><a id="15601" class="Symbol">}{</a><a id="15603" href="plfa.Substitution.html#15603" class="Bound">B</a><a id="15604" class="Symbol">}</a> <a id="15606" class="Symbol">=</a>
  <a id="15610" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin</a>
    <a id="15620" href="/PLFA-zh/Substitution/#6539" class="Function">ren</a> <a id="15624" class="Symbol">(</a><a id="15625" href="/PLFA-zh/Untyped/#5883" class="Function">ext</a> <a id="15629" href="plfa.Substitution.html#15597" class="Bound">ρ</a><a id="15630" class="Symbol">)</a>
  <a id="15634" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="15637" href="/PLFA-zh/Substitution/#13326" class="Function">ren-ext</a> <a id="15645" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
    <a id="15651" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="15656" class="Symbol">(</a><a id="15657" href="/PLFA-zh/Substitution/#6539" class="Function">ren</a> <a id="15661" href="plfa.Substitution.html#15597" class="Bound">ρ</a><a id="15662" class="Symbol">)</a>
  <a id="15666" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="15669" href="/PLFA-zh/Substitution/#15059" class="Function">exts-cons-shift</a><a id="15684" class="Symbol">{</a><a id="15685" class="Argument">σ</a> <a id="15687" class="Symbol">=</a> <a id="15689" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="15693" href="plfa.Substitution.html#15597" class="Bound">ρ</a><a id="15694" class="Symbol">}</a> <a id="15696" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
   <a id="15701" class="Symbol">((</a><a id="15703" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="15705" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="15706" class="Symbol">)</a> <a id="15708" href="/PLFA-zh/Substitution/#3468" class="Function Operator">•</a> <a id="15710" class="Symbol">(</a><a id="15711" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="15715" href="plfa.Substitution.html#15597" class="Bound">ρ</a> <a id="15717" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="15719" href="plfa.Substitution.html#3226" class="Function">↑</a><a id="15720" class="Symbol">))</a>
  <a id="15725" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">∎</a>
</pre>
<p>Finally, the <code class="highlighter-rouge">subst-zero M</code> substitution is equivalent to cons’ing <code class="highlighter-rouge">M</code>
onto the identity substitution.</p>

<pre class="Agda"><a id="subst-Z-cons-ids"></a><a id="15840" href="/PLFA-zh/Substitution/#15840" class="Function">subst-Z-cons-ids</a> <a id="15857" class="Symbol">:</a> <a id="15859" class="Symbol">∀{</a><a id="15861" href="plfa.Substitution.html#15861" class="Bound">Γ</a><a id="15862" class="Symbol">}{</a><a id="15864" href="plfa.Substitution.html#15864" class="Bound">A</a> <a id="15866" href="plfa.Substitution.html#15866" class="Bound">B</a> <a id="15868" class="Symbol">:</a> <a id="15870" href="/PLFA-zh/Untyped/#2857" class="Datatype">Type</a><a id="15874" class="Symbol">}{</a><a id="15876" href="plfa.Substitution.html#15876" class="Bound">M</a> <a id="15878" class="Symbol">:</a> <a id="15880" href="plfa.Substitution.html#15861" class="Bound">Γ</a> <a id="15882" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="15884" href="plfa.Substitution.html#15866" class="Bound">B</a><a id="15885" class="Symbol">}</a>
                 <a id="15904" class="Symbol">→</a> <a id="15906" href="/PLFA-zh/Untyped/#7333" class="Function">subst-zero</a> <a id="15917" href="/PLFA-zh/Substitution/#15876" class="Bound">M</a> <a id="15919" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="15921" class="Symbol">(</a><a id="15922" href="plfa.Substitution.html#15876" class="Bound">M</a> <a id="15924" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="15926" href="plfa.Substitution.html#3087" class="Function">ids</a><a id="15929" class="Symbol">)</a> <a id="15931" class="Symbol">{</a><a id="15932" href="plfa.Substitution.html#15864" class="Bound">A</a><a id="15933" class="Symbol">}</a>
<a id="15935" href="/PLFA-zh/Substitution/#15840" class="Function">subst-Z-cons-ids</a> <a id="15952" class="Symbol">=</a> <a id="15954" href="plfa.Substitution.html#1968" class="Postulate">extensionality</a> <a id="15969" class="Symbol">λ</a> <a id="15971" href="plfa.Substitution.html#15971" class="Bound">x</a> <a id="15973" class="Symbol">→</a> <a id="15975" href="plfa.Substitution.html#15999" class="Function">lemma</a> <a id="15981" class="Symbol">{</a><a id="15982" class="Argument">x</a> <a id="15984" class="Symbol">=</a> <a id="15986" href="plfa.Substitution.html#15971" class="Bound">x</a><a id="15987" class="Symbol">}</a>
  <a id="15991" class="Keyword">where</a>
  <a id="15999" href="/PLFA-zh/Substitution/#15999" class="Function">lemma</a> <a id="16005" class="Symbol">:</a> <a id="16007" class="Symbol">∀{</a><a id="16009" href="plfa.Substitution.html#16009" class="Bound">Γ</a><a id="16010" class="Symbol">}{</a><a id="16012" href="plfa.Substitution.html#16012" class="Bound">A</a> <a id="16014" href="plfa.Substitution.html#16014" class="Bound">B</a> <a id="16016" class="Symbol">:</a> <a id="16018" href="/PLFA-zh/Untyped/#2857" class="Datatype">Type</a><a id="16022" class="Symbol">}{</a><a id="16024" href="plfa.Substitution.html#16024" class="Bound">M</a> <a id="16026" class="Symbol">:</a> <a id="16028" href="plfa.Substitution.html#16009" class="Bound">Γ</a> <a id="16030" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="16032" href="plfa.Substitution.html#16014" class="Bound">B</a><a id="16033" class="Symbol">}{</a><a id="16035" href="plfa.Substitution.html#16035" class="Bound">x</a> <a id="16037" class="Symbol">:</a> <a id="16039" href="plfa.Substitution.html#16009" class="Bound">Γ</a> <a id="16041" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="16043" href="plfa.Substitution.html#16014" class="Bound">B</a> <a id="16045" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="16047" href="plfa.Substitution.html#16012" class="Bound">A</a><a id="16048" class="Symbol">}</a>
                      <a id="16072" class="Symbol">→</a> <a id="16074" href="/PLFA-zh/Untyped/#7333" class="Function">subst-zero</a> <a id="16085" href="/PLFA-zh/Substitution/#16024" class="Bound">M</a> <a id="16087" href="plfa.Substitution.html#16035" class="Bound">x</a> <a id="16089" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="16091" class="Symbol">(</a><a id="16092" href="plfa.Substitution.html#16024" class="Bound">M</a> <a id="16094" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="16096" href="plfa.Substitution.html#3087" class="Function">ids</a><a id="16099" class="Symbol">)</a> <a id="16101" href="plfa.Substitution.html#16035" class="Bound">x</a>
  <a id="16105" href="/PLFA-zh/Substitution/#15999" class="Function">lemma</a> <a id="16111" class="Symbol">{</a><a id="16112" class="Argument">x</a> <a id="16114" class="Symbol">=</a> <a id="16116" href="/PLFA-zh/Untyped/#3519" class="InductiveConstructor">Z</a><a id="16117" class="Symbol">}</a> <a id="16119" class="Symbol">=</a> <a id="16121" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
  <a id="16128" href="/PLFA-zh/Substitution/#15999" class="Function">lemma</a> <a id="16134" class="Symbol">{</a><a id="16135" class="Argument">x</a> <a id="16137" class="Symbol">=</a> <a id="16139" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="16141" href="plfa.Substitution.html#16141" class="Bound">x</a><a id="16142" class="Symbol">}</a> <a id="16144" class="Symbol">=</a> <a id="16146" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>

<h2 id="proofs-of-sub-abs-sub-id-and-rename-id">Proofs of sub-abs, sub-id, and rename-id</h2>

<p>The equation <code class="highlighter-rouge">sub-abs</code> follows immediately from the equation
<code class="highlighter-rouge">exts-cons-shift</code>.</p>

<pre class="Agda"><a id="sub-abs"></a><a id="16287" href="/PLFA-zh/Substitution/#16287" class="Function">sub-abs</a> <a id="16295" class="Symbol">:</a> <a id="16297" class="Symbol">∀{</a><a id="16299" href="plfa.Substitution.html#16299" class="Bound">Γ</a> <a id="16301" href="plfa.Substitution.html#16301" class="Bound">Δ</a><a id="16302" class="Symbol">}</a> <a id="16304" class="Symbol">{</a><a id="16305" href="plfa.Substitution.html#16305" class="Bound">σ</a> <a id="16307" class="Symbol">:</a> <a id="16309" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="16315" href="plfa.Substitution.html#16299" class="Bound">Γ</a> <a id="16317" href="plfa.Substitution.html#16301" class="Bound">Δ</a><a id="16318" class="Symbol">}</a> <a id="16320" class="Symbol">{</a><a id="16321" href="plfa.Substitution.html#16321" class="Bound">N</a> <a id="16323" class="Symbol">:</a> <a id="16325" href="plfa.Substitution.html#16299" class="Bound">Γ</a> <a id="16327" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="16329" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="16331" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="16333" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="16334" class="Symbol">}</a>
        <a id="16344" class="Symbol">→</a> <a id="16346" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="16348" href="plfa.Substitution.html#16305" class="Bound">σ</a> <a id="16350" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="16352" class="Symbol">(</a><a id="16353" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16355" href="plfa.Substitution.html#16321" class="Bound">N</a><a id="16356" class="Symbol">)</a> <a id="16358" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="16360" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16362" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="16364" class="Symbol">(</a><a id="16365" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16367" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16368" class="Symbol">)</a> <a id="16370" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="16372" class="Symbol">(</a><a id="16373" href="plfa.Substitution.html#16305" class="Bound">σ</a> <a id="16375" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="16377" href="plfa.Substitution.html#3226" class="Function">↑</a><a id="16378" class="Symbol">)</a> <a id="16380" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="16382" href="plfa.Substitution.html#16321" class="Bound">N</a>
<a id="16384" href="/PLFA-zh/Substitution/#16287" class="Function">sub-abs</a> <a id="16392" class="Symbol">{</a><a id="16393" class="Argument">σ</a> <a id="16395" class="Symbol">=</a> <a id="16397" href="plfa.Substitution.html#16397" class="Bound">σ</a><a id="16398" class="Symbol">}{</a><a id="16400" class="Argument">N</a> <a id="16402" class="Symbol">=</a> <a id="16404" href="plfa.Substitution.html#16404" class="Bound">N</a><a id="16405" class="Symbol">}</a> <a id="16407" class="Symbol">=</a>
   <a id="16412" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin</a>
     <a id="16423" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="16425" href="plfa.Substitution.html#16397" class="Bound">σ</a> <a id="16427" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="16429" class="Symbol">(</a><a id="16430" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16432" href="plfa.Substitution.html#16404" class="Bound">N</a><a id="16433" class="Symbol">)</a>
   <a id="16438" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
     <a id="16447" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16449" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="16451" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="16456" href="plfa.Substitution.html#16397" class="Bound">σ</a> <a id="16458" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="16460" href="plfa.Substitution.html#16404" class="Bound">N</a>
   <a id="16465" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="16468" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="16473" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ_</a> <a id="16476" class="Symbol">(</a><a id="16477" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a><a id="16485" class="Symbol">{</a><a id="16486" class="Argument">M</a> <a id="16488" class="Symbol">=</a> <a id="16490" href="plfa.Substitution.html#16404" class="Bound">N</a><a id="16491" class="Symbol">}</a> <a id="16493" href="plfa.Substitution.html#15059" class="Function">exts-cons-shift</a> <a id="16509" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="16513" class="Symbol">)</a> <a id="16515" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
     <a id="16522" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16524" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="16526" class="Symbol">(</a><a id="16527" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`</a> <a id="16529" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="16530" class="Symbol">)</a> <a id="16532" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="16534" class="Symbol">(</a><a id="16535" href="plfa.Substitution.html#16397" class="Bound">σ</a> <a id="16537" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="16539" href="plfa.Substitution.html#3226" class="Function">↑</a><a id="16540" class="Symbol">)</a> <a id="16542" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="16544" href="plfa.Substitution.html#16404" class="Bound">N</a>
   <a id="16549" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">∎</a>
</pre>
<p>The proof of <code class="highlighter-rouge">sub-id</code> requires the following lemma which says that
extending the identity substitution produces the identity
substitution.</p>

<pre class="Agda"><a id="exts-ids"></a><a id="16700" href="/PLFA-zh/Substitution/#16700" class="Function">exts-ids</a> <a id="16709" class="Symbol">:</a> <a id="16711" class="Symbol">∀{</a><a id="16713" href="plfa.Substitution.html#16713" class="Bound">Γ</a><a id="16714" class="Symbol">}{</a><a id="16716" href="plfa.Substitution.html#16716" class="Bound">A</a> <a id="16718" href="plfa.Substitution.html#16718" class="Bound">B</a><a id="16719" class="Symbol">}</a>
         <a id="16730" class="Symbol">→</a> <a id="16732" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="16737" href="/PLFA-zh/Substitution/#3087" class="Function">ids</a> <a id="16741" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="16743" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="16747" class="Symbol">{</a><a id="16748" href="plfa.Substitution.html#16713" class="Bound">Γ</a> <a id="16750" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="16752" href="plfa.Substitution.html#16718" class="Bound">B</a><a id="16753" class="Symbol">}</a> <a id="16755" class="Symbol">{</a><a id="16756" href="plfa.Substitution.html#16716" class="Bound">A</a><a id="16757" class="Symbol">}</a>
<a id="16759" href="/PLFA-zh/Substitution/#16700" class="Function">exts-ids</a> <a id="16768" class="Symbol">{</a><a id="16769" href="plfa.Substitution.html#16769" class="Bound">Γ</a><a id="16770" class="Symbol">}{</a><a id="16772" href="plfa.Substitution.html#16772" class="Bound">A</a><a id="16773" class="Symbol">}{</a><a id="16775" href="plfa.Substitution.html#16775" class="Bound">B</a><a id="16776" class="Symbol">}</a> <a id="16778" class="Symbol">=</a> <a id="16780" href="plfa.Substitution.html#1968" class="Postulate">extensionality</a> <a id="16795" href="plfa.Substitution.html#16809" class="Function">lemma</a>
  <a id="16803" class="Keyword">where</a> <a id="16809" href="/PLFA-zh/Substitution/#16809" class="Function">lemma</a> <a id="16815" class="Symbol">:</a> <a id="16817" class="Symbol">(</a><a id="16818" href="plfa.Substitution.html#16818" class="Bound">x</a> <a id="16820" class="Symbol">:</a> <a id="16822" href="plfa.Substitution.html#16769" class="Bound">Γ</a> <a id="16824" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="16826" href="plfa.Substitution.html#16775" class="Bound">B</a> <a id="16828" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="16830" href="plfa.Substitution.html#16772" class="Bound">A</a><a id="16831" class="Symbol">)</a> <a id="16833" class="Symbol">→</a> <a id="16835" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="16840" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="16844" href="plfa.Substitution.html#16818" class="Bound">x</a> <a id="16846" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="16848" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="16852" href="plfa.Substitution.html#16818" class="Bound">x</a>
        <a id="16862" href="/PLFA-zh/Substitution/#16809" class="Function">lemma</a> <a id="16868" href="/PLFA-zh/Untyped/#3519" class="InductiveConstructor">Z</a> <a id="16870" class="Symbol">=</a> <a id="16872" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
        <a id="16885" href="/PLFA-zh/Substitution/#16809" class="Function">lemma</a> <a id="16891" class="Symbol">(</a><a id="16892" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="16894" href="plfa.Substitution.html#16894" class="Bound">x</a><a id="16895" class="Symbol">)</a> <a id="16897" class="Symbol">=</a> <a id="16899" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<p>The proof of <code class="highlighter-rouge">⟪ ids ⟫ M ≡ M</code> now follows easily by induction on <code class="highlighter-rouge">M</code>,
using <code class="highlighter-rouge">exts-ids</code> in the case for <code class="highlighter-rouge">M ≡ ƛ N</code>.</p>

<pre class="Agda"><a id="sub-id"></a><a id="17027" href="/PLFA-zh/Substitution/#17027" class="Function">sub-id</a> <a id="17034" class="Symbol">:</a> <a id="17036" class="Symbol">∀{</a><a id="17038" href="plfa.Substitution.html#17038" class="Bound">Γ</a><a id="17039" class="Symbol">}</a> <a id="17041" class="Symbol">{</a><a id="17042" href="plfa.Substitution.html#17042" class="Bound">A</a><a id="17043" class="Symbol">}</a> <a id="17045" class="Symbol">{</a><a id="17046" href="plfa.Substitution.html#17046" class="Bound">M</a> <a id="17048" class="Symbol">:</a> <a id="17050" href="plfa.Substitution.html#17038" class="Bound">Γ</a> <a id="17052" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="17054" href="plfa.Substitution.html#17042" class="Bound">A</a><a id="17055" class="Symbol">}</a>
         <a id="17066" class="Symbol">→</a> <a id="17068" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="17070" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="17074" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="17076" href="plfa.Substitution.html#17046" class="Bound">M</a> <a id="17078" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="17080" href="plfa.Substitution.html#17046" class="Bound">M</a>
<a id="17082" href="/PLFA-zh/Substitution/#17027" class="Function">sub-id</a> <a id="17089" class="Symbol">{</a><a id="17090" class="Argument">M</a> <a id="17092" class="Symbol">=</a> <a id="17094" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="17096" href="plfa.Substitution.html#17096" class="Bound">x</a><a id="17097" class="Symbol">}</a> <a id="17099" class="Symbol">=</a> <a id="17101" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="17106" href="/PLFA-zh/Substitution/#17027" class="Function">sub-id</a> <a id="17113" class="Symbol">{</a><a id="17114" class="Argument">M</a> <a id="17116" class="Symbol">=</a> <a id="17118" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="17120" href="plfa.Substitution.html#17120" class="Bound">N</a><a id="17121" class="Symbol">}</a> <a id="17123" class="Symbol">=</a>
   <a id="17128" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin</a>
     <a id="17139" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="17141" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="17145" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="17147" class="Symbol">(</a><a id="17148" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="17150" href="plfa.Substitution.html#17120" class="Bound">N</a><a id="17151" class="Symbol">)</a>
   <a id="17156" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
     <a id="17165" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="17167" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="17169" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="17174" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="17178" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="17180" href="plfa.Substitution.html#17120" class="Bound">N</a>
   <a id="17185" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="17188" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="17193" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ_</a> <a id="17196" class="Symbol">(</a><a id="17197" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a><a id="17205" class="Symbol">{</a><a id="17206" class="Argument">M</a> <a id="17208" class="Symbol">=</a> <a id="17210" href="plfa.Substitution.html#17120" class="Bound">N</a><a id="17211" class="Symbol">}</a> <a id="17213" href="plfa.Substitution.html#16700" class="Function">exts-ids</a> <a id="17222" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="17226" class="Symbol">)</a>  <a id="17229" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
     <a id="17236" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="17238" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="17240" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="17244" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="17246" href="plfa.Substitution.html#17120" class="Bound">N</a>
   <a id="17251" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="17254" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="17259" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ_</a> <a id="17262" href="/PLFA-zh/Substitution/#17027" class="Function">sub-id</a> <a id="17269" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
     <a id="17276" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="17278" href="/PLFA-zh/Substitution/#17120" class="Bound">N</a>
   <a id="17283" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">∎</a>
<a id="17285" href="/PLFA-zh/Substitution/#17027" class="Function">sub-id</a> <a id="17292" class="Symbol">{</a><a id="17293" class="Argument">M</a> <a id="17295" class="Symbol">=</a> <a id="17297" href="plfa.Substitution.html#17297" class="Bound">L</a> <a id="17299" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="17301" href="plfa.Substitution.html#17301" class="Bound">M</a><a id="17302" class="Symbol">}</a> <a id="17304" class="Symbol">=</a> <a id="17306" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1436" class="Function">cong₂</a> <a id="17312" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">_·_</a> <a id="17316" href="plfa.Substitution.html#17027" class="Function">sub-id</a> <a id="17323" href="plfa.Substitution.html#17027" class="Function">sub-id</a>
</pre>
<p>The <code class="highlighter-rouge">rename-id</code> equation is a corollary is <code class="highlighter-rouge">sub-id</code>.</p>

<pre class="Agda"><a id="rename-id"></a><a id="17393" href="/PLFA-zh/Substitution/#17393" class="Function">rename-id</a> <a id="17403" class="Symbol">:</a> <a id="17405" class="Symbol">∀</a> <a id="17407" class="Symbol">{</a><a id="17408" href="plfa.Substitution.html#17408" class="Bound">Γ</a><a id="17409" class="Symbol">}{</a><a id="17411" href="plfa.Substitution.html#17411" class="Bound">A</a><a id="17412" class="Symbol">}</a> <a id="17414" class="Symbol">{</a><a id="17415" href="plfa.Substitution.html#17415" class="Bound">M</a> <a id="17417" class="Symbol">:</a> <a id="17419" href="plfa.Substitution.html#17408" class="Bound">Γ</a> <a id="17421" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="17423" href="plfa.Substitution.html#17411" class="Bound">A</a><a id="17424" class="Symbol">}</a>
  <a id="17428" class="Symbol">→</a> <a id="17430" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="17437" class="Symbol">(λ</a> <a id="17440" class="Symbol">{</a><a id="17441" href="/PLFA-zh/Substitution/#17441" class="Bound">A</a><a id="17442" class="Symbol">}</a> <a id="17444" href="plfa.Substitution.html#17444" class="Bound">x</a> <a id="17446" class="Symbol">→</a> <a id="17448" href="plfa.Substitution.html#17444" class="Bound">x</a><a id="17449" class="Symbol">)</a> <a id="17451" href="plfa.Substitution.html#17415" class="Bound">M</a> <a id="17453" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="17455" href="plfa.Substitution.html#17415" class="Bound">M</a>
<a id="17457" href="/PLFA-zh/Substitution/#17393" class="Function">rename-id</a> <a id="17467" class="Symbol">{</a><a id="17468" class="Argument">M</a> <a id="17470" class="Symbol">=</a> <a id="17472" href="plfa.Substitution.html#17472" class="Bound">M</a><a id="17473" class="Symbol">}</a> <a id="17475" class="Symbol">=</a>
   <a id="17480" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin</a>
     <a id="17491" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="17498" class="Symbol">(λ</a> <a id="17501" class="Symbol">{</a><a id="17502" href="/PLFA-zh/Substitution/#17502" class="Bound">A</a><a id="17503" class="Symbol">}</a> <a id="17505" href="plfa.Substitution.html#17505" class="Bound">x</a> <a id="17507" class="Symbol">→</a> <a id="17509" href="plfa.Substitution.html#17505" class="Bound">x</a><a id="17510" class="Symbol">)</a> <a id="17512" href="plfa.Substitution.html#17472" class="Bound">M</a>
   <a id="17517" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="17520" href="/PLFA-zh/Substitution/#13695" class="Function">rename-subst-ren</a>  <a id="17538" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
     <a id="17545" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="17547" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="17551" class="Symbol">(λ</a> <a id="17554" class="Symbol">{</a><a id="17555" href="plfa.Substitution.html#17555" class="Bound">A</a><a id="17556" class="Symbol">}</a> <a id="17558" href="plfa.Substitution.html#17558" class="Bound">x</a> <a id="17560" class="Symbol">→</a> <a id="17562" href="plfa.Substitution.html#17558" class="Bound">x</a><a id="17563" class="Symbol">)</a> <a id="17565" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="17567" href="plfa.Substitution.html#17472" class="Bound">M</a>
   <a id="17572" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
     <a id="17581" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="17583" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="17587" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="17589" href="plfa.Substitution.html#17472" class="Bound">M</a>
   <a id="17594" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="17597" href="/PLFA-zh/Substitution/#17027" class="Function">sub-id</a>  <a id="17605" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
     <a id="17612" href="/PLFA-zh/Substitution/#17472" class="Bound">M</a>
   <a id="17617" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">∎</a>
</pre>
<h2 id="proof-of-sub-idr">Proof of sub-idR</h2>

<p>The proof of <code class="highlighter-rouge">sub-idR</code> follows directly from <code class="highlighter-rouge">sub-id</code>.</p>

<pre class="Agda"><a id="sub-idR"></a><a id="17705" href="/PLFA-zh/Substitution/#17705" class="Function">sub-idR</a> <a id="17713" class="Symbol">:</a> <a id="17715" class="Symbol">∀{</a><a id="17717" href="plfa.Substitution.html#17717" class="Bound">Γ</a> <a id="17719" href="plfa.Substitution.html#17719" class="Bound">Δ</a><a id="17720" class="Symbol">}</a> <a id="17722" class="Symbol">{</a><a id="17723" href="plfa.Substitution.html#17723" class="Bound">σ</a> <a id="17725" class="Symbol">:</a> <a id="17727" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="17733" href="plfa.Substitution.html#17717" class="Bound">Γ</a> <a id="17735" href="plfa.Substitution.html#17719" class="Bound">Δ</a><a id="17736" class="Symbol">}</a> <a id="17738" class="Symbol">{</a><a id="17739" href="plfa.Substitution.html#17739" class="Bound">A</a><a id="17740" class="Symbol">}</a>
       <a id="17749" class="Symbol">→</a> <a id="17751" class="Symbol">(</a><a id="17752" href="/PLFA-zh/Substitution/#17723" class="Bound">σ</a> <a id="17754" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="17756" href="plfa.Substitution.html#3087" class="Function">ids</a><a id="17759" class="Symbol">)</a> <a id="17761" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="17763" href="plfa.Substitution.html#17723" class="Bound">σ</a> <a id="17765" class="Symbol">{</a><a id="17766" href="plfa.Substitution.html#17739" class="Bound">A</a><a id="17767" class="Symbol">}</a>
<a id="17769" href="/PLFA-zh/Substitution/#17705" class="Function">sub-idR</a> <a id="17777" class="Symbol">{</a><a id="17778" href="plfa.Substitution.html#17778" class="Bound">Γ</a><a id="17779" class="Symbol">}{</a><a id="17781" class="Argument">σ</a> <a id="17783" class="Symbol">=</a> <a id="17785" href="plfa.Substitution.html#17785" class="Bound">σ</a><a id="17786" class="Symbol">}{</a><a id="17788" href="plfa.Substitution.html#17788" class="Bound">A</a><a id="17789" class="Symbol">}</a> <a id="17791" class="Symbol">=</a>
          <a id="17803" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin</a>
            <a id="17821" href="/PLFA-zh/Substitution/#17785" class="Bound">σ</a> <a id="17823" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="17825" href="plfa.Substitution.html#3087" class="Function">ids</a>
          <a id="17839" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
            <a id="17855" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="17857" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="17861" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="17863" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="17865" href="plfa.Substitution.html#17785" class="Bound">σ</a>
          <a id="17877" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="17880" href="/PLFA-zh/Substitution/#1968" class="Postulate">extensionality</a> <a id="17895" class="Symbol">(λ</a> <a id="17898" href="plfa.Substitution.html#17898" class="Bound">x</a> <a id="17900" class="Symbol">→</a> <a id="17902" href="plfa.Substitution.html#17027" class="Function">sub-id</a><a id="17908" class="Symbol">)</a> <a id="17910" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
            <a id="17924" href="/PLFA-zh/Substitution/#17785" class="Bound">σ</a>
          <a id="17936" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">∎</a>
</pre>

<h2 id="proof-of-sub-sub">Proof of sub-sub</h2>

<p>The <code class="highlighter-rouge">sub-sub</code> equation states that sequenced substitutions <code class="highlighter-rouge">σ ⨟ τ</code>
are equivalent to first applying <code class="highlighter-rouge">σ</code> then applying <code class="highlighter-rouge">τ</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>⟪ τ ⟫ ⟪ σ ⟫ M  ≡ ⟪ σ ⨟ τ ⟫ M
</code></pre></div></div>

<p>The proof requires several lemmas. First, we need to prove the
specialization for renaming.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rename ρ (rename ρ′ M) ≡ rename (ρ ∘ ρ′) M
</code></pre></div></div>

<p>This in turn requires the following lemma about <code class="highlighter-rouge">ext</code>.</p>

<pre class="Agda"><a id="compose-ext"></a><a id="18324" href="/PLFA-zh/Substitution/#18324" class="Function">compose-ext</a> <a id="18336" class="Symbol">:</a> <a id="18338" class="Symbol">∀{</a><a id="18340" href="plfa.Substitution.html#18340" class="Bound">Γ</a> <a id="18342" href="plfa.Substitution.html#18342" class="Bound">Δ</a> <a id="18344" href="plfa.Substitution.html#18344" class="Bound">Σ</a><a id="18345" class="Symbol">}{</a><a id="18347" href="plfa.Substitution.html#18347" class="Bound">ρ</a> <a id="18349" class="Symbol">:</a> <a id="18351" href="plfa.Substitution.html#2233" class="Function">Rename</a> <a id="18358" href="plfa.Substitution.html#18342" class="Bound">Δ</a> <a id="18360" href="plfa.Substitution.html#18344" class="Bound">Σ</a><a id="18361" class="Symbol">}</a> <a id="18363" class="Symbol">{</a><a id="18364" href="plfa.Substitution.html#18364" class="Bound">ρ′</a> <a id="18367" class="Symbol">:</a> <a id="18369" href="plfa.Substitution.html#2233" class="Function">Rename</a> <a id="18376" href="plfa.Substitution.html#18340" class="Bound">Γ</a> <a id="18378" href="plfa.Substitution.html#18342" class="Bound">Δ</a><a id="18379" class="Symbol">}</a> <a id="18381" class="Symbol">{</a><a id="18382" href="plfa.Substitution.html#18382" class="Bound">A</a> <a id="18384" href="plfa.Substitution.html#18384" class="Bound">B</a><a id="18385" class="Symbol">}</a>
            <a id="18399" class="Symbol">→</a> <a id="18401" class="Symbol">((</a><a id="18403" href="/PLFA-zh/Untyped/#5883" class="Function">ext</a> <a id="18407" href="/PLFA-zh/Substitution/#18347" class="Bound">ρ</a><a id="18408" class="Symbol">)</a> <a id="18410" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="18412" class="Symbol">(</a><a id="18413" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="18417" href="plfa.Substitution.html#18364" class="Bound">ρ′</a><a id="18419" class="Symbol">))</a> <a id="18422" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="18424" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="18428" class="Symbol">(</a><a id="18429" href="plfa.Substitution.html#18347" class="Bound">ρ</a> <a id="18431" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="18433" href="plfa.Substitution.html#18364" class="Bound">ρ′</a><a id="18435" class="Symbol">)</a> <a id="18437" class="Symbol">{</a><a id="18438" href="plfa.Substitution.html#18384" class="Bound">B</a><a id="18439" class="Symbol">}</a> <a id="18441" class="Symbol">{</a><a id="18442" href="plfa.Substitution.html#18382" class="Bound">A</a><a id="18443" class="Symbol">}</a>
<a id="18445" href="/PLFA-zh/Substitution/#18324" class="Function">compose-ext</a> <a id="18457" class="Symbol">=</a> <a id="18459" href="plfa.Substitution.html#1968" class="Postulate">extensionality</a> <a id="18474" class="Symbol">λ</a> <a id="18476" href="plfa.Substitution.html#18476" class="Bound">x</a> <a id="18478" class="Symbol">→</a> <a id="18480" href="plfa.Substitution.html#18504" class="Function">lemma</a> <a id="18486" class="Symbol">{</a><a id="18487" class="Argument">x</a> <a id="18489" class="Symbol">=</a> <a id="18491" href="plfa.Substitution.html#18476" class="Bound">x</a><a id="18492" class="Symbol">}</a>
  <a id="18496" class="Keyword">where</a>
  <a id="18504" href="/PLFA-zh/Substitution/#18504" class="Function">lemma</a> <a id="18510" class="Symbol">:</a> <a id="18512" class="Symbol">∀{</a><a id="18514" href="plfa.Substitution.html#18514" class="Bound">Γ</a> <a id="18516" href="plfa.Substitution.html#18516" class="Bound">Δ</a> <a id="18518" href="plfa.Substitution.html#18518" class="Bound">Σ</a><a id="18519" class="Symbol">}{</a><a id="18521" href="plfa.Substitution.html#18521" class="Bound">ρ</a> <a id="18523" class="Symbol">:</a> <a id="18525" href="plfa.Substitution.html#2233" class="Function">Rename</a> <a id="18532" href="plfa.Substitution.html#18516" class="Bound">Δ</a> <a id="18534" href="plfa.Substitution.html#18518" class="Bound">Σ</a><a id="18535" class="Symbol">}</a> <a id="18537" class="Symbol">{</a><a id="18538" href="plfa.Substitution.html#18538" class="Bound">ρ′</a> <a id="18541" class="Symbol">:</a> <a id="18543" href="plfa.Substitution.html#2233" class="Function">Rename</a> <a id="18550" href="plfa.Substitution.html#18514" class="Bound">Γ</a> <a id="18552" href="plfa.Substitution.html#18516" class="Bound">Δ</a><a id="18553" class="Symbol">}</a> <a id="18555" class="Symbol">{</a><a id="18556" href="plfa.Substitution.html#18556" class="Bound">A</a> <a id="18558" href="plfa.Substitution.html#18558" class="Bound">B</a><a id="18559" class="Symbol">}</a> <a id="18561" class="Symbol">{</a><a id="18562" href="plfa.Substitution.html#18562" class="Bound">x</a> <a id="18564" class="Symbol">:</a> <a id="18566" href="plfa.Substitution.html#18514" class="Bound">Γ</a> <a id="18568" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="18570" href="plfa.Substitution.html#18558" class="Bound">B</a> <a id="18572" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="18574" href="plfa.Substitution.html#18556" class="Bound">A</a><a id="18575" class="Symbol">}</a>
              <a id="18591" class="Symbol">→</a> <a id="18593" class="Symbol">((</a><a id="18595" href="/PLFA-zh/Untyped/#5883" class="Function">ext</a> <a id="18599" href="/PLFA-zh/Substitution/#18521" class="Bound">ρ</a><a id="18600" class="Symbol">)</a> <a id="18602" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="18604" class="Symbol">(</a><a id="18605" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="18609" href="plfa.Substitution.html#18538" class="Bound">ρ′</a><a id="18611" class="Symbol">))</a> <a id="18614" href="plfa.Substitution.html#18562" class="Bound">x</a> <a id="18616" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="18618" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="18622" class="Symbol">(</a><a id="18623" href="plfa.Substitution.html#18521" class="Bound">ρ</a> <a id="18625" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="18627" href="plfa.Substitution.html#18538" class="Bound">ρ′</a><a id="18629" class="Symbol">)</a> <a id="18631" href="plfa.Substitution.html#18562" class="Bound">x</a>
  <a id="18635" href="/PLFA-zh/Substitution/#18504" class="Function">lemma</a> <a id="18641" class="Symbol">{</a><a id="18642" class="Argument">x</a> <a id="18644" class="Symbol">=</a> <a id="18646" href="/PLFA-zh/Untyped/#3519" class="InductiveConstructor">Z</a><a id="18647" class="Symbol">}</a> <a id="18649" class="Symbol">=</a> <a id="18651" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
  <a id="18658" href="/PLFA-zh/Substitution/#18504" class="Function">lemma</a> <a id="18664" class="Symbol">{</a><a id="18665" class="Argument">x</a> <a id="18667" class="Symbol">=</a> <a id="18669" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="18671" href="plfa.Substitution.html#18671" class="Bound">x</a><a id="18672" class="Symbol">}</a> <a id="18674" class="Symbol">=</a> <a id="18676" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<p>To prove that composing renamings is equivalent to applying one after
the other using <code class="highlighter-rouge">rename</code>, we proceed by induction on the term <code class="highlighter-rouge">M</code>,
using the <code class="highlighter-rouge">compose-ext</code> lemma in the case for <code class="highlighter-rouge">M ≡ ƛ N</code>.</p>

<pre class="Agda"><a id="compose-rename"></a><a id="18885" href="/PLFA-zh/Substitution/#18885" class="Function">compose-rename</a> <a id="18900" class="Symbol">:</a> <a id="18902" class="Symbol">∀{</a><a id="18904" href="plfa.Substitution.html#18904" class="Bound">Γ</a> <a id="18906" href="plfa.Substitution.html#18906" class="Bound">Δ</a> <a id="18908" href="plfa.Substitution.html#18908" class="Bound">Σ</a><a id="18909" class="Symbol">}{</a><a id="18911" href="plfa.Substitution.html#18911" class="Bound">A</a><a id="18912" class="Symbol">}{</a><a id="18914" href="plfa.Substitution.html#18914" class="Bound">M</a> <a id="18916" class="Symbol">:</a> <a id="18918" href="plfa.Substitution.html#18904" class="Bound">Γ</a> <a id="18920" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="18922" href="plfa.Substitution.html#18911" class="Bound">A</a><a id="18923" class="Symbol">}{</a><a id="18925" href="plfa.Substitution.html#18925" class="Bound">ρ</a> <a id="18927" class="Symbol">:</a> <a id="18929" href="plfa.Substitution.html#2233" class="Function">Rename</a> <a id="18936" href="plfa.Substitution.html#18906" class="Bound">Δ</a> <a id="18938" href="plfa.Substitution.html#18908" class="Bound">Σ</a><a id="18939" class="Symbol">}{</a><a id="18941" href="plfa.Substitution.html#18941" class="Bound">ρ′</a> <a id="18944" class="Symbol">:</a> <a id="18946" href="plfa.Substitution.html#2233" class="Function">Rename</a> <a id="18953" href="plfa.Substitution.html#18904" class="Bound">Γ</a> <a id="18955" href="plfa.Substitution.html#18906" class="Bound">Δ</a><a id="18956" class="Symbol">}</a>
  <a id="18960" class="Symbol">→</a> <a id="18962" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="18969" href="/PLFA-zh/Substitution/#18925" class="Bound">ρ</a> <a id="18971" class="Symbol">(</a><a id="18972" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="18979" href="plfa.Substitution.html#18941" class="Bound">ρ′</a> <a id="18982" href="plfa.Substitution.html#18914" class="Bound">M</a><a id="18983" class="Symbol">)</a> <a id="18985" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="18987" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="18994" class="Symbol">(</a><a id="18995" href="plfa.Substitution.html#18925" class="Bound">ρ</a> <a id="18997" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="18999" href="plfa.Substitution.html#18941" class="Bound">ρ′</a><a id="19001" class="Symbol">)</a> <a id="19003" href="plfa.Substitution.html#18914" class="Bound">M</a>
<a id="19005" href="/PLFA-zh/Substitution/#18885" class="Function">compose-rename</a> <a id="19020" class="Symbol">{</a><a id="19021" class="Argument">M</a> <a id="19023" class="Symbol">=</a> <a id="19025" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="19027" href="plfa.Substitution.html#19027" class="Bound">x</a><a id="19028" class="Symbol">}</a> <a id="19030" class="Symbol">=</a> <a id="19032" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="19037" href="/PLFA-zh/Substitution/#18885" class="Function">compose-rename</a> <a id="19052" class="Symbol">{</a><a id="19053" href="plfa.Substitution.html#19053" class="Bound">Γ</a><a id="19054" class="Symbol">}{</a><a id="19056" href="plfa.Substitution.html#19056" class="Bound">Δ</a><a id="19057" class="Symbol">}{</a><a id="19059" href="plfa.Substitution.html#19059" class="Bound">Σ</a><a id="19060" class="Symbol">}{</a><a id="19062" href="plfa.Substitution.html#19062" class="Bound">A</a><a id="19063" class="Symbol">}{</a><a id="19065" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="19067" href="plfa.Substitution.html#19067" class="Bound">N</a><a id="19068" class="Symbol">}{</a><a id="19070" href="plfa.Substitution.html#19070" class="Bound">ρ</a><a id="19071" class="Symbol">}{</a><a id="19073" href="plfa.Substitution.html#19073" class="Bound">ρ′</a><a id="19075" class="Symbol">}</a> <a id="19077" class="Symbol">=</a> <a id="19079" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="19084" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ_</a> <a id="19087" href="plfa.Substitution.html#19099" class="Function">G</a>
  <a id="19091" class="Keyword">where</a>
  <a id="19099" href="/PLFA-zh/Substitution/#19099" class="Function">G</a> <a id="19101" class="Symbol">:</a> <a id="19103" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="19110" class="Symbol">(</a><a id="19111" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="19115" href="plfa.Substitution.html#19070" class="Bound">ρ</a><a id="19116" class="Symbol">)</a> <a id="19118" class="Symbol">(</a><a id="19119" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="19126" class="Symbol">(</a><a id="19127" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="19131" href="plfa.Substitution.html#19073" class="Bound">ρ′</a><a id="19133" class="Symbol">)</a> <a id="19135" href="plfa.Substitution.html#19067" class="Bound">N</a><a id="19136" class="Symbol">)</a> <a id="19138" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="19140" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="19147" class="Symbol">(</a><a id="19148" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="19152" class="Symbol">(</a><a id="19153" href="plfa.Substitution.html#19070" class="Bound">ρ</a> <a id="19155" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="19157" href="plfa.Substitution.html#19073" class="Bound">ρ′</a><a id="19159" class="Symbol">))</a> <a id="19162" href="plfa.Substitution.html#19067" class="Bound">N</a>
  <a id="19166" href="/PLFA-zh/Substitution/#19099" class="Function">G</a> <a id="19168" class="Symbol">=</a>
      <a id="19176" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin</a>
        <a id="19190" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="19197" class="Symbol">(</a><a id="19198" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="19202" href="/PLFA-zh/Substitution/#19070" class="Bound">ρ</a><a id="19203" class="Symbol">)</a> <a id="19205" class="Symbol">(</a><a id="19206" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="19213" class="Symbol">(</a><a id="19214" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="19218" href="plfa.Substitution.html#19073" class="Bound">ρ′</a><a id="19220" class="Symbol">)</a> <a id="19222" href="plfa.Substitution.html#19067" class="Bound">N</a><a id="19223" class="Symbol">)</a>
      <a id="19231" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="19234" href="/PLFA-zh/Substitution/#18885" class="Function">compose-rename</a><a id="19248" class="Symbol">{</a><a id="19249" class="Argument">ρ</a> <a id="19251" class="Symbol">=</a> <a id="19253" href="/PLFA-zh/Untyped/#5883" class="Function">ext</a> <a id="19257" href="plfa.Substitution.html#19070" class="Bound">ρ</a><a id="19258" class="Symbol">}{</a><a id="19260" class="Argument">ρ′</a> <a id="19263" class="Symbol">=</a> <a id="19265" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="19269" href="plfa.Substitution.html#19073" class="Bound">ρ′</a><a id="19271" class="Symbol">}</a> <a id="19273" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
        <a id="19283" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="19290" class="Symbol">((</a><a id="19292" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="19296" href="/PLFA-zh/Substitution/#19070" class="Bound">ρ</a><a id="19297" class="Symbol">)</a> <a id="19299" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="19301" class="Symbol">(</a><a id="19302" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="19306" href="plfa.Substitution.html#19073" class="Bound">ρ′</a><a id="19308" class="Symbol">))</a> <a id="19311" href="plfa.Substitution.html#19067" class="Bound">N</a>
      <a id="19319" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="19322" href="/PLFA-zh/Substitution/#10411" class="Function">cong-rename</a> <a id="19334" href="plfa.Substitution.html#18324" class="Function">compose-ext</a> <a id="19346" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="19351" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
        <a id="19361" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="19368" class="Symbol">(</a><a id="19369" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="19373" class="Symbol">(</a><a id="19374" href="/PLFA-zh/Substitution/#19070" class="Bound">ρ</a> <a id="19376" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="19378" href="plfa.Substitution.html#19073" class="Bound">ρ′</a><a id="19380" class="Symbol">))</a> <a id="19383" href="plfa.Substitution.html#19067" class="Bound">N</a>
      <a id="19391" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">∎</a>
<a id="19393" href="/PLFA-zh/Substitution/#18885" class="Function">compose-rename</a> <a id="19408" class="Symbol">{</a><a id="19409" class="Argument">M</a> <a id="19411" class="Symbol">=</a> <a id="19413" href="plfa.Substitution.html#19413" class="Bound">L</a> <a id="19415" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="19417" href="plfa.Substitution.html#19417" class="Bound">M</a><a id="19418" class="Symbol">}</a> <a id="19420" class="Symbol">=</a> <a id="19422" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1436" class="Function">cong₂</a> <a id="19428" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">_·_</a> <a id="19432" href="plfa.Substitution.html#18885" class="Function">compose-rename</a> <a id="19447" href="plfa.Substitution.html#18885" class="Function">compose-rename</a>
</pre>
<p>The next lemma states that if a renaming and substitution commute on
variables, then they also commute on terms. We explain the proof in
detail below.</p>

<pre class="Agda"><a id="commute-subst-rename"></a><a id="19623" href="/PLFA-zh/Substitution/#19623" class="Function">commute-subst-rename</a> <a id="19644" class="Symbol">:</a> <a id="19646" class="Symbol">∀{</a><a id="19648" href="plfa.Substitution.html#19648" class="Bound">Γ</a> <a id="19650" href="plfa.Substitution.html#19650" class="Bound">Δ</a><a id="19651" class="Symbol">}{</a><a id="19653" href="plfa.Substitution.html#19653" class="Bound">M</a> <a id="19655" class="Symbol">:</a> <a id="19657" href="plfa.Substitution.html#19648" class="Bound">Γ</a> <a id="19659" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="19661" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="19662" class="Symbol">}{</a><a id="19664" href="plfa.Substitution.html#19664" class="Bound">σ</a> <a id="19666" class="Symbol">:</a> <a id="19668" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="19674" href="plfa.Substitution.html#19648" class="Bound">Γ</a> <a id="19676" href="plfa.Substitution.html#19650" class="Bound">Δ</a><a id="19677" class="Symbol">}</a>
                        <a id="19703" class="Symbol">{</a><a id="19704" href="/PLFA-zh/Substitution/#19704" class="Bound">ρ</a> <a id="19706" class="Symbol">:</a> <a id="19708" class="Symbol">∀{</a><a id="19710" href="plfa.Substitution.html#19710" class="Bound">Γ</a><a id="19711" class="Symbol">}</a> <a id="19713" class="Symbol">→</a> <a id="19715" href="plfa.Substitution.html#2233" class="Function">Rename</a> <a id="19722" href="plfa.Substitution.html#19710" class="Bound">Γ</a> <a id="19724" class="Symbol">(</a><a id="19725" href="plfa.Substitution.html#19710" class="Bound">Γ</a> <a id="19727" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="19729" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="19730" class="Symbol">)}</a>
     <a id="19738" class="Symbol">→</a> <a id="19740" class="Symbol">(∀{</a><a id="19743" href="/PLFA-zh/Substitution/#19743" class="Bound">x</a> <a id="19745" class="Symbol">:</a> <a id="19747" href="plfa.Substitution.html#19648" class="Bound">Γ</a> <a id="19749" href="/PLFA-zh/Untyped/#3483" class="Datatype Operator">∋</a> <a id="19751" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="19752" class="Symbol">}</a> <a id="19754" class="Symbol">→</a> <a id="19756" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="19761" href="plfa.Substitution.html#19664" class="Bound">σ</a> <a id="19763" class="Symbol">{</a><a id="19764" class="Argument">B</a> <a id="19766" class="Symbol">=</a> <a id="19768" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="19769" class="Symbol">}</a> <a id="19771" class="Symbol">(</a><a id="19772" href="plfa.Substitution.html#19704" class="Bound">ρ</a> <a id="19774" href="plfa.Substitution.html#19743" class="Bound">x</a><a id="19775" class="Symbol">)</a> <a id="19777" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="19779" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="19786" href="plfa.Substitution.html#19704" class="Bound">ρ</a> <a id="19788" class="Symbol">(</a><a id="19789" href="plfa.Substitution.html#19664" class="Bound">σ</a> <a id="19791" href="plfa.Substitution.html#19743" class="Bound">x</a><a id="19792" class="Symbol">))</a>
     <a id="19800" class="Symbol">→</a> <a id="19802" href="/PLFA-zh/Untyped/#6921" class="Function">subst</a> <a id="19808" class="Symbol">(</a><a id="19809" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="19814" href="/PLFA-zh/Substitution/#19664" class="Bound">σ</a> <a id="19816" class="Symbol">{</a><a id="19817" class="Argument">B</a> <a id="19819" class="Symbol">=</a> <a id="19821" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="19822" class="Symbol">})</a> <a id="19825" class="Symbol">(</a><a id="19826" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="19833" href="plfa.Substitution.html#19704" class="Bound">ρ</a> <a id="19835" href="plfa.Substitution.html#19653" class="Bound">M</a><a id="19836" class="Symbol">)</a> <a id="19838" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="19840" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="19847" href="plfa.Substitution.html#19704" class="Bound">ρ</a> <a id="19849" class="Symbol">(</a><a id="19850" href="plfa.Untyped.html#6921" class="Function">subst</a> <a id="19856" href="plfa.Substitution.html#19664" class="Bound">σ</a> <a id="19858" href="plfa.Substitution.html#19653" class="Bound">M</a><a id="19859" class="Symbol">)</a>
<a id="19861" href="/PLFA-zh/Substitution/#19623" class="Function">commute-subst-rename</a> <a id="19882" class="Symbol">{</a><a id="19883" class="Argument">M</a> <a id="19885" class="Symbol">=</a> <a id="19887" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="19889" href="plfa.Substitution.html#19889" class="Bound">x</a><a id="19890" class="Symbol">}</a> <a id="19892" href="plfa.Substitution.html#19892" class="Bound">r</a> <a id="19894" class="Symbol">=</a> <a id="19896" href="plfa.Substitution.html#19892" class="Bound">r</a>
<a id="19898" href="/PLFA-zh/Substitution/#19623" class="Function">commute-subst-rename</a><a id="19918" class="Symbol">{</a><a id="19919" href="plfa.Substitution.html#19919" class="Bound">Γ</a><a id="19920" class="Symbol">}{</a><a id="19922" href="plfa.Substitution.html#19922" class="Bound">Δ</a><a id="19923" class="Symbol">}{</a><a id="19925" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="19927" href="plfa.Substitution.html#19927" class="Bound">N</a><a id="19928" class="Symbol">}{</a><a id="19930" href="plfa.Substitution.html#19930" class="Bound">σ</a><a id="19931" class="Symbol">}{</a><a id="19933" href="plfa.Substitution.html#19933" class="Bound">ρ</a><a id="19934" class="Symbol">}</a> <a id="19936" href="plfa.Substitution.html#19936" class="Bound">r</a> <a id="19938" class="Symbol">=</a>
   <a id="19943" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="19948" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ_</a> <a id="19951" class="Symbol">(</a><a id="19952" href="/PLFA-zh/Substitution/#19623" class="Function">commute-subst-rename</a><a id="19972" class="Symbol">{</a><a id="19973" href="plfa.Substitution.html#19919" class="Bound">Γ</a> <a id="19975" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="19977" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="19978" class="Symbol">}{</a><a id="19980" href="plfa.Substitution.html#19922" class="Bound">Δ</a> <a id="19982" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="19984" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="19985" class="Symbol">}{</a><a id="19987" href="plfa.Substitution.html#19927" class="Bound">N</a><a id="19988" class="Symbol">}</a>
               <a id="20005" class="Symbol">{</a><a id="20006" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="20011" href="/PLFA-zh/Substitution/#19930" class="Bound">σ</a><a id="20012" class="Symbol">}{</a><a id="20014" class="Argument">ρ</a> <a id="20016" class="Symbol">=</a> <a id="20018" href="plfa.Substitution.html#20051" class="Function">ρ′</a><a id="20020" class="Symbol">}</a> <a id="20022" class="Symbol">(λ</a> <a id="20025" class="Symbol">{</a><a id="20026" href="plfa.Substitution.html#20026" class="Bound">x</a><a id="20027" class="Symbol">}</a> <a id="20029" class="Symbol">→</a> <a id="20031" href="plfa.Substitution.html#20124" class="Function">H</a> <a id="20033" class="Symbol">{</a><a id="20034" href="plfa.Substitution.html#20026" class="Bound">x</a><a id="20035" class="Symbol">}))</a>
   <a id="20042" class="Keyword">where</a>
   <a id="20051" href="/PLFA-zh/Substitution/#20051" class="Function">ρ′</a> <a id="20054" class="Symbol">:</a> <a id="20056" class="Symbol">∀</a> <a id="20058" class="Symbol">{</a><a id="20059" href="plfa.Substitution.html#20059" class="Bound">Γ</a><a id="20060" class="Symbol">}</a> <a id="20062" class="Symbol">→</a> <a id="20064" href="plfa.Substitution.html#2233" class="Function">Rename</a> <a id="20071" href="plfa.Substitution.html#20059" class="Bound">Γ</a> <a id="20073" class="Symbol">(</a><a id="20074" href="plfa.Substitution.html#20059" class="Bound">Γ</a> <a id="20076" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="20078" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="20079" class="Symbol">)</a>
   <a id="20084" href="/PLFA-zh/Substitution/#20051" class="Function">ρ′</a> <a id="20087" class="Symbol">{</a><a id="20088" href="/PLFA-zh/Untyped/#3152" class="InductiveConstructor">∅</a><a id="20089" class="Symbol">}</a> <a id="20091" class="Symbol">=</a> <a id="20093" class="Symbol">λ</a> <a id="20095" class="Symbol">()</a>
   <a id="20101" href="/PLFA-zh/Substitution/#20051" class="Function">ρ′</a> <a id="20104" class="Symbol">{</a><a id="20105" href="plfa.Substitution.html#20105" class="Bound">Γ</a> <a id="20107" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="20109" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="20110" class="Symbol">}</a> <a id="20112" class="Symbol">=</a> <a id="20114" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="20118" href="plfa.Substitution.html#19933" class="Bound">ρ</a>

   <a id="20124" href="/PLFA-zh/Substitution/#20124" class="Function">H</a> <a id="20126" class="Symbol">:</a> <a id="20128" class="Symbol">{</a><a id="20129" href="plfa.Substitution.html#20129" class="Bound">x</a> <a id="20131" class="Symbol">:</a> <a id="20133" href="plfa.Substitution.html#19919" class="Bound">Γ</a> <a id="20135" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="20137" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="20139" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="20141" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="20142" class="Symbol">}</a> <a id="20144" class="Symbol">→</a> <a id="20146" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="20151" class="Symbol">(</a><a id="20152" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="20157" href="plfa.Substitution.html#19930" class="Bound">σ</a><a id="20158" class="Symbol">)</a> <a id="20160" class="Symbol">(</a><a id="20161" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="20165" href="plfa.Substitution.html#19933" class="Bound">ρ</a> <a id="20167" href="plfa.Substitution.html#20129" class="Bound">x</a><a id="20168" class="Symbol">)</a> <a id="20170" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="20172" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="20179" class="Symbol">(</a><a id="20180" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="20184" href="plfa.Substitution.html#19933" class="Bound">ρ</a><a id="20185" class="Symbol">)</a> <a id="20187" class="Symbol">(</a><a id="20188" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="20193" href="plfa.Substitution.html#19930" class="Bound">σ</a> <a id="20195" href="plfa.Substitution.html#20129" class="Bound">x</a><a id="20196" class="Symbol">)</a>
   <a id="20201" href="/PLFA-zh/Substitution/#20124" class="Function">H</a> <a id="20203" class="Symbol">{</a><a id="20204" href="/PLFA-zh/Untyped/#3519" class="InductiveConstructor">Z</a><a id="20205" class="Symbol">}</a> <a id="20207" class="Symbol">=</a> <a id="20209" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
   <a id="20217" href="/PLFA-zh/Substitution/#20124" class="Function">H</a> <a id="20219" class="Symbol">{</a><a id="20220" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="20222" href="plfa.Substitution.html#20222" class="Bound">y</a><a id="20223" class="Symbol">}</a> <a id="20225" class="Symbol">=</a>
     <a id="20232" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin</a>
       <a id="20245" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="20250" class="Symbol">(</a><a id="20251" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="20256" href="/PLFA-zh/Substitution/#19930" class="Bound">σ</a><a id="20257" class="Symbol">)</a> <a id="20259" class="Symbol">(</a><a id="20260" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="20264" href="plfa.Substitution.html#19933" class="Bound">ρ</a> <a id="20266" class="Symbol">(</a><a id="20267" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="20269" href="plfa.Substitution.html#20222" class="Bound">y</a><a id="20270" class="Symbol">))</a>
     <a id="20278" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
       <a id="20289" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="20296" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a> <a id="20299" class="Symbol">(</a><a id="20300" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="20305" href="/PLFA-zh/Substitution/#19930" class="Bound">σ</a> <a id="20307" class="Symbol">(</a><a id="20308" href="plfa.Substitution.html#19933" class="Bound">ρ</a> <a id="20310" href="plfa.Substitution.html#20222" class="Bound">y</a><a id="20311" class="Symbol">))</a>
     <a id="20319" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="20322" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="20327" class="Symbol">(</a><a id="20328" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="20335" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a><a id="20337" class="Symbol">)</a> <a id="20339" href="/PLFA-zh/Substitution/#19936" class="Bound">r</a> <a id="20341" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="20350" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="20357" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a> <a id="20360" class="Symbol">(</a><a id="20361" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="20368" href="/PLFA-zh/Substitution/#19933" class="Bound">ρ</a> <a id="20370" class="Symbol">(</a><a id="20371" href="plfa.Substitution.html#19930" class="Bound">σ</a> <a id="20373" href="plfa.Substitution.html#20222" class="Bound">y</a><a id="20374" class="Symbol">))</a>
     <a id="20382" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="20385" href="/PLFA-zh/Substitution/#18885" class="Function">compose-rename</a> <a id="20400" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="20409" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="20416" class="Symbol">(</a><a id="20417" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a> <a id="20420" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="20422" href="/PLFA-zh/Substitution/#19933" class="Bound">ρ</a><a id="20423" class="Symbol">)</a> <a id="20425" class="Symbol">(</a><a id="20426" href="plfa.Substitution.html#19930" class="Bound">σ</a> <a id="20428" href="plfa.Substitution.html#20222" class="Bound">y</a><a id="20429" class="Symbol">)</a>
     <a id="20436" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="20439" href="/PLFA-zh/Substitution/#10411" class="Function">cong-rename</a> <a id="20451" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="20456" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="20461" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="20470" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="20477" class="Symbol">((</a><a id="20479" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="20483" href="/PLFA-zh/Substitution/#19933" class="Bound">ρ</a><a id="20484" class="Symbol">)</a> <a id="20486" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="20488" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a><a id="20490" class="Symbol">)</a> <a id="20492" class="Symbol">(</a><a id="20493" href="plfa.Substitution.html#19930" class="Bound">σ</a> <a id="20495" href="plfa.Substitution.html#20222" class="Bound">y</a><a id="20496" class="Symbol">)</a>
     <a id="20503" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="20506" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="20510" href="/PLFA-zh/Substitution/#18885" class="Function">compose-rename</a> <a id="20525" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="20534" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="20541" class="Symbol">(</a><a id="20542" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="20546" href="/PLFA-zh/Substitution/#19933" class="Bound">ρ</a><a id="20547" class="Symbol">)</a> <a id="20549" class="Symbol">(</a><a id="20550" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="20557" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a> <a id="20560" class="Symbol">(</a><a id="20561" href="plfa.Substitution.html#19930" class="Bound">σ</a> <a id="20563" href="plfa.Substitution.html#20222" class="Bound">y</a><a id="20564" class="Symbol">))</a>
     <a id="20572" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
       <a id="20583" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="20590" class="Symbol">(</a><a id="20591" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="20595" href="/PLFA-zh/Substitution/#19933" class="Bound">ρ</a><a id="20596" class="Symbol">)</a> <a id="20598" class="Symbol">(</a><a id="20599" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="20604" href="plfa.Substitution.html#19930" class="Bound">σ</a> <a id="20606" class="Symbol">(</a><a id="20607" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="20609" href="plfa.Substitution.html#20222" class="Bound">y</a><a id="20610" class="Symbol">))</a>
     <a id="20618" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">∎</a>
<a id="20620" href="/PLFA-zh/Substitution/#19623" class="Function">commute-subst-rename</a> <a id="20641" class="Symbol">{</a><a id="20642" class="Argument">M</a> <a id="20644" class="Symbol">=</a> <a id="20646" href="plfa.Substitution.html#20646" class="Bound">L</a> <a id="20648" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="20650" href="plfa.Substitution.html#20650" class="Bound">M</a><a id="20651" class="Symbol">}{</a><a id="20653" class="Argument">ρ</a> <a id="20655" class="Symbol">=</a> <a id="20657" href="plfa.Substitution.html#20657" class="Bound">ρ</a><a id="20658" class="Symbol">}</a> <a id="20660" href="plfa.Substitution.html#20660" class="Bound">r</a> <a id="20662" class="Symbol">=</a>
   <a id="20667" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1436" class="Function">cong₂</a> <a id="20673" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">_·_</a> <a id="20677" class="Symbol">(</a><a id="20678" href="/PLFA-zh/Substitution/#19623" class="Function">commute-subst-rename</a><a id="20698" class="Symbol">{</a><a id="20699" class="Argument">M</a> <a id="20701" class="Symbol">=</a> <a id="20703" href="plfa.Substitution.html#20646" class="Bound">L</a><a id="20704" class="Symbol">}{</a><a id="20706" class="Argument">ρ</a> <a id="20708" class="Symbol">=</a> <a id="20710" href="plfa.Substitution.html#20657" class="Bound">ρ</a><a id="20711" class="Symbol">}</a> <a id="20713" href="plfa.Substitution.html#20660" class="Bound">r</a><a id="20714" class="Symbol">)</a>
             <a id="20729" class="Symbol">(</a><a id="20730" href="/PLFA-zh/Substitution/#19623" class="Function">commute-subst-rename</a><a id="20750" class="Symbol">{</a><a id="20751" class="Argument">M</a> <a id="20753" class="Symbol">=</a> <a id="20755" href="plfa.Substitution.html#20650" class="Bound">M</a><a id="20756" class="Symbol">}{</a><a id="20758" class="Argument">ρ</a> <a id="20760" class="Symbol">=</a> <a id="20762" href="plfa.Substitution.html#20657" class="Bound">ρ</a><a id="20763" class="Symbol">}</a> <a id="20765" href="plfa.Substitution.html#20660" class="Bound">r</a><a id="20766" class="Symbol">)</a>
</pre>
<p>The proof is by induction on the term <code class="highlighter-rouge">M</code>.</p>

<ul>
  <li>
    <p>If <code class="highlighter-rouge">M</code> is a variable, then we use the premise to conclude.</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">M ≡ ƛ N</code>, we conclude using the induction hypothesis for
<code class="highlighter-rouge">N</code>. However, to use the induction hypothesis, we must show
that</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  exts (exts σ) (ext ρ x) ≡ rename (ext ρ) (exts σ x)
</code></pre></div>    </div>

    <p>We prove this equation by cases on x.</p>

    <ul>
      <li>
        <p>If <code class="highlighter-rouge">x = Z</code>, the two sides are equal by definition.</p>
      </li>
      <li>
        <p>If <code class="highlighter-rouge">x = S y</code>, we obtain the goal by the following equational reasoning.</p>

        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exts (exts σ) (ext ρ (S y))   ≡ rename S_ (exts σ (ρ y))   ≡ rename S_ (rename S_ (σ (ρ y)      (by the premise)   ≡ rename (ext ρ) (exts σ (S y))      (by compose-rename)   ≡ rename ((ext ρ) ∘ S_) (σ y)   ≡ rename (ext ρ) (rename S_ (σ y))   (by compose-rename)   ≡ rename (ext ρ) (exts σ (S y))
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">M</code> is an application, we obtain the goal using the induction
hypothesis for each subterm.</p>
  </li>
</ul>

<p>The last lemma needed to prove <code class="highlighter-rouge">sub-sub</code> states that the <code class="highlighter-rouge">exts</code>
function distributes with sequencing. It is a corollary of
<code class="highlighter-rouge">commute-subst-rename</code> as described below.  (It would have been nicer
to prove this directly by equational reasoning in the σ algebra, but
that would require the <code class="highlighter-rouge">sub-assoc</code> equation, whose proof depends on
<code class="highlighter-rouge">sub-sub</code>, which in turn depends on this lemma.)</p>

<pre class="Agda"><a id="exts-seq"></a><a id="22079" href="/PLFA-zh/Substitution/#22079" class="Function">exts-seq</a> <a id="22088" class="Symbol">:</a> <a id="22090" class="Symbol">∀{</a><a id="22092" href="plfa.Substitution.html#22092" class="Bound">Γ</a> <a id="22094" href="plfa.Substitution.html#22094" class="Bound">Δ</a> <a id="22096" href="plfa.Substitution.html#22096" class="Bound">Δ′</a><a id="22098" class="Symbol">}</a> <a id="22100" class="Symbol">{</a><a id="22101" href="plfa.Substitution.html#22101" class="Bound">σ₁</a> <a id="22104" class="Symbol">:</a> <a id="22106" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="22112" href="plfa.Substitution.html#22092" class="Bound">Γ</a> <a id="22114" href="plfa.Substitution.html#22094" class="Bound">Δ</a><a id="22115" class="Symbol">}</a> <a id="22117" class="Symbol">{</a><a id="22118" href="plfa.Substitution.html#22118" class="Bound">σ₂</a> <a id="22121" class="Symbol">:</a> <a id="22123" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="22129" href="plfa.Substitution.html#22094" class="Bound">Δ</a> <a id="22131" href="plfa.Substitution.html#22096" class="Bound">Δ′</a><a id="22133" class="Symbol">}</a>
         <a id="22144" class="Symbol">→</a> <a id="22146" class="Symbol">∀</a> <a id="22148" class="Symbol">{</a><a id="22149" href="/PLFA-zh/Substitution/#22149" class="Bound">A</a><a id="22150" class="Symbol">}</a> <a id="22152" class="Symbol">→</a> <a id="22154" class="Symbol">(</a><a id="22155" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="22160" href="plfa.Substitution.html#22101" class="Bound">σ₁</a> <a id="22163" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="22165" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="22170" href="plfa.Substitution.html#22118" class="Bound">σ₂</a><a id="22172" class="Symbol">)</a> <a id="22174" class="Symbol">{</a><a id="22175" href="plfa.Substitution.html#22149" class="Bound">A</a><a id="22176" class="Symbol">}</a> <a id="22178" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="22180" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="22185" class="Symbol">(</a><a id="22186" href="plfa.Substitution.html#22101" class="Bound">σ₁</a> <a id="22189" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="22191" href="plfa.Substitution.html#22118" class="Bound">σ₂</a><a id="22193" class="Symbol">)</a>
<a id="22195" href="/PLFA-zh/Substitution/#22079" class="Function">exts-seq</a> <a id="22204" class="Symbol">=</a> <a id="22206" href="plfa.Substitution.html#1968" class="Postulate">extensionality</a> <a id="22221" class="Symbol">λ</a> <a id="22223" href="plfa.Substitution.html#22223" class="Bound">x</a> <a id="22225" class="Symbol">→</a> <a id="22227" href="plfa.Substitution.html#22251" class="Function">lemma</a> <a id="22233" class="Symbol">{</a><a id="22234" class="Argument">x</a> <a id="22236" class="Symbol">=</a> <a id="22238" href="plfa.Substitution.html#22223" class="Bound">x</a><a id="22239" class="Symbol">}</a>
  <a id="22243" class="Keyword">where</a>
  <a id="22251" href="/PLFA-zh/Substitution/#22251" class="Function">lemma</a> <a id="22257" class="Symbol">:</a> <a id="22259" class="Symbol">∀{</a><a id="22261" href="plfa.Substitution.html#22261" class="Bound">Γ</a> <a id="22263" href="plfa.Substitution.html#22263" class="Bound">Δ</a> <a id="22265" href="plfa.Substitution.html#22265" class="Bound">Δ′</a><a id="22267" class="Symbol">}{</a><a id="22269" href="plfa.Substitution.html#22269" class="Bound">A</a><a id="22270" class="Symbol">}{</a><a id="22272" href="plfa.Substitution.html#22272" class="Bound">x</a> <a id="22274" class="Symbol">:</a> <a id="22276" href="plfa.Substitution.html#22261" class="Bound">Γ</a> <a id="22278" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="22280" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="22282" href="plfa.Untyped.html#3483" class="Datatype Operator">∋</a> <a id="22284" href="plfa.Substitution.html#22269" class="Bound">A</a><a id="22285" class="Symbol">}</a> <a id="22287" class="Symbol">{</a><a id="22288" href="plfa.Substitution.html#22288" class="Bound">σ₁</a> <a id="22291" class="Symbol">:</a> <a id="22293" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="22299" href="plfa.Substitution.html#22261" class="Bound">Γ</a> <a id="22301" href="plfa.Substitution.html#22263" class="Bound">Δ</a><a id="22302" class="Symbol">}{</a><a id="22304" href="plfa.Substitution.html#22304" class="Bound">σ₂</a> <a id="22307" class="Symbol">:</a> <a id="22309" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="22315" href="plfa.Substitution.html#22263" class="Bound">Δ</a> <a id="22317" href="plfa.Substitution.html#22265" class="Bound">Δ′</a><a id="22319" class="Symbol">}</a>
     <a id="22326" class="Symbol">→</a> <a id="22328" class="Symbol">(</a><a id="22329" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="22334" href="/PLFA-zh/Substitution/#22288" class="Bound">σ₁</a> <a id="22337" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="22339" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="22344" href="plfa.Substitution.html#22304" class="Bound">σ₂</a><a id="22346" class="Symbol">)</a> <a id="22348" href="plfa.Substitution.html#22272" class="Bound">x</a> <a id="22350" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="22352" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="22357" class="Symbol">(</a><a id="22358" href="plfa.Substitution.html#22288" class="Bound">σ₁</a> <a id="22361" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="22363" href="plfa.Substitution.html#22304" class="Bound">σ₂</a><a id="22365" class="Symbol">)</a> <a id="22367" href="plfa.Substitution.html#22272" class="Bound">x</a>
  <a id="22371" href="/PLFA-zh/Substitution/#22251" class="Function">lemma</a> <a id="22377" class="Symbol">{</a><a id="22378" class="Argument">x</a> <a id="22380" class="Symbol">=</a> <a id="22382" href="/PLFA-zh/Untyped/#3519" class="InductiveConstructor">Z</a><a id="22383" class="Symbol">}</a> <a id="22385" class="Symbol">=</a> <a id="22387" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
  <a id="22394" href="/PLFA-zh/Substitution/#22251" class="Function">lemma</a> <a id="22400" class="Symbol">{</a><a id="22401" class="Argument">A</a> <a id="22403" class="Symbol">=</a> <a id="22405" href="/PLFA-zh/Untyped/#2876" class="InductiveConstructor">★</a><a id="22406" class="Symbol">}{</a><a id="22408" class="Argument">x</a> <a id="22410" class="Symbol">=</a> <a id="22412" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="22414" href="plfa.Substitution.html#22414" class="Bound">x</a><a id="22415" class="Symbol">}{</a><a id="22417" href="plfa.Substitution.html#22417" class="Bound">σ₁</a><a id="22419" class="Symbol">}{</a><a id="22421" href="plfa.Substitution.html#22421" class="Bound">σ₂</a><a id="22423" class="Symbol">}</a> <a id="22425" class="Symbol">=</a>
     <a id="22432" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin</a>
       <a id="22445" class="Symbol">(</a><a id="22446" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="22451" href="/PLFA-zh/Substitution/#22417" class="Bound">σ₁</a> <a id="22454" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="22456" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="22461" href="plfa.Substitution.html#22421" class="Bound">σ₂</a><a id="22463" class="Symbol">)</a> <a id="22465" class="Symbol">(</a><a id="22466" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="22468" href="plfa.Substitution.html#22414" class="Bound">x</a><a id="22469" class="Symbol">)</a>
     <a id="22476" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
       <a id="22487" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="22489" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="22494" href="plfa.Substitution.html#22421" class="Bound">σ₂</a> <a id="22497" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="22499" class="Symbol">(</a><a id="22500" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="22507" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a> <a id="22510" class="Symbol">(</a><a id="22511" href="plfa.Substitution.html#22417" class="Bound">σ₁</a> <a id="22514" href="plfa.Substitution.html#22414" class="Bound">x</a><a id="22515" class="Symbol">))</a>
     <a id="22523" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="22526" href="/PLFA-zh/Substitution/#19623" class="Function">commute-subst-rename</a><a id="22546" class="Symbol">{</a><a id="22547" class="Argument">M</a> <a id="22549" class="Symbol">=</a> <a id="22551" href="plfa.Substitution.html#22417" class="Bound">σ₁</a> <a id="22554" href="plfa.Substitution.html#22414" class="Bound">x</a><a id="22555" class="Symbol">}{</a><a id="22557" class="Argument">σ</a> <a id="22559" class="Symbol">=</a> <a id="22561" href="plfa.Substitution.html#22421" class="Bound">σ₂</a><a id="22563" class="Symbol">}{</a><a id="22565" class="Argument">ρ</a> <a id="22567" class="Symbol">=</a> <a id="22569" href="/PLFA-zh/Untyped/#3564" class="InductiveConstructor Operator">S_</a><a id="22571" class="Symbol">}</a> <a id="22573" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="22578" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="22587" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="22594" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a> <a id="22597" class="Symbol">(</a><a id="22598" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="22600" href="plfa.Substitution.html#22421" class="Bound">σ₂</a> <a id="22603" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="22605" class="Symbol">(</a><a id="22606" href="plfa.Substitution.html#22417" class="Bound">σ₁</a> <a id="22609" href="plfa.Substitution.html#22414" class="Bound">x</a><a id="22610" class="Symbol">))</a>
     <a id="22618" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
       <a id="22629" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="22636" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a> <a id="22639" class="Symbol">((</a><a id="22641" href="/PLFA-zh/Substitution/#22417" class="Bound">σ₁</a> <a id="22644" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="22646" href="plfa.Substitution.html#22421" class="Bound">σ₂</a><a id="22648" class="Symbol">)</a> <a id="22650" href="plfa.Substitution.html#22414" class="Bound">x</a><a id="22651" class="Symbol">)</a>
     <a id="22658" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">∎</a>
</pre>
<p>The proof proceed by cases on <code class="highlighter-rouge">x</code>.</p>

<ul>
  <li>
    <p>If <code class="highlighter-rouge">x = Z</code>, the two sides are equal by the definition of <code class="highlighter-rouge">exts</code>
and sequencing.</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">x = S x</code>, we unfold the first use of <code class="highlighter-rouge">exts</code> and sequencing, then
apply the lemma <code class="highlighter-rouge">commute-subst-rename</code>. We conclude by the
definition of sequencing.</p>
  </li>
</ul>

<p>Now we come to the proof of <code class="highlighter-rouge">sub-sub</code>, which we explain below.</p>

<pre class="Agda"><a id="sub-sub"></a><a id="23016" href="/PLFA-zh/Substitution/#23016" class="Function">sub-sub</a> <a id="23024" class="Symbol">:</a> <a id="23026" class="Symbol">∀{</a><a id="23028" href="plfa.Substitution.html#23028" class="Bound">Γ</a> <a id="23030" href="plfa.Substitution.html#23030" class="Bound">Δ</a> <a id="23032" href="plfa.Substitution.html#23032" class="Bound">Σ</a><a id="23033" class="Symbol">}{</a><a id="23035" href="plfa.Substitution.html#23035" class="Bound">A</a><a id="23036" class="Symbol">}{</a><a id="23038" href="plfa.Substitution.html#23038" class="Bound">M</a> <a id="23040" class="Symbol">:</a> <a id="23042" href="plfa.Substitution.html#23028" class="Bound">Γ</a> <a id="23044" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="23046" href="plfa.Substitution.html#23035" class="Bound">A</a><a id="23047" class="Symbol">}</a> <a id="23049" class="Symbol">{</a><a id="23050" href="plfa.Substitution.html#23050" class="Bound">σ₁</a> <a id="23053" class="Symbol">:</a> <a id="23055" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="23061" href="plfa.Substitution.html#23028" class="Bound">Γ</a> <a id="23063" href="plfa.Substitution.html#23030" class="Bound">Δ</a><a id="23064" class="Symbol">}{</a><a id="23066" href="plfa.Substitution.html#23066" class="Bound">σ₂</a> <a id="23069" class="Symbol">:</a> <a id="23071" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="23077" href="plfa.Substitution.html#23030" class="Bound">Δ</a> <a id="23079" href="plfa.Substitution.html#23032" class="Bound">Σ</a><a id="23080" class="Symbol">}</a>
            <a id="23094" class="Symbol">→</a> <a id="23096" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="23098" href="plfa.Substitution.html#23066" class="Bound">σ₂</a> <a id="23101" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="23103" class="Symbol">(</a><a id="23104" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="23106" href="plfa.Substitution.html#23050" class="Bound">σ₁</a> <a id="23109" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="23111" href="plfa.Substitution.html#23038" class="Bound">M</a><a id="23112" class="Symbol">)</a> <a id="23114" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="23116" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="23118" href="plfa.Substitution.html#23050" class="Bound">σ₁</a> <a id="23121" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="23123" href="plfa.Substitution.html#23066" class="Bound">σ₂</a> <a id="23126" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="23128" href="plfa.Substitution.html#23038" class="Bound">M</a>
<a id="23130" href="/PLFA-zh/Substitution/#23016" class="Function">sub-sub</a> <a id="23138" class="Symbol">{</a><a id="23139" class="Argument">M</a> <a id="23141" class="Symbol">=</a> <a id="23143" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="23145" href="plfa.Substitution.html#23145" class="Bound">x</a><a id="23146" class="Symbol">}</a> <a id="23148" class="Symbol">=</a> <a id="23150" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="23155" href="/PLFA-zh/Substitution/#23016" class="Function">sub-sub</a> <a id="23163" class="Symbol">{</a><a id="23164" href="plfa.Substitution.html#23164" class="Bound">Γ</a><a id="23165" class="Symbol">}{</a><a id="23167" href="plfa.Substitution.html#23167" class="Bound">Δ</a><a id="23168" class="Symbol">}{</a><a id="23170" href="plfa.Substitution.html#23170" class="Bound">Σ</a><a id="23171" class="Symbol">}{</a><a id="23173" href="plfa.Substitution.html#23173" class="Bound">A</a><a id="23174" class="Symbol">}{</a><a id="23176" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="23178" href="plfa.Substitution.html#23178" class="Bound">N</a><a id="23179" class="Symbol">}{</a><a id="23181" href="plfa.Substitution.html#23181" class="Bound">σ₁</a><a id="23183" class="Symbol">}{</a><a id="23185" href="plfa.Substitution.html#23185" class="Bound">σ₂</a><a id="23187" class="Symbol">}</a> <a id="23189" class="Symbol">=</a>
   <a id="23194" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin</a>
     <a id="23205" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="23207" href="plfa.Substitution.html#23185" class="Bound">σ₂</a> <a id="23210" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="23212" class="Symbol">(</a><a id="23213" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="23215" href="plfa.Substitution.html#23181" class="Bound">σ₁</a> <a id="23218" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="23220" class="Symbol">(</a><a id="23221" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="23223" href="plfa.Substitution.html#23178" class="Bound">N</a><a id="23224" class="Symbol">))</a>
   <a id="23230" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
     <a id="23239" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="23241" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="23243" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="23248" href="plfa.Substitution.html#23185" class="Bound">σ₂</a> <a id="23251" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="23253" class="Symbol">(</a><a id="23254" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="23256" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="23261" href="plfa.Substitution.html#23181" class="Bound">σ₁</a> <a id="23264" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="23266" href="plfa.Substitution.html#23178" class="Bound">N</a><a id="23267" class="Symbol">)</a>
   <a id="23272" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="23275" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="23280" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ_</a> <a id="23283" class="Symbol">(</a><a id="23284" href="/PLFA-zh/Substitution/#23016" class="Function">sub-sub</a><a id="23291" class="Symbol">{</a><a id="23292" class="Argument">M</a> <a id="23294" class="Symbol">=</a> <a id="23296" href="plfa.Substitution.html#23178" class="Bound">N</a><a id="23297" class="Symbol">}{</a><a id="23299" class="Argument">σ₁</a> <a id="23302" class="Symbol">=</a> <a id="23304" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="23309" href="plfa.Substitution.html#23181" class="Bound">σ₁</a><a id="23311" class="Symbol">}{</a><a id="23313" class="Argument">σ₂</a> <a id="23316" class="Symbol">=</a> <a id="23318" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="23323" href="plfa.Substitution.html#23185" class="Bound">σ₂</a><a id="23325" class="Symbol">})</a> <a id="23328" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
     <a id="23335" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="23337" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="23339" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="23344" href="plfa.Substitution.html#23181" class="Bound">σ₁</a> <a id="23347" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="23349" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="23354" href="plfa.Substitution.html#23185" class="Bound">σ₂</a> <a id="23357" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="23359" href="plfa.Substitution.html#23178" class="Bound">N</a>
   <a id="23364" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="23367" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="23372" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ_</a> <a id="23375" class="Symbol">(</a><a id="23376" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a><a id="23384" class="Symbol">{</a><a id="23385" class="Argument">M</a> <a id="23387" class="Symbol">=</a> <a id="23389" href="plfa.Substitution.html#23178" class="Bound">N</a><a id="23390" class="Symbol">}</a> <a id="23392" class="Symbol">(λ</a> <a id="23395" class="Symbol">{</a><a id="23396" href="plfa.Substitution.html#23396" class="Bound">A</a><a id="23397" class="Symbol">}</a> <a id="23399" class="Symbol">→</a> <a id="23401" href="plfa.Substitution.html#22079" class="Function">exts-seq</a><a id="23409" class="Symbol">)</a> <a id="23411" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="23415" class="Symbol">)</a> <a id="23417" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
     <a id="23424" href="/PLFA-zh/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="23426" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="23428" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="23433" class="Symbol">(</a> <a id="23435" href="plfa.Substitution.html#23181" class="Bound">σ₁</a> <a id="23438" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="23440" href="plfa.Substitution.html#23185" class="Bound">σ₂</a><a id="23442" class="Symbol">)</a> <a id="23444" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="23446" href="plfa.Substitution.html#23178" class="Bound">N</a>
   <a id="23451" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">∎</a>
<a id="23453" href="/PLFA-zh/Substitution/#23016" class="Function">sub-sub</a> <a id="23461" class="Symbol">{</a><a id="23462" class="Argument">M</a> <a id="23464" class="Symbol">=</a> <a id="23466" href="plfa.Substitution.html#23466" class="Bound">L</a> <a id="23468" href="/PLFA-zh/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="23470" href="plfa.Substitution.html#23470" class="Bound">M</a><a id="23471" class="Symbol">}</a> <a id="23473" class="Symbol">=</a> <a id="23475" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1436" class="Function">cong₂</a> <a id="23481" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">_·_</a> <a id="23485" class="Symbol">(</a><a id="23486" href="plfa.Substitution.html#23016" class="Function">sub-sub</a><a id="23493" class="Symbol">{</a><a id="23494" class="Argument">M</a> <a id="23496" class="Symbol">=</a> <a id="23498" href="plfa.Substitution.html#23466" class="Bound">L</a><a id="23499" class="Symbol">})</a> <a id="23502" class="Symbol">(</a><a id="23503" href="plfa.Substitution.html#23016" class="Function">sub-sub</a><a id="23510" class="Symbol">{</a><a id="23511" class="Argument">M</a> <a id="23513" class="Symbol">=</a> <a id="23515" href="plfa.Substitution.html#23470" class="Bound">M</a><a id="23516" class="Symbol">})</a>
</pre>
<p>We proceed by induction on the term <code class="highlighter-rouge">M</code>.</p>

<ul>
  <li>
    <p>If <code class="highlighter-rouge">M = x</code>, then both sides are equal to <code class="highlighter-rouge">σ₂ (σ₁ x)</code>.</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">M = ƛ N</code>, we first use the induction hypothesis to show that</p>

    <p>ƛ ⟪ exts σ₂ ⟫ (⟪ exts σ₁ ⟫ N) ≡ ƛ ⟪ exts σ₁ ⨟ exts σ₂ ⟫ N</p>

    <p>and then use the lemma <code class="highlighter-rouge">exts-seq</code> to show</p>

    <p>ƛ ⟪ exts σ₁ ⨟ exts σ₂ ⟫ N ≡ ƛ ⟪ exts ( σ₁ ⨟ σ₂) ⟫ N</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">M</code> is an application, we use the induction hypothesis
for both subterms.</p>
  </li>
</ul>

<p>The following corollary of <code class="highlighter-rouge">sub-sub</code> specializes the first
substitution to a renaming.</p>

<pre class="Agda"><a id="rename-subst"></a><a id="24032" href="/PLFA-zh/Substitution/#24032" class="Function">rename-subst</a> <a id="24045" class="Symbol">:</a> <a id="24047" class="Symbol">∀{</a><a id="24049" href="plfa.Substitution.html#24049" class="Bound">Γ</a> <a id="24051" href="plfa.Substitution.html#24051" class="Bound">Δ</a> <a id="24053" href="plfa.Substitution.html#24053" class="Bound">Δ′</a><a id="24055" class="Symbol">}{</a><a id="24057" href="plfa.Substitution.html#24057" class="Bound">M</a> <a id="24059" class="Symbol">:</a> <a id="24061" href="plfa.Substitution.html#24049" class="Bound">Γ</a> <a id="24063" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="24065" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="24066" class="Symbol">}{</a><a id="24068" href="plfa.Substitution.html#24068" class="Bound">ρ</a> <a id="24070" class="Symbol">:</a> <a id="24072" href="plfa.Substitution.html#2233" class="Function">Rename</a> <a id="24079" href="plfa.Substitution.html#24049" class="Bound">Γ</a> <a id="24081" href="plfa.Substitution.html#24051" class="Bound">Δ</a><a id="24082" class="Symbol">}{</a><a id="24084" href="plfa.Substitution.html#24084" class="Bound">σ</a> <a id="24086" class="Symbol">:</a> <a id="24088" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="24094" href="plfa.Substitution.html#24051" class="Bound">Δ</a> <a id="24096" href="plfa.Substitution.html#24053" class="Bound">Δ′</a><a id="24098" class="Symbol">}</a>
             <a id="24113" class="Symbol">→</a> <a id="24115" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="24117" href="plfa.Substitution.html#24084" class="Bound">σ</a> <a id="24119" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="24121" class="Symbol">(</a><a id="24122" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="24129" href="plfa.Substitution.html#24068" class="Bound">ρ</a> <a id="24131" href="plfa.Substitution.html#24057" class="Bound">M</a><a id="24132" class="Symbol">)</a> <a id="24134" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="24136" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="24138" href="plfa.Substitution.html#24084" class="Bound">σ</a> <a id="24140" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="24142" href="plfa.Substitution.html#24068" class="Bound">ρ</a> <a id="24144" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="24146" href="plfa.Substitution.html#24057" class="Bound">M</a>
<a id="24148" href="/PLFA-zh/Substitution/#24032" class="Function">rename-subst</a> <a id="24161" class="Symbol">{</a><a id="24162" href="plfa.Substitution.html#24162" class="Bound">Γ</a><a id="24163" class="Symbol">}{</a><a id="24165" href="plfa.Substitution.html#24165" class="Bound">Δ</a><a id="24166" class="Symbol">}{</a><a id="24168" href="plfa.Substitution.html#24168" class="Bound">Δ′</a><a id="24170" class="Symbol">}{</a><a id="24172" href="plfa.Substitution.html#24172" class="Bound">M</a><a id="24173" class="Symbol">}{</a><a id="24175" href="plfa.Substitution.html#24175" class="Bound">ρ</a><a id="24176" class="Symbol">}{</a><a id="24178" href="plfa.Substitution.html#24178" class="Bound">σ</a><a id="24179" class="Symbol">}</a> <a id="24181" class="Symbol">=</a>
   <a id="24186" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin</a>
     <a id="24197" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="24199" href="plfa.Substitution.html#24178" class="Bound">σ</a> <a id="24201" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="24203" class="Symbol">(</a><a id="24204" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="24211" href="plfa.Substitution.html#24175" class="Bound">ρ</a> <a id="24213" href="plfa.Substitution.html#24172" class="Bound">M</a><a id="24214" class="Symbol">)</a>
   <a id="24219" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="24222" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="24227" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="24229" href="plfa.Substitution.html#24178" class="Bound">σ</a> <a id="24231" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="24233" class="Symbol">(</a><a id="24234" href="plfa.Substitution.html#13695" class="Function">rename-subst-ren</a><a id="24250" class="Symbol">{</a><a id="24251" class="Argument">M</a> <a id="24253" class="Symbol">=</a> <a id="24255" href="plfa.Substitution.html#24172" class="Bound">M</a><a id="24256" class="Symbol">})</a> <a id="24259" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
     <a id="24266" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="24268" href="plfa.Substitution.html#24178" class="Bound">σ</a> <a id="24270" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="24272" class="Symbol">(</a><a id="24273" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="24275" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="24279" href="plfa.Substitution.html#24175" class="Bound">ρ</a> <a id="24281" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="24283" href="plfa.Substitution.html#24172" class="Bound">M</a><a id="24284" class="Symbol">)</a>
   <a id="24289" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="24292" href="/PLFA-zh/Substitution/#23016" class="Function">sub-sub</a><a id="24299" class="Symbol">{</a><a id="24300" class="Argument">M</a> <a id="24302" class="Symbol">=</a> <a id="24304" href="plfa.Substitution.html#24172" class="Bound">M</a><a id="24305" class="Symbol">}</a> <a id="24307" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
     <a id="24314" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="24316" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="24320" href="plfa.Substitution.html#24175" class="Bound">ρ</a> <a id="24322" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="24324" href="plfa.Substitution.html#24178" class="Bound">σ</a> <a id="24326" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="24328" href="plfa.Substitution.html#24172" class="Bound">M</a>
   <a id="24333" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
     <a id="24342" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="24344" href="plfa.Substitution.html#24178" class="Bound">σ</a> <a id="24346" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="24348" href="plfa.Substitution.html#24175" class="Bound">ρ</a> <a id="24350" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="24352" href="plfa.Substitution.html#24172" class="Bound">M</a>
   <a id="24357" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">∎</a>
</pre>

<h2 id="proof-of-sub-assoc">Proof of sub-assoc</h2>

<p>The proof of <code class="highlighter-rouge">sub-assoc</code> follows directly from <code class="highlighter-rouge">sub-sub</code> and the
definition of sequencing.</p>

<pre class="Agda"><a id="sub-assoc"></a><a id="24484" href="/PLFA-zh/Substitution/#24484" class="Function">sub-assoc</a> <a id="24494" class="Symbol">:</a> <a id="24496" class="Symbol">∀{</a><a id="24498" href="plfa.Substitution.html#24498" class="Bound">Γ</a> <a id="24500" href="plfa.Substitution.html#24500" class="Bound">Δ</a> <a id="24502" href="plfa.Substitution.html#24502" class="Bound">Σ</a> <a id="24504" href="plfa.Substitution.html#24504" class="Bound">Ψ</a> <a id="24506" class="Symbol">:</a> <a id="24508" href="/PLFA-zh/Untyped/#3130" class="Datatype">Context</a><a id="24515" class="Symbol">}</a> <a id="24517" class="Symbol">{</a><a id="24518" href="plfa.Substitution.html#24518" class="Bound">σ</a> <a id="24520" class="Symbol">:</a> <a id="24522" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="24528" href="plfa.Substitution.html#24498" class="Bound">Γ</a> <a id="24530" href="plfa.Substitution.html#24500" class="Bound">Δ</a><a id="24531" class="Symbol">}</a> <a id="24533" class="Symbol">{</a><a id="24534" href="plfa.Substitution.html#24534" class="Bound">τ</a> <a id="24536" class="Symbol">:</a> <a id="24538" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="24544" href="plfa.Substitution.html#24500" class="Bound">Δ</a> <a id="24546" href="plfa.Substitution.html#24502" class="Bound">Σ</a><a id="24547" class="Symbol">}</a>
             <a id="24562" class="Symbol">{</a><a id="24563" href="/PLFA-zh/Substitution/#24563" class="Bound">θ</a> <a id="24565" class="Symbol">:</a> <a id="24567" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="24573" href="plfa.Substitution.html#24502" class="Bound">Σ</a> <a id="24575" href="plfa.Substitution.html#24504" class="Bound">Ψ</a><a id="24576" class="Symbol">}</a>
          <a id="24588" class="Symbol">→</a> <a id="24590" class="Symbol">∀{</a><a id="24592" href="/PLFA-zh/Substitution/#24592" class="Bound">A</a><a id="24593" class="Symbol">}</a> <a id="24595" class="Symbol">→</a> <a id="24597" class="Symbol">(</a><a id="24598" href="plfa.Substitution.html#24518" class="Bound">σ</a> <a id="24600" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="24602" href="plfa.Substitution.html#24534" class="Bound">τ</a><a id="24603" class="Symbol">)</a> <a id="24605" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="24607" href="plfa.Substitution.html#24563" class="Bound">θ</a> <a id="24609" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="24611" class="Symbol">(</a><a id="24612" href="plfa.Substitution.html#24518" class="Bound">σ</a> <a id="24614" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="24616" href="plfa.Substitution.html#24534" class="Bound">τ</a> <a id="24618" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="24620" href="plfa.Substitution.html#24563" class="Bound">θ</a><a id="24621" class="Symbol">)</a> <a id="24623" class="Symbol">{</a><a id="24624" href="plfa.Substitution.html#24592" class="Bound">A</a><a id="24625" class="Symbol">}</a>
<a id="24627" href="/PLFA-zh/Substitution/#24484" class="Function">sub-assoc</a> <a id="24637" class="Symbol">{</a><a id="24638" href="plfa.Substitution.html#24638" class="Bound">Γ</a><a id="24639" class="Symbol">}{</a><a id="24641" href="plfa.Substitution.html#24641" class="Bound">Δ</a><a id="24642" class="Symbol">}{</a><a id="24644" href="plfa.Substitution.html#24644" class="Bound">Σ</a><a id="24645" class="Symbol">}{</a><a id="24647" href="plfa.Substitution.html#24647" class="Bound">Ψ</a><a id="24648" class="Symbol">}{</a><a id="24650" href="plfa.Substitution.html#24650" class="Bound">σ</a><a id="24651" class="Symbol">}{</a><a id="24653" href="plfa.Substitution.html#24653" class="Bound">τ</a><a id="24654" class="Symbol">}{</a><a id="24656" href="plfa.Substitution.html#24656" class="Bound">θ</a><a id="24657" class="Symbol">}{</a><a id="24659" href="plfa.Substitution.html#24659" class="Bound">A</a><a id="24660" class="Symbol">}</a> <a id="24662" class="Symbol">=</a> <a id="24664" href="plfa.Substitution.html#1968" class="Postulate">extensionality</a> <a id="24679" class="Symbol">λ</a> <a id="24681" href="plfa.Substitution.html#24681" class="Bound">x</a> <a id="24683" class="Symbol">→</a> <a id="24685" href="plfa.Substitution.html#24708" class="Function">lemma</a><a id="24690" class="Symbol">{</a><a id="24691" class="Argument">x</a> <a id="24693" class="Symbol">=</a> <a id="24695" href="plfa.Substitution.html#24681" class="Bound">x</a><a id="24696" class="Symbol">}</a>
  <a id="24700" class="Keyword">where</a>
  <a id="24708" href="/PLFA-zh/Substitution/#24708" class="Function">lemma</a> <a id="24714" class="Symbol">:</a> <a id="24716" class="Symbol">∀</a> <a id="24718" class="Symbol">{</a><a id="24719" href="plfa.Substitution.html#24719" class="Bound">x</a> <a id="24721" class="Symbol">:</a> <a id="24723" href="plfa.Substitution.html#24638" class="Bound">Γ</a> <a id="24725" href="/PLFA-zh/Untyped/#3483" class="Datatype Operator">∋</a> <a id="24727" href="plfa.Substitution.html#24659" class="Bound">A</a><a id="24728" class="Symbol">}</a> <a id="24730" class="Symbol">→</a> <a id="24732" class="Symbol">((</a><a id="24734" href="plfa.Substitution.html#24650" class="Bound">σ</a> <a id="24736" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="24738" href="plfa.Substitution.html#24653" class="Bound">τ</a><a id="24739" class="Symbol">)</a> <a id="24741" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="24743" href="plfa.Substitution.html#24656" class="Bound">θ</a><a id="24744" class="Symbol">)</a> <a id="24746" href="plfa.Substitution.html#24719" class="Bound">x</a> <a id="24748" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="24750" class="Symbol">(</a><a id="24751" href="plfa.Substitution.html#24650" class="Bound">σ</a> <a id="24753" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="24755" href="plfa.Substitution.html#24653" class="Bound">τ</a> <a id="24757" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="24759" href="plfa.Substitution.html#24656" class="Bound">θ</a><a id="24760" class="Symbol">)</a> <a id="24762" href="plfa.Substitution.html#24719" class="Bound">x</a>
  <a id="24766" href="/PLFA-zh/Substitution/#24708" class="Function">lemma</a> <a id="24772" class="Symbol">{</a><a id="24773" href="plfa.Substitution.html#24773" class="Bound">x</a><a id="24774" class="Symbol">}</a> <a id="24776" class="Symbol">=</a>
      <a id="24784" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin</a>
        <a id="24798" class="Symbol">((</a><a id="24800" href="/PLFA-zh/Substitution/#24650" class="Bound">σ</a> <a id="24802" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="24804" href="plfa.Substitution.html#24653" class="Bound">τ</a><a id="24805" class="Symbol">)</a> <a id="24807" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="24809" href="plfa.Substitution.html#24656" class="Bound">θ</a><a id="24810" class="Symbol">)</a> <a id="24812" href="plfa.Substitution.html#24773" class="Bound">x</a>
      <a id="24820" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
        <a id="24832" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="24834" href="plfa.Substitution.html#24656" class="Bound">θ</a> <a id="24836" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="24838" class="Symbol">(</a><a id="24839" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="24841" href="plfa.Substitution.html#24653" class="Bound">τ</a> <a id="24843" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="24845" class="Symbol">(</a><a id="24846" href="plfa.Substitution.html#24650" class="Bound">σ</a> <a id="24848" href="plfa.Substitution.html#24773" class="Bound">x</a><a id="24849" class="Symbol">))</a>
      <a id="24858" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="24861" href="/PLFA-zh/Substitution/#23016" class="Function">sub-sub</a><a id="24868" class="Symbol">{</a><a id="24869" class="Argument">M</a> <a id="24871" class="Symbol">=</a> <a id="24873" href="plfa.Substitution.html#24650" class="Bound">σ</a> <a id="24875" href="plfa.Substitution.html#24773" class="Bound">x</a><a id="24876" class="Symbol">}</a> <a id="24878" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
        <a id="24888" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="24890" href="plfa.Substitution.html#24653" class="Bound">τ</a> <a id="24892" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="24894" href="plfa.Substitution.html#24656" class="Bound">θ</a> <a id="24896" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="24898" class="Symbol">(</a><a id="24899" href="plfa.Substitution.html#24650" class="Bound">σ</a> <a id="24901" href="plfa.Substitution.html#24773" class="Bound">x</a><a id="24902" class="Symbol">)</a>
      <a id="24910" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
        <a id="24922" class="Symbol">(</a><a id="24923" href="/PLFA-zh/Substitution/#24650" class="Bound">σ</a> <a id="24925" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="24927" href="plfa.Substitution.html#24653" class="Bound">τ</a> <a id="24929" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="24931" href="plfa.Substitution.html#24656" class="Bound">θ</a><a id="24932" class="Symbol">)</a> <a id="24934" href="plfa.Substitution.html#24773" class="Bound">x</a>
      <a id="24942" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">∎</a>
</pre>
<h2 id="proof-of-subst-zero-exts-cons">Proof of subst-zero-exts-cons</h2>

<p>The last equation we needed to prove <code class="highlighter-rouge">subst-zero-exts-cons</code> was
<code class="highlighter-rouge">sub-assoc</code>, so we can now go ahead with its proof.  We simply apply
the equations for <code class="highlighter-rouge">exts</code> and <code class="highlighter-rouge">subst-zero</code> and then apply the σ algebra
equation to arrive at the normal form <code class="highlighter-rouge">M • σ</code>.</p>

<pre class="Agda"><a id="subst-zero-exts-cons"></a><a id="25239" href="/PLFA-zh/Substitution/#25239" class="Function">subst-zero-exts-cons</a> <a id="25260" class="Symbol">:</a> <a id="25262" class="Symbol">∀{</a><a id="25264" href="plfa.Substitution.html#25264" class="Bound">Γ</a> <a id="25266" href="plfa.Substitution.html#25266" class="Bound">Δ</a><a id="25267" class="Symbol">}{</a><a id="25269" href="plfa.Substitution.html#25269" class="Bound">σ</a> <a id="25271" class="Symbol">:</a> <a id="25273" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="25279" href="plfa.Substitution.html#25264" class="Bound">Γ</a> <a id="25281" href="plfa.Substitution.html#25266" class="Bound">Δ</a><a id="25282" class="Symbol">}{</a><a id="25284" href="plfa.Substitution.html#25284" class="Bound">B</a><a id="25285" class="Symbol">}{</a><a id="25287" href="plfa.Substitution.html#25287" class="Bound">M</a> <a id="25289" class="Symbol">:</a> <a id="25291" href="plfa.Substitution.html#25266" class="Bound">Δ</a> <a id="25293" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="25295" href="plfa.Substitution.html#25284" class="Bound">B</a><a id="25296" class="Symbol">}{</a><a id="25298" href="plfa.Substitution.html#25298" class="Bound">A</a><a id="25299" class="Symbol">}</a>
                     <a id="25322" class="Symbol">→</a> <a id="25324" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="25329" href="/PLFA-zh/Substitution/#25269" class="Bound">σ</a> <a id="25331" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="25333" href="plfa.Untyped.html#7333" class="Function">subst-zero</a> <a id="25344" href="plfa.Substitution.html#25287" class="Bound">M</a> <a id="25346" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="25348" class="Symbol">(</a><a id="25349" href="plfa.Substitution.html#25287" class="Bound">M</a> <a id="25351" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="25353" href="plfa.Substitution.html#25269" class="Bound">σ</a><a id="25354" class="Symbol">)</a> <a id="25356" class="Symbol">{</a><a id="25357" href="plfa.Substitution.html#25298" class="Bound">A</a><a id="25358" class="Symbol">}</a>
<a id="25360" href="/PLFA-zh/Substitution/#25239" class="Function">subst-zero-exts-cons</a> <a id="25381" class="Symbol">{</a><a id="25382" href="plfa.Substitution.html#25382" class="Bound">Γ</a><a id="25383" class="Symbol">}{</a><a id="25385" href="plfa.Substitution.html#25385" class="Bound">Δ</a><a id="25386" class="Symbol">}{</a><a id="25388" href="plfa.Substitution.html#25388" class="Bound">σ</a><a id="25389" class="Symbol">}{</a><a id="25391" href="plfa.Substitution.html#25391" class="Bound">B</a><a id="25392" class="Symbol">}{</a><a id="25394" href="plfa.Substitution.html#25394" class="Bound">M</a><a id="25395" class="Symbol">}{</a><a id="25397" href="plfa.Substitution.html#25397" class="Bound">A</a><a id="25398" class="Symbol">}</a> <a id="25400" class="Symbol">=</a>
    <a id="25406" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin</a>
      <a id="25418" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="25423" href="/PLFA-zh/Substitution/#25388" class="Bound">σ</a> <a id="25425" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="25427" href="plfa.Untyped.html#7333" class="Function">subst-zero</a> <a id="25438" href="plfa.Substitution.html#25394" class="Bound">M</a>
    <a id="25444" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="25447" href="/PLFA-zh/Substitution/#12297" class="Function">cong-seq</a> <a id="25456" href="plfa.Substitution.html#15059" class="Function">exts-cons-shift</a> <a id="25472" href="plfa.Substitution.html#15840" class="Function">subst-Z-cons-ids</a> <a id="25489" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
      <a id="25497" class="Symbol">(</a><a id="25498" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="25500" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a> <a id="25502" href="/PLFA-zh/Substitution/#3468" class="Function Operator">•</a> <a id="25504" class="Symbol">(</a><a id="25505" href="plfa.Substitution.html#25388" class="Bound">σ</a> <a id="25507" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="25509" href="plfa.Substitution.html#3226" class="Function">↑</a><a id="25510" class="Symbol">))</a> <a id="25513" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="25515" class="Symbol">(</a><a id="25516" href="plfa.Substitution.html#25394" class="Bound">M</a> <a id="25518" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="25520" href="plfa.Substitution.html#3087" class="Function">ids</a><a id="25523" class="Symbol">)</a>
    <a id="25529" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="25532" href="/PLFA-zh/Substitution/#9115" class="Function">sub-dist</a> <a id="25541" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
      <a id="25549" class="Symbol">(</a><a id="25550" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="25552" href="plfa.Substitution.html#25394" class="Bound">M</a> <a id="25554" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="25556" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="25560" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="25562" class="Symbol">(</a><a id="25563" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="25565" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="25566" class="Symbol">))</a> <a id="25569" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="25571" class="Symbol">((</a><a id="25573" href="plfa.Substitution.html#25388" class="Bound">σ</a> <a id="25575" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="25577" href="plfa.Substitution.html#3226" class="Function">↑</a><a id="25578" class="Symbol">)</a> <a id="25580" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="25582" class="Symbol">(</a><a id="25583" href="plfa.Substitution.html#25394" class="Bound">M</a> <a id="25585" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="25587" href="plfa.Substitution.html#3087" class="Function">ids</a><a id="25590" class="Symbol">))</a>
    <a id="25597" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="25600" href="/PLFA-zh/Substitution/#11952" class="Function">cong-cons</a> <a id="25610" class="Symbol">(</a><a id="25611" href="plfa.Substitution.html#8300" class="Function">sub-head</a><a id="25619" class="Symbol">{</a><a id="25620" class="Argument">σ</a> <a id="25622" class="Symbol">=</a> <a id="25624" href="plfa.Substitution.html#3087" class="Function">ids</a><a id="25627" class="Symbol">})</a> <a id="25630" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="25635" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
      <a id="25643" href="/PLFA-zh/Substitution/#25394" class="Bound">M</a> <a id="25645" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="25647" class="Symbol">((</a><a id="25649" href="plfa.Substitution.html#25388" class="Bound">σ</a> <a id="25651" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="25653" href="plfa.Substitution.html#3226" class="Function">↑</a><a id="25654" class="Symbol">)</a> <a id="25656" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="25658" class="Symbol">(</a><a id="25659" href="plfa.Substitution.html#25394" class="Bound">M</a> <a id="25661" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="25663" href="plfa.Substitution.html#3087" class="Function">ids</a><a id="25666" class="Symbol">))</a>
    <a id="25673" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="25676" href="/PLFA-zh/Substitution/#11952" class="Function">cong-cons</a> <a id="25686" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="25691" class="Symbol">(</a><a id="25692" href="plfa.Substitution.html#24484" class="Function">sub-assoc</a><a id="25701" class="Symbol">{</a><a id="25702" class="Argument">σ</a> <a id="25704" class="Symbol">=</a> <a id="25706" href="plfa.Substitution.html#25388" class="Bound">σ</a><a id="25707" class="Symbol">})</a> <a id="25710" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
      <a id="25718" href="/PLFA-zh/Substitution/#25394" class="Bound">M</a> <a id="25720" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="25722" class="Symbol">(</a><a id="25723" href="plfa.Substitution.html#25388" class="Bound">σ</a> <a id="25725" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="25727" class="Symbol">(</a><a id="25728" href="plfa.Substitution.html#3226" class="Function">↑</a> <a id="25730" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="25732" class="Symbol">(</a><a id="25733" href="plfa.Substitution.html#25394" class="Bound">M</a> <a id="25735" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="25737" href="plfa.Substitution.html#3087" class="Function">ids</a><a id="25740" class="Symbol">)))</a>
    <a id="25748" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="25751" href="/PLFA-zh/Substitution/#11952" class="Function">cong-cons</a> <a id="25761" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="25766" class="Symbol">(</a><a id="25767" href="plfa.Substitution.html#12297" class="Function">cong-seq</a><a id="25775" class="Symbol">{</a><a id="25776" class="Argument">σ</a> <a id="25778" class="Symbol">=</a> <a id="25780" href="plfa.Substitution.html#25388" class="Bound">σ</a><a id="25781" class="Symbol">}</a> <a id="25783" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="25788" class="Symbol">(</a><a id="25789" href="plfa.Substitution.html#8406" class="Function">sub-tail</a><a id="25797" class="Symbol">{</a><a id="25798" class="Argument">M</a> <a id="25800" class="Symbol">=</a> <a id="25802" href="plfa.Substitution.html#25394" class="Bound">M</a><a id="25803" class="Symbol">}{</a><a id="25805" class="Argument">σ</a> <a id="25807" class="Symbol">=</a> <a id="25809" href="plfa.Substitution.html#3087" class="Function">ids</a><a id="25812" class="Symbol">}))</a> <a id="25816" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
      <a id="25824" href="/PLFA-zh/Substitution/#25394" class="Bound">M</a> <a id="25826" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="25828" class="Symbol">(</a><a id="25829" href="plfa.Substitution.html#25388" class="Bound">σ</a> <a id="25831" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="25833" href="plfa.Substitution.html#3087" class="Function">ids</a><a id="25836" class="Symbol">)</a>
    <a id="25842" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="25845" href="/PLFA-zh/Substitution/#11952" class="Function">cong-cons</a> <a id="25855" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="25860" class="Symbol">(</a><a id="25861" href="plfa.Substitution.html#17705" class="Function">sub-idR</a><a id="25868" class="Symbol">{</a><a id="25869" class="Argument">σ</a> <a id="25871" class="Symbol">=</a> <a id="25873" href="plfa.Substitution.html#25388" class="Bound">σ</a><a id="25874" class="Symbol">})</a> <a id="25877" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
      <a id="25885" href="/PLFA-zh/Substitution/#25394" class="Bound">M</a> <a id="25887" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="25889" href="plfa.Substitution.html#25388" class="Bound">σ</a>
    <a id="25895" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">∎</a>
</pre>

<h2 id="proof-of-the-substitution-lemma">Proof of the substitution lemma</h2>

<p>We first prove the generalized form of the substitution lemma, showing
that a substitution <code class="highlighter-rouge">σ</code> commutes with the substitution of <code class="highlighter-rouge">M</code> into
<code class="highlighter-rouge">N</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>⟪ exts σ ⟫ N [ ⟪ σ ⟫ M ] ≡ ⟪ σ ⟫ (N [ M ])
</code></pre></div></div>

<p>This proof is where the σ algebra pays off.  The proof is by direct
equational reasoning. Starting with the left-hand side, we apply σ
algebra equations, oriented left-to-right, until we arrive at the
normal form</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>⟪ ⟪ σ ⟫ M • σ ⟫ N
</code></pre></div></div>

<p>We then do the same with the right-hand side, arriving at the same
normal form.</p>

<pre class="Agda"><a id="subst-commute"></a><a id="26453" href="/PLFA-zh/Substitution/#26453" class="Function">subst-commute</a> <a id="26467" class="Symbol">:</a> <a id="26469" class="Symbol">∀{</a><a id="26471" href="plfa.Substitution.html#26471" class="Bound">Γ</a> <a id="26473" href="plfa.Substitution.html#26473" class="Bound">Δ</a><a id="26474" class="Symbol">}{</a><a id="26476" href="plfa.Substitution.html#26476" class="Bound">N</a> <a id="26478" class="Symbol">:</a> <a id="26480" href="plfa.Substitution.html#26471" class="Bound">Γ</a> <a id="26482" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="26484" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="26486" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="26488" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="26489" class="Symbol">}{</a><a id="26491" href="plfa.Substitution.html#26491" class="Bound">M</a> <a id="26493" class="Symbol">:</a> <a id="26495" href="plfa.Substitution.html#26471" class="Bound">Γ</a> <a id="26497" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="26499" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="26500" class="Symbol">}{</a><a id="26502" href="plfa.Substitution.html#26502" class="Bound">σ</a> <a id="26504" class="Symbol">:</a> <a id="26506" href="plfa.Substitution.html#2446" class="Function">Subst</a> <a id="26512" href="plfa.Substitution.html#26471" class="Bound">Γ</a> <a id="26514" href="plfa.Substitution.html#26473" class="Bound">Δ</a> <a id="26516" class="Symbol">}</a>
    <a id="26522" class="Symbol">→</a> <a id="26524" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="26526" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="26531" href="plfa.Substitution.html#26502" class="Bound">σ</a> <a id="26533" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="26535" href="plfa.Substitution.html#26476" class="Bound">N</a> <a id="26537" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="26539" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="26541" href="plfa.Substitution.html#26502" class="Bound">σ</a> <a id="26543" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="26545" href="plfa.Substitution.html#26491" class="Bound">M</a> <a id="26547" href="plfa.Untyped.html#7449" class="Function Operator">]</a> <a id="26549" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="26551" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="26553" href="plfa.Substitution.html#26502" class="Bound">σ</a> <a id="26555" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="26557" class="Symbol">(</a><a id="26558" href="plfa.Substitution.html#26476" class="Bound">N</a> <a id="26560" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="26562" href="plfa.Substitution.html#26491" class="Bound">M</a> <a id="26564" href="plfa.Untyped.html#7449" class="Function Operator">]</a><a id="26565" class="Symbol">)</a>
<a id="26567" href="/PLFA-zh/Substitution/#26453" class="Function">subst-commute</a> <a id="26581" class="Symbol">{</a><a id="26582" href="plfa.Substitution.html#26582" class="Bound">Γ</a><a id="26583" class="Symbol">}{</a><a id="26585" href="plfa.Substitution.html#26585" class="Bound">Δ</a><a id="26586" class="Symbol">}{</a><a id="26588" href="plfa.Substitution.html#26588" class="Bound">N</a><a id="26589" class="Symbol">}{</a><a id="26591" href="plfa.Substitution.html#26591" class="Bound">M</a><a id="26592" class="Symbol">}{</a><a id="26594" href="plfa.Substitution.html#26594" class="Bound">σ</a><a id="26595" class="Symbol">}</a> <a id="26597" class="Symbol">=</a>
     <a id="26604" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin</a>
       <a id="26617" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="26619" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="26624" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="26626" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="26628" href="plfa.Substitution.html#26588" class="Bound">N</a> <a id="26630" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="26632" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="26634" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="26636" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="26638" href="plfa.Substitution.html#26591" class="Bound">M</a> <a id="26640" href="plfa.Untyped.html#7449" class="Function Operator">]</a>
     <a id="26647" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
       <a id="26658" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="26660" href="/PLFA-zh/Untyped/#7333" class="Function">subst-zero</a> <a id="26671" class="Symbol">(</a><a id="26672" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="26674" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="26676" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="26678" href="plfa.Substitution.html#26591" class="Bound">M</a><a id="26679" class="Symbol">)</a> <a id="26681" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="26683" class="Symbol">(</a><a id="26684" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="26686" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="26691" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="26693" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="26695" href="plfa.Substitution.html#26588" class="Bound">N</a><a id="26696" class="Symbol">)</a>
     <a id="26703" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="26706" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a> <a id="26715" class="Symbol">{</a><a id="26716" class="Argument">M</a> <a id="26718" class="Symbol">=</a> <a id="26720" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="26722" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="26727" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="26729" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="26731" href="plfa.Substitution.html#26588" class="Bound">N</a><a id="26732" class="Symbol">}</a> <a id="26734" href="plfa.Substitution.html#15840" class="Function">subst-Z-cons-ids</a> <a id="26751" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="26756" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="26765" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="26767" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="26769" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="26771" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="26773" href="plfa.Substitution.html#26591" class="Bound">M</a> <a id="26775" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="26777" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="26781" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="26783" class="Symbol">(</a><a id="26784" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="26786" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="26791" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="26793" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="26795" href="plfa.Substitution.html#26588" class="Bound">N</a><a id="26796" class="Symbol">)</a>
     <a id="26803" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="26806" href="/PLFA-zh/Substitution/#23016" class="Function">sub-sub</a> <a id="26814" class="Symbol">{</a><a id="26815" class="Argument">M</a> <a id="26817" class="Symbol">=</a> <a id="26819" href="plfa.Substitution.html#26588" class="Bound">N</a><a id="26820" class="Symbol">}</a> <a id="26822" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="26831" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="26833" class="Symbol">(</a><a id="26834" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="26839" href="plfa.Substitution.html#26594" class="Bound">σ</a><a id="26840" class="Symbol">)</a> <a id="26842" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="26844" class="Symbol">((</a><a id="26846" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="26848" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="26850" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="26852" href="plfa.Substitution.html#26591" class="Bound">M</a><a id="26853" class="Symbol">)</a> <a id="26855" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="26857" href="plfa.Substitution.html#3087" class="Function">ids</a><a id="26860" class="Symbol">)</a> <a id="26862" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="26864" href="plfa.Substitution.html#26588" class="Bound">N</a>
     <a id="26871" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="26874" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a> <a id="26883" class="Symbol">{</a><a id="26884" class="Argument">M</a> <a id="26886" class="Symbol">=</a> <a id="26888" href="plfa.Substitution.html#26588" class="Bound">N</a><a id="26889" class="Symbol">}</a> <a id="26891" class="Symbol">(</a><a id="26892" href="plfa.Substitution.html#12297" class="Function">cong-seq</a> <a id="26901" href="plfa.Substitution.html#15059" class="Function">exts-cons-shift</a> <a id="26917" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="26921" class="Symbol">)</a> <a id="26923" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="26928" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="26937" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="26939" class="Symbol">(</a><a id="26940" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="26942" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a> <a id="26944" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="26946" class="Symbol">(</a><a id="26947" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="26949" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="26951" href="plfa.Substitution.html#3226" class="Function">↑</a><a id="26952" class="Symbol">))</a> <a id="26955" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="26957" class="Symbol">(</a><a id="26958" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="26960" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="26962" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="26964" href="plfa.Substitution.html#26591" class="Bound">M</a> <a id="26966" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="26968" href="plfa.Substitution.html#3087" class="Function">ids</a><a id="26971" class="Symbol">)</a> <a id="26973" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="26975" href="plfa.Substitution.html#26588" class="Bound">N</a>
     <a id="26982" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="26985" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a> <a id="26994" class="Symbol">{</a><a id="26995" class="Argument">M</a> <a id="26997" class="Symbol">=</a> <a id="26999" href="plfa.Substitution.html#26588" class="Bound">N</a><a id="27000" class="Symbol">}</a> <a id="27002" class="Symbol">(</a><a id="27003" href="plfa.Substitution.html#9115" class="Function">sub-dist</a> <a id="27012" class="Symbol">{</a><a id="27013" class="Argument">M</a> <a id="27015" class="Symbol">=</a> <a id="27017" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="27019" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="27020" class="Symbol">})</a> <a id="27023" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="27028" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="27037" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="27039" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="27041" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="27043" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27045" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27047" href="plfa.Substitution.html#26591" class="Bound">M</a> <a id="27049" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="27051" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="27055" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27057" class="Symbol">(</a><a id="27058" href="/PLFA-zh/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="27060" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="27061" class="Symbol">)</a> <a id="27063" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="27065" class="Symbol">((</a><a id="27067" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27069" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="27071" href="plfa.Substitution.html#3226" class="Function">↑</a><a id="27072" class="Symbol">)</a> <a id="27074" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="27076" class="Symbol">(</a><a id="27077" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="27079" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27081" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27083" href="plfa.Substitution.html#26591" class="Bound">M</a> <a id="27085" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="27087" href="plfa.Substitution.html#3087" class="Function">ids</a><a id="27090" class="Symbol">))</a> <a id="27093" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27095" href="plfa.Substitution.html#26588" class="Bound">N</a>
     <a id="27102" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2655" class="Function Operator">≡⟨⟩</a>
       <a id="27113" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="27115" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="27117" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27119" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27121" href="plfa.Substitution.html#26591" class="Bound">M</a> <a id="27123" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="27125" class="Symbol">((</a><a id="27127" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27129" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="27131" href="plfa.Substitution.html#3226" class="Function">↑</a><a id="27132" class="Symbol">)</a> <a id="27134" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="27136" class="Symbol">(</a><a id="27137" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="27139" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27141" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27143" href="plfa.Substitution.html#26591" class="Bound">M</a> <a id="27145" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="27147" href="plfa.Substitution.html#3087" class="Function">ids</a><a id="27150" class="Symbol">))</a> <a id="27153" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27155" href="plfa.Substitution.html#26588" class="Bound">N</a>
     <a id="27162" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="27165" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a><a id="27173" class="Symbol">{</a><a id="27174" class="Argument">M</a> <a id="27176" class="Symbol">=</a> <a id="27178" href="plfa.Substitution.html#26588" class="Bound">N</a><a id="27179" class="Symbol">}</a> <a id="27181" class="Symbol">(</a><a id="27182" href="plfa.Substitution.html#11952" class="Function">cong-cons</a> <a id="27192" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="27197" class="Symbol">(</a><a id="27198" href="plfa.Substitution.html#24484" class="Function">sub-assoc</a><a id="27207" class="Symbol">{</a><a id="27208" class="Argument">σ</a> <a id="27210" class="Symbol">=</a> <a id="27212" href="plfa.Substitution.html#26594" class="Bound">σ</a><a id="27213" class="Symbol">}))</a> <a id="27217" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="27222" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="27231" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="27233" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="27235" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27237" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27239" href="plfa.Substitution.html#26591" class="Bound">M</a> <a id="27241" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="27243" class="Symbol">(</a><a id="27244" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27246" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="27248" href="plfa.Substitution.html#3226" class="Function">↑</a> <a id="27250" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="27252" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="27254" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27256" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27258" href="plfa.Substitution.html#26591" class="Bound">M</a> <a id="27260" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="27262" href="plfa.Substitution.html#3087" class="Function">ids</a><a id="27265" class="Symbol">)</a> <a id="27267" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27269" href="plfa.Substitution.html#26588" class="Bound">N</a>
     <a id="27276" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="27279" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a><a id="27287" class="Symbol">{</a><a id="27288" class="Argument">M</a> <a id="27290" class="Symbol">=</a> <a id="27292" href="plfa.Substitution.html#26588" class="Bound">N</a><a id="27293" class="Symbol">}</a> <a id="27295" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="27300" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="27305" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="27314" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="27316" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="27318" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27320" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27322" href="plfa.Substitution.html#26591" class="Bound">M</a> <a id="27324" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="27326" class="Symbol">(</a><a id="27327" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27329" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="27331" href="plfa.Substitution.html#3087" class="Function">ids</a><a id="27334" class="Symbol">)</a> <a id="27336" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27338" href="plfa.Substitution.html#26588" class="Bound">N</a>
     <a id="27345" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="27348" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a><a id="27356" class="Symbol">{</a><a id="27357" class="Argument">M</a> <a id="27359" class="Symbol">=</a> <a id="27361" href="plfa.Substitution.html#26588" class="Bound">N</a><a id="27362" class="Symbol">}</a> <a id="27364" class="Symbol">(</a><a id="27365" href="plfa.Substitution.html#11952" class="Function">cong-cons</a> <a id="27375" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="27380" class="Symbol">(</a><a id="27381" href="plfa.Substitution.html#17705" class="Function">sub-idR</a><a id="27388" class="Symbol">{</a><a id="27389" class="Argument">σ</a> <a id="27391" class="Symbol">=</a> <a id="27393" href="plfa.Substitution.html#26594" class="Bound">σ</a><a id="27394" class="Symbol">}))</a> <a id="27398" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="27403" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="27412" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="27414" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="27416" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27418" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27420" href="plfa.Substitution.html#26591" class="Bound">M</a> <a id="27422" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="27424" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27426" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27428" href="plfa.Substitution.html#26588" class="Bound">N</a>
     <a id="27435" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="27438" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a><a id="27446" class="Symbol">{</a><a id="27447" class="Argument">M</a> <a id="27449" class="Symbol">=</a> <a id="27451" href="plfa.Substitution.html#26588" class="Bound">N</a><a id="27452" class="Symbol">}</a> <a id="27454" class="Symbol">(</a><a id="27455" href="plfa.Substitution.html#11952" class="Function">cong-cons</a> <a id="27465" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="27470" class="Symbol">(</a><a id="27471" href="plfa.Substitution.html#9008" class="Function">sub-idL</a><a id="27478" class="Symbol">{</a><a id="27479" class="Argument">σ</a> <a id="27481" class="Symbol">=</a> <a id="27483" href="plfa.Substitution.html#26594" class="Bound">σ</a><a id="27484" class="Symbol">}))</a> <a id="27488" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="27493" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="27502" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="27504" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="27506" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27508" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27510" href="plfa.Substitution.html#26591" class="Bound">M</a> <a id="27512" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="27514" class="Symbol">(</a><a id="27515" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="27519" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="27521" href="plfa.Substitution.html#26594" class="Bound">σ</a><a id="27522" class="Symbol">)</a> <a id="27524" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27526" href="plfa.Substitution.html#26588" class="Bound">N</a>
     <a id="27533" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="27536" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a><a id="27544" class="Symbol">{</a><a id="27545" class="Argument">M</a> <a id="27547" class="Symbol">=</a> <a id="27549" href="plfa.Substitution.html#26588" class="Bound">N</a><a id="27550" class="Symbol">}</a> <a id="27552" class="Symbol">(</a><a id="27553" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="27557" href="plfa.Substitution.html#9115" class="Function">sub-dist</a><a id="27565" class="Symbol">)</a> <a id="27567" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="27572" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="27581" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="27583" href="plfa.Substitution.html#26591" class="Bound">M</a> <a id="27585" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="27587" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="27591" href="plfa.Substitution.html#3801" class="Function Operator">⨟</a> <a id="27593" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27595" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27597" href="plfa.Substitution.html#26588" class="Bound">N</a>
     <a id="27604" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="27607" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="27611" class="Symbol">(</a><a id="27612" href="/PLFA-zh/Substitution/#23016" class="Function">sub-sub</a><a id="27619" class="Symbol">{</a><a id="27620" class="Argument">M</a> <a id="27622" class="Symbol">=</a> <a id="27624" href="plfa.Substitution.html#26588" class="Bound">N</a><a id="27625" class="Symbol">})</a> <a id="27628" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="27637" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="27639" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27641" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27643" class="Symbol">(</a><a id="27644" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="27646" href="plfa.Substitution.html#26591" class="Bound">M</a> <a id="27648" href="plfa.Substitution.html#3468" class="Function Operator">•</a> <a id="27650" href="plfa.Substitution.html#3087" class="Function">ids</a> <a id="27654" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27656" href="plfa.Substitution.html#26588" class="Bound">N</a><a id="27657" class="Symbol">)</a>
     <a id="27664" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="27667" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="27672" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="27674" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27676" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27678" class="Symbol">(</a><a id="27679" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="27683" class="Symbol">(</a><a id="27684" href="plfa.Substitution.html#11213" class="Function">cong-sub</a><a id="27692" class="Symbol">{</a><a id="27693" class="Argument">M</a> <a id="27695" class="Symbol">=</a> <a id="27697" href="plfa.Substitution.html#26588" class="Bound">N</a><a id="27698" class="Symbol">}</a> <a id="27700" href="plfa.Substitution.html#15840" class="Function">subst-Z-cons-ids</a> <a id="27717" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="27721" class="Symbol">))</a> <a id="27724" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="27733" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="27735" href="plfa.Substitution.html#26594" class="Bound">σ</a> <a id="27737" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="27739" class="Symbol">(</a><a id="27740" href="plfa.Substitution.html#26588" class="Bound">N</a> <a id="27742" href="/PLFA-zh/Untyped/#7449" class="Function Operator">[</a> <a id="27744" href="plfa.Substitution.html#26591" class="Bound">M</a> <a id="27746" href="plfa.Untyped.html#7449" class="Function Operator">]</a><a id="27747" class="Symbol">)</a>
     <a id="27754" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">∎</a>
</pre>
<p>A corollary of <code class="highlighter-rouge">subst-commute</code> is that <code class="highlighter-rouge">rename</code> also commutes with
substitution. In the proof below, we first exchange <code class="highlighter-rouge">rename ρ</code> for
the substitution <code class="highlighter-rouge">⟪ ren ρ ⟫</code>, and apply <code class="highlighter-rouge">subst-commute</code>, and
then convert back to <code class="highlighter-rouge">rename ρ</code>.</p>

<pre class="Agda"><a id="rename-subst-commute"></a><a id="27994" href="/PLFA-zh/Substitution/#27994" class="Function">rename-subst-commute</a> <a id="28015" class="Symbol">:</a> <a id="28017" class="Symbol">∀{</a><a id="28019" href="plfa.Substitution.html#28019" class="Bound">Γ</a> <a id="28021" href="plfa.Substitution.html#28021" class="Bound">Δ</a><a id="28022" class="Symbol">}{</a><a id="28024" href="plfa.Substitution.html#28024" class="Bound">N</a> <a id="28026" class="Symbol">:</a> <a id="28028" href="plfa.Substitution.html#28019" class="Bound">Γ</a> <a id="28030" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="28032" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="28034" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="28036" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="28037" class="Symbol">}{</a><a id="28039" href="plfa.Substitution.html#28039" class="Bound">M</a> <a id="28041" class="Symbol">:</a> <a id="28043" href="plfa.Substitution.html#28019" class="Bound">Γ</a> <a id="28045" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="28047" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="28048" class="Symbol">}{</a><a id="28050" href="plfa.Substitution.html#28050" class="Bound">ρ</a> <a id="28052" class="Symbol">:</a> <a id="28054" href="plfa.Substitution.html#2233" class="Function">Rename</a> <a id="28061" href="plfa.Substitution.html#28019" class="Bound">Γ</a> <a id="28063" href="plfa.Substitution.html#28021" class="Bound">Δ</a> <a id="28065" class="Symbol">}</a>
    <a id="28071" class="Symbol">→</a> <a id="28073" class="Symbol">(</a><a id="28074" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="28081" class="Symbol">(</a><a id="28082" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="28086" href="/PLFA-zh/Substitution/#28050" class="Bound">ρ</a><a id="28087" class="Symbol">)</a> <a id="28089" href="plfa.Substitution.html#28024" class="Bound">N</a><a id="28090" class="Symbol">)</a> <a id="28092" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="28094" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="28101" href="plfa.Substitution.html#28050" class="Bound">ρ</a> <a id="28103" href="plfa.Substitution.html#28039" class="Bound">M</a> <a id="28105" href="plfa.Untyped.html#7449" class="Function Operator">]</a> <a id="28107" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="28109" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="28116" href="plfa.Substitution.html#28050" class="Bound">ρ</a> <a id="28118" class="Symbol">(</a><a id="28119" href="plfa.Substitution.html#28024" class="Bound">N</a> <a id="28121" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="28123" href="plfa.Substitution.html#28039" class="Bound">M</a> <a id="28125" href="plfa.Untyped.html#7449" class="Function Operator">]</a><a id="28126" class="Symbol">)</a>
<a id="28128" href="/PLFA-zh/Substitution/#27994" class="Function">rename-subst-commute</a> <a id="28149" class="Symbol">{</a><a id="28150" href="plfa.Substitution.html#28150" class="Bound">Γ</a><a id="28151" class="Symbol">}{</a><a id="28153" href="plfa.Substitution.html#28153" class="Bound">Δ</a><a id="28154" class="Symbol">}{</a><a id="28156" href="plfa.Substitution.html#28156" class="Bound">N</a><a id="28157" class="Symbol">}{</a><a id="28159" href="plfa.Substitution.html#28159" class="Bound">M</a><a id="28160" class="Symbol">}{</a><a id="28162" href="plfa.Substitution.html#28162" class="Bound">ρ</a><a id="28163" class="Symbol">}</a> <a id="28165" class="Symbol">=</a>
     <a id="28172" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2597" class="Function Operator">begin</a>
       <a id="28185" class="Symbol">(</a><a id="28186" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="28193" class="Symbol">(</a><a id="28194" href="plfa.Untyped.html#5883" class="Function">ext</a> <a id="28198" href="/PLFA-zh/Substitution/#28162" class="Bound">ρ</a><a id="28199" class="Symbol">)</a> <a id="28201" href="plfa.Substitution.html#28156" class="Bound">N</a><a id="28202" class="Symbol">)</a> <a id="28204" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="28206" href="plfa.Untyped.html#6193" class="Function">rename</a> <a id="28213" href="plfa.Substitution.html#28162" class="Bound">ρ</a> <a id="28215" href="plfa.Substitution.html#28159" class="Bound">M</a> <a id="28217" href="plfa.Untyped.html#7449" class="Function Operator">]</a>
     <a id="28224" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="28227" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a> <a id="28236" class="Symbol">(</a><a id="28237" href="plfa.Substitution.html#11701" class="Function">cong-sub-zero</a> <a id="28251" class="Symbol">(</a><a id="28252" href="plfa.Substitution.html#13695" class="Function">rename-subst-ren</a><a id="28268" class="Symbol">{</a><a id="28269" class="Argument">M</a> <a id="28271" class="Symbol">=</a> <a id="28273" href="plfa.Substitution.html#28159" class="Bound">M</a><a id="28274" class="Symbol">}))</a>
                 <a id="28295" class="Symbol">(</a><a id="28296" href="/PLFA-zh/Substitution/#13695" class="Function">rename-subst-ren</a><a id="28312" class="Symbol">{</a><a id="28313" class="Argument">M</a> <a id="28315" class="Symbol">=</a> <a id="28317" href="plfa.Substitution.html#28156" class="Bound">N</a><a id="28318" class="Symbol">})</a> <a id="28321" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="28330" class="Symbol">(</a><a id="28331" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="28333" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="28337" class="Symbol">(</a><a id="28338" href="/PLFA-zh/Untyped/#5883" class="Function">ext</a> <a id="28342" href="plfa.Substitution.html#28162" class="Bound">ρ</a><a id="28343" class="Symbol">)</a> <a id="28345" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="28347" href="plfa.Substitution.html#28156" class="Bound">N</a><a id="28348" class="Symbol">)</a> <a id="28350" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="28352" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="28354" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="28358" href="plfa.Substitution.html#28162" class="Bound">ρ</a> <a id="28360" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="28362" href="plfa.Substitution.html#28159" class="Bound">M</a> <a id="28364" href="plfa.Untyped.html#7449" class="Function Operator">]</a>
     <a id="28371" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="28374" href="/PLFA-zh/Substitution/#11213" class="Function">cong-sub</a> <a id="28383" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="28388" class="Symbol">(</a><a id="28389" href="plfa.Substitution.html#11213" class="Function">cong-sub</a><a id="28397" class="Symbol">{</a><a id="28398" class="Argument">M</a> <a id="28400" class="Symbol">=</a> <a id="28402" href="plfa.Substitution.html#28156" class="Bound">N</a><a id="28403" class="Symbol">}</a> <a id="28405" href="plfa.Substitution.html#13326" class="Function">ren-ext</a> <a id="28413" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="28417" class="Symbol">)</a> <a id="28419" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="28428" class="Symbol">(</a><a id="28429" href="/PLFA-zh/Substitution/#2587" class="Function Operator">⟪</a> <a id="28431" href="/PLFA-zh/Untyped/#6629" class="Function">exts</a> <a id="28436" class="Symbol">(</a><a id="28437" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="28441" href="plfa.Substitution.html#28162" class="Bound">ρ</a><a id="28442" class="Symbol">)</a> <a id="28444" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="28446" href="plfa.Substitution.html#28156" class="Bound">N</a><a id="28447" class="Symbol">)</a> <a id="28449" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="28451" href="plfa.Substitution.html#2587" class="Function Operator">⟪</a> <a id="28453" href="plfa.Substitution.html#6539" class="Function">ren</a> <a id="28457" href="plfa.Substitution.html#28162" class="Bound">ρ</a> <a id="28459" href="plfa.Substitution.html#2587" class="Function Operator">⟫</a> <a id="28461" href="plfa.Substitution.html#28159" class="Bound">M</a> <a id="28463" href="plfa.Untyped.html#7449" class="Function Operator">]</a>
     <a id="28470" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="28473" href="/PLFA-zh/Substitution/#26453" class="Function">subst-commute</a><a id="28486" class="Symbol">{</a><a id="28487" class="Argument">N</a> <a id="28489" class="Symbol">=</a> <a id="28491" href="plfa.Substitution.html#28156" class="Bound">N</a><a id="28492" class="Symbol">}</a> <a id="28494" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="28503" href="/PLFA-zh/Untyped/#6921" class="Function">subst</a> <a id="28509" class="Symbol">(</a><a id="28510" href="/PLFA-zh/Substitution/#6539" class="Function">ren</a> <a id="28514" href="plfa.Substitution.html#28162" class="Bound">ρ</a><a id="28515" class="Symbol">)</a> <a id="28517" class="Symbol">(</a><a id="28518" href="plfa.Substitution.html#28156" class="Bound">N</a> <a id="28520" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="28522" href="plfa.Substitution.html#28159" class="Bound">M</a> <a id="28524" href="plfa.Untyped.html#7449" class="Function Operator">]</a><a id="28525" class="Symbol">)</a>
     <a id="28532" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">≡⟨</a> <a id="28535" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="28539" class="Symbol">(</a><a id="28540" href="/PLFA-zh/Substitution/#13695" class="Function">rename-subst-ren</a><a id="28556" class="Symbol">)</a> <a id="28558" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2714" class="Function Operator">⟩</a>
       <a id="28567" href="/PLFA-zh/Untyped/#6193" class="Function">rename</a> <a id="28574" href="/PLFA-zh/Substitution/#28162" class="Bound">ρ</a> <a id="28576" class="Symbol">(</a><a id="28577" href="plfa.Substitution.html#28156" class="Bound">N</a> <a id="28579" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="28581" href="plfa.Substitution.html#28159" class="Bound">M</a> <a id="28583" href="plfa.Untyped.html#7449" class="Function Operator">]</a><a id="28584" class="Symbol">)</a>
     <a id="28591" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#2892" class="Function Operator">∎</a>
</pre>
<p>To present the substitution lemma, we introduce the following notation
for substituting a term <code class="highlighter-rouge">M</code> for index 1 within term <code class="highlighter-rouge">N</code>.</p>

<pre class="Agda"><a id="_〔_〕"></a><a id="28731" href="/PLFA-zh/Substitution/#28731" class="Function Operator">_〔_〕</a> <a id="28736" class="Symbol">:</a> <a id="28738" class="Symbol">∀</a> <a id="28740" class="Symbol">{</a><a id="28741" href="plfa.Substitution.html#28741" class="Bound">Γ</a> <a id="28743" href="plfa.Substitution.html#28743" class="Bound">A</a> <a id="28745" href="plfa.Substitution.html#28745" class="Bound">B</a> <a id="28747" href="plfa.Substitution.html#28747" class="Bound">C</a><a id="28748" class="Symbol">}</a>
        <a id="28758" class="Symbol">→</a> <a id="28760" href="/PLFA-zh/Substitution/#28741" class="Bound">Γ</a> <a id="28762" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="28764" href="plfa.Substitution.html#28745" class="Bound">B</a> <a id="28766" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="28768" href="plfa.Substitution.html#28747" class="Bound">C</a> <a id="28770" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="28772" href="plfa.Substitution.html#28743" class="Bound">A</a>
        <a id="28782" class="Symbol">→</a> <a id="28784" href="/PLFA-zh/Substitution/#28741" class="Bound">Γ</a> <a id="28786" href="/PLFA-zh/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="28788" href="plfa.Substitution.html#28745" class="Bound">B</a>
          <a id="28800" class="Comment">---------</a>
        <a id="28818" class="Symbol">→</a> <a id="28820" href="/PLFA-zh/Substitution/#28741" class="Bound">Γ</a> <a id="28822" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="28824" href="plfa.Substitution.html#28747" class="Bound">C</a> <a id="28826" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="28828" href="plfa.Substitution.html#28743" class="Bound">A</a>
<a id="28830" href="/PLFA-zh/Substitution/#28731" class="Function Operator">_〔_〕</a> <a id="28835" class="Symbol">{</a><a id="28836" href="plfa.Substitution.html#28836" class="Bound">Γ</a><a id="28837" class="Symbol">}</a> <a id="28839" class="Symbol">{</a><a id="28840" href="plfa.Substitution.html#28840" class="Bound">A</a><a id="28841" class="Symbol">}</a> <a id="28843" class="Symbol">{</a><a id="28844" href="plfa.Substitution.html#28844" class="Bound">B</a><a id="28845" class="Symbol">}</a> <a id="28847" class="Symbol">{</a><a id="28848" href="plfa.Substitution.html#28848" class="Bound">C</a><a id="28849" class="Symbol">}</a> <a id="28851" href="plfa.Substitution.html#28851" class="Bound">N</a> <a id="28853" href="plfa.Substitution.html#28853" class="Bound">M</a> <a id="28855" class="Symbol">=</a>
   <a id="28860" href="/PLFA-zh/Untyped/#6921" class="Function">subst</a> <a id="28866" class="Symbol">{</a><a id="28867" href="/PLFA-zh/Substitution/#28836" class="Bound">Γ</a> <a id="28869" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="28871" href="plfa.Substitution.html#28844" class="Bound">B</a> <a id="28873" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="28875" href="plfa.Substitution.html#28848" class="Bound">C</a><a id="28876" class="Symbol">}</a> <a id="28878" class="Symbol">{</a><a id="28879" href="plfa.Substitution.html#28836" class="Bound">Γ</a> <a id="28881" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="28883" href="plfa.Substitution.html#28848" class="Bound">C</a><a id="28884" class="Symbol">}</a> <a id="28886" class="Symbol">(</a><a id="28887" href="plfa.Untyped.html#6629" class="Function">exts</a> <a id="28892" class="Symbol">(</a><a id="28893" href="plfa.Untyped.html#7333" class="Function">subst-zero</a> <a id="28904" href="plfa.Substitution.html#28853" class="Bound">M</a><a id="28905" class="Symbol">))</a> <a id="28908" class="Symbol">{</a><a id="28909" href="plfa.Substitution.html#28840" class="Bound">A</a><a id="28910" class="Symbol">}</a> <a id="28912" href="plfa.Substitution.html#28851" class="Bound">N</a>
</pre>
<p>The substitution lemma is stated as follows and proved as a corollary
of the <code class="highlighter-rouge">subst-commute</code> lemma.</p>

<pre class="Agda"><a id="substitution"></a><a id="29024" href="/PLFA-zh/Substitution/#29024" class="Function">substitution</a> <a id="29037" class="Symbol">:</a> <a id="29039" class="Symbol">∀{</a><a id="29041" href="plfa.Substitution.html#29041" class="Bound">Γ</a><a id="29042" class="Symbol">}{</a><a id="29044" href="plfa.Substitution.html#29044" class="Bound">M</a> <a id="29046" class="Symbol">:</a> <a id="29048" href="plfa.Substitution.html#29041" class="Bound">Γ</a> <a id="29050" href="/PLFA-zh/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="29052" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="29054" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="29056" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="29058" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="29060" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="29061" class="Symbol">}{</a><a id="29063" href="plfa.Substitution.html#29063" class="Bound">N</a> <a id="29065" class="Symbol">:</a> <a id="29067" href="plfa.Substitution.html#29041" class="Bound">Γ</a> <a id="29069" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="29071" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="29073" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="29075" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="29076" class="Symbol">}{</a><a id="29078" href="plfa.Substitution.html#29078" class="Bound">L</a> <a id="29080" class="Symbol">:</a> <a id="29082" href="plfa.Substitution.html#29041" class="Bound">Γ</a> <a id="29084" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="29086" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="29087" class="Symbol">}</a>
    <a id="29093" class="Symbol">→</a> <a id="29095" class="Symbol">(</a><a id="29096" href="/PLFA-zh/Substitution/#29044" class="Bound">M</a> <a id="29098" href="/PLFA-zh/Untyped/#7449" class="Function Operator">[</a> <a id="29100" href="plfa.Substitution.html#29063" class="Bound">N</a> <a id="29102" href="plfa.Untyped.html#7449" class="Function Operator">]</a><a id="29103" class="Symbol">)</a> <a id="29105" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="29107" href="plfa.Substitution.html#29078" class="Bound">L</a> <a id="29109" href="plfa.Untyped.html#7449" class="Function Operator">]</a> <a id="29111" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="29113" class="Symbol">(</a><a id="29114" href="plfa.Substitution.html#29044" class="Bound">M</a> <a id="29116" href="plfa.Substitution.html#28731" class="Function Operator">〔</a> <a id="29118" href="plfa.Substitution.html#29078" class="Bound">L</a> <a id="29120" href="plfa.Substitution.html#28731" class="Function Operator">〕</a><a id="29121" class="Symbol">)</a> <a id="29123" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="29125" class="Symbol">(</a><a id="29126" href="plfa.Substitution.html#29063" class="Bound">N</a> <a id="29128" href="plfa.Untyped.html#7449" class="Function Operator">[</a> <a id="29130" href="plfa.Substitution.html#29078" class="Bound">L</a> <a id="29132" href="plfa.Untyped.html#7449" class="Function Operator">]</a><a id="29133" class="Symbol">)</a> <a id="29135" href="plfa.Untyped.html#7449" class="Function Operator">]</a>
<a id="29137" href="/PLFA-zh/Substitution/#29024" class="Function">substitution</a><a id="29149" class="Symbol">{</a><a id="29150" class="Argument">M</a> <a id="29152" class="Symbol">=</a> <a id="29154" href="plfa.Substitution.html#29154" class="Bound">M</a><a id="29155" class="Symbol">}{</a><a id="29157" class="Argument">N</a> <a id="29159" class="Symbol">=</a> <a id="29161" href="plfa.Substitution.html#29161" class="Bound">N</a><a id="29162" class="Symbol">}{</a><a id="29164" class="Argument">L</a> <a id="29166" class="Symbol">=</a> <a id="29168" href="plfa.Substitution.html#29168" class="Bound">L</a><a id="29169" class="Symbol">}</a> <a id="29171" class="Symbol">=</a>
   <a id="29176" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="29180" class="Symbol">(</a><a id="29181" href="/PLFA-zh/Substitution/#26453" class="Function">subst-commute</a><a id="29194" class="Symbol">{</a><a id="29195" class="Argument">N</a> <a id="29197" class="Symbol">=</a> <a id="29199" href="plfa.Substitution.html#29154" class="Bound">M</a><a id="29200" class="Symbol">}{</a><a id="29202" class="Argument">M</a> <a id="29204" class="Symbol">=</a> <a id="29206" href="plfa.Substitution.html#29161" class="Bound">N</a><a id="29207" class="Symbol">}{</a><a id="29209" class="Argument">σ</a> <a id="29211" class="Symbol">=</a> <a id="29213" href="/PLFA-zh/Untyped/#7333" class="Function">subst-zero</a> <a id="29224" href="plfa.Substitution.html#29168" class="Bound">L</a><a id="29225" class="Symbol">})</a>
</pre>

<h2 id="notes">Notes</h2>

<p>Most of the properties and proofs in this file are based on the paper
<em>Autosubst: Reasoning with de Bruijn Terms and Parallel Substitution</em>
by Schafer, Tebbi, and Smolka (ITP 2015). That paper, in turn, is
based on the paper of Abadi, Cardelli, Curien, and Levy (1991) that
defines the σ algebra.</p>

<h2 id="unicode">Unicode</h2>

<p>This chapter uses the following unicode:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>⟪  U+27EA  MATHEMATICAL LEFT DOUBLE ANGLE BRACKET (\&lt;&lt;)
⟫  U+27EA  MATHEMATICAL RIGHT DOUBLE ANGLE BRACKET (\&gt;&gt;)
↑  U+2191  UPWARDS ARROW (\u)
•  U+2022  BULLET (\bub)
⨟  U+2A1F  Z NOTATION SCHEMA COMPOSITION (C-x 8 RET Z NOTATION SCHEMA COMPOSITION)
〔  U+3014  LEFT TORTOISE SHELL BRACKET (\( option 9 on page 2)
〕  U+3015  RIGHT TORTOISE SHELL BRACKET (\) option 9 on page 2)
</code></pre></div></div>

  </div>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/PLFA-zh/ContextualEquivalence/">上一章</a>
    
    
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/Agda-zh/PLFA-zh/blob/dev/src/plfa/Substitution.lagda.md">源代码</a>
    
    
    &bullet;
    
    
    <a alt="Next chapter" href="/PLFA-zh/Acknowledgements/">下一章</a>
    
</p>


</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/PLFA-zh/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">编程语言基础：Agda 语言描述
</h2>

    <h3 class="footer-heading">原作者：</h3><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Philip Wadler</li>
          <li><a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wadler"><svg class="svg-icon"><use xlink:href="/PLFA-zh/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wadler</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wen Kokke</li>
          <li><a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wenkokke"><svg class="svg-icon"><use xlink:href="/PLFA-zh/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wenkokke</span></a></li><li><a href="https://www.twitter.com/wenkokke"><svg class="svg-icon"><use xlink:href="/PLFA-zh/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">wenkokke</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><h3 class="footer-heading">本章暂无翻译</h3>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">创作共用-署名 4.0 国际（CC BY 4.0）许可协议</a>授权。<br />
  </div>
</footer>
<!-- Import jQuery -->
<script type="text/javascript" src="/PLFA-zh/assets/jquery.js"></script>

<!-- Script which draws background for progress tags -->
<script type="text/javascript">
$('span.progress').each(function(){
    const progress = parseInt($(this).text());
    $(this).css({
        'border-style': 'solid',
        'border-radius': '5px',
        'border-width': 'thin',
        'border-color': progress === 100 ? 'limegreen' : 'dimgray',
        'font-size': '70%',
        'padding': '0% 0.5% 0% 0.5%',
        'margin': '0em 0em 0em 0.5em',
        'box-sizing': 'border-box',
        'vertical-align': '10%'
    });
    $(this).text(progress.toString() + " %");
})
</script>

<!-- Script which allows for foldable code blocks -->
<script type="text/javascript">

 // Makes sandwhich menu works
 $('.menu-icon').click(function(){
   $('.trigger').toggle();
 });

 // Script which allows for foldable code blocks
 $('div.foldable pre').each(function(){
     var autoHeight = $(this).height();
     var lineHeight = parseFloat($(this).css('line-height'));

     var plus    = $("<div></div>");
     var horLine = $("<div></div>");
     var verLine = $("<div></div>");
     $(this).prepend(plus);
     plus.css({
         'position'         : 'relative',
         'float'            : 'right',
         'right'            : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'width'            : lineHeight,
         'height'           : lineHeight});
     verLine.css({
         'position'         : 'relative',
         'height'           : lineHeight,
         'width'            : '3px',
         'background-color' : '#C1E0FF'});
     horLine.css({
         'position'         : 'relative',
         'top'              : '-' + (0.5 * lineHeight + 1.5) + 'px',
         'left'             : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'height'           : '3px',
         'width'            : lineHeight,
         'background-color' : '#C1E0FF'});
     plus.append(verLine);
     plus.append(horLine);

     $(this).height(2.0 * lineHeight);
     $(this).css('overflow','hidden');

     $(this).click(function(){
         if ($(this).height() == autoHeight) {
             $(this).height(2.0 * lineHeight);
             plus.show();
         }
         else {
             $(this).height('auto');
             plus.hide();
         }
     });
 });
</script>

<!-- Import KaTeX -->
<script type="text/javascript" src="/PLFA-zh/assets/katex.js"></script>

<!-- Script which renders TeX using KaTeX -->
<script type="text/javascript">
 $("script[type='math/tex']").replaceWith(
     function(){
         var tex = $(this).text();
         return "<span class=\"inline-equation\">" +
                katex.renderToString(tex) +
                "</span>";
     });
 $("script[type='math/tex; mode=display']").replaceWith(
     function(){
         var tex = $(this).text().replace(/%.*?(\n|$)/g,"");
         return "<div class=\"equation\">" +
                katex.renderToString("\\displaystyle "+tex) +
                "</div>";
     });
</script>
</body>

</html>
